import{Q as _e,A as O}from"./Skeleton-DP44cgo5.js";import{r as y,h as me,m as Ae,k as Oe,o as be,j as oe,g as D}from"./vendors-Dtot3KuJ.js";import{ar as z,r as f,O as E,as as R,at as Ie,au as Re,H as ae,W as Se,a4 as I,ah as ve,av as w,I as g,_ as C,aw as Ce,A as ie,Z as Ne}from"./index-rYEy9Y7-.js";import{d as T}from"./ton-JVN5BOEN.js";class b{data;type;status;queryId;createdAt;constructor(e){this.data=e,this.type=e.type,this.status=e.status,this.queryId=e.queryId,this.createdAt=e.createdAt}}class A{type;transactions;operationId;status;createdAt;isFulfilled;isFinalized;constructor(e){this.type=e.type,this.transactions=e.transactions,this.createdAt=e.transactions[0].createdAt,this.operationId=this.transactions.map(s=>s.queryId).join(""),this.status=e.overrideStatus??[...e.transactions].sort((s,r)=>z[s.status]-z[r.status])[0].status,this.isFulfilled=this.transactions.every(s=>[f.FULFILLED_ERROR,f.FULFILLED_SUCCESS].includes(s.status)),this.isFinalized=[E.UNKNOWN,E.CANCELED,E.FINALIZED_SUCCESS,E.FINALIZED_ERROR].includes(this.status)}getTransactionsByType(e){return this.transactions.filter(s=>s.type===e)}getTransactionByType(e){return this.getTransactionsByType(e).at(0)}isStatusBefore(e){return R[this.status]<R[e]}isStatus(e){return this.status===e}isStatusAfter(e){return R[this.status]>R[e]}}var ce=y.createContext(!1),xe=()=>y.useContext(ce);ce.Provider;function Le(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var Ue=y.createContext(Le()),Pe=()=>y.useContext(Ue);function ke(t,e){return typeof t=="function"?t(...e):!!t}var Fe=(t,e)=>{(t.suspense||t.throwOnError)&&(e.isReset()||(t.retryOnMount=!1))},Be=t=>{y.useEffect(()=>{t.clearReset()},[t])},Me=({result:t,errorResetBoundary:e,throwOnError:s,query:r})=>t.isError&&!e.isReset()&&!t.isFetching&&r&&ke(s,[t.error,r]),je=t=>{t.suspense&&typeof t.staleTime!="number"&&(t.staleTime=1e3)},$e=(t,e)=>t?.suspense&&e.isPending,qe=(t,e,s)=>e.fetchOptimistic(t).catch(()=>{s.clearReset()});function De(t,e,s){const r=Ie(),o=xe(),a=Pe(),c=r.defaultQueryOptions(t);c._optimisticResults=o?"isRestoring":"optimistic",je(c),Fe(c,a),Be(a);const[i]=y.useState(()=>new e(r,c)),u=i.getOptimisticResult(c);if(y.useSyncExternalStore(y.useCallback(l=>{const n=o?()=>{}:i.subscribe(Re.batchCalls(l));return i.updateResult(),n},[i,o]),()=>i.getCurrentResult(),()=>i.getCurrentResult()),y.useEffect(()=>{i.setOptions(c,{listeners:!1})},[c,i]),$e(c,u))throw qe(c,i,a);if(Me({result:u,errorResetBoundary:a,throwOnError:c.throwOnError,query:r.getQueryCache().get(c.queryHash)}))throw u.error;return c.notifyOnChangeProps?u:i.trackResult(u)}function _s(t,e){return De(t,_e)}var ze=Object.defineProperty,We=Object.getOwnPropertyDescriptor,B=(t,e,s,r)=>{for(var o=r>1?void 0:r?We(e,s):e,a=t.length-1,c;a>=0;a--)(c=t[a])&&(o=(r?c(e,s,o):c(o))||o);return r&&o&&ze(e,s,o),o};let v=class{constructor(e){this.dependencies=e,Ae(this),Oe(()=>e.WalletStore.wallet?.key,()=>this.operationsMap.clear())}operationsMap=be.map();get operations(){return[...this.operationsMap.values()].sort((e,s)=>s.createdAt.getTime()-e.createdAt.getTime())}get hasPendingOperation(){return this.operations.some(e=>this.isPendingOperation(e))}getPendingOperations=()=>this.operations.filter(e=>this.isPendingOperation(e));getPendingOperationsByType=e=>this.getPendingOperations().filter(s=>this.isPendingOperation(s)&&s.type===e);getOperationById=e=>this.operationsMap.get(e)??null;updateOperation=e=>{this.operationsMap.set(e.operationId,e),this.dependencies.logger.log("updateOperation",e)};isPendingOperation(e){return!e.isFinalized}};B([oe],v.prototype,"operations",1);B([oe],v.prototype,"hasPendingOperation",1);B([me.bound],v.prototype,"updateOperation",2);const As=new v({logger:ae.child("stores","OperationsStore"),WalletStore:Se}),He=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,Ge=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,Ye=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function Qe(t,e){if(t==="__proto__"||t==="constructor"&&e&&typeof e=="object"&&"prototype"in e){Je(t);return}return e}function Je(t){console.warn(`[destr] Dropping "${t}" key to prevent prototype pollution.`)}function Ve(t,e={}){if(typeof t!="string")return t;const s=t.trim();if(t[0]==='"'&&t.at(-1)==='"'&&!t.includes("\\"))return s.slice(1,-1);if(s.length<=9){const r=s.toLowerCase();if(r==="true")return!0;if(r==="false")return!1;if(r==="undefined")return;if(r==="null")return null;if(r==="nan")return Number.NaN;if(r==="infinity")return Number.POSITIVE_INFINITY;if(r==="-infinity")return Number.NEGATIVE_INFINITY}if(!Ye.test(t)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return t}try{if(He.test(t)||Ge.test(t)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(t,Qe)}return JSON.parse(t)}catch(r){if(e.strict)throw r;return t}}const Ze=/#/g,Ke=/&/g,Xe=/=/g,M=/\+/g,et=/%5e/gi,tt=/%60/gi,st=/%7c/gi,rt=/%20/gi;function nt(t){return encodeURI(""+t).replace(st,"|")}function U(t){return nt(typeof t=="string"?t:JSON.stringify(t)).replace(M,"%2B").replace(rt,"+").replace(Ze,"%23").replace(Ke,"%26").replace(tt,"`").replace(et,"^")}function N(t){return U(t).replace(Xe,"%3D")}function ue(t=""){try{return decodeURIComponent(""+t)}catch{return""+t}}function ot(t){return ue(t.replace(M," "))}function at(t){return ue(t.replace(M," "))}function it(t=""){const e={};t[0]==="?"&&(t=t.slice(1));for(const s of t.split("&")){const r=s.match(/([^=]+)=?(.*)/)||[];if(r.length<2)continue;const o=ot(r[1]);if(o==="__proto__"||o==="constructor")continue;const a=at(r[2]||"");e[o]===void 0?e[o]=a:Array.isArray(e[o])?e[o].push(a):e[o]=[e[o],a]}return e}function ct(t,e){return(typeof e=="number"||typeof e=="boolean")&&(e=String(e)),e?Array.isArray(e)?e.map(s=>`${N(t)}=${U(s)}`).join("&"):`${N(t)}=${U(e)}`:N(t)}function ut(t){return Object.keys(t).filter(e=>t[e]!==void 0).map(e=>ct(e,t[e])).filter(Boolean).join("&")}const lt=/^[\s\w\0+.-]{2,}:([/\\]{1,2})/,pt=/^[\s\w\0+.-]{2,}:([/\\]{2})?/,ht=/^([/\\]\s*){2,}[^/\\]/;function le(t,e={}){return typeof e=="boolean"&&(e={acceptRelative:e}),e.strict?lt.test(t):pt.test(t)||(e.acceptRelative?ht.test(t):!1)}function dt(t="",e){return t.endsWith("/")}function ft(t="",e){return(dt(t)?t.slice(0,-1):t)||"/"}function yt(t="",e){return t.endsWith("/")?t:t+"/"}function gt(t,e){if(Tt(e)||le(t))return t;const s=ft(e);return t.startsWith(s)?t:mt(s,t)}function Et(t,e){const s=At(t),r={...it(s.search),...e};return s.search=ut(r),Ot(s)}function Tt(t){return!t||t==="/"}function wt(t){return t&&t!=="/"}const _t=/^\.?\//;function mt(t,...e){let s=t||"";for(const r of e.filter(o=>wt(o)))if(s){const o=r.replace(_t,"");s=yt(s)+o}else s=r;return s}function At(t="",e){const s=t.match(/^[\s\0]*(blob:|data:|javascript:|vbscript:)(.*)/i);if(s){const[,p,h=""]=s;return{protocol:p.toLowerCase(),pathname:h,href:p+h,auth:"",host:"",search:"",hash:""}}if(!le(t,{acceptRelative:!0}))return W(t);const[,r="",o,a=""]=t.replace(/\\/g,"/").match(/^[\s\0]*([\w+.-]{2,}:)?\/\/([^/@]+@)?(.*)/)||[],[,c="",i=""]=a.match(/([^#/?]*)(.*)?/)||[],{pathname:u,search:l,hash:n}=W(i.replace(/\/(?=[A-Za-z]:)/,""));return{protocol:r.toLowerCase(),auth:o?o.slice(0,Math.max(0,o.length-1)):"",host:c,pathname:u,search:l,hash:n}}function W(t=""){const[e="",s="",r=""]=(t.match(/([^#?]*)(\?[^#]*)?(#.*)?/)||[]).splice(1);return{pathname:e,search:s,hash:r}}function Ot(t){const e=t.pathname||"",s=t.search?(t.search.startsWith("?")?"":"?")+t.search:"",r=t.hash||"",o=t.auth?t.auth+"@":"",a=t.host||"";return(t.protocol?t.protocol+"//":"")+o+a+e+s+r}class bt extends Error{constructor(e,s){super(e,s),this.name="FetchError",s!=null&&s.cause&&!this.cause&&(this.cause=s.cause)}}function It(t){var e,s,r,o,a;const c=((e=t.error)==null?void 0:e.message)||((s=t.error)==null?void 0:s.toString())||"",i=((r=t.request)==null?void 0:r.method)||((o=t.options)==null?void 0:o.method)||"GET",u=((a=t.request)==null?void 0:a.url)||String(t.request)||"/",l=`[${i}] ${JSON.stringify(u)}`,n=t.response?`${t.response.status} ${t.response.statusText}`:"<no response>",p=`${l}: ${n}${c?` ${c}`:""}`,h=new bt(p,t.error?{cause:t.error}:void 0);for(const d of["request","options","response"])Object.defineProperty(h,d,{get(){return t[d]}});for(const[d,we]of[["data","_data"],["status","status"],["statusCode","status"],["statusText","statusText"],["statusMessage","statusText"]])Object.defineProperty(h,d,{get(){return t.response&&t.response[we]}});return h}const Rt=new Set(Object.freeze(["PATCH","POST","PUT","DELETE"]));function H(t="GET"){return Rt.has(t.toUpperCase())}function St(t){if(t===void 0)return!1;const e=typeof t;return e==="string"||e==="number"||e==="boolean"||e===null?!0:e!=="object"?!1:Array.isArray(t)?!0:t.buffer?!1:t.constructor&&t.constructor.name==="Object"||typeof t.toJSON=="function"}const vt=new Set(["image/svg","application/xml","application/xhtml","application/html"]),Ct=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function Nt(t=""){if(!t)return"json";const e=t.split(";").shift()||"";return Ct.test(e)?"json":vt.has(e)||e.startsWith("text/")?"text":"blob"}function xt(t,e,s=globalThis.Headers){const r={...e,...t};if(e!=null&&e.params&&t!=null&&t.params&&(r.params={...e?.params,...t?.params}),e!=null&&e.query&&t!=null&&t.query&&(r.query={...e?.query,...t?.query}),e!=null&&e.headers&&t!=null&&t.headers){r.headers=new s(e?.headers||{});for(const[o,a]of new s(t?.headers||{}))r.headers.set(o,a)}return r}const Lt=new Set([408,409,425,429,500,502,503,504]),Ut=new Set([101,204,205,304]);function pe(t={}){const{fetch:e=globalThis.fetch,Headers:s=globalThis.Headers,AbortController:r=globalThis.AbortController}=t;async function o(i){const u=i.error&&i.error.name==="AbortError"&&!i.options.timeout||!1;if(i.options.retry!==!1&&!u){let n;typeof i.options.retry=="number"?n=i.options.retry:n=H(i.options.method)?0:1;const p=i.response&&i.response.status||500;if(n>0&&(Array.isArray(i.options.retryStatusCodes)?i.options.retryStatusCodes.includes(p):Lt.has(p))){const h=i.options.retryDelay||0;return h>0&&await new Promise(d=>setTimeout(d,h)),a(i.request,{...i.options,retry:n-1,timeout:i.options.timeout})}}const l=It(i);throw Error.captureStackTrace&&Error.captureStackTrace(l,a),l}const a=async function(i,u={}){var l;const n={request:i,options:xt(u,t.defaults,s),response:void 0,error:void 0};if(n.options.method=(l=n.options.method)==null?void 0:l.toUpperCase(),n.options.onRequest&&await n.options.onRequest(n),typeof n.request=="string"&&(n.options.baseURL&&(n.request=gt(n.request,n.options.baseURL)),(n.options.query||n.options.params)&&(n.request=Et(n.request,{...n.options.params,...n.options.query}))),n.options.body&&H(n.options.method)&&(St(n.options.body)?(n.options.body=typeof n.options.body=="string"?n.options.body:JSON.stringify(n.options.body),n.options.headers=new s(n.options.headers||{}),n.options.headers.has("content-type")||n.options.headers.set("content-type","application/json"),n.options.headers.has("accept")||n.options.headers.set("accept","application/json")):("pipeTo"in n.options.body&&typeof n.options.body.pipeTo=="function"||typeof n.options.body.pipe=="function")&&("duplex"in n.options||(n.options.duplex="half"))),!n.options.signal&&n.options.timeout){const p=new r;setTimeout(()=>p.abort(),n.options.timeout),n.options.signal=p.signal}try{n.response=await e(n.request,n.options)}catch(p){return n.error=p,n.options.onRequestError&&await n.options.onRequestError(n),await o(n)}if(n.response.body&&!Ut.has(n.response.status)&&n.options.method!=="HEAD"){const p=(n.options.parseResponse?"json":n.options.responseType)||Nt(n.response.headers.get("content-type")||"");switch(p){case"json":{const h=await n.response.text(),d=n.options.parseResponse||Ve;n.response._data=d(h);break}case"stream":{n.response._data=n.response.body;break}default:n.response._data=await n.response[p]()}}return n.options.onResponse&&await n.options.onResponse(n),!n.options.ignoreResponseError&&n.response.status>=400&&n.response.status<600?(n.options.onResponseError&&await n.options.onResponseError(n),await o(n)):n.response},c=async function(i,u){return(await a(i,u))._data};return c.raw=a,c.native=(...i)=>e(...i),c.create=(i={})=>pe({...t,defaults:{...t.defaults,...i}}),c}const j=function(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof D<"u")return D;throw new Error("unable to locate global object")}(),Pt=j.fetch||(()=>Promise.reject(new Error("[ofetch] global.fetch is not supported!"))),kt=j.Headers,Ft=j.AbortController,Bt=pe({fetch:Pt,Headers:kt,AbortController:Ft});function Mt(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var $={exports:{}};const he=t=>typeof t=="object"&&t!==null,de=Symbol("skip"),G=t=>he(t)&&!(t instanceof RegExp)&&!(t instanceof Error)&&!(t instanceof Date),P=(t,e,s,r=new WeakMap)=>{if(s={deep:!1,target:{},...s},r.has(t))return r.get(t);r.set(t,s.target);const{target:o}=s;delete s.target;const a=c=>c.map(i=>G(i)?P(i,e,s,r):i);if(Array.isArray(t))return a(t);for(const[c,i]of Object.entries(t)){const u=e(c,i,t);if(u===de)continue;let[l,n,{shouldRecurse:p=!0}={}]=u;l!=="__proto__"&&(s.deep&&p&&G(n)&&(n=Array.isArray(n)?a(n):P(n,e,s,r)),o[l]=n)}return o};$.exports=(t,e,s)=>{if(!he(t))throw new TypeError(`Expected an object, got \`${t}\` (${typeof t})`);return P(t,e,s)};$.exports.mapObjectSkip=de;var jt=$.exports;const Y=Mt(jt);class fe extends Map{constructor(e={}){if(super(),!(e.maxSize&&e.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof e.maxAge=="number"&&e.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=e.maxSize,this.maxAge=e.maxAge||Number.POSITIVE_INFINITY,this.onEviction=e.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(e){if(typeof this.onEviction=="function")for(const[s,r]of e)this.onEviction(s,r.value)}_deleteIfExpired(e,s){return typeof s.expiry=="number"&&s.expiry<=Date.now()?(typeof this.onEviction=="function"&&this.onEviction(e,s.value),this.delete(e)):!1}_getOrDeleteIfExpired(e,s){if(this._deleteIfExpired(e,s)===!1)return s.value}_getItemValue(e,s){return s.expiry?this._getOrDeleteIfExpired(e,s):s.value}_peek(e,s){const r=s.get(e);return this._getItemValue(e,r)}_set(e,s){this.cache.set(e,s),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(e,s){this.oldCache.delete(e),this._set(e,s)}*_entriesAscending(){for(const e of this.oldCache){const[s,r]=e;this.cache.has(s)||this._deleteIfExpired(s,r)===!1&&(yield e)}for(const e of this.cache){const[s,r]=e;this._deleteIfExpired(s,r)===!1&&(yield e)}}get(e){if(this.cache.has(e)){const s=this.cache.get(e);return this._getItemValue(e,s)}if(this.oldCache.has(e)){const s=this.oldCache.get(e);if(this._deleteIfExpired(e,s)===!1)return this._moveToRecent(e,s),s.value}}set(e,s,{maxAge:r=this.maxAge}={}){const o=typeof r=="number"&&r!==Number.POSITIVE_INFINITY?Date.now()+r:void 0;return this.cache.has(e)?this.cache.set(e,{value:s,expiry:o}):this._set(e,{value:s,expiry:o}),this}has(e){return this.cache.has(e)?!this._deleteIfExpired(e,this.cache.get(e)):this.oldCache.has(e)?!this._deleteIfExpired(e,this.oldCache.get(e)):!1}peek(e){if(this.cache.has(e))return this._peek(e,this.cache);if(this.oldCache.has(e))return this._peek(e,this.oldCache)}delete(e){const s=this.cache.delete(e);return s&&this._size--,this.oldCache.delete(e)||s}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(e){if(!(e&&e>0))throw new TypeError("`maxSize` must be a number greater than 0");const s=[...this._entriesAscending()],r=s.length-e;r<0?(this.cache=new Map(s),this.oldCache=new Map,this._size=s.length):(r>0&&this._emitEvictions(s.slice(0,r)),this.oldCache=new Map(s.slice(r)),this.cache=new Map,this._size=0),this.maxSize=e}*keys(){for(const[e]of this)yield e}*values(){for(const[,e]of this)yield e}*[Symbol.iterator](){for(const e of this.cache){const[s,r]=e;this._deleteIfExpired(s,r)===!1&&(yield[s,r.value])}for(const e of this.oldCache){const[s,r]=e;this.cache.has(s)||this._deleteIfExpired(s,r)===!1&&(yield[s,r.value])}}*entriesDescending(){let e=[...this.cache];for(let s=e.length-1;s>=0;--s){const r=e[s],[o,a]=r;this._deleteIfExpired(o,a)===!1&&(yield[o,a.value])}e=[...this.oldCache];for(let s=e.length-1;s>=0;--s){const r=e[s],[o,a]=r;this.cache.has(o)||this._deleteIfExpired(o,a)===!1&&(yield[o,a.value])}}*entriesAscending(){for(const[e,s]of this._entriesAscending())yield[e,s.value]}get size(){if(!this._size)return this.oldCache.size;let e=0;for(const s of this.oldCache.keys())this.cache.has(s)||e++;return Math.min(this._size+e,this.maxSize)}entries(){return this.entriesAscending()}forEach(e,s=this){for(const[r,o]of this.entriesAscending())e.call(s,o,r,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}const $t=(t,e)=>(t=t.replace(new RegExp("((?<![\\p{Uppercase_Letter}\\d])[\\p{Uppercase_Letter}\\d](?![\\p{Uppercase_Letter}\\d]))","gu"),s=>s.toLowerCase()),t.replace(new RegExp("(\\p{Uppercase_Letter}+)(\\p{Uppercase_Letter}\\p{Lowercase_Letter}+)","gu"),(s,r,o)=>r+e+o.toLowerCase()));function qt(t,{separator:e="_",preserveConsecutiveUppercase:s=!1}={}){if(!(typeof t=="string"&&typeof e=="string"))throw new TypeError("The `text` and `separator` arguments should be of type `string`");if(t.length<2)return s?t:t.toLowerCase();const r=`$1${e}$2`,o=t.replace(new RegExp("([\\p{Lowercase_Letter}\\d])(\\p{Uppercase_Letter})","gu"),r);return s?$t(o,e):o.replace(new RegExp("(\\p{Uppercase_Letter})(\\p{Uppercase_Letter}\\p{Lowercase_Letter}+)","gu"),r).toLowerCase()}const Dt=(t,e)=>t.some(s=>typeof s=="string"?s===e:(s.lastIndex=0,s.test(e))),x=new fe({maxSize:1e5}),Q=t=>typeof t=="object"&&t!==null&&!(t instanceof RegExp)&&!(t instanceof Error)&&!(t instanceof Date),J=(t,e={})=>{if(!Q(t))return t;const{separator:s="_",exclude:r,deep:o=!1}=e,a=c=>(i,u)=>{if(o&&Q(u)&&(u=Y(u,a())),!(r&&Dt(r,i))){const l=`${s}${i}`;if(x.has(l))i=x.get(l);else{const n=qt(i,{separator:s});i.length<100&&x.set(l,n),i=n}}return[i,u]};return Y(t,a())};function zt(t,e){return Array.isArray(t)?Object.keys(t).map(s=>J(t[s],e)):J(t,e)}function Wt(t){return zt(t,{deep:!0})}function V(t){let e=t;for(;e.indexOf("/")>=0;)e=e.replace("/","_");for(;e.indexOf("+")>=0;)e=e.replace("+","-");for(;e.indexOf("=")>=0;)e=e.replace("=","");return e}function _(t,e){const s=t.replace(/{([a-zA-Z0-9_]+)}/g,(r,o)=>{var a,c;const i=(a=e?.query)==null?void 0:a[o];if(!i)throw new Error(`Missing value for path parameter "${o}"`);return(c=e?.query)==null||delete c[o],V(i)});if(e!=null&&e.query){for(const r in e.query){const o=e.query[r];typeof o=="string"&&(e.query[r]=V(o))}e.query=Wt(e.query)}return[s,e]}const ye=t=>typeof t=="object"&&t!==null,Z=t=>ye(t)&&!(t instanceof RegExp)&&!(t instanceof Error)&&!(t instanceof Date),Ht=Symbol("mapObjectSkip"),k=(t,e,s,r=new WeakMap)=>{if(s={deep:!1,target:{},...s},r.has(t))return r.get(t);r.set(t,s.target);const{target:o}=s;delete s.target;const a=c=>c.map(i=>Z(i)?k(i,e,s,r):i);if(Array.isArray(t))return a(t);for(const[c,i]of Object.entries(t)){const u=e(c,i,t);if(u===Ht)continue;let[l,n,{shouldRecurse:p=!0}={}]=u;l!=="__proto__"&&(s.deep&&p&&Z(n)&&(n=Array.isArray(n)?a(n):k(n,e,s,r)),o[l]=n)}return o};function K(t,e,s){if(!ye(t))throw new TypeError(`Expected an object, got \`${t}\` (${typeof t})`);return k(t,e,s)}const Gt=/[\p{Lu}]/u,Yt=/[\p{Ll}]/u,X=/^[\p{Lu}](?![\p{Lu}])/gu,ge=/([\p{Alpha}\p{N}_]|$)/u,q=/[_.\- ]+/,Qt=new RegExp("^"+q.source),ee=new RegExp(q.source+ge.source,"gu"),te=new RegExp("\\d+"+ge.source,"gu"),Jt=(t,e,s,r)=>{let o=!1,a=!1,c=!1,i=!1;for(let u=0;u<t.length;u++){const l=t[u];i=u>2?t[u-3]==="-":!0,o&&Gt.test(l)?(t=t.slice(0,u)+"-"+t.slice(u),o=!1,c=a,a=!0,u++):a&&c&&Yt.test(l)&&(!i||r)?(t=t.slice(0,u-1)+"-"+t.slice(u-1),c=a,a=!1,o=!0):(o=e(l)===l&&s(l)!==l,c=a,a=s(l)===l&&e(l)!==l)}return t},Vt=(t,e)=>(X.lastIndex=0,t.replaceAll(X,s=>e(s))),Zt=(t,e)=>(ee.lastIndex=0,te.lastIndex=0,t.replaceAll(te,(s,r,o)=>["_","-"].includes(t.charAt(o+s.length))?s:e(s)).replaceAll(ee,(s,r)=>e(r)));function Kt(t,e){if(!(typeof t=="string"||Array.isArray(t)))throw new TypeError("Expected the input to be `string | string[]`");if(e={pascalCase:!1,preserveConsecutiveUppercase:!1,...e},Array.isArray(t)?t=t.map(o=>o.trim()).filter(o=>o.length).join("-"):t=t.trim(),t.length===0)return"";const s=e.locale===!1?o=>o.toLowerCase():o=>o.toLocaleLowerCase(e.locale),r=e.locale===!1?o=>o.toUpperCase():o=>o.toLocaleUpperCase(e.locale);return t.length===1?q.test(t)?"":e.pascalCase?r(t):s(t):(t!==s(t)&&(t=Jt(t,s,r,e.preserveConsecutiveUppercase)),t=t.replace(Qt,""),t=e.preserveConsecutiveUppercase?Vt(t,s):s(t),e.pascalCase&&(t=r(t.charAt(0))+t.slice(1)),Zt(t,r))}const Xt=(t,e)=>t.some(s=>typeof s=="string"?s===e:(s.lastIndex=0,s.test(e))),L=new fe({maxSize:1e5}),se=t=>typeof t=="object"&&t!==null&&!(t instanceof RegExp)&&!(t instanceof Error)&&!(t instanceof Date),re=(t,e={})=>{if(!se(t))return t;const{exclude:s,pascalCase:r=!1,stopPaths:o,deep:a=!1,preserveConsecutiveUppercase:c=!1}=e,i=new Set(o),u=l=>(n,p)=>{if(a&&se(p)){const h=l===void 0?n:`${l}.${n}`;i.has(h)||(p=K(p,u(h)))}if(!(s&&Xt(s,n))){const h=r?`${n}_`:n;if(L.has(h))n=L.get(h);else{const d=Kt(n,{pascalCase:r,locale:!1,preserveConsecutiveUppercase:c});n.length<100&&L.set(h,d),n=d}}return[n,p]};return K(t,u(void 0))};function es(t,e){return Array.isArray(t)?Object.keys(t).map(s=>re(t[s],e)):re(t,e)}function ts(t){return es(t,{deep:!0})}function Ee(t){const e={};for(const s in t){const r=t[s];e[s]=r===null?void 0:r&&typeof r=="object"&&r.__proto__.constructor===Object?Ee(r):r}return e}function m(t){return Ee(ts(t))}class Te{constructor(e){const s=new URL(e?.baseUrl??"https://api.ston.fi"),r=[...new URLSearchParams(s.search)].reduce((o,[a,c])=>({...o,[a]:c}),{});this.apiFetch=Bt.create({baseURL:`${s.origin}${s.pathname}`,query:r})}async getAssets(){return m(await this.apiFetch(..._("/v1/assets",{method:"GET"}))).assetList}async getFarms(){return m(await this.apiFetch(..._("/v1/farms",{method:"GET"}))).farmList}async getPools(){return m(await this.apiFetch(..._("/v1/pools",{method:"GET"}))).poolList}async getJettonWalletAddress(e){return m(await this.apiFetch(..._("/v1/jetton/{jettonAddress}/address",{method:"GET",query:e}))).address}async getWalletAssets(e){return m(await this.apiFetch(..._("/v1/wallets/{walletAddress}/assets",{method:"GET",query:{walletAddress:e}}))).assetList}async getWalletFarms(e){return m(await this.apiFetch(..._("/v1/wallets/{walletAddress}/farm",{method:"GET",query:{walletAddress:e}}))).farmList}async getWalletPools(e){return m(await this.apiFetch(..._("/v1/wallets/{walletAddress}/pools",{method:"GET",query:{walletAddress:e}}))).poolList}}class ss extends T.TonClient{constructor(e){super(e),this.stonApiClient=e.stonApiClient??new Te}async callGetMethod(...e){var s,r;if(e[1]==="get_wallet_address"&&((r=(s=e[2])==null?void 0:s[0])==null?void 0:r.type)==="slice")try{const o=await this.stonApiClient.getJettonWalletAddress({jettonAddress:e[0].toString(),ownerAddress:e[2][0].cell.beginParse().loadAddress().toString()});return{gas_used:0,stack:new T.TupleReader([{type:"slice",cell:T.beginCell().storeAddress(T.Address.parse(o)).endCell()}])}}catch{}return super.callGetMethod(...e)}}function S(t){return t instanceof T.Address?t:T.address(t.toString())}class rs{constructor(e,s){this.address=S(e)}static create(e){return new this(e)}}class Os extends rs{async getWalletAddress(e,s){return(await e.get("get_wallet_address",[{type:"slice",cell:T.beginCell().storeAddress(S(s)).endCell()}])).stack.readAddress()}async getJettonData(e){const s=await e.get("get_jetton_data",[]);return{totalSupply:s.stack.readBigNumber(),canIncSupply:!!s.stack.readNumber(),adminAddress:s.stack.readAddressOpt(),contentRaw:s.stack.readCell(),jettonWalletCode:s.stack.readCell()}}}function bs(t){const e=T.beginCell();return e.storeUint(260734629,32),e.storeUint(t.queryId,64),e.storeCoins(BigInt(t.amount)),e.storeAddress(S(t.destination)),e.storeAddress(t.responseDestination?S(t.responseDestination):void 0),t.customPayload?(e.storeBit(!0),e.storeRef(t.customPayload)):e.storeBit(!1),e.storeCoins(BigInt(t.forwardTonAmount)),t.forwardPayload?(e.storeBit(!0),e.storeRef(t.forwardPayload)):e.storeBit(!1),e.endCell()}let ns=class{constructor(e){this.dependencies=e}async getWalletInfo(e){const{logger:s,AssetsService:r,getTonAsset:o}=this.dependencies,a=s.child("getWalletInfo");try{a.log("called");const c=o();if(!c)throw new Error("TON asset not found");const i=await r.fetchAssetsMetadataByAddresses([c.contractAddress],e);if(i instanceof Error)throw i;const u=i.at(0);if(!u)throw new Error("TON info not found in the response");const l={address:e,balance:new I.BN(u.balance??0)};return a.log("response",l),l}catch(c){throw a.error(c),c}}async getTokenWalletInfo({token:e,ownerAddress:s}){const{logger:r,AssetsService:o}=this.dependencies,a=r.child("getTokenWalletInfo");try{a.log("called");const c=await o.fetchAssetsMetadataByAddresses([e.contractAddress],s);if(c instanceof Error)throw c;const i=c[0];if(!i)throw new Error("Token info not found in the response");const u=o.buildAssetEntity(i);if(!u)throw new Error("cannot build token balance entity from the response info");return a.log("response",u),u}catch(c){throw a.error(c),c}}};const ne=new ns({logger:ae.child("services","BlockchainService"),AssetsService:ve,getTonAsset:O.getTonAsset.bind(O)});function F(t){return new Promise(e=>setTimeout(e,t))}async function os(t,e,s=1e3){let r=1;const o=async()=>{try{return await t()}catch(a){if(r>=e)throw a;return await F(s*2**r),r++,o()}};return o()}function as(t=0,e=Number.MAX_SAFE_INTEGER){return Math.floor(Math.random()*(e-t+1))+t}class is extends Error{constructor(e,s){const r="UnknownBalanceError",a=[`Unknown ${e.debug} balance`,s];super(...a),this.token=e,this.name=r,Object.setPrototypeOf(this,new.target.prototype)}}class cs extends Error{constructor(e,s,r){const o="InsufficientBalanceError",c=[[`Insufficient ${e.debug} balance`,`Required amount: ${e.debug}, current balance: ${s.debug}`].join(`.
`),r];super(...c),this.requiredAmount=e,this.currentBalance=s,this.name=o,Object.setPrototypeOf(this,new.target.prototype)}}class Rs extends Error{constructor(...e){const s="SimulationGeneralError";super(...e),this.name=s,Object.setPrototypeOf(this,new.target.prototype)}}class Ss extends Error{constructor(...e){const s="SimulationVerificationError";super(...e),this.name=s,Object.setPrototypeOf(this,new.target.prototype)}}const us={[w.MAINNET]:g.API_TON_API_URL,[w.TESTNET]:g.API_TESTNET_TON_API_URL},ls={[w.MAINNET]:g.API_TON_API_KEY,[w.TESTNET]:g.API_TESTNET_TON_API_KEY},ps={[w.MAINNET]:g.API_STON_REST_API_URL,[w.TESTNET]:g.API_TESTNET_STON_REST_API_URL};class vs{sdkClientCache;settings;getTokenByAddress;getTonToken;fetchTokenBalance;TON_AMOUNT_VALIDATION_MARGIN;OPERATION_REFETCH_FREQUENCY;OPERATION_REFETCH_TIMEOUT;OPERATION_RETRY_COUNT;constructor(e){this.settings=e.settings,this.getTokenByAddress=e.getTokenByAddress,this.getTonToken=e.getTonToken,this.fetchTokenBalance=e.fetchTokenBalance,this.TON_AMOUNT_VALIDATION_MARGIN=e.TON_AMOUNT_VALIDATION_MARGIN,this.OPERATION_REFETCH_FREQUENCY=e.OPERATION_REFETCH_FREQUENCY,this.OPERATION_REFETCH_TIMEOUT=e.OPERATION_REFETCH_TIMEOUT,this.OPERATION_RETRY_COUNT=e.OPERATION_RETRY_COUNT}get sdkClient(){if(!this.sdkClientCache){const e=this.settings.network;this.sdkClientCache=new ss({endpoint:us[e],apiKey:ls[e],stonApiClient:new Te({baseUrl:ps[e]})})}return this.sdkClientCache}async validateWalletTokenAmounts(e){const s=new Map;if(e.tonAmounts){const a=this.getTonToken();s.set(a.key,new C({...a,amount:e.tonAmounts.reduce((c,i)=>c.add(new I.BN(i.toString())),new I.BN(0))}))}e.tokenAmounts.forEach(a=>{const i=s.get(a.key)?.amount??new I.BN(0);s.set(a.key,new C({...a,amount:i.add(a.amount)}))});let r=!0;const o=Array.from(s.values()).map(async a=>{try{const c=await this.fetchTokenBalance({token:a,ownerAddress:e.wallet.address});c.amount.lt(a.amount)&&(r=new cs(a,c))}catch(c){r=new is(a,{cause:c})}});return await Promise.all(o),r}async getOperationStatus(e,s){const{transactions:r}=e;if(r.some(l=>l.status!==f.SUBMITTED))throw new Error("Unexpected status of operation");const o=s?.frequency??this.OPERATION_REFETCH_FREQUENCY,a=s?.timeout??this.OPERATION_REFETCH_TIMEOUT,c=new Map,i=new AbortController,u=async l=>{try{const n=await os(async()=>this.fetchTransactionStatus(l),this.OPERATION_RETRY_COUNT);if(n?.status===f.FULFILLED_SUCCESS||n?.status===f.FULFILLED_ERROR)c.set(l.queryId,n);else{if(i.signal.aborted)return;await F(o),await u(l)}}catch{}};return await Promise.race([F(a).then(()=>i.abort()),Promise.all(r.map(u))]),new A({...e,transactions:r.map(l=>{const n=c.get(l.queryId);return n?new b({...n.data}):new b({...l.data,status:f.UNKNOWN})})})}async buildOperationExecutor({wallet:e,simulation:s,onUpdate:r,onError:o,onSuccess:a}){const c=await this.buildTransaction(e,s);if(c instanceof Error)return c;const i=await Promise.all(c.map(p=>this.mapSdkTransactionToWalletTransaction(e.address,p)));let u=await this.buildOperation(e,s,c);const l=async()=>{u=new A({...u,transactions:u.transactions.map(p=>new b({...p.data,status:f.CANCELED}))}),r?.(u)};return{cancelTransaction:l,signTransaction:async()=>{if(u=new A({...u,transactions:u.transactions.map(h=>new b({...h.data,status:f.SUBMIT_REQUESTED}))}),r?.(u),!await e.requestTransfer(i)){l();return}u=new A({...u,transactions:u.transactions.map(h=>new b({...h.data,status:f.SUBMITTED}))}),r?.(u),u=await this.getOperationStatus(u),r?.(u),u.status===E.FULFILLED_SUCCESS?(await a?.(u),u=new A({...u,overrideStatus:E.FINALIZED_SUCCESS})):u.status===E.FULFILLED_ERROR&&(await o?.(u),u=new A({...u,overrideStatus:E.FINALIZED_ERROR})),r?.(u)}}}async mapSdkTransactionToWalletTransaction(e,s){return{sender:e,to:s.to.toString(),value:s.value.toString(),data:s.body?s.body.toBoc().toString("base64"):null}}getTokenAmountFromBalanceDeltasResponse(e,s){const r=Object.entries(s).find(([o])=>e.contractAddress.equals(o))?.[1];if(r)return new C({...e,amount:r})}generateQueryId(){const e=as(1e9,9999999999),s=`${e}`.split("").reduce((o,a)=>o+Number(a),0),r=`${e}${s+Ce}`;return Number(r)}}const Cs={settings:ie,getTokenByAddress:O.getAssetByAddress.bind(O),getTonToken:O.getTonAsset.bind(O),fetchTokenBalance:ne.getTokenWalletInfo.bind(ne),TON_AMOUNT_VALIDATION_MARGIN:new I.BN(1e7),OPERATION_REFETCH_FREQUENCY:g.APP_OPERATION_STATUS_REFETCH_INTERVAL_MS,OPERATION_REFETCH_TIMEOUT:g.APP_OPERATION_STATUS_TIMEOUT_MS,OPERATION_RETRY_COUNT:g.APP_OPERATION_STATUS_RETRY_COUNT};let hs=class{network;constructor({network:e}){this.network=e}};const ds={[w.MAINNET]:"https://tonviewer.com",[w.TESTNET]:"https://testnet.tonviewer.com"};class fs extends hs{name="Tonviewer";get baseUrl(){return ds[this.network()]}getWalletLink=e=>new URL(`${this.baseUrl}/${e.base64}`);getAssetLink=e=>new URL(`${this.baseUrl}/${e.contractAddress.base64}`);getAssetBalanceLink=(e,s)=>s.type===Ne.TON?this.getWalletLink(e):new URL(`${this.baseUrl}/${e.base64}/jetton/${s.contractAddress.base64}`);getTransactionLink=e=>new URL(`${this.baseUrl}/transaction/${e.hex}`);getNftLink=e=>new URL(`${this.baseUrl}/${e.base64}`)}const ys=new fs({network:()=>ie.network}),xs=()=>ys;export{vs as B,rs as C,cs as I,Os as J,As as O,Rs as S,b as T,is as U,_s as a,A as b,Cs as c,F as d,bs as e,ne as f,Ss as g,S as t,xs as u};
