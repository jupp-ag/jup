// Version: 1.1.1
var{keys:a}=Object;version='1.1.1';window.MetaCRMTracking={};let b;window.MetaCRMTracking.manualConnectWallet=A=>b=A;(async ()=>{var _=document.getElementById('metacrm-tracking'),B=null,c=w(),d=!1,e=!1,f=0,g=_.getAttribute('data-entity-id'),h=_.getAttribute('apiKey'),I=_.getAttribute('MetaCRMTrackingExecutionEnvironment'),j=(()=>{switch(I) {case 'local':return'http://localhost:21667/api/tracking';case 'dev':return'https://api-dev.metacrm.inc/api/tracking';case 'demo':return'https://api-demo.metacrm.inc/api/tracking';default:return'https://api-desk.metacrm.inc/api/tracking'}})(),g=_.getAttribute('data-entity-id'),k='metacrm-tracking-address'+'-'+g,l='metacrm-tracking-referrer'+'-'+g,m='metacrm-tracking-info'+'-'+g,n='metacrm-tracking-utm'+'-'+g,o='metacrm-tracking-ip'+'-'+g,p='metacrm-tracking-timestamp'+'-'+g,q='metacrm-tracking-uid'+'-'+g;async function r(){if(window.ethereum!==void 0){aA('Ethereum is available');try {let C=await ethereum.request({method:'eth_accounts'});if(C.length>0){aA('scenario 1');aA(`Ethereum address:, ${C[0]}`);return C[0]}aA('scenario 2');aA('No connected Ethereum address')} catch (_a) {aA(_a)}}return null}function s(){if(aC()){let D=localStorage.getItem('wagmi.store');if(JSON.parse(D).state.data.account)return JSON.parse(D).state.data.account.toLowerCase()}return null}async function t(){try {let _A=await fetch('https://api.ipify.org?format=json');let _b=await _A.json();return _b.ip} catch (E) {aA(E);return null}}function u(){let aZ=window.location.search;if(!aZ)return null;let _B=[];let _c=aZ.substring(1).split('&');for(let i=0;i<_c.length;i++){let bA=_c[i].split('=');_B.push({key:bA[0],value:bA[1]})}return _B}function v(){let bB=document.referrer;if(!bB)return null;return bB}function w(){let bC=navigator.userAgent;if(!bC)return null;return bC}function x(){return new Date().getTime()}function y(){localStorage.removeItem(k);localStorage.removeItem(l);localStorage.removeItem(m);localStorage.removeItem(o)}function z(){let bD=JSON.parse(localStorage.getItem(m));let bE=bD[bD.length-1];localStorage.setItem(m,JSON.stringify([bE]))}function aA(){}function aB(bF,bG){if(bF==bG)return!0;if(typeof bF!=='object'||typeof bG!=='object'||bF==null||bG==null)return!1;var _C=a(bF),_d=a(bG);if(_C.length!==_d.length)return!1;for(const bH of _C)if(!_d.includes(bH)||!aB(bF[bH],bG[bH]))return!1;return!0}function aC(){if(localStorage.getItem('wagmi.wallet')&&localStorage.getItem('wagmi.connected')){aA('wagmi flags are set');return!0}aA('wagmi flags are not set');return!1}function aD(bI=3){let bJ=new Date().getTime();if(bJ-f<bI*1000&&bJ-f>0)return!0;f=bJ;return!1}function aE(bK=60){let bL=new Date().getTime();let bM=aW();aA(`currentTimestamp, ${bL}`);aA(`lastUpdatedAtTimestamp, ${bM}`);aA(`diff, ${bL-bM}`);if(bL-bM<bK*1000&&bL-bM>0){aA('in time throttle');return!0}aA('not in time throttle');return!1}function aF(bN){return new Promise(function(bO,bP){let bQ=new XMLHttpRequest();bQ.onload=()=>bQ.status==200?(aA('tracking info sent successfully'),bO(!0)):(aA('tracking info failed to send'),bP(!1));bQ.onerror=()=>{aA('network error');bP(!1)};bQ.open('POST',j,!0);bQ.setRequestHeader('Content-Type','application/json');bQ.setRequestHeader('X-API-KEY',h);bQ.setRequestHeader('version',version);try {bQ.send(JSON.stringify(bN))} catch (bR) {aA(bR)}})}function aG(bS){var bT=JSON.stringify(bS),bU=new Blob([bT], {type:'application/json'});try {navigator.sendBeacon(j,bU)} catch (bV) {aA(bV)}}function aH(bW){let bX=JSON.parse(localStorage.getItem(m))||[];if(!bX.length)return!0;for(let i=0;i<bX.length;i++){let bY={...bW};let bZ={...bX[i]};delete bY.updatedAt;delete bZ.updatedAt;if(aB(bZ,bY))return!1}return!0}function aI(){let cA={uid:aQ(),ipAddress:aS(),queryString:aU(),referrer:aT(),userAgent:c,updatedAt:aV()};aR()&&(cA['address']=aR());return cA}async function aJ(){let cB=b||await r()||s();return cB}async function aK(){aA('set address to local storage');let cC=await aJ();cC&&localStorage.setItem(k,cC)}async function aL(){aA('set ip address to local storage');let cD=await t();cD&&localStorage.setItem(o,cD)}function aM(cE){aA('set current data to local storage');if(!localStorage.getItem(m))localStorage.setItem(m,JSON.stringify([cE]));else{let cF=JSON.parse(localStorage.getItem(m));cF.push(cE);localStorage.setItem(m,JSON.stringify(cF))}}function aN(){aA('set referrer to local storage');let cG=v();cG&&localStorage.setItem(l,cG)}function aO(){aA('set utm to local storage');let cH=u();cH&&localStorage.setItem(n,JSON.stringify(cH))}function aP(){aA('set current timestamp to local storage');let cI=x();cI&&localStorage.setItem(p,cI)}function aQ(){let cJ=localStorage.getItem(q);aA('uid',cJ);!cJ&&(cJ=Math.random().toString(36).substring(2,15),aA('uid generated',cJ),localStorage.setItem(q,cJ));return cJ}function aR(){let cK=localStorage.getItem(k);if(!cK)return null;return cK}function aS(){let cL=localStorage.getItem(o);if(!cL)return null;return cL}function aT(){let cM=localStorage.getItem(l);if(!cM)return null;return cM}function aU(){let cN=JSON.parse(localStorage.getItem(n));if(!cN)return null;return cN}function aV(){let cO=localStorage.getItem(p);if(!cO)return 0;return cO}function aW(){try {let cP=JSON.parse(localStorage.getItem(m));let cQ=cP[cP.length-1];aA(cQ);if(!cQ)return 0;return cQ.updatedAt} catch {return 0}}async function aX(){aP();if(aE(300)){aA('within time throttle, check current attributes');let cR=v();let cS=await aJ();let cT=aT();let _D=aR();if(aB(u(),aU())&&cR==cT&&cS==_D)aA('utm / referrer / address are the same');else{aA('utm / referrer / address are different');aO();aN();await aK();B=aI();aA(B);aH(B)&&aF(B).then(()=>{aM(B);z()}).catch(cU=>aA(cU))}}else{aA('not within time throttle, update utm / referrer / address / timestamp');aO();aN();await aK();B=aI();aA(B);aF(B).then(()=>aM(B)).catch(cV=>aA(cV))}}function aY(){B=aI();aA(B);try {aF(B)} catch (cW) {aA(cW)}}window.addEventListener('load',async function(){await aL();await aK();await aX();f=new Date().getTime();e=!0});window.addEventListener('touchstart',async function(){e&&(d=!0)});window.addEventListener('touchend',async function(){e&&d&&!aD(3)&&(await aX(),d=!1)});window.addEventListener('click',async function(){e&&!d&&!aD(3)&&await aX()});window.addEventListener('scroll',async function(){e&&!aD(10)&&await aX()});window.addEventListener('beforeunload',function(){if(B)if(navigator.sendBeacon)try {aG(B)} catch (cX) {aA(cX)}else aY();y()});window.ethereum!==void 0&&ethereum.on('accountsChanged',async function(cY){if(cY){aA('scenario 3');aA(`Ethereum address:, ${cY[0]}`);await aX()}})})();
