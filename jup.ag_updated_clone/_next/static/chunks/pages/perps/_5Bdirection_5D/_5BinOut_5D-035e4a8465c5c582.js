(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4364,4566],{74966:function(e,t,n){"use strict";n.d(t,{Z:function(){return p}});var s=n(91596),i=n(76021),l=n(23877);function r(e){return function(e,t){if(null==e)throw new TypeError("assign requires that input parameter not be null or undefined");for(var n in t=t||{})Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}({},e)}var o=n(72775),a=n(33219),c=6e4,d=1440,u=43200,x=525600;function m(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};(0,a.Z)(2,arguments);var m=n.locale||o.Z;if(!m.formatDistance)throw new RangeError("locale must contain localize.formatDistance property");var p=(0,i.Z)(e,t);if(isNaN(p))throw new RangeError("Invalid time value");var f,h,v=r(n);v.addSuffix=Boolean(n.addSuffix),v.comparison=p,p>0?(f=(0,l.Z)(t),h=(0,l.Z)(e)):(f=(0,l.Z)(e),h=(0,l.Z)(t));var g,b=null==n.roundingMethod?"round":String(n.roundingMethod);if("floor"===b)g=Math.floor;else if("ceil"===b)g=Math.ceil;else{if("round"!==b)throw new RangeError("roundingMethod must be 'floor', 'ceil' or 'round'");g=Math.round}var w,j=h.getTime()-f.getTime(),y=j/c,N=(0,s.Z)(h)-(0,s.Z)(f),P=(j-N)/c;if("second"===(w=null==n.unit?y<1?"second":y<60?"minute":y<d?"hour":P<u?"day":P<x?"month":"year":String(n.unit))){var k=g(j/1e3);return m.formatDistance("xSeconds",k,v)}if("minute"===w){var S=g(y);return m.formatDistance("xMinutes",S,v)}if("hour"===w){var C=g(y/60);return m.formatDistance("xHours",C,v)}if("day"===w){var Z=g(P/d);return m.formatDistance("xDays",Z,v)}if("month"===w){var _=g(P/u);return 12===_&&"month"!==n.unit?m.formatDistance("xYears",1,v):m.formatDistance("xMonths",_,v)}if("year"===w){var T=g(P/x);return m.formatDistance("xYears",T,v)}throw new RangeError("unit must be 'second', 'minute', 'hour', 'day', 'month' or 'year'")}function p(e,t){return(0,a.Z)(1,arguments),m(e,Date.now(),t)}},54566:function(e,t,n){"use strict";n.r(t);var s=n(93981),i=n(13838),l=n(84985),r=n(25546),o=n(29541);t.default=function(e){var t,n=e.tokenInfo,a=e.amount,c=e.maxDecimals,d=e.prefix,u=(0,l.y6)(),x=u.tokenPriceMap,m=u.getUSDValue,p=n.address;(0,s.useEffect)((function(){p&&m([p])}),[p,m]);var f=p&&(null===(t=x[p])||void 0===t?void 0:t.usd)||0,h=new i.Z(a||0).mul(f).toNumber();return!h||h<=0?(0,o.jsx)(o.Fragment,{children:""}):c&&new i.Z(h).lte(.1)?(0,o.jsxs)(o.Fragment,{children:[d,"$",parseFloat(r.uf.format(h,c))]}):(0,o.jsxs)(o.Fragment,{children:[d,"$",r.uf.format(h,2)]})}},80751:function(e,t,n){"use strict";var s=n(76613),i=n(93981),l=n(29541);t.Z=function(e){var t=e.open,n=e.onClose,r=e.children,o=(0,s.Gc)(),a=((0,i.useMemo)((function(){return"xs"===o||"sm"===o||"md"===o}),[o]),(0,i.useRef)(null));(0,s.O3)(a,(function(){var e;return null===(e=a.current)||void 0===e?void 0:e.close()}));var c=(0,i.useCallback)((function(){var e;null===(e=a.current)||void 0===e||e.close(),n()}),[n,a]);return(0,i.useEffect)((function(){if(a.current&&(t?a.current.open||a.current.show():a.current.close()),t){var e=a.current;return null===e||void 0===e||e.addEventListener("close",c),function(){null===e||void 0===e||e.removeEventListener("close",c)}}}),[c,t]),(0,l.jsx)("dialog",{ref:a,className:"fixed z-40 top-0 rounded-lg bg-black/30 backdrop-blur-sm animate-fade-in flex items-center justify-center",children:r})}},32529:function(e,t,n){"use strict";n.d(t,{Y:function(){return o}});var s=n(70107),i=n(17769),l=n(93981);function r(e,t){return Array(t-e+1).fill(void 0).map((function(t,n){return e+n}))}function o(e){var t=e.pageIndex,n=void 0===t?0:t,o=e.pageCount,a=void 0===o?0:o,c=e.setPageIndex,d=(0,i.XA)(),u=l.useMemo((function(){var e=n+1;return d?a<=5?r(1,a):e<=2?[].concat((0,s.Z)(r(1,3)),["...",a]):e>=a-2?[1,"..."].concat((0,s.Z)(r(a-2,a))):[1,"...",e,"...",a]:a<=8?r(1,a):e<=2?[].concat((0,s.Z)(r(1,3)),["...",a]):e>=a-2?[1,"..."].concat((0,s.Z)(r(a-2,a))):[1,"..."].concat((0,s.Z)(r(e,e+2)),["...",a])}),[n,d,a]),x=(0,l.useMemo)((function(){return n>0}),[n]),m=(0,l.useMemo)((function(){return n<a-1}),[n,a]),p=(0,l.useCallback)((function(e){return c(e)}),[c]);return{pager:u,canPreviousPage:x,canNextPage:m,gotoPage:p}}},17639:function(e,t,n){"use strict";var s=n(7761),i=(n(93981),n(18112)),l=n(11017),r=n(24201),o=n(29541);t.Z=function(e){var t=e.canPreviousPage,n=e.gotoPage,a=e.pageIndex,c=e.pager,d=e.canNextPage;return(0,o.jsxs)("div",{className:"flex flex-row justify-between px-2 py-5 lg:px-6 mb-20",children:[(0,o.jsxs)("button",{type:"button",disabled:!t,onClick:function(){return n(a-1)},className:"flex flex-row items-center text-[#E8F9FF] cursor-pointer disabled:cursor-not-allowed text-opacity-50 hover:text-opacity-100",children:[(0,o.jsx)(i.Z,{width:12,height:12}),(0,o.jsx)("span",{className:"ml-2 text-xs",children:s.ag._("Previous")})]}),(0,o.jsx)("div",{className:"flex-row space-x-2 flex",children:c.map((function(e,t){var s=e===a+1,i="".concat(e,"-").concat(t);return"string"===typeof e?(0,o.jsx)("div",{className:"flex flex-row items-center justify-center text-xs",children:e},i):(0,o.jsx)("div",{onClick:function(){return n(e-1)},className:(0,r.cn)("h-10 w-10 text-xs rounded-lg flex flex-row items-center justify-center text-[#E8F9FF]/50 hover:text-v2-primary cursor-pointer",{"!text-v2-primary border bg-v2-primary/10 border-v2-primary/50 font-semibold":s}),children:e},i)}))}),(0,o.jsxs)("button",{type:"button",disabled:!d,onClick:function(){return n(a+1)},className:"flex flex-row items-center text-[#E8F9FF] cursor-pointer disabled:cursor-not-allowed text-opacity-50 hover:text-opacity-100",children:[(0,o.jsx)("span",{className:"mr-2 text-xs",children:s.ag._("Next")}),(0,o.jsx)(l.Z,{width:12,height:12})]})]})}},50944:function(e,t,n){"use strict";n.d(t,{Y8:function(){return g},hb:function(){return N},zu:function(){return b}});var s=n(63956),i=n(73360),l=n(7761),r=n(93981),o=n(40558),a=n(13838),c=n(64508),d=n.n(c),u=n(56100),x=n(35569),m=n(24201),p=n(25546),f=n(29541);function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,s)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){(0,s.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var g=(0,r.memo)((function(e){var t=e.collateralInput,n=e.orderInfoLoading;return(0,f.jsxs)("div",{className:"flex flex-col lg:flex-row justify-between lg:items-center",children:[(0,f.jsx)("span",{className:"text-xs text-white/50 ",children:l.ag._("Collateral")}),(0,f.jsx)(o.Z,{variant:"dark",content:(0,f.jsxs)("div",{className:"space-y-2",children:[(0,f.jsx)("p",{className:"text-xs",children:l.ag._("When opening a position, a snapshot will be taken and collateral will be calculated in USD.")}),(0,f.jsx)("p",{className:"text-xs",children:l.ag._("Depending on the token selection, token may be swapped via Jupiter's best possible rate.")})]}),children:(0,f.jsx)("div",{translate:"no",className:"text-xs text-white/75 mt-0.5",children:t&&!n?(0,f.jsxs)("span",{children:[p.uf.format(t,2)," USD"]}):!t||null!==t&&void 0!==t&&t.eq(0)?(0,f.jsx)("span",{className:"text-white/75 text-xs h-[14px]",children:"-"}):(0,f.jsx)(u.O,{className:"h-[14px] !w-20"})})})]})})),b=(0,r.memo)((function(e){var t=e.sizeUsd,n=e.collateralInput,s=e.orderInfoLoading;return(0,f.jsxs)("div",{className:"flex flex-col lg:flex-row justify-between lg:items-center",children:[(0,f.jsx)("span",{className:"text-xs text-white/50 leading-none",children:l.ag._("Size in USD")}),(0,f.jsx)("div",{translate:"no",className:"text-xs text-white/75 mt-0.5",children:t&&!s?(0,f.jsx)("span",{translate:"no",className:"text-xs h-[14px] text-white/75",children:(0,f.jsxs)("span",{children:[p.uf.format(t,2)," USD"]})}):!n||null!==n&&void 0!==n&&n.eq(0)?(0,f.jsx)("span",{className:"text-white/75 text-xs h-[14px]",children:"-"}):(0,f.jsx)(u.O,{className:"h-[14px] !w-20"})})]})})),w=(0,r.memo)((function(e){e.positionInfo;var t=e.orderInfo,n=e.orderInfoLoading;return(0,f.jsxs)("div",{className:"flex flex-col lg:flex-row justify-between lg:items-center",children:[(0,f.jsx)("span",{className:"text-xs text-white/50",children:l.ag._("Entry price")}),(0,f.jsx)("span",{className:"text-xs text-white/75",children:t.entryPriceTextWithShifting&&!n?t.entryPriceTextWithShifting:(0,f.jsx)(u.O,{className:"!w-16 !h-4"})})]})})),j=(0,r.memo)((function(e){e.positionInfo;var t=e.orderInfo,n=e.orderInfoLoading;return(0,f.jsxs)("div",{className:"flex flex-col lg:flex-row justify-between lg:items-center",children:[(0,f.jsxs)("span",{className:"flex items-center leading-none",children:[(0,f.jsx)("span",{className:(0,m.cn)("inline-block lg:hidden text-xs",t.isNewLiquidationWorse?"text-warning":"text-white/40"),children:l.ag._("Liquidation")}),(0,f.jsx)("span",{className:(0,m.cn)("hidden lg:inline-block text-xs",t.isNewLiquidationWorse?"text-warning":"text-white/40"),children:l.ag._("Liquidation price")}),t.isNewLiquidationWorse&&!n?(0,f.jsx)(o.Z,{buttonContentClassName:"ml-1 inline-block",content:l.ag._("Your new order and outstanding borrow fees is resulting in a worse liquidation price, try increasing your collateral, or reduce your leverage."),children:(0,f.jsx)(x.Z,{width:14,height:14,className:"text-warning"})}):null]}),(0,f.jsx)("span",{className:(0,m.cn)("text-xs mt-1",t.isNewLiquidationWorse?"text-warning":"text-white/75"),children:t.liquidationPriceTextWithShifting&&!n?t.liquidationPriceTextWithShifting:(0,f.jsx)(u.O,{className:"!w-16 !h-4"})})]})})),y=(0,r.memo)((function(e){var t=e.pool,n=e.orderInfo,s=e.orderInfoLoading,i=t?new a.Z(t.fees.increasePositionBps.toString()).div(100):null;return(0,f.jsxs)("div",{className:"flex flex-col lg:flex-row justify-between lg:items-center",children:[t?(0,f.jsx)("span",{className:"text-xs text-white/50 whitespace-nowrap",children:l.ag._("Open fee ({openFeePct}%)",{openFeePct:i})}):(0,f.jsx)(u.O,{className:"!h-4 !w-20"}),(0,f.jsx)("span",{className:"text-xs text-white/75",children:n.openFeeUsdText&&!s?"".concat(n.openFeeUsdText):(0,f.jsx)(u.O,{className:"!w-16 !h-4"})})]})})),N=(0,r.memo)((function(e){var t=e.impactPct,n=e.impactFeeUsdText,s=e.orderInfoLoading,i=e.breakline;return(0,f.jsxs)("div",{className:(0,m.cn)("!w-full flex lg:flex-row justify-between lg:items-center text-xs text-white/50",[null!==t&&void 0!==t&&t.gte(.15)?"text-red-400":"",null!==t&&void 0!==t&&t.gte(.1)?"text-warning":"",i?"flex-col":""]),children:[(0,f.jsxs)("span",{className:"inline-block lg:flex lg:flex-row lg:items-center leading-none",children:[l.ag._("Price impact")," ",t?"(".concat(null===t||void 0===t?void 0:t.toFixed(2),"%)"):"",(0,f.jsx)("div",{className:"ml-1 inline-block",children:(0,f.jsx)(o.Z,{content:(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("p",{children:"Price impact is calculated based on your order size, you can reduce your price impact by splitting your orders."}),(0,f.jsx)(d(),{href:"https://www.jupresear.ch/t/jupiter-perpetuals-price-impact-fee-mechanism/17140",target:"_blank",className:"underline",children:(0,f.jsx)("p",{className:"mt-2",children:l.ag._("Learn More")})})]}),children:(0,f.jsx)(x.Z,{width:14,height:14,className:"inline-block mb-0.5 md:mb-0"})})})]}),(0,f.jsx)("span",{className:(0,m.cn)("text-xs text-white/75",[null!==t&&void 0!==t&&t.gte(.15)?"text-red-400":"",null!==t&&void 0!==t&&t.gte(.1)?"text-warning":""]),children:n&&!s?n:(0,f.jsx)(u.O,{className:"!w-16 !h-4"})})]})})),P=(0,r.memo)((function(e){var t=e.positionInfo,n=e.orderInfo,s=e.orderInfoLoading;return(0,f.jsxs)("div",{className:(0,m.cn)("flex flex-col lg:flex-row justify-between lg:items-center text-xs",t.insufficientNewCollateral&&n.isNewLiquidationWorse?"text-warning":"text-white/50"),children:[(0,f.jsxs)("span",{className:"inline-block lg:flex lg:flex-row lg:items-center leading-none",children:[l.ag._("Borrow fees due"),(0,f.jsx)("div",{className:"ml-1 inline-block",children:(0,f.jsx)(o.Z,{content:l.ag._("Borrow fees due are settled when you make changes to your existing position."),children:(0,f.jsx)(x.Z,{width:14,height:14,className:"inline-block mb-0.5 md:mb-0"})})})]}),(0,f.jsx)("span",{className:(0,m.cn)("text-xs",t.insufficientNewCollateral&&n.isNewLiquidationWorse?"text-warning":"text-white/75"),children:n.outstandingFundingFeeUsdText&&!s?"".concat(n.outstandingFundingFeeUsdText):(0,f.jsx)(u.O,{className:"!w-16 !h-4"})})]})})),k=(0,r.memo)((function(e){var t=e.positionInfo,n=e.orderInfoLoading;return(0,f.jsxs)("div",{className:"flex flex-col lg:flex-row justify-between lg:items-center gap-x-4",children:[(0,f.jsxs)("div",{className:"flex items-center text-xs text-white/50 !h-4",children:[(0,f.jsx)("span",{className:"text-xs text-white/50 mr-1",children:l.ag._("Borrow rate")}),(0,f.jsx)(o.Z,{variant:"dark",placement:"top",content:(0,f.jsx)("p",{className:"flex items-center text-xs",children:(0,f.jsx)(i.cC,{id:"The borrow rate is calculated as (assets borrowed) / (total assets in pool) * {0}% per hour * position size.",values:{0:t.hourlyFundingDbps.div(1e3).toString()}})}),children:(0,f.jsx)(x.Z,{width:14,height:14})})]}),(0,f.jsx)("span",{className:"flex items-center text-xs text-white/75",children:t.borrowFeeText&&!n?t.borrowFeeText:(0,f.jsx)(u.O,{className:"!w-16 !h-4"})})]})})),S=(0,r.memo)((function(e){var t=e.positionInfo,n=(e.orderInfo,e.orderInfoLoading);return(0,f.jsxs)("div",{className:"flex flex-col lg:flex-row justify-between lg:items-center gap-x-4",children:[(0,f.jsx)("span",{className:"block lg:hidden text-xs text-white/50",children:l.ag._("Available liq.")}),(0,f.jsx)("span",{className:"hidden lg:block text-xs text-white/50",children:l.ag._("Available liquidity")}),(0,f.jsx)("span",{className:"text-xs text-white/75",children:t.availableLiquidityText&&!n?t.availableLiquidityText:(0,f.jsx)(u.O,{className:"!w-16 !h-4"})})]})})),C=(0,r.memo)((function(e){return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("div",{className:"hidden lg:block rounded-lg p-3 w-full",children:(0,f.jsx)("div",{className:"border border-white/5 rounded-lg p-3 w-full",children:(0,f.jsxs)("div",{className:"space-y-1",children:[(0,f.jsx)(w,v({},e)),(0,f.jsx)(j,v({},e)),(0,f.jsx)(y,v({},e)),(0,f.jsx)(N,{impactPct:e.orderInfo.impactPct,impactFeeUsdText:e.orderInfo.impactFeeUsdText,orderInfoLoading:e.orderInfoLoading}),e.orderInfo.outstandingFundingFeeUsdText?(0,f.jsx)(P,v({},e)):null,(0,f.jsx)(k,v({},e)),(0,f.jsx)(S,v({},e))]})})}),(0,f.jsx)("div",{className:"block lg:hidden px-1.5 pt-3 min-h-full bg-[#1E2A36] w-full !min-w-[110px] max-w-[30vw]",children:(0,f.jsxs)("div",{className:"space-y-3",children:[(0,f.jsx)(g,v({},e)),(0,f.jsx)(b,v({},e)),(0,f.jsx)(w,v({},e)),(0,f.jsx)(j,v({},e)),(0,f.jsx)(y,v({},e)),(0,f.jsx)(N,{impactPct:e.orderInfo.impactPct,impactFeeUsdText:e.orderInfo.impactFeeUsdText,orderInfoLoading:e.orderInfoLoading,breakline:!0}),e.orderInfo.outstandingFundingFeeUsdText?(0,f.jsx)(P,v({},e)):null,(0,f.jsx)(k,v({},e)),(0,f.jsx)(S,v({},e))]})})]})}));t.ZP=C},13020:function(e,t,n){"use strict";n.d(t,{M:function(){return f}});var s=n(63956),i=n(7761),l=n(93981),r=n(13838),o=n(9319),a=n.n(o),c=n(76613),d=n(84985),u=n(80989),x=n(90491);function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,s)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach((function(t){(0,s.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var f=function(e){var t=(0,x.tc)(),n=t.perpsTokens,s=t.custodies,i=(0,d.Bn)().getTokenInfo;return(0,l.useMemo)((function(){return n.stableTokens?n.stableTokens.map((function(t){var n=s.find((function(e){return e.account.mint.toString()===t.address}));if(!n)return null;if(e&&new r.Z(n.account.assets.owned.sub(n.account.assets.locked).toString()).div(1e6).lt(e))return null;var i=n.account.assets.owned.gtn(0)&&n.account.assets.locked.gtn(0)?new r.Z(n.account.assets.locked.toString()).div(n.account.assets.owned.toString()).mul(1e4):new r.Z(0);return{mint:n.account.mint.toString(),utilizationBps:i}})).filter(Boolean).sort((function(e,t){return e.utilizationBps.toNumber()-t.utilizationBps.toNumber()})).map((function(e){return p(p({},e),{},{tokenInfo:i(e.mint)})})):[]}),[n.stableTokens,s,e,i])};t.Z=function(e){var t=e.fromPairTokenInfo,n=e.toPairTokenInfo,s=e.fromPairValue,o=(0,x.tc)().slippage,d=(0,l.useMemo)((function(){return!(!t||!n)&&t.address!==n.address}),[t,n]),m=(0,l.useMemo)((function(){return(0,c.Hd)(s)&&t?a().BigInt(new r.Z(s).mul(Math.pow(10,t.decimals)).round().toFixed()||0):a().BigInt(0)}),[s,t]),p=(0,u.Z)({disabled:!d,amount:m,fromTokenInfo:t,toTokenInfo:n,slippage:o}),f=p.isLoading,h=p.outAmount,v=p.otherAmountThreshold,g=p.quoteResponseMeta,b=p.useJupError,w=p.refresh,j=p.lastRefreshTimestamp,y=(0,l.useMemo)((function(){if(d&&b)return i.ag._("We're having trouble finding route for this trade. Please try again with different amount or other token.")}),[b,d]);return{isLoading:!!d&&f,isTokenSwapRequired:d,outAmount:h,otherAmountThreshold:v,quoteResponseMeta:g,hasJupiterError:y,refresh:w,lastRefreshTimestamp:j}}},80989:function(e,t,n){"use strict";var s=n(94728),i=n(93981),l=n(13845);t.Z=function(e){var t=e.disabled,n=e.amount,r=e.fromTokenInfo,o=e.toTokenInfo,a=e.slippage,c=(0,i.useMemo)((function(){return Math.ceil(100*Number(a))}),[a]),d=(0,i.useMemo)((function(){return{amount:n,inputMint:t||null===r||void 0===r||!r.address?void 0:new s.PublicKey(r.address),outputMint:t||null===o||void 0===o||!o.address?void 0:new s.PublicKey(o.address),slippageBps:c,maxAccounts:45,disabledProgramIds:["jupoNjAxXgZ4rjzxzPMP4oxduvQsQtZzyknqvzYNrNu"]}}),[n,t,r,o,c]),u=(0,l.OO)(d),x=u.quoteResponseMeta,m=u.loading,p=u.refresh,f=u.error,h=u.lastRefreshTimestamp,v=(0,i.useMemo)((function(){return{outAmount:null===x||void 0===x?void 0:x.quoteResponse.outAmount,otherAmountThreshold:null===x||void 0===x?void 0:x.quoteResponse.otherAmountThreshold,isLoading:!t&&m}}),[t,m,x]),g=v.outAmount,b=v.otherAmountThreshold;return{isLoading:v.isLoading,outAmount:g,otherAmountThreshold:b,quoteResponseMeta:x,useJupError:f,refresh:p,lastRefreshTimestamp:h}}},46226:function(e,t,n){"use strict";var s=n(93981);t.Z=function(){var e=(0,s.useState)(!0),t=e[0],n=e[1],i=(0,s.useCallback)((function(){"visible"===document.visibilityState?n(!0):n(!1)}),[]);return(0,s.useEffect)((function(){return document.addEventListener("visibilitychange",i),function(){document.removeEventListener("visibilitychange",i)}}),[i]),t}},38756:function(e,t,n){"use strict";n.d(t,{w:function(){return g}});var s=n(97620),i=n(63956),l=n(27195),r=n(8857),o=n.n(r),a=n(57565),c=n(75206),d=n(94728),u=n(90491),x=n(13170),m=n(8770),p=n(58532),f=n(795).Buffer;function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,s)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){(0,i.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function g(e){return b.apply(this,arguments)}function b(){return(b=(0,l.Z)(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",w(v(v({},t),{},{requestType:"market",triggerAboveThreshold:null,triggerPrice:null})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return j.apply(this,arguments)}function j(){return(j=(0,l.Z)(o().mark((function e(t){var n,i,l,r,h,v,g,b,w,j,y,N,P,k,S,C,Z,_,T,M,O,F,L,D,A,q;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.wallet,i=t.connection,l=t.side,r=t.collateralCustody,h=t.positionCustody,v=t.inputMint,g=t.requestType,b=t.sizeUsdDelta,w=t.collateralTokenDelta,j=t.priceSlippage,y=t.triggerAboveThreshold,N=t.jupiterMinimumOut,P=t.triggerPrice,k=n.adapter.publicKey){e.next=4;break}throw new Error("Wallet not connected");case 4:return S=(0,m.h)(n,i),e.next=7,(0,p.c1)(v,k,i);case 7:if(C=e.sent,Z=(0,s.Z)(C,2),_=Z[0],T=Z[1],M=d.PublicKey.findProgramAddressSync([f.from("position"),k.toBuffer(),u.FW.toBuffer(),h.publicKey.toBuffer(),r.publicKey.toBuffer(),"long"===l?[1]:[2]],S.programId)[0],O=new a.BN(Math.floor(1e9*Math.random())),F=d.PublicKey.findProgramAddressSync([f.from("position_request"),M.toBuffer(),O.toArrayLike(f,"le",8),[1]],S.programId)[0],L=d.PublicKey.findProgramAddressSync([F.toBuffer(),c.TOKEN_PROGRAM_ID.toBuffer(),v.toBuffer()],c.ASSOCIATED_TOKEN_PROGRAM_ID)[0],D=[],A=[],e.prev=17,v.equals(x.W4)&&(T&&D.push(T),D.push(d.SystemProgram.transfer({fromPubkey:k,toPubkey:_,lamports:BigInt(w.toString())})),D.push(c.Token.createSyncNativeInstruction(c.TOKEN_PROGRAM_ID,_)),A.push(c.Token.createCloseAccountInstruction(c.TOKEN_PROGRAM_ID,_,k,k,[]))),"market"!==g){e.next=27;break}if(j){e.next=22;break}throw"Slippage not set";case 22:return e.next=24,S.methods.createIncreasePositionMarketRequest({sizeUsdDelta:b,collateralTokenDelta:w,side:"long"===l?{long:{}}:{short:{}},priceSlippage:j,jupiterMinimumOut:N,counter:O}).accounts({owner:k,fundingAccount:_,perpetuals:u.TJ,pool:u.FW,position:M,positionRequest:F,positionRequestAta:L,custody:h.publicKey,collateralCustody:r.publicKey,inputMint:v,referral:null}).instruction();case 24:q=e.sent,e.next=30;break;case 27:return e.next=29,S.methods.createIncreasePositionRequest({collateralTokenDelta:w,sizeUsdDelta:b,side:"long"===l?{long:{}}:{short:{}},requestType:{trigger:{}},priceSlippage:j,jupiterMinimumOut:N,triggerPrice:P,triggerAboveThreshold:y,counter:O}).accounts({owner:k,fundingAccount:_,perpetuals:u.TJ,pool:u.FW,position:M,positionRequest:F,positionRequestAta:L,custody:h.publicKey,custodyOracleAccount:h.account.oracle.oracleAccount,collateralCustody:r.publicKey,inputMint:v,referral:null}).instruction();case 29:q=e.sent;case 30:return e.abrupt("return",{instructions:[].concat(D,[q],A),positionRequestKey:F});case 33:throw e.prev=33,e.t0=e.catch(17),console.log(e.t0),e.t0;case 37:case"end":return e.stop()}}),e,null,[[17,33]])})))).apply(this,arguments)}},69825:function(e,t,n){"use strict";var s=n(63956),i=n(54423),l=n(93981),r=n(87821),o=n(84985),a=n(25546),c=n(24201),d=n(29541),u=["testId","name","onChange","value","disabled","decimals","onMouseOver","onFocus","onKeyDown","className","placeholder","onBlur","suffix","max","autofocus","style","enableDynamicSizing"];function x(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,s)}return n}var m=l.forwardRef((function(e,t){e.testId;var n=e.name,m=e.onChange,p=e.value,f=e.disabled,h=void 0!==f&&f,v=e.decimals,g=e.onMouseOver,b=e.onFocus,w=e.onKeyDown,j=e.className,y=e.placeholder,N=e.onBlur,P=e.suffix,k=e.max,S=e.autofocus,C=void 0!==S&&S,Z=e.style,_=e.enableDynamicSizing,T=(0,i.Z)(e,u),M=(0,o.MG)().constants.MAX_INPUT_LIMIT,O=l.useMemo((function(){return T.isAllowed||function(e){var t=e.floatValue;return k?!t||t<=Number(k):!t||t<=M}}),[M,T.isAllowed,k]),F=String(p).length>=9?"text-base md:text-xl":"text-xl",L=","===a.A5?".":",",D=","===a.A5?",":".",A=l.useRef(null),q=(0,l.useState)(Z),R=q[0],I=q[1];return(0,l.useEffect)((function(){var e;_&&I(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x(Object(n),!0).forEach((function(t){(0,s.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({width:null===(e=A.current)||void 0===e?void 0:e.clientWidth},Z))}),[p,Z,_]),(0,d.jsx)(r.Z,{onKeyDown:w,autoComplete:"off",name:n,inputMode:"decimal",onBlur:N,"data-lpignore":"true",decimalSeparator:D,value:null!==p&&void 0!==p?p:"",allowedDecimalSeparators:[".",","],thousandSeparator:L,decimalScale:v,allowNegative:!1,allowLeadingZeros:!1,disabled:h,isAllowed:O,onValueChange:function(e){e.value!==(null===p||void 0===p?void 0:p.toString())&&m&&m(e)},isNumericString:!0,placeholder:h?"":null!==y&&void 0!==y?y:"0.00",className:(0,c.cn)("h-full w-full bg-transparent disabled:cursor-not-allowed disabled:opacity-100 disabled:text-black dark:text-white text-right font-semibold dark:placeholder:text-white/25",F,j),onMouseOver:g,onFocus:b,getInputRef:t,suffix:P,autoFocus:C,style:R})}));t.Z=m},18112:function(e,t,n){"use strict";var s=n(63956),i=n(54423),l=(n(93981),n(29541)),r=["className"];function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,s)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){(0,s.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}t.Z=function(e){e.className;var t=(0,i.Z)(e,r);return(0,l.jsx)("svg",a(a({width:"53",height:"52",viewBox:"0 0 53 52",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t),{},{children:(0,l.jsx)("path",{d:"M17.3336 23.8334H43.7062V28.1667H17.3336L28.9555 39.7887L25.8919 42.8524L9.03955 26L25.8919 9.14771L28.9555 12.2114L17.3336 23.8334Z",fill:"currentColor"})}))}},11017:function(e,t,n){"use strict";n(93981);var s=n(29541);t.Z=function(e){var t=e.className,n=void 0===t?"":t,i=e.width,l=void 0===i?8:i,r=e.height,o=void 0===r?7:r;return(0,s.jsx)("svg",{className:n,xmlns:"http://www.w3.org/2000/svg",width:l,height:o,fill:"none",viewBox:"0 0 8 7",children:(0,s.jsx)("path",{fill:"currentColor",fillRule:"evenodd",d:"M5.647 3.674H.69c-.91 0-.91-1.38 0-1.38h4.957L3.89.537c-.659-.659.314-1.631.973-.972l2.949 2.949c.25.25.25.69 0 .972l-2.95 2.95c-.658.627-1.63-.346-.972-.973l1.757-1.788z",clipRule:"evenodd"})})}},88987:function(e,t,n){"use strict";n.r(t),n.d(t,{__N_SSG:function(){return zt},default:function(){return Bt}});var s=n(93981),i=n(26577),l=n(97620),r=n(76770),o=n(27195),a=n(8857),c=n.n(a),d=n(7761),u=n(45009),x=n(13838),m=n(39268),p=n.n(m),f=n(24201),h=n(90491),v=n(29541),g=function(e){var t=e.width,n=void 0===t?120:t,s=e.height,i=void 0===s?40:s;return(0,v.jsxs)("svg",{width:n,height:i,fill:"inherit",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 370.99 127.93",children:[(0,v.jsx)("path",{stroke:"currentColor",d:"m127.92,47.62v-31.17h14.43c2.05,0,3.83.39,5.34,1.18s2.7,1.88,3.56,3.27c.86,1.4,1.29,3.02,1.29,4.85s-.43,3.46-1.29,4.85c-.86,1.4-2.06,2.49-3.58,3.27-1.53.79-3.3,1.18-5.32,1.18h-9.75v12.56h-4.68Zm4.68-16.52h9.26c1.84,0,3.3-.48,4.39-1.45s1.63-2.25,1.63-3.85-.54-2.88-1.63-3.83c-1.08-.95-2.55-1.42-4.39-1.42h-9.26v10.55Z"}),(0,v.jsx)("path",{stroke:"currentColor",d:"m166,48.07c-2.2,0-4.19-.52-5.99-1.56-1.8-1.04-3.21-2.45-4.25-4.23-1.04-1.78-1.56-3.77-1.56-5.97s.52-4.19,1.56-5.97c1.04-1.78,2.46-3.2,4.25-4.25,1.8-1.05,3.79-1.58,5.99-1.58s4.23.53,6.01,1.58c1.78,1.06,3.19,2.47,4.23,4.25,1.04,1.78,1.56,3.77,1.56,5.97s-.52,4.19-1.56,5.97-2.45,3.19-4.23,4.23-3.78,1.56-6.01,1.56Zm0-3.92c1.4,0,2.66-.35,3.79-1.05,1.13-.7,2.02-1.64,2.67-2.83.65-1.19.98-2.52.98-4.01s-.33-2.77-1-3.94c-.67-1.17-1.56-2.12-2.67-2.83-1.11-.71-2.37-1.07-3.76-1.07s-2.65.36-3.76,1.07c-1.11.71-2,1.65-2.67,2.83-.67,1.17-1,2.49-1,3.94s.33,2.82.98,4.01,1.54,2.13,2.67,2.83,2.39,1.05,3.79,1.05Z"}),(0,v.jsx)("path",{stroke:"currentColor",d:"m186.71,47.62l-6.32-22.67h4.32l4.41,16.66,5.17-16.66h3.83l5.17,16.66,4.41-16.66h4.19l-6.37,22.67h-4.27l-5.08-16.61-5.12,16.61h-4.32Z"}),(0,v.jsx)("path",{stroke:"currentColor",d:"m226.34,48.02c-2.23,0-4.24-.52-6.04-1.56-1.8-1.04-3.22-2.45-4.27-4.23-1.05-1.78-1.58-3.77-1.58-5.97s.5-4.13,1.51-5.9c1.01-1.77,2.38-3.18,4.1-4.23,1.72-1.05,3.64-1.58,5.74-1.58s3.98.53,5.61,1.58c1.63,1.06,2.93,2.48,3.9,4.28.96,1.8,1.45,3.82,1.45,6.08v1.25h-17.86c.24,1.25.71,2.36,1.4,3.34.7.98,1.59,1.75,2.67,2.32,1.08.56,2.26.85,3.54.85,1.1,0,2.16-.17,3.18-.51,1.02-.34,1.88-.84,2.56-1.49l2.85,2.81c-1.34,1.01-2.71,1.76-4.12,2.25-1.41.49-2.96.74-4.65.74Zm-7.39-13.63h13.4c-.18-1.19-.59-2.23-1.23-3.14-.64-.91-1.42-1.62-2.36-2.14-.94-.52-1.95-.78-3.05-.78s-2.17.25-3.12.76c-.95.51-1.74,1.21-2.38,2.12-.64.91-1.06,1.97-1.27,3.18Z"}),(0,v.jsx)("path",{stroke:"currentColor",d:"m241.89,47.62v-22.67h4.45v2.9c.71-1.07,1.6-1.91,2.65-2.52,1.05-.61,2.25-.91,3.59-.91.92.03,1.68.16,2.27.4v4.01c-.42-.18-.85-.3-1.29-.38-.45-.07-.89-.11-1.34-.11-1.31,0-2.47.35-3.48,1.05s-1.81,1.71-2.4,3.05v15.19h-4.45Z"}),(0,v.jsx)("path",{stroke:"currentColor",d:"m268.87,48.02c-2.23,0-4.24-.52-6.04-1.56-1.79-1.04-3.22-2.45-4.27-4.23-1.06-1.78-1.58-3.77-1.58-5.97s.51-4.13,1.51-5.9c1.01-1.77,2.38-3.18,4.1-4.23,1.72-1.05,3.64-1.58,5.75-1.58s3.98.53,5.61,1.58c1.63,1.06,2.93,2.48,3.9,4.28s1.45,3.82,1.45,6.08v1.25h-17.86c.24,1.25.71,2.36,1.4,3.34.7.98,1.59,1.75,2.67,2.32,1.08.56,2.26.85,3.54.85,1.1,0,2.16-.17,3.18-.51,1.02-.34,1.88-.84,2.56-1.49l2.85,2.81c-1.34,1.01-2.71,1.76-4.12,2.25s-2.96.74-4.65.74Zm-7.39-13.63h13.4c-.18-1.19-.59-2.23-1.22-3.14-.64-.91-1.43-1.62-2.36-2.14-.94-.52-1.95-.78-3.05-.78s-2.17.25-3.12.76c-.95.51-1.74,1.21-2.38,2.12-.64.91-1.06,1.97-1.27,3.18Z"}),(0,v.jsx)("path",{stroke:"currentColor",d:"m294.88,47.98c-2.11,0-4.04-.52-5.79-1.56-1.75-1.04-3.13-2.44-4.14-4.21-1.01-1.77-1.51-3.75-1.51-5.95s.51-4.17,1.54-5.92c1.02-1.75,2.41-3.15,4.16-4.19,1.75-1.04,3.7-1.56,5.83-1.56,1.25,0,2.45.19,3.61.58,1.16.39,2.23.95,3.21,1.69v-10.42l4.45-.85v32.02h-4.41v-2.18c-1.93,1.69-4.25,2.54-6.95,2.54Zm.58-3.87c1.3,0,2.5-.24,3.58-.71,1.08-.47,2-1.16,2.74-2.05v-10.2c-.74-.83-1.65-1.49-2.74-1.98s-2.28-.73-3.58-.73c-1.43,0-2.72.34-3.88,1.02-1.16.68-2.08,1.61-2.76,2.78-.68,1.17-1.02,2.5-1.02,3.99s.34,2.82,1.02,4.01c.68,1.19,1.6,2.13,2.76,2.83,1.16.7,2.45,1.05,3.88,1.05Z"}),(0,v.jsx)("path",{stroke:"currentColor",d:"m322.58,47.62v-31.17l4.45-.85v11.49c1.9-1.66,4.2-2.49,6.9-2.49,2.14,0,4.08.52,5.81,1.56,1.74,1.04,3.11,2.43,4.12,4.19,1.01,1.75,1.51,3.73,1.51,5.92s-.51,4.18-1.54,5.95c-1.02,1.77-2.4,3.17-4.14,4.21-1.74,1.04-3.69,1.56-5.86,1.56-1.25,0-2.46-.2-3.63-.6-1.17-.4-2.25-.97-3.23-1.72v1.96h-4.41Zm10.78-3.52c1.45,0,2.75-.34,3.9-1.02,1.14-.68,2.05-1.61,2.74-2.78.68-1.17,1.02-2.5,1.02-3.99s-.34-2.82-1.02-4.01c-.68-1.19-1.6-2.12-2.74-2.81-1.14-.68-2.44-1.02-3.9-1.02-1.28,0-2.47.24-3.56.71-1.1.47-2.02,1.14-2.76,2v10.24c.74.83,1.67,1.48,2.78,1.96,1.11.48,2.29.71,3.54.71Z"}),(0,v.jsx)("path",{stroke:"currentColor",d:"m351.35,57.2c-.47,0-.92-.02-1.34-.07s-.76-.11-1.02-.2v-3.92c.53.12,1.19.18,1.96.18,2.08,0,3.58-1.11,4.5-3.34l.98-2.18-9.08-22.71h4.94l6.59,17.28,7.3-17.28h4.81l-10.95,25.47c-.71,1.6-1.47,2.9-2.27,3.9-.8.99-1.72,1.72-2.76,2.18-1.04.46-2.26.69-3.65.69Z"}),(0,v.jsx)("path",{stroke:"currentColor",d:"m143.02,97.41v-8.49h20.13c3.08,0,5.48-.87,7.2-2.62,1.72-1.75,2.59-4.05,2.59-6.9s-.86-5.2-2.59-6.9-4.13-2.55-7.2-2.55h-26.54v42.39h-8.69v-51.17h35.23c2.9,0,5.48.43,7.76,1.28,2.27.85,4.19,2.05,5.76,3.59,1.56,1.54,2.76,3.42,3.59,5.62.83,2.21,1.24,4.69,1.24,7.46s-.42,5.19-1.24,7.42c-.83,2.23-2.03,4.15-3.59,5.77-1.56,1.61-3.48,2.86-5.76,3.76-2.27.9-4.86,1.35-7.76,1.35h-20.13Z"}),(0,v.jsx)("path",{stroke:"currentColor",d:"m210.01,112.33v-20.03l-26.61-31.14h11.79l19.51,23.13,19.58-23.13h11.17l-26.69,31.14v20.03h-8.75,0Z"}),(0,v.jsx)("path",{stroke:"currentColor",d:"m275.64,112.33v-42.4h-23.06v-8.77h54.9v8.77h-23.09v42.4h-8.75Z"}),(0,v.jsx)("path",{stroke:"currentColor",d:"m362.27,61.16h8.72v51.17h-8.72v-51.17Z"}),(0,v.jsx)("path",{stroke:"currentColor",d:"m324.63,112.33v-22.7h32.45v-7.77h-32.45v-20.7h-8.72v51.17h8.72Z"}),(0,v.jsx)("path",{stroke:"currentColor",d:"m51.17,0c-9.32,0-18.06,2.49-25.59,6.85-4.82,2.78-9.14,6.33-12.79,10.48C4.83,26.35,0,38.2,0,51.17v38.38l12.79,12.79v-51.17c0-11.36,4.94-21.58,12.79-28.61,3.69-3.3,8.03-5.9,12.79-7.58,4-1.42,8.31-2.19,12.79-2.19,21.19,0,38.38,17.18,38.38,38.38s-17.18,38.38-38.38,38.38v12.79c28.26,0,51.17-22.91,51.17-51.17S79.44,0,51.17,0Z"}),(0,v.jsx)("path",{stroke:"currentColor",d:"m63.96,51.17c0,7.06-5.73,12.79-12.79,12.79v12.79c14.13,0,25.59-11.46,25.59-25.59s-11.46-25.59-25.59-25.59c-4.66,0-9.03,1.24-12.79,3.43-7.65,4.42-12.79,12.69-12.79,22.16v63.97l11.5,11.5,1.29,1.29V51.17c0-7.06,5.73-12.79,12.79-12.79s12.79,5.73,12.79,12.79Z"})]})},b=n(64508),w=n.n(b),j=n(17769),y=n(84985),N=n(3011),P=n(78877),k=n(85394),S=n(33715),C=n(6340),Z=function(){var e=(0,y.Os)().wallet,t=(0,h.tc)(),n=t.userPositions,i=t.refreshPositionInfo,r=t.isAnyFormSubmitting,a=(0,y.Bn)().connection,u=(0,C.Z)().promptKeeperCloseAllPositionNotification,x=(0,N.KO)(S.l.isClosingAllPositions),m=(0,l.Z)(x,2),p=m[0],f=m[1],g=(0,s.useCallback)((0,o.Z)(c().mark((function t(){var s;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n&&0!==(null===n||void 0===n?void 0:n.length)){t.next=2;break}return t.abrupt("return");case 2:if(e){t.next=4;break}throw new Error("Wallet not connected");case 4:return f(!0),t.prev=5,t.next=8,Promise.all(n.map((function(t){return(0,P._L)(e,a,t)})));case 8:return s=t.sent,t.next=11,u(s.filter(Boolean));case 11:t.next=16;break;case 13:t.prev=13,t.t0=t.catch(5),console.log("Failed to close all positions!",t.t0);case 16:return t.prev=16,i(),f(!1),t.finish(16);case 20:case"end":return t.stop()}}),t,null,[[5,13,16,20]])}))),[a,u,i,f,n,e]);return(0,v.jsx)("button",{type:"button",className:"rounded-lg whitespace-nowrap px-2 py-1.5 text-white/50 text-xs bg-white/5 border border-[rgba(255,255,255,0.02)] hover:bg-white/10 disabled:opacity-50",disabled:p||0===(null===n||void 0===n?void 0:n.length)||r,onClick:g,children:p?(0,v.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,v.jsx)(k.Z,{width:8,height:8}),(0,v.jsx)("span",{children:d.ag._("Closing...")})]}):d.ag._("Close All")})},_=p()((function(){return n.e(4710).then(n.bind(n,44710))}),{ssr:!1,loadableGenerated:{webpack:function(){return[44710]}}}),T=function(){return(0,v.jsx)("div",{className:"border-l border-l-v2-lily/5 h-full"})},M=function(e){var t=e.title,n=e.active,s=e.onClick;return(0,v.jsx)("button",{type:"button",onClick:s,className:(0,f.cn)("leading-none flex items-center font-semibold text-xs text-white/20 whitespace-nowrap","hover:!text-v2-lily",{"!text-v2-lily":n}),children:t})},O=function(e){var t=e.activeTab,n=e.setActiveTab,i=e.className,r=e.showPositions,o=e.setShowPositions,a=e.children,c=(0,h.tc)().userPositions,u=(0,s.useMemo)((function(){return(null===c||void 0===c?void 0:c.length)||0}),[null===c||void 0===c?void 0:c.length]),x=(0,j.XA)(),m=s.useState(!1),p=(0,l.Z)(m,2),b=p[0],y=p[1],N=(0,s.useRef)(null),P=(0,s.useRef)(null);return(0,s.useEffect)((function(){function e(){var e,t=(null===(e=P.current)||void 0===e?void 0:e.offsetTop)||0;N.current&&x&&window.scrollY>t?y(!0):y(!1)}return window.addEventListener("scroll",e),function(){window.removeEventListener("scroll",e)}}),[x]),(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{ref:P,className:"w-full"}),(0,v.jsx)("div",{className:(0,f.cn)(b?"pt-[44px]":"")}),(0,v.jsx)("div",{ref:N,className:(0,f.cn)("flex w-full lg:mx-auto bg-[#16202B] relative",i,b?"fixed top-0 w-full z-50":""),children:(0,v.jsx)("div",{className:"w-full max-w-full overflow-hidden",children:(0,v.jsxs)("div",{className:"lg:flex flex-row justify-between w-full border-b border-v2-lily/5",children:[(0,v.jsxs)("div",{className:"flex justify-between",children:[(0,v.jsxs)("div",{className:"flex space-x-6 justify-start items-center overflow-y-auto p-3 w-full",children:[(0,v.jsx)(M,{title:u>0?d.ag._("Positions ({0})",{0:null===c||void 0===c?void 0:c.length}):d.ag._("Positions"),active:"Positions"===t,onClick:function(){return n("Positions")}}),(0,v.jsx)(M,{title:d.ag._("Trade History"),active:"Trade History"===t,onClick:function(){return n("Trade History")}}),(0,v.jsx)(M,{title:d.ag._("Expired Orders"),active:"Expired Orders"===t,onClick:function(){return n("Expired Orders")}})]}),(0,v.jsx)("div",{className:"flex 2xl:hidden items-center pr-2",children:(0,v.jsx)(Z,{})})]}),(0,v.jsxs)("div",{className:"hidden lg:flex items-center px-2 gap-x-2",children:[(0,v.jsxs)("div",{className:"flex whitespace-nowrap space-x-2 items-center text-xs text-v2-lily/50",children:[(0,v.jsx)(_,{active:r,onClick:function(){return o((function(e){return!e}))}}),(0,v.jsx)("span",{children:d.ag._("Show Positions on Chart")})]}),(0,v.jsx)(T,{}),(0,v.jsx)(w(),{href:"https://pyth.network/",rel:"noopener noreferrer",target:"_blank",className:(0,f.cn)(" items-center space-x-2 justify-end px-4 py-2 text-v2-lily/50 fill-current text-xxs","pl-4"),children:(0,v.jsx)(g,{width:60,height:20})})]})]})})}),a]})},F=n(87648),L=n(76613),D=n(68586),A=n(72997),q=n(89953),R=n(56100),I=n(20787),U=n(25546),V=n(11352),E=function(e){var t=e.price,n=e.precision,i=e.children,l=(0,s.useState)(""),r=l[0],o=l[1],a=(0,U.D9)(null===t||void 0===t?void 0:t.toDP(n)),c=(0,s.useRef)(Date.now());return(0,s.useEffect)((function(){var e=null===t||void 0===t?void 0:t.toDP(n);if(a)return null!==e&&void 0!==e&&e.gt(a)?(o("text-perps-green"),void(c.current=Date.now())):null!==e&&void 0!==e&&e.lt(a)?(o("text-red-500"),void(c.current=Date.now())):void(null!==e&&void 0!==e&&e.eq(a)&&Date.now()-c.current>1e3&&o(""));Date.now()-c.current>1e3&&o("")}),[t]),(0,v.jsx)("span",{className:(0,f.cn)("transition-all duration-100 text-white",r),children:i})},z=n(6397),B=n(46226),K=n(21039);var $=n(6901),W=n(73360),H=n(3380),G=n(99384),Y=function(e){var t=e.loading,n=e.emptyText,s=e.className,i=(0,y.Os)().wallet;return(0,v.jsx)("div",{className:(0,f.cn)("flex flex-col items-center space-y-2 rounded-lg mt-4 bg-white-5 py-[60px] justify-start dark:border-white-10 mx-5 lg:mx-0",s),children:null!==i&&void 0!==i&&i.adapter.publicKey?(0,v.jsx)(v.Fragment,{children:t?(0,v.jsxs)("div",{className:"flex items-center",children:[(0,v.jsx)("div",{className:"mr-2 fill-current animate-spin",children:(0,v.jsx)(G.Z,{width:8,height:8})}),(0,v.jsx)("div",{className:"text-sm dark:text-white/50",children:(0,v.jsx)(W.cC,{id:"Loading data"})})]}):(0,v.jsx)("div",{className:"text-sm dark:text-white/50",children:n})}):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{className:"text-sm dark:text-white/50",children:(0,v.jsx)(W.cC,{id:"Connect your wallet to see your Trades"})}),(0,v.jsx)(H.T,{})]})})},Q=n(14518),J=n(40558),X=n(88381),ee=n(36872),te=n(59978),ne=function(e){var t=e.width,n=void 0===t?15:t,s=e.height,i=void 0===s?15:s;return(0,v.jsx)("svg",{width:n,height:i,viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,v.jsx)("path",{id:"Icon",d:"M11.9999 6.66665L9.33319 3.99998M1.6665 14.3333L3.92275 14.0826C4.19841 14.052 4.33624 14.0367 4.46507 13.995C4.57936 13.958 4.68814 13.9057 4.78843 13.8396C4.90147 13.765 4.99953 13.6669 5.19565 13.4708L13.9999 4.66665C14.7362 3.93027 14.7362 2.73636 13.9999 1.99998C13.2635 1.2636 12.0696 1.2636 11.3332 1.99998L2.52899 10.8042C2.33287 11.0003 2.23481 11.0983 2.16026 11.2114C2.09413 11.3117 2.04185 11.4205 2.00485 11.5347C1.96314 11.6636 1.94783 11.8014 1.9172 12.0771L1.6665 14.3333Z",stroke:"currentColor",strokeWidth:"1.3",strokeLinecap:"round",strokeLinejoin:"round"})})},se=n(86150),ie=function(e){var t=e.width,n=void 0===t?12:t,s=e.height,i=void 0===s?12:s;return(0,v.jsx)("svg",{width:n,height:i,viewBox:"0 0 12 12",fill:"inherit",fillOpacity:0,xmlns:"http://www.w3.org/2000/svg",children:(0,v.jsx)("path",{d:"M5 1.5H8M2 3H11M10 3L9.64936 8.25964C9.59675 9.04877 9.57044 9.44333 9.40001 9.7425C9.24996 10.0059 9.02362 10.2176 8.75083 10.3498C8.44098 10.5 8.04555 10.5 7.25467 10.5H5.74533C4.95445 10.5 4.55902 10.5 4.24917 10.3498C3.97638 10.2176 3.75004 10.0059 3.59999 9.7425C3.42956 9.44333 3.40325 9.04877 3.35064 8.25965L3 3M5.5 5.25V7.75M7.5 5.25V7.75",stroke:"currentColor",strokeWidth:"1.3",strokeLinecap:"round",strokeLinejoin:"round"})})},le=n(63956),re=n(71048),oe=n(69825),ae=n(12866),ce=n(94728),de=n(70107),ue=n(57565),xe=n(8770);function me(e){return pe.apply(this,arguments)}function pe(){return(pe=(0,o.Z)(c().mark((function e(t){var n,s,i,l,r,o,a,d;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.wallet,s=t.connection,i=t.positionAccount,l=t.positionRequestAccount,r=t.sizeUsdDelta,o=t.triggerPrice,a=n.adapter.publicKey){e.next=4;break}throw new Error("Wallet not connected");case 4:return d=(0,xe.h)(n,s),e.prev=5,e.next=8,d.methods.updateDecreasePositionRequest({sizeUsdDelta:r,triggerPrice:o}).accounts({owner:a,perpetuals:h.TJ,pool:h.FW,position:i.publicKey,positionRequest:l,custody:i.custody.publicKey,custodyOracleAccount:i.custody.account.oracle.oracleAccount}).instruction();case 8:return e.abrupt("return",e.sent);case 11:throw e.prev=11,e.t0=e.catch(5),console.log(e.t0),e.t0;case 15:case"end":return e.stop()}}),e,null,[[5,11]])})))).apply(this,arguments)}var fe=n(75206),he=n(58532);function ve(e){return ge.apply(this,arguments)}function ge(){return(ge=(0,o.Z)(c().mark((function e(t){var n,s,i,r,o,a,d,u,x,m,p,f,v,g,b,w,j,y,N,P;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.wallet,s=t.connection,i=t.cancelTP,r=t.cancelSL,e.prev=1,o=n.adapter.publicKey){e.next=5;break}throw new Error("Wallet not connected");case 5:if(a=(0,xe.h)(n,s),d=[],u=[],!i){e.next=21;break}return e.next=11,(0,he.c1)(i.positionRequestMint,o,s);case 11:return x=e.sent,m=(0,l.Z)(x,2),p=m[0],f=m[1],v=ce.PublicKey.findProgramAddressSync([i.positionRequestPubkey.toBuffer(),fe.TOKEN_PROGRAM_ID.toBuffer(),i.positionRequestMint.toBuffer()],fe.ASSOCIATED_TOKEN_PROGRAM_ID)[0],f&&d.push(f),e.next=19,a.methods.closePositionRequest({}).accounts({keeper:null,owner:o,ownerAta:p,pool:h.FW,positionRequest:i.positionRequestPubkey,positionRequestAta:v,position:i.positionPubkey}).instruction();case 19:g=e.sent,u.push(g);case 21:if(!r){e.next=34;break}return e.next=24,(0,he.c1)(r.positionRequestMint,o,s);case 24:return b=e.sent,w=(0,l.Z)(b,2),j=w[0],y=w[1],N=ce.PublicKey.findProgramAddressSync([r.positionRequestPubkey.toBuffer(),fe.TOKEN_PROGRAM_ID.toBuffer(),r.positionRequestMint.toBuffer()],fe.ASSOCIATED_TOKEN_PROGRAM_ID)[0],y&&d.push(y),e.next=32,a.methods.closePositionRequest({}).accounts({keeper:null,owner:o,ownerAta:j,pool:h.FW,positionRequest:r.positionRequestPubkey,positionRequestAta:N,position:r.positionPubkey}).instruction();case 32:P=e.sent,u.push(P);case 34:return e.abrupt("return",{preInstructions:d,instructions:u});case 37:throw e.prev=37,e.t0=e.catch(1),console.log(e.t0),e.t0;case 41:case"end":return e.stop()}}),e,null,[[1,37]])})))).apply(this,arguments)}function be(e){return we.apply(this,arguments)}function we(){return(we=(0,o.Z)(c().mark((function e(t){var n,s,i,l,r,o,a,d,u,x,m,p,f,h,v,g,b,w,j,y;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.wallet,s=t.connection,i=t.positionAccount,t.custody,l=t.desiredMint,r=t.tpPrice,o=t.slPrice,a=t.updateTPPrice,d=t.updateSLPrice,u=t.cancelTP,x=t.cancelSL,e.prev=1,n.adapter.publicKey){e.next=5;break}throw new Error("Wallet not connected");case 5:if(!([r,o,a,d,u,x].filter(Boolean).length>2)){e.next=7;break}throw new Error("Only two actions can be performed at a time");case 7:if(m=[],p=[],!r&&!o){e.next=17;break}return e.next=12,(0,P.Zn)({wallet:n,connection:s,positionAccount:i,desiredMint:l,tpPrice:r,slPrice:o});case 12:f=e.sent,h=f.preInstructions,v=f.instructions,h&&m.push.apply(m,(0,de.Z)(h)),v&&p.push.apply(p,(0,de.Z)(v));case 17:if(!a){e.next=22;break}return e.next=20,me({wallet:n,connection:s,positionAccount:i,positionRequestAccount:a.positionRequestAccount,sizeUsdDelta:new ue.BN(0),triggerPrice:a.triggerPrice});case 20:g=e.sent,p.push(g);case 22:if(!d){e.next=27;break}return e.next=25,me({wallet:n,connection:s,positionAccount:i,positionRequestAccount:d.positionRequestAccount,sizeUsdDelta:new ue.BN(0),triggerPrice:d.triggerPrice});case 25:b=e.sent,p.push(b);case 27:if(!u&&!x){e.next=35;break}return e.next=30,ve({wallet:n,connection:s,cancelTP:u,cancelSL:x});case 30:w=e.sent,j=w.preInstructions,y=w.instructions,j&&m.push.apply(m,(0,de.Z)(j)),y&&p.push.apply(p,(0,de.Z)(y));case 35:return e.abrupt("return",[].concat(m,p));case 38:throw e.prev=38,e.t0=e.catch(1),console.log(e.t0),e.t0;case 42:case"end":return e.stop()}}),e,null,[[1,38]])})))).apply(this,arguments)}var je=n(39694),ye=n.n(je)()((function(e){var t,n,s,i;return{hasTp:null!==(t=e.takeProfitPositionRequest)&&void 0!==t&&t.account.triggerPrice?new x.Z(null===(n=e.takeProfitPositionRequest)||void 0===n?void 0:n.account.triggerPrice.toString()).div(1e6):null,hasSl:null!==(s=e.stopLossPositionRequest)&&void 0!==s&&s.account.triggerPrice?new x.Z(null===(i=e.stopLossPositionRequest)||void 0===i?void 0:i.account.triggerPrice.toString()).div(1e6):null}})),Ne=function(e){var t,n,i=e.positionAccount,l=e.tpPrice,r=e.slPrice,o=(0,h.tc)().oraclePrices,a=(0,s.useMemo)((function(){return"long"===i.side}),[i.side]),c=(0,s.useMemo)((function(){var e=i.custody.account.mint.toString();return o&&o[e]}),[i.custody.account.mint,o]),d=(0,s.useMemo)((function(){return c?c.toNearest(.01,x.Z.ROUND_DOWN):null}),[c]),u=(0,s.useMemo)((function(){var e,t;return c&&null!==(e=i.accounting)&&void 0!==e&&e.liquidationPrice?(a?new x.Z(null===(t=i.accounting)||void 0===t?void 0:t.liquidationPrice.div(1e6).toFixed(2)):c).toNearest(.01,x.Z.ROUND_DOWN):null}),[c,null===(t=i.accounting)||void 0===t?void 0:t.liquidationPrice,a]),m=(0,s.useMemo)((function(){var e,t;return c&&null!==(e=i.accounting)&&void 0!==e&&e.liquidationPrice?(a?c:new x.Z(null===(t=i.accounting)||void 0===t?void 0:t.liquidationPrice.div(1e6).toFixed(2))).toNearest(.01,x.Z.ROUND_DOWN):null}),[c,null===(n=i.accounting)||void 0===n?void 0:n.liquidationPrice,a]),p=(0,s.useMemo)((function(){return!(!l.floatValue||!d)&&(a?new x.Z(l.floatValue).gte(d):new x.Z(l.floatValue).lte(d))}),[d,a,l.floatValue]),f=(0,s.useMemo)((function(){return!!(r.floatValue&&u&&m)&&(a?new x.Z(r.floatValue).gte(u)&&new x.Z(r.floatValue).lte(m):new x.Z(r.floatValue).lte(m)&&new x.Z(r.floatValue).gte(u))}),[m,u,a,r]),v=(0,s.useCallback)((function(e){if(!i.accounting)return null;var t=e.sub(i.price).mul(a?1:-1),n=new x.Z(i.sizeUsd.toString()).div(new x.Z(i.price.toString())).mul(t),s=new x.Z(n).minus(i.accounting.totalFeeUsd);return{positionValue:new x.Z(i.sizeUsd.toString()).add(s),pnlRate:s.div(new x.Z(i.accounting.initialCollateral.toString())).mul(100),pnl:s}}),[a,i.accounting,i.price,i.sizeUsd]),g=(0,s.useMemo)((function(){return l.floatValue&&p?v(new x.Z(l.floatValue).mul(1e6)):null}),[l.floatValue,p,v]),b=(0,s.useMemo)((function(){return r.floatValue&&f?v(new x.Z(r.floatValue).mul(1e6)):null}),[r.floatValue,f,v]),w=ye(i),j=w.hasTp,y=w.hasSl;return{showTPChanged:(0,s.useMemo)((function(){return!(null===j||void 0===j||!j.gt(0)||!l.floatValue||new x.Z(l.floatValue).eq(j)||!p)}),[j,p,l.floatValue]),showTPRemoved:(0,s.useMemo)((function(){return!(null===j||void 0===j||!j.gt(0)||l.floatValue)}),[j,l.floatValue]),showSLChanged:(0,s.useMemo)((function(){return!(null===y||void 0===y||!y.gt(0)||!r.floatValue||new x.Z(r.floatValue).eq(y)||!f)}),[y,f,r.floatValue]),showSLRemoved:(0,s.useMemo)((function(){return!(null===y||void 0===y||!y.gt(0)||r.floatValue)}),[y,r.floatValue]),minimumTPPrice:d,minimumSLPrice:u,maximumSLPrice:m,isWithinTPRange:p,isWithinSLRange:f,expectedPositionValueAtSL:b,expectedPositionValueAtTP:g}},Pe=function(e){var t=e.changePct,n=e.pnl;if(!t||!n)return(0,v.jsx)(R.O,{className:"!w-12 !h-4"});var s=n.abs().div(1e6).toFixed(2),i=t.toDP(2).abs().toFixed(2);return(0,v.jsx)("p",{className:(0,f.cn)("text-xs",n.gt(0)?"text-perps-green":"text-perps-red"),children:n.gt(0)?"+$".concat(s," (+").concat(i,"%)"):"-$".concat(s," (-").concat(i,"%)")})},ke=n(80751);function Se(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,s)}return n}function Ce(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Se(Object(n),!0).forEach((function(t){(0,le.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Se(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ze(e){var t,n,s;return e?{floatValue:null!==(t=null===e||void 0===e?void 0:e.toNumber())&&void 0!==t?t:void 0,formattedValue:null!==(n=null===e||void 0===e?void 0:e.toString())&&void 0!==n?n:"",value:null!==(s=null===e||void 0===e?void 0:e.toString())&&void 0!==s?s:""}:{floatValue:void 0,formattedValue:"",value:""}}var _e=function(e){var t=e.open,n=e.onClose,i=e.positionAccount,l=e.type,r=(0,h.tc)(),a=r.viewClient,u=r.oraclePrices,x=r.isAnyFormSubmitting,m=(0,y.Bn)(),p=m.connection,g=m.getTokenInfo,b=m.tokenMap,w=(0,y.Os)().wallet,j=(0,C.Z)().promptKeeperCreateTPSLNotification,N=(0,s.useMemo)((function(){return g(i.custody.account.mint.toString())}),[g,i.custody.account.mint]),P=s.useRef(null);(0,L.O3)(P,(function(){var e;return null===(e=P.current)||void 0===e?void 0:e.close()}));var S=(0,s.useCallback)((function(){var e;null===(e=P.current)||void 0===e||e.close(),n()}),[n,P]);(0,s.useEffect)((function(){if(P.current&&(t?P.current.open||P.current.show():P.current.close()),t){var e=P.current;return null===e||void 0===e||e.addEventListener("close",S),function(){null===e||void 0===e||e.removeEventListener("close",S)}}}),[S,t]);var Z=(0,s.useMemo)((function(){return g(i.collateralCustody.account.mint.toString())}),[g,i.collateralCustody.account.mint]),_=ye(i),T=_.hasTp,M=_.hasSl,O=(0,re.cI)({defaultValues:{tpPrice:Ze(T),slPrice:Ze(M)}}),F=O.control,D=O.handleSubmit,A=O.watch,q=(O.setValue,O.formState),R=A("tpPrice"),I=A("slPrice"),U=Ne({positionAccount:i,tpPrice:R,slPrice:I}),V=U.expectedPositionValueAtSL,E=U.expectedPositionValueAtTP,z=(0,s.useState)(null),B=z[0],K=z[1],$=(0,s.useMemo)((function(){var e=i.takeProfitPositionRequest||i.stopLossPositionRequest;if(e)return e}),[i.stopLossPositionRequest,i.takeProfitPositionRequest]);(0,s.useEffect)((function(){$&&K(b.get($.account.mint.toString())||null),!B&&Z&&K(Z)}),[Z,$,B,b]);var H=(0,s.useMemo)((function(){var e=i.custody.account.mint.toString();return u&&u[e]?u[e]:null}),[u,i.custody.account.mint]),G=(0,s.useMemo)((function(){return q.isSubmitting}),[q.isSubmitting]),Y=(0,s.useCallback)((0,o.Z)(c().mark((function e(){var t,n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(w&&w.adapter.publicKey&&N&&a&&H&&B){e.next=2;break}return e.abrupt("return");case 2:if(e.prev=2,t="tp"===l&&i.takeProfitPositionRequest?{cancelTP:{positionPubkey:i.publicKey,positionRequestPubkey:i.takeProfitPositionRequest.publicKey,positionRequestMint:i.takeProfitPositionRequest.account.mint},cancelSL:null}:"sl"===l&&i.stopLossPositionRequest?{cancelTP:null,cancelSL:{positionPubkey:i.publicKey,positionRequestPubkey:i.stopLossPositionRequest.publicKey,positionRequestMint:i.stopLossPositionRequest.account.mint}}:void 0){e.next=6;break}throw new Error("No cancel action found!");case 6:return e.next=8,be(Ce({wallet:w,connection:p,positionAccount:i,custody:i.custody.account,desiredMint:new ce.PublicKey(B.address),tpPrice:null,slPrice:null,updateTPPrice:null,updateSLPrice:null},t));case 8:return n=e.sent,e.next=11,new Promise(function(){var e=(0,o.Z)(c().mark((function e(t,s){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j(n,(function(e){S(),t(e)}),(function(e){s(e)}),"tp"===l?d.ag._("Removing Take Profit..."):d.ag._("Removing Stop Loss..."));case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 11:return e.abrupt("return",e.sent);case 14:e.prev=14,e.t0=e.catch(2),console.log("Failed to submit position request!",e.t0);case 17:case"end":return e.stop()}}),e,null,[[2,14]])}))),[w,N,a,H,B,p,i,l,j,S]);return(0,v.jsx)(ke.Z,{open:t,onClose:n,children:(0,v.jsxs)("form",{className:"relative w-full lg:max-w-[400px] bg-v2-perps-modal rounded-lg",children:[(0,v.jsx)("div",{className:"p-6 font-semibold text-lg text-v2-lily",children:"tp"===l?d.ag._("Remove Take Profit"):d.ag._("Remove Stop Loss")}),(0,v.jsx)("button",{type:"button",disabled:x,className:"flex absolute top-5 lg:top-8 right-8 z-10 text-v2-lily/[.25] fill-current cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed",onClick:S,children:(0,v.jsx)(ae.Z,{width:12,height:12})}),(0,v.jsxs)("div",{className:"max-h-[80vh] overflow-y-auto",children:[(0,v.jsxs)("div",{className:"px-6",children:[(0,v.jsx)("div",{className:"flex text-sm whitespace-nowrap flex-wrap text-v2-lily/50",children:(0,v.jsx)(W.cC,{id:"<0>{0}</0><1>{1}?</1>",values:{0:d.ag._("Are you sure you want to remove your"),1:"tp"===l?d.ag._("take profit"):d.ag._("stop loss")},components:{0:(0,v.jsx)("p",{}),1:(0,v.jsx)("p",{className:"mx-1"})}})}),"tp"===l?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{className:"mt-5",children:(0,v.jsxs)("div",{className:"flex justify-between items-end leading-none",children:[(0,v.jsx)("div",{className:"text-v2-lily text-sm font-semibold",children:d.ag._("Take Profit Price:")}),E?(0,v.jsx)("div",{className:"text-v2-lily/[.25] hover:text-v2-lily text-xs",children:(0,v.jsx)(Pe,{changePct:E.pnlRate,pnl:E.pnl})}):null]})}),(0,v.jsx)("div",{className:"mt-2 rounded-lg bg-v2-perps-input pl-2 pr-4 py-3.5 text-md text-right",children:(0,v.jsx)(re.Qr,{name:"tpPrice",control:F,render:function(e){var t=e.field,n=t.onChange,s=t.value;return(0,v.jsx)(oe.Z,{disabled:!0,decimals:6,onChange:n,value:s.value,className:"disabled:cursor-not-allowed !outline-none !text-right w-full !text-sm",placeholder:"0.00",suffix:" USD"})}})}),(0,v.jsx)("div",{className:"mt-1 space-y-1",children:E?(0,v.jsx)("p",{className:"text-xs text-v2-lily/30",children:d.ag._("Expected position value: ${0}",{0:E.positionValue.div(1e6).toFixed(2)})}):null})]}):null,"sl"===l?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{className:"mt-5",children:(0,v.jsxs)("div",{className:"flex justify-between items-end leading-none",children:[(0,v.jsx)("div",{className:"text-v2-lily text-sm font-semibold",children:d.ag._("Stop Loss Price:")}),V?(0,v.jsx)("div",{className:"text-v2-lily/[.25] hover:text-v2-lily text-xs",children:(0,v.jsx)(Pe,{changePct:V.pnlRate,pnl:V.pnl})}):null]})}),(0,v.jsx)("div",{className:"mt-2 rounded-lg bg-v2-perps-input pl-2 pr-4 py-3.5 text-md text-right",children:(0,v.jsx)(re.Qr,{name:"slPrice",control:F,render:function(e){var t=e.field,n=t.onChange,s=t.value;return(0,v.jsx)(oe.Z,{disabled:!0,decimals:6,onChange:n,value:s.value,className:"disabled:cursor-not-allowed !outline-none !text-right w-full !text-sm",placeholder:"0.00",suffix:" USD"})}})}),(0,v.jsx)("div",{className:"mt-1 space-y-1",children:V?(0,v.jsx)("span",{className:"text-xs text-v2-lily/30",children:d.ag._("Expected position value: ${0}",{0:V.positionValue.div(1e6).toFixed(2)})}):null})]}):null]}),(0,v.jsxs)("div",{className:"w-full text-xs flex p-6 space-x-3",children:[q.isSubmitting?null:(0,v.jsx)("button",{type:"button",className:(0,f.cn)("w-full py-2.5 px-6 border rounded-lg border-v2-lily/10 text-v2-lily bg-v2-lily/5 hover:bg-v2-lily/10 text-sm font-semibold disabled:cursor-not-allowed disabled:opacity-20",{"opacity-50 curosr-not-allowed":q.isSubmitting}),disabled:q.isSubmitting,onClick:S,children:(0,v.jsx)("span",{children:d.ag._("Cancel")})}),(0,v.jsx)("button",{type:"button",className:(0,f.cn)("w-full py-2.5 px-6 border rounded-lg border-labs/20 text-labs hover:bg-labs/5 text-sm font-semibold disabled:cursor-not-allowed disabled:opacity-20",{"opacity-50 curosr-not-allowed":q.isSubmitting||G}),disabled:G,onClick:D(Y),children:q.isSubmitting?(0,v.jsxs)("span",{className:"flex justify-center items-center",children:[(0,v.jsx)(k.Z,{className:"!h-4 !w-4",baseColor:"white",spinnerColor:"black"}),(0,v.jsx)("div",{className:"mr-2"}),"tp"===l?d.ag._("Removing Take Profit"):d.ag._("Removing Stop Loss")]}):(0,v.jsx)("span",{className:"text-center",children:d.ag._("Confirm")})})]})]})]})})},Te=function(e,t){var n=U.uf.format(e.abs().div(1e6),t);return e.gt(0)?"+$".concat(n):"-$".concat(n)},Me=function(e){var t=e.positionAccount;if(!t.accounting)return(0,v.jsx)(R.O,{className:"!w-24 !h-9"});var n=t.accounting,s=n.unrealizedPNL,i=n.unrealizedPNLPct,l=n.positionValue,r=n.initialCollateral,o=n.fundingFeeUsd,a=n.openPositionFeeUsd,c=n.closePositionFeeUsd,u=n.pnlAfterFeesUsd,m=t.pool,p=(0,$.y)(l);return(0,v.jsxs)("div",{className:(0,f.cn)("text-sm text-v2-lily"),children:[(0,v.jsx)("div",{className:"flex",children:(0,v.jsx)(J.Z,{variant:"dark",placement:"top",content:(0,v.jsxs)("div",{className:"flex flex-col text-white cursor-help",children:[(0,v.jsx)("p",{children:d.ag._("Net Value:")}),(0,v.jsx)("p",{className:"mb-4",children:d.ag._("Initial collateral + PnL - Fees")}),(0,v.jsxs)("div",{className:"flex justify-between mb-1",children:[(0,v.jsx)("span",{className:"text-white/50",children:d.ag._("Initial Collateral:")}),(0,v.jsxs)("span",{children:["$",r.add(a).div(1e6).toFixed(p)]})]}),(0,v.jsxs)("div",{className:"flex justify-between mb-1",children:[(0,v.jsx)("span",{className:"text-white/50",children:d.ag._("PnL:")}),(0,v.jsx)("span",{children:Te(s,p)})]}),(0,v.jsxs)("div",{className:"flex justify-between mb-1",children:[(0,v.jsx)("span",{className:"text-white/50",children:d.ag._("Borrow Fee:")}),(0,v.jsxs)("span",{children:["-$",o.div(1e6).toFixed(p)]})]}),(0,v.jsxs)("div",{className:"flex justify-between mb-1",children:[(0,v.jsx)("span",{className:"text-white/50",children:d.ag._("Open Fee ({0}%):",{0:new x.Z(m.fees.increasePositionBps.toString()).div(100).toDP(2).toString()})}),(0,v.jsxs)("span",{children:["-$",a.div(1e6).toFixed(p)]})]}),(0,v.jsxs)("div",{className:"flex justify-between mb-1",children:[(0,v.jsx)("span",{className:"text-white/50",children:d.ag._("Close Fee ({0}%):",{0:new x.Z(m.fees.decreasePositionBps.toString()).div(100).toDP(2).toString()})}),(0,v.jsxs)("span",{children:["-$",c.div(1e6).toFixed(p)]})]}),(0,v.jsxs)("div",{className:"flex justify-between",children:[(0,v.jsx)("span",{className:"text-white/50",children:d.ag._("PnL After Fees:")}),(0,v.jsx)("span",{children:Te(u,p)})]}),(0,v.jsx)("p",{className:"mt-2 text-white/50 !w-[180px]",children:d.ag._("PnL calculated are estimated and does not includes price impact.")})]}),children:(0,v.jsxs)("span",{className:"underline decoration-dashed decoration-1 underline-offset-[3px] decoration-white/50 cursor-help",children:["$",U.uf.format(l.div(1e6),p)]})})}),(0,v.jsx)(Pe,{changePct:i,pnl:s})]})},Oe=function(e){var t,n,i,r,o,a,c,u,m,p,g,b,w,j,P,k,C,Z,_,T=e.positionAccount,M=e.onSelectMarket,O=e.onShowEditCollateralDialog,F=e.onShowCloseConfirmationDialog,L=e.onShowEditTPSLDialog,D=e.setShowPerpsShareDialog,A=(0,h.tc)(),q=A.oraclePrices,I=A.userPositionsLoading,V=A.isAnyFormSubmitting,E=(0,y.Bn)().getTokenInfo,z=(0,s.useMemo)((function(){return E(T.custody.account.mint.toString())}),[E,T.custody.account.mint]),B=(0,N.KO)(S.l.isClosingAllPositions),K=(0,l.Z)(B,1)[0],H=(0,s.useCallback)((function(){T&&!K&&F({positionAccountPubkey:T.publicKey})}),[K,F,T]),G=null!==(t=T.accounting)&&void 0!==t&&t.unrealizedPNL.abs().gt(100)?2:4,Y=(0,s.useState)(!1),le=Y[0],re=Y[1],oe=(0,s.useMemo)((function(){return q&&q[T.custody.account.mint.toString()]}),[q,T.custody.account.mint]),ae=(0,$.y)(oe),ce=(0,s.useCallback)((function(){z&&oe&&T.accounting&&D({symbol:null===z||void 0===z?void 0:z.symbol,leverage:T.leverage.toFixed(2),side:T.side,entryPrice:U.uf.format(T.price.div(1e6),ae),markPrice:U.uf.format(oe,ae),openedDate:(0,Q.Z)(new Date(1e3*T.position.openTime.toNumber()),"MMM dd, kk:mm O"),pnlPercentage:T.accounting.unrealizedPNL.gt(0)?T.accounting.unrealizedPNLPct.toDP(2):T.accounting.unrealizedPNLPct.toDP(2).mul(-1)})}),[z,oe,T.accounting,T.leverage,T.side,T.price,T.position.openTime,D,ae]),de=(0,s.useMemo)((function(){return T?T.sizeUsd.div(T.price):null}),[T]);return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("div",{className:(0,f.cn)("hidden 2xl:flex","justify-between items-center rounded-lg h-[72px] min-w-[1092px] border-b border-b-v2-lily/[0.02] overflow-x-hidden"),children:[(0,v.jsxs)("div",{onClick:function(){return M(T)},className:"cursor-pointer pl-2 py-3 flex text-white/[.75] items-center text-xs w-[130px]",children:[(0,v.jsx)(te.Z,{info:z}),(0,v.jsxs)("div",{className:"ml-2",children:[(0,v.jsx)(J.Z,{variant:"dark",placement:"top",content:(0,v.jsxs)("div",{className:"leading-none space-y-2",children:[(0,v.jsx)("p",{className:"text-xs",children:(0,v.jsx)(W.cC,{id:"Click on a row to select the position's market, then use the trade box to increase your position size if needed."})}),(0,v.jsx)("p",{className:"text-xs",children:(0,v.jsx)(W.cC,{id:'Use the "Close" button to reduce your position size, or to set stop-loss / take-profit orders.'})})]}),children:(0,v.jsx)("p",{className:"underline font-semibold decoration-dashed decoration-1 underline-offset-[3px] decoration-white/50 text-sm text-v2-lily",children:null===z||void 0===z?void 0:z.symbol})}),(0,v.jsxs)("p",{className:"text-xs text-white/75",children:[T.leverage.toFixed(2),"x ",T.side]})]})]}),(0,v.jsx)("div",{className:"pl-2 py-3 flex text-white/[.75] items-center text-xs w-[128px]",children:(0,v.jsx)(Me,{positionAccount:T})}),(0,v.jsxs)("div",{className:"pl-2 py-3 flex flex-col text-xs w-[70px]",children:[(0,v.jsx)("span",{className:"text-white/[.75]",children:T.sizeUsd?"$"+T.sizeUsd.div(1e6).toFixed(2):(0,v.jsx)(R.O,{className:"!h-4 !w-10"})}),(0,v.jsx)("span",{className:"text-v2-lily/40 whitespace-nowrap flex",children:de?(0,v.jsxs)(v.Fragment,{children:[(0,X.M)({value:de.toDP(null===z||void 0===z?void 0:z.decimals).toNumber()}),(0,v.jsx)("span",{className:"ml-0.5",children:null===z||void 0===z?void 0:z.symbol})]}):(0,v.jsx)(R.O,{className:"!h-4 !w-10"})})]}),(0,v.jsx)("div",{className:"pl-2 py-3 flex text-white/[.75] items-center text-xs w-[120px] space-x-2",children:(0,v.jsx)("div",{className:"flex items-center cursor-help text-xs space-x-2",children:null!==(n=T.accounting)&&void 0!==n&&n.initialCollateral.gt(0)?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(J.Z,{variant:"dark",placement:"top",content:(0,v.jsxs)("div",{className:"leading-none",children:[(0,v.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,v.jsx)("div",{className:"text-white/75",children:d.ag._("Initial Collateral:")}),(0,v.jsxs)("div",{children:["$",null===(i=T.accounting)||void 0===i?void 0:i.initialCollateral.div(1e6).toFixed(G)]})]}),(0,v.jsxs)("div",{className:"flex justify-between text-xs mt-2",children:[(0,v.jsx)("div",{className:"text-white/75",children:d.ag._("Borrow Fee:")}),(0,v.jsxs)("div",{children:["-$",null===(r=T.accounting)||void 0===r?void 0:r.fundingFeeUsd.div(1e6).toFixed(G)]})]}),(0,v.jsxs)("div",{className:"flex justify-between text-xs mt-2",children:[(0,v.jsx)("div",{className:"text-white/75",children:d.ag._("Borrow Fee / Hour:")}),(0,v.jsxs)("div",{children:["-$",null===(o=T.accounting)||void 0===o?void 0:o.borrowFeePerHourForPosition.div(1e6).toFixed(G)]})]}),(0,v.jsx)("div",{className:"mt-4",children:(0,v.jsx)("p",{className:"text-xs",children:(0,v.jsx)(W.cC,{id:"Use the Edit Collateral icon to deposit or withdraw collateral."})})})]}),children:(0,v.jsx)("span",{children:"$"+(null===(a=T.accounting)||void 0===a?void 0:a.initialCollateral.div(1e6).toFixed(2))})}),(0,v.jsx)("button",{type:"button",onClick:function(){return O({positionAccountPubkey:T.publicKey})},disabled:V,className:(0,f.cn)("rounded-lg px-2 py-1.5 text-white/50 text-xs bg-white/5 border border-[rgba(255,255,255,0.02)] hover:bg-white/10",{"opacity-50 cursor-not-allowed":V}),children:d.ag._("Edit")})]}):(0,v.jsx)(R.O,{className:"!h-4 !w-12"})})}),(0,v.jsx)("div",{className:"pl-2 py-3 flex text-white/[.75] items-center justify-center text-xs w-[144px]",children:T.price?(0,v.jsxs)("div",{className:"flex space-x-1",children:[(0,v.jsx)("span",{children:"$"+U.uf.format(T.price.div(1e6),ae)}),(0,v.jsx)("span",{className:"text-v2-lily/40",children:"/"}),(0,v.jsx)("span",{className:"text-v2-lily/40",children:oe?U.uf.format(oe,ae):(0,v.jsx)(R.O,{className:"!h-4 !w-12"})})]}):(0,v.jsx)(R.O,{className:"!h-4 !w-12"})}),(0,v.jsx)(J.Z,{variant:"dark",placement:"top",content:(0,v.jsx)("div",{className:"leading-none",children:(0,v.jsxs)("div",{className:"text-xs",children:[(0,v.jsx)("div",{children:d.ag._("Liquidation Price calculation:")}),(0,v.jsxs)("div",{className:"mt-2 text-white/75",children:["Liquidation Price =",(0,v.jsx)("br",{}),"(Position Price) + (Collateral - Fees - Size / Max Leverage) * Position Price / Size"]})]})}),children:(0,v.jsx)("div",{className:"pl-2 py-3 flex items-center text-xs w-[70px] cursor-help text-perps-warning justify-center",children:null!==(c=T.accounting)&&void 0!==c&&c.liquidationPrice?"$".concat(U.uf.format(null===(u=T.accounting)||void 0===u?void 0:u.liquidationPrice.div(1e6),ae)):null})}),le?(0,v.jsx)(_e,{open:"tp"===le||"sl"===le,onClose:function(){return re(!1)},positionAccount:T,type:le}):null,(0,v.jsx)("div",{className:"pl-2 py-3 flex text-white/[.75] items-center justify-center text-xs w-[95px] decoration-white/30 space-x-2 relative",children:null!==(m=T.takeProfitPositionRequest)&&void 0!==m&&m.account.triggerPrice?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("span",{children:["$",U.uf.format(new x.Z(T.takeProfitPositionRequest.account.triggerPrice.toString()).div(1e6),2)]}),(0,v.jsx)("div",{onClick:function(){return L({positionAccountPubkey:T.publicKey,focusOn:"tp"})},className:"cursor-pointer text-white/30 hover:text-white/70 fill-current w-4 h-4 flex items-center justify-center",children:(0,v.jsx)(ne,{width:16,height:16})}),(0,v.jsx)("div",{onClick:function(){return re("tp")},className:"cursor-pointer text-white/30 hover:text-white/70 fill-current w-4 h-4 flex items-center justify-center",children:(0,v.jsx)(ie,{width:16,height:16})})]}):(0,v.jsx)("div",{className:"w-full flex justify-center",children:(0,v.jsx)("button",{type:"button",onClick:function(){return L({positionAccountPubkey:T.publicKey,focusOn:"tp"})},disabled:V,className:(0,f.cn)("text-xs rounded-lg px-2 py-1.5 border border-v2-lily/5 text-perps-green bg-perps-green/5 hover:bg-perps-green/20",{"opacity-50 cursor-not-allowed":V}),children:d.ag._("Add TP")})})}),(0,v.jsx)("div",{className:"pl-2 py-3 flex text-white/[.75] items-center justify-center text-xs w-[95px] decoration-white/30 space-x-2",children:null!==(p=T.stopLossPositionRequest)&&void 0!==p&&p.account.triggerPrice?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("span",{children:["$",U.uf.format(new x.Z(T.stopLossPositionRequest.account.triggerPrice.toString()).div(1e6),2)]}),(0,v.jsx)("div",{onClick:function(){return L({positionAccountPubkey:T.publicKey,focusOn:"sl"})},className:"cursor-pointer text-white/30 hover:text-white/70 fill-current w-4 h-4 flex items-center justify-center",children:(0,v.jsx)(ne,{width:16,height:16})}),(0,v.jsx)("div",{onClick:function(){return re("sl")},className:"cursor-pointer text-white/30 hover:text-white/70 fill-current w-4 h-4 flex items-center justify-center",children:(0,v.jsx)(ie,{width:16,height:16})})]}):(0,v.jsx)("div",{className:"w-full flex justify-center",children:(0,v.jsx)("button",{type:"button",onClick:function(){return L({positionAccountPubkey:T.publicKey,focusOn:"sl"})},disabled:V,className:(0,f.cn)("text-xs rounded-lg px-2 py-1.5 border border-v2-lily/5 text-perps-red bg-perps-red/5 hover:bg-perps-red/20",{"opacity-50 cursor-not-allowed":V}),children:d.ag._("Add SL")})})}),(0,v.jsxs)("div",{className:"flex justify-center text-xs w-[100px] pl-4 xl:pl-0 pr-4",children:[(0,v.jsx)("button",{type:"button",onClick:ce,className:"rounded-lg px-2 py-1.5 text-white/50 fill-current text-xs bg-white/5 border border-[rgba(255,255,255,0.02)] hover:bg-white/10",children:(0,v.jsx)(se.Z,{width:12,height:12})}),(0,v.jsx)("button",{type:"button",className:(0,f.cn)("ml-1 rounded-lg px-2 py-1.5 text-white/50 text-xs bg-white/5 border border-[rgba(255,255,255,0.02)] hover:bg-white/10 disabled:opacity-50",{"opacity-50 cursor-not-allowed":K||V}),onClick:H,disabled:K||V,children:d.ag._("Close")})]})]}),(0,v.jsxs)("div",{className:(0,f.cn)("block 2xl:hidden","mt-5 px-3 pb-5 border-b border-b-v2-lily/5 overflow-x-hidden"),children:[(0,v.jsxs)("div",{onClick:function(){return M(T)},className:"cursor-pointer flex text-white/[.75] items-center text-xs",children:[(0,v.jsx)("div",{className:"flex lg:hidden",children:(0,v.jsx)(te.Z,{info:z,width:16,height:16})}),(0,v.jsx)("div",{className:"hidden lg:flex",children:(0,v.jsx)(te.Z,{info:z,width:32,height:32})}),(0,v.jsxs)("span",{className:"ml-2 font-semibold text-sm text-v2-lily",children:[null===z||void 0===z?void 0:z.symbol,"-PERP"]}),(0,v.jsxs)("span",{className:"ml-2 text-xs text-v2-lily/40",children:[T.leverage.toFixed(2),"x ",T.side]}),I?(0,v.jsx)(ee.Z,{}):null,(0,v.jsxs)("button",{type:"button",onClick:ce,className:"ml-auto rounded-full border border-labs/10  p-1 fill-current space-x-1 flex items-center px-2 py-1.5 bg-labs/10 text-labs hover:bg-labs/20",children:[(0,v.jsx)(se.Z,{width:12,height:12}),(0,v.jsx)("span",{children:d.ag._("Share")})]})]}),(0,v.jsxs)("div",{className:"mt-3 flex justify-between",children:[(0,v.jsxs)("div",{className:"basis-5/12 flex flex-col",children:[(0,v.jsx)("span",{className:"text-xs text-v2-lily/40",children:d.ag._("Value")}),(0,v.jsx)("span",{className:"text-sm font-semibold",children:(0,v.jsx)(Me,{positionAccount:T})})]}),(0,v.jsxs)("div",{className:"basis-3/12 flex flex-col mt-1",children:[(0,v.jsx)("span",{className:"text-xs text-v2-lily/40",children:d.ag._("Size")}),(0,v.jsxs)("div",{className:"flex flex-col",children:[(0,v.jsx)("span",{className:"text-white/[.75]",children:T.sizeUsd?"$"+T.sizeUsd.div(1e6).toFixed(2):(0,v.jsx)(R.O,{className:"!h-4 !w-10"})}),(0,v.jsx)("span",{className:"text-v2-lily/40",children:de?(0,v.jsxs)(v.Fragment,{children:[(0,X.M)({value:de.toDP(null===z||void 0===z?void 0:z.decimals).toNumber()}),(0,v.jsx)("span",{className:"ml-0.5",children:null===z||void 0===z?void 0:z.symbol})]}):(0,v.jsx)(R.O,{className:"!h-4 !w-10"})})]})]}),(0,v.jsxs)("div",{className:"basis-4/12 flex flex-col items-end",children:[(0,v.jsx)("span",{className:"text-xs text-v2-lily/40",children:d.ag._("Collateral")}),(0,v.jsx)("span",{className:"text-xs font-semibold text-v2-lily/75 mt-1",children:null!==(g=T.accounting)&&void 0!==g&&g.initialCollateral.gt(0)?(0,v.jsx)(v.Fragment,{children:(0,v.jsx)(J.Z,{variant:"dark",placement:"top",content:(0,v.jsxs)("div",{className:"leading-none",children:[(0,v.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,v.jsx)("div",{className:"text-white/75",children:d.ag._("Initial Collateral:")}),(0,v.jsxs)("div",{children:["$",null===(b=T.accounting)||void 0===b?void 0:b.initialCollateral.div(1e6).toFixed(G)]})]}),(0,v.jsxs)("div",{className:"flex justify-between text-xs mt-2",children:[(0,v.jsx)("div",{className:"text-white/75",children:d.ag._("Borrow Fee:")}),(0,v.jsxs)("div",{children:["-$",null===(w=T.accounting)||void 0===w?void 0:w.fundingFeeUsd.div(1e6).toFixed(G)]})]}),(0,v.jsxs)("div",{className:"flex justify-between text-xs mt-2",children:[(0,v.jsx)("div",{className:"text-white/75",children:d.ag._("Borrow Fee / Hour:")}),(0,v.jsxs)("div",{children:["-$",null===(j=T.accounting)||void 0===j?void 0:j.borrowFeePerHourForPosition.div(1e6).toFixed(G)]})]}),(0,v.jsx)("div",{className:"mt-4",children:(0,v.jsx)("p",{className:"text-xs",children:(0,v.jsx)(W.cC,{id:"Use the Edit Collateral icon to deposit or withdraw collateral."})})})]}),children:(0,v.jsx)("span",{children:"$"+(null===(P=T.accounting)||void 0===P?void 0:P.initialCollateral.div(1e6).toFixed(2))})})}):(0,v.jsx)(R.O,{className:"!h-4 !w-12"})})]})]}),(0,v.jsxs)("div",{className:"mt-3 flex w-full justify-between",children:[(0,v.jsxs)("div",{className:"basis-5/12 flex flex-col",children:[(0,v.jsx)("span",{className:"text-xs text-v2-lily/40",children:d.ag._("Entry Price")}),(0,v.jsx)("span",{className:"text-xs font-semibold text-v2-lily/75 mt-1",children:T.price?(0,v.jsx)("div",{className:"flex space-x-1",children:(0,v.jsx)("span",{children:"$"+U.uf.format(T.price.div(1e6),ae)})}):(0,v.jsx)(R.O,{className:"!h-4 !w-12"})})]}),(0,v.jsxs)("div",{className:"basis-3/12 flex flex-col",children:[(0,v.jsx)("span",{className:"text-xs text-v2-lily/40",children:d.ag._("Mark Price")}),(0,v.jsx)("span",{className:"text-xs font-semibold text-v2-lily/75 mt-1",children:oe?U.uf.format(oe,ae):(0,v.jsx)(R.O,{className:"!h-4 !w-12"})})]}),(0,v.jsxs)("div",{className:"basis-4/12 flex flex-col items-end",children:[(0,v.jsx)("span",{className:"text-xs text-v2-lily/40",children:d.ag._("Liq. Price")}),(0,v.jsx)("span",{className:"text-xs font-semibold",children:(0,v.jsx)(J.Z,{variant:"dark",placement:"top",content:(0,v.jsx)("div",{className:"leading-none",children:(0,v.jsxs)("div",{className:"text-xs",children:[(0,v.jsx)("div",{children:d.ag._("Liquidation Price calculation:")}),(0,v.jsxs)("div",{className:"mt-2 text-white/75",children:["Liquidation Price =",(0,v.jsx)("br",{}),"(Position Price) + (Collateral - Fees - Size / Max Leverage) * Position Price / Size"]})]})}),children:(0,v.jsx)("div",{className:"flex items-center text-xs cursor-help text-perps-warning/75",children:null!==(k=T.accounting)&&void 0!==k&&k.liquidationPrice?"$".concat(U.uf.format(null===(C=T.accounting)||void 0===C?void 0:C.liquidationPrice.div(1e6),ae)):null})})})]})]}),(0,v.jsxs)("div",{className:"w-full mt-3 py-2 flex justify-between items-center lg:justify-start bg-black/50 rounded-lg",children:[(0,v.jsxs)("div",{className:"basis-6/12 md:basis-5/12",children:[(0,v.jsx)("span",{className:"text-v2-lily/40 pl-4",children:d.ag._("Take Profit")}),null!==(Z=T.takeProfitPositionRequest)&&void 0!==Z&&Z.account.triggerPrice?(0,v.jsxs)("span",{className:"ml-3 text-perps-green",children:["$",U.uf.format(new x.Z(T.takeProfitPositionRequest.account.triggerPrice.toString()).div(1e6),2)]}):(0,v.jsx)("span",{className:"ml-3 text-v2-lily/40",children:"-"})]}),(0,v.jsxs)("div",{className:"basis-6/12 md:basis-3/12",children:[(0,v.jsx)("span",{className:"text-v2-lily/40",children:d.ag._("Stop Loss")}),null!==(_=T.stopLossPositionRequest)&&void 0!==_&&_.account.triggerPrice?(0,v.jsxs)("span",{className:"ml-3 text-perps-red",children:["$",U.uf.format(new x.Z(T.stopLossPositionRequest.account.triggerPrice.toString()).div(1e6),2)]}):(0,v.jsx)("span",{className:"ml-3 text-v2-lily/40",children:"-"})]}),(0,v.jsx)("div",{className:"hidden min-w-[400px]:basis-4/12"})]}),(0,v.jsxs)("div",{className:"w-full mt-3 flex justify-between space-x-2",children:[(0,v.jsx)("button",{type:"button",onClick:function(){return L({positionAccountPubkey:T.publicKey})},disabled:V,className:(0,f.cn)("flex flex-1 border border-v2-lily/5 rounded-lg p-3 justify-center bg-v2-lily/[.02] hover:bg-v2-lily/5",{"opacity-50 cursor-not-allowed":V}),children:d.ag._("TP/SL")}),(0,v.jsx)("button",{type:"button",onClick:function(){return O({positionAccountPubkey:T.publicKey})},disabled:V,className:(0,f.cn)("flex flex-1 border border-v2-lily/5 rounded-lg p-3 justify-center bg-v2-lily/[.02] hover:bg-v2-lily/5",{"opacity-50 cursor-not-allowed":V}),children:d.ag._("Edit Collateral")}),(0,v.jsx)("button",{type:"button",onClick:H,disabled:K||V,className:(0,f.cn)("flex flex-1 border border-v2-lily/5 rounded-lg p-3 justify-center bg-v2-lily/[.02] hover:bg-v2-lily/5 disabled:opacity-50 disabled:cursor-not-allowed",{"opacity-50 cursor-not-allowed":K||V}),children:d.ag._("Market Close")})]})]})]})},Fe=function(e){var t=e.onShowEditCollateralDialog,n=e.onShowCloseConfirmationDialog,i=e.onShowEditTPSLDialog,l=e.setPositionDirection,r=e.setShowPerpsShareDialog,o=(0,y.Os)().wallet,a=(0,h.tc)(),c=a.userPositions,d=a.userPositionsFetched,u=a.oraclePrices,x=(0,y.Bn)().getTokenInfo,m=(0,s.useMemo)((function(){return c?c.sort((function(e,t){return e.sizeUsd.gt(t.sizeUsd)?-1:1})):null}),[c]),p=m&&Object.keys(m).length>0,g=(0,K.Ne)(),b=(0,s.useCallback)((function(e){var t=x(e.custody.account.mint.toString()),n=x(e.custody.account.mint.toString());t&&n&&(g(t,n,e.side),l(e.side))}),[g,x,l]),w=(0,s.useMemo)((function(){return!d||0===Object.keys(u||{}).length}),[u,d]);return(0,v.jsx)("div",{className:"flex-1 w-full min-w-[300px] overflow-hidden bg-[#16202B] pb-20",children:(0,v.jsxs)("div",{className:"w-full text-xs xl:px-0 overflow-x-auto webkit-scrollbar",children:[null!==o&&void 0!==o&&o.adapter.publicKey?(0,v.jsxs)("div",{className:(0,f.cn)("text-xs dark:text-white-50 justify-between font-semibold dark:font-normal border-y border-[rgba(255,255,255,0.02)]","hidden 2xl:flex w-full"),children:[(0,v.jsx)("div",{className:"pl-4 py-3 flex items-center text-xs w-[130px]",children:"Position"}),(0,v.jsx)("div",{className:"pl-2 py-3 flex items-center text-xs w-[128px]",children:"Value"}),(0,v.jsx)("div",{className:"pl-2 py-3 flex items-center text-xs w-[70px]",children:"Size"}),(0,v.jsx)("div",{className:"pl-2 py-3 flex items-center text-xs w-[120px]",children:"Collateral"}),(0,v.jsx)("div",{className:"pl-2 py-3 flex items-center text-xs w-[144px] justify-center",children:"Entry / Mark Price"}),(0,v.jsx)("div",{className:"pl-2 py-3 flex items-center text-xs w-[70px] justify-center",children:"Liq. Price"}),(0,v.jsx)("div",{className:"pl-2 py-3 flex items-center text-xs w-[95px] justify-center",children:"Take Profit"}),(0,v.jsx)("div",{className:"pl-2 py-3 flex items-center text-xs w-[95px] justify-center",children:"Stop Loss"}),(0,v.jsx)("div",{className:"py-3 flex items-center justify-end pr-4 text-xs w-[100px]",children:(0,v.jsx)(Z,{})})]}):null,p?null:(0,v.jsx)(Y,{loading:w,emptyText:(0,v.jsx)(W.cC,{id:"No positions"})}),p?(0,v.jsx)("div",{className:"overflow-auto webkit-scrollbar bg-[#16202B]",children:m.map((function(e,s){return(0,v.jsx)(Oe,{id:e.publicKey.toString(),positionAccount:e,onSelectMarket:b,onShowCloseConfirmationDialog:n,onShowEditCollateralDialog:t,onShowEditTPSLDialog:i,setShowPerpsShareDialog:r},s)}))}):null]})})},Le=n(55540),De=function(){var e=(0,o.Z)(c().mark((function e(t,n,s){var i,r,o,a,d,u,x,m;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=[],r=n.account.mint.equals(fe.NATIVE_MINT),o=ce.PublicKey.findProgramAddressSync([n.publicKey.toBuffer(),fe.TOKEN_PROGRAM_ID.toBuffer(),n.account.mint.toBuffer()],fe.ASSOCIATED_TOKEN_PROGRAM_ID)[0],e.next=5,(0,he.c1)(n.account.mint,n.account.owner,s);case 5:return a=e.sent,d=(0,l.Z)(a,2),u=d[0],x=d[1],!r&&x&&i.push(x),e.next=12,t.methods.closePositionRequest({}).accounts({keeper:null,owner:n.account.owner,ownerAta:r?null:u,pool:h.FW,positionRequest:n.publicKey,positionRequestAta:o,position:n.account.position}).instruction();case 12:return m=e.sent,i.push(m),e.abrupt("return",i);case 15:case"end":return e.stop()}}),e)})));return function(t,n,s){return e.apply(this,arguments)}}(),Ae=n(90342),qe=n(24628),Re=n(49839),Ie=n(33130),Ue=n(11711),Ve=function(e){var t,n,i=e.id,r=e.data,a=(0,h.tc)().program,u=(0,Ue.NL)(),m=(0,y.Bn)(),p=m.connection,g=m.getTokenInfo,b=(0,y.oP)().getExplorer,w=(0,y.Os)().publicKey,j=(0,Ie.R3)(),P=(0,N.KO)(Re.yz),S=(0,l.Z)(P,1)[0],C=(0,Ae.gs)().priorityLevel,Z=(0,s.useMemo)((function(){return g(r.account.mint.toString())}),[r.account.mint,g]),_=(0,s.useState)(!1),T=_[0],M=_[1],O=(0,s.useCallback)((0,o.Z)(c().mark((function e(){var t,n,s,i,l,o,x;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.publicKey){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,M(!0),e.next=6,p.getLatestBlockhash("confirmed");case 6:return n=e.sent,s=n.blockhash,i=n.lastValidBlockHeight,e.next=11,De(a,r,p);case 11:return l=e.sent,o=(t=new ce.Transaction({blockhash:s,lastValidBlockHeight:i,feePayer:w})).add.apply(t,(0,de.Z)(l)),e.next=15,j(o,{blockhash:s,idl:Le.x,idlProgramId:h.KX,lastValidBlockHeight:i},{successMessage:d.ag._("Pending order closed"),submittingMessage:d.ag._("Closing pending order..."),errorMessage:d.ag._("Failed to close pending order"),referenceFee:"MEDIUM"===C?S.perps.m:"HIGH"===C?S.perps.h:"VERY_HIGH"===C?S.perps.vh:void 0,minimumFee:Re.uo,requestComputeBudgetLimit:3e5});case 15:if(!("error"in(x=e.sent))){e.next=18;break}throw x.error;case 18:u.setQueryData(["perps-pending-refunds",null===w||void 0===w?void 0:w.toString()],(function(e){return e?e.filter((function(e){return!e.publicKey.equals(r.publicKey)})):e})),e.next=24;break;case 21:e.prev=21,e.t0=e.catch(2),console.log("Failed to close pending order",e.t0);case 24:return e.prev=24,M(!1),e.finish(24);case 27:case"end":return e.stop()}}),e,null,[[2,21,24,27]])}))),[p,r,j,C,a,w,u,S.perps.h,S.perps.m,S.perps.vh]);return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("div",{id:"jupiter-perps-order-mobile-".concat(i),className:"flex lg:hidden w-full px-3 py-4 bg-[#16202B] border-t border-cyan-50 border-opacity-5 flex-col justify-center items-start gap-3",children:[(0,v.jsxs)("div",{className:"flex justify-between items-center w-full gap-2",children:[(0,v.jsxs)("div",{className:"items-center gap-2 flex",children:[(0,v.jsx)("div",{className:"relative",children:Z&&(0,v.jsx)(te.Z,{info:Z,width:16,height:16})}),(0,v.jsx)("div",{className:"items-center gap-1 flex",children:(0,v.jsxs)("div",{translate:"no",className:"text-v2-lily text-sm font-semibold",children:[null===Z||void 0===Z?void 0:Z.symbol,"-PERP"]})}),(0,v.jsx)("div",{className:"px-2 py-0.5 bg-perps-red bg-opacity-20 rounded-2xl border border-perps-red border-opacity-20 items-center flex",children:(0,v.jsxs)("div",{className:"text-center text-perps-red text-[11px] font-medium",children:[r.account.requestChange.increase?d.ag._("Increase"):d.ag._("Decrease")," ",r.account.side.long?d.ag._("Long"):d.ag._("Short")]})})]}),(0,v.jsx)("div",{className:"flex items-center text-v2-lily/50",children:(0,v.jsx)("a",{href:b(r.publicKey.toString()),target:"_blank",rel:"noreferrer",className:"space-x-2",children:(0,v.jsx)(qe.Z,{})})})]}),(0,v.jsxs)("div",{className:"w-full items-start justify-between gap-x-2 flex",children:[(0,v.jsxs)("div",{className:"grow shrink basis-0 flex-col items-start flex",children:[(0,v.jsx)("div",{className:"text-v2-lily/40 text-xs font-medium",children:d.ag._("Collateral")}),(0,v.jsxs)("div",{className:"text-v2-lily/75 text-xs font-semibold",children:[new x.Z((null===(t=r.account.collateralDelta)||void 0===t?void 0:t.toString())||0).div(Math.pow(10,(null===Z||void 0===Z?void 0:Z.decimals)||0)).toString()," ",null===Z||void 0===Z?void 0:Z.symbol]})]}),(0,v.jsx)("div",{className:(0,f.cn)("flex items-center text-xs text-white/[.75]"),children:(0,v.jsx)("button",{type:"button",className:"rounded-lg whitespace-nowrap px-2 py-1.5 text-white/50 text-xs bg-white/5 border border-[rgba(255,255,255,0.02)] hover:bg-white/10 disabled:opacity-50",disabled:T,onClick:O,children:T?(0,v.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,v.jsx)(k.Z,{width:8,height:8}),(0,v.jsx)("span",{children:d.ag._("Closing...")})]}):d.ag._("Close")})})]}),(0,v.jsx)("div",{className:"text-center text-xxs text-v2-lily/30",children:(0,Q.Z)(r.account.openTime.muln(1e3).toNumber(),"H:mm dd/MM/yyyy (x)")})]}),(0,v.jsxs)("div",{id:"jupiter-perps-order-".concat(i),className:(0,f.cn)("hidden lg:flex justify-between items-center h-[62px] w-full min-w-[762px]"),children:[(0,v.jsxs)("div",{className:"w-[30%] flex justify-between",children:[(0,v.jsxs)("div",{className:"pl-2 py-3 flex flex-col items-start text-xs min-w-[150px]",children:[(0,v.jsxs)("span",{className:"font-semibold",children:[null===Z||void 0===Z?void 0:Z.symbol,"-PERP"]}),(0,v.jsx)("div",{className:"text-center text-xxs text-v2-lily/30",children:(0,Q.Z)(r.account.openTime.muln(1e3).toNumber(),"H:mm dd/MM/yyyy (x)")})]}),(0,v.jsxs)("div",{className:"pl-2 py-3 flex flex-col justify-center text-xs min-w-[120px] text-white/[.75]",children:[r.account.requestChange.increase?d.ag._("Increase"):d.ag._("Decrease")," ",r.account.side.long?d.ag._("Long"):d.ag._("Short")]})]}),(0,v.jsxs)("div",{className:"w-[60%] flex justify-evenly",children:[(0,v.jsx)("div",{className:(0,f.cn)("pl-2 py-3 flex items-center justify-center text-xs min-w-[90px] text-white/[.75]"),children:r.account.requestChange.decrease?"-":"\n              ".concat(new x.Z((null===(n=r.account.collateralDelta)||void 0===n?void 0:n.toString())||0).div(Math.pow(10,(null===Z||void 0===Z?void 0:Z.decimals)||0)).toString()," ").concat(null===Z||void 0===Z?void 0:Z.symbol,"\n             ")}),(0,v.jsx)("div",{className:(0,f.cn)("pl-2 py-3 flex items-center text-xs min-w-[84px] text-white/[.75]"),children:(0,v.jsx)("button",{type:"button",className:"rounded-lg whitespace-nowrap px-2 py-1.5 text-white/50 text-xs bg-white/5 border border-[rgba(255,255,255,0.02)] hover:bg-white/10 disabled:opacity-50",disabled:T,onClick:O,children:T?(0,v.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,v.jsx)(k.Z,{width:8,height:8}),(0,v.jsx)("span",{children:d.ag._("Closing...")})]}):d.ag._("Close")})})]}),(0,v.jsx)("div",{className:"w-[10%] flex justify-between",children:(0,v.jsx)("div",{className:"min-w-[42px] pl-2 py-3 flex items-center text-white/50 fill-current dark:text-white/50",children:(0,v.jsx)("a",{href:b(r.publicKey.toString(),"account"),target:"_blank",rel:"noreferrer",className:"space-x-2",children:(0,v.jsx)(qe.Z,{})})})})]})]})},Ee=function(e){(0,r.Z)(e);var t=(0,y.Os)().wallet,n=(0,h.tc)(),s=n.pendingRefund,i=n.pendingRefundLoading;return(0,v.jsx)("div",{className:"flex-1 w-full min-w-[300px] bg-[#16202B]",children:(0,v.jsxs)("div",{className:"w-full text-xs xl:px-0 overflow-x-auto webkit-scrollbar rounded-lg relative",children:[null!==t&&void 0!==t&&t.adapter.publicKey?(0,v.jsxs)("div",{className:(0,f.cn)("hidden lg:flex text-xs dark:text-white-50 font-semibold dark:font-normal border-b border-v2-lily/5","w-full min-w-[762px]"),children:[(0,v.jsxs)("div",{className:"w-[30%] flex justify-between",children:[(0,v.jsx)("div",{className:"pl-2 py-3 flex items-center text-xs min-w-[150px]",children:d.ag._("Position")}),(0,v.jsx)("div",{className:"pl-2 py-3 flex items-center text-xs min-w-[120px]",children:d.ag._("Action")})]}),(0,v.jsxs)("div",{className:"w-[60%] flex justify-evenly",children:[(0,v.jsx)("div",{className:"pl-2 py-3 flex justify-center items-center text-xs min-w-[90px]",children:d.ag._("Collateral")}),(0,v.jsx)("div",{className:"pl-2 py-3 flex items-center text-xs min-w-[84px]",children:d.ag._("Close")})]}),(0,v.jsx)("div",{className:"w-[10%] flex justify-between",children:(0,v.jsx)("div",{className:"pl-2 py-3 flex items-center text-xs min-w-[84px]",children:d.ag._("Account")})})]}):null,(0,v.jsxs)("div",{children:[0===s.length?(0,v.jsx)(Y,{loading:Boolean(i),emptyText:(0,v.jsx)(W.cC,{id:"No expired orders"})}):null,s.length>0?s.map((function(e,t){return(0,v.jsx)(Ve,{id:e.publicKey.toString(),data:e},t)})):null]})]})})},ze=n(32529),Be=n(17639),Ke=function(e){var t=e.width,n=void 0===t?16:t,s=e.height,i=void 0===s?16:s,l=e.className;return(0,v.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:n,height:i,viewBox:"0 0 24 24",className:l,children:(0,v.jsx)("path",{fill:"none",stroke:"currentColor",strokeLinejoin:"round",strokeWidth:"2",d:"M20 4H4v2l6 6v8.5l4-2.5v-6l6-6z"})})},$e=function(e){var t=e.width,n=void 0===t?10:t,s=e.height,i=void 0===s?10:s,l=e.stroke,r=void 0===l?"#768222":l;return(0,v.jsx)("svg",{width:n,height:i,viewBox:"0 0 10 10",fill:"inherit",xmlns:"http://www.w3.org/2000/svg",children:(0,v.jsx)("path",{d:"M8.33329 2.5L3.74996 7.08333L1.66663 5",stroke:r,strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"})})},We=function(){return(0,v.jsx)("div",{className:"h-4"})},He=function(e){var t=e.item,n=t.label,s=t.onClick,i=t.selected,l=void 0!==i&&i,r=t.separator,o=void 0!==r&&r,a=t.className,c=Boolean(s);return(0,v.jsxs)("li",{className:"flex flex-col cursor-default",children:[(0,v.jsxs)("div",{className:(0,L.cn)("w-full flex items-center justify-between text-left text-sm text-white/50 bg-transparent space-x-2 pl-2 pr-4 fill-current",c?"hover:bg-white/10 cursor-pointer":"cursor-default",a),onClick:function(e){e.stopPropagation(),null===s||void 0===s||s()},children:[(0,v.jsx)("div",{className:"w-full",children:n}),l&&(0,v.jsx)($e,{stroke:"rgba(199, 242, 132, 1)"})]}),o&&(0,v.jsx)(We,{})]})},Ge=function(e){var t=e.items,n=e.filterOn,i=(0,s.useRef)(null),l=(0,s.useState)(!1),r=l[0],o=l[1];return(0,s.useEffect)((function(){var e=function(e){i.current&&!i.current.contains(e.target)&&o(!1)};return document.addEventListener("mousedown",e),function(){document.removeEventListener("mousedown",e)}}),[]),(0,v.jsxs)("button",{className:(0,L.cn)("relative fill-current",n?"text-v2-lily":"hover:text-v2-lily text-v2-lily/50"),onClick:function(){o((function(e){return!e}))},ref:i,children:[(0,v.jsx)(Ke,{width:12,height:12}),(0,v.jsx)("div",{className:(0,L.cn)("absolute top-2 left-full min-w-[15rem] transition-all overflow-hidden","bg-v3 shadow-header-settings rounded-xl border border-v2-lily/10",r?"opacity-100 z-50":"opacity-0 pointer-events-none"),children:(0,v.jsx)("ul",{children:t.map((function(e,t){return(0,v.jsx)(He,{item:e},t)}))})})]})},Ye=function(e){var t=e.id,n=e.data,i=e.setPositionDirection,l=(e.setShowPerpsShareDialog,(0,y.Bn)().getTokenInfo),r=(0,y.oP)().getExplorer,o=(0,s.useMemo)((function(){return l(n.mint.toString())}),[l,n.mint]),a=n.pnlUsd?new x.Z(n.pnlUsd.toString()).div(1e6).toDP(2):null,c=(0,K.Ne)(),u=(0,s.useCallback)((function(){if(n.inOutTokenMint&&o){var e=l(n.inOutTokenMint.toString());e&&o&&(c(e,o,"Long"===n.side?"long":"short"),i("Long"===n.side?"long":"short"))}}),[n.inOutTokenMint,n.side,o,l,c,i]);return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("div",{id:"jupiter-perps-order-mobile-".concat(t),className:"flex lg:hidden w-full px-3 py-4 bg-[#16202B] border-t border-cyan-50 border-opacity-5 flex-col justify-center items-start gap-3",children:[(0,v.jsxs)("div",{className:"flex justify-between items-center w-full gap-2",onClick:function(){return u()},children:[(0,v.jsxs)("div",{className:"items-center gap-2 flex",children:[(0,v.jsx)("div",{className:"relative",children:(0,v.jsx)(te.Z,{info:o,width:16,height:16})}),(0,v.jsx)("div",{className:"items-center gap-1 flex",children:(0,v.jsxs)("div",{translate:"no",className:"text-v2-lily text-sm font-semibold",children:[null===o||void 0===o?void 0:o.symbol,"-PERP"]})}),(0,v.jsx)("div",{className:"px-2 py-0.5 bg-perps-red bg-opacity-20 rounded-2xl border border-perps-red border-opacity-20 items-center flex",children:(0,v.jsxs)("div",{className:"text-center text-perps-red text-[11px] font-medium",children:[n.requestChange," ",n.side]})})]}),(0,v.jsx)("div",{className:"flex items-center text-v2-lily/50",children:(0,v.jsx)("a",{href:r(n.txId),target:"_blank",rel:"noreferrer",className:"space-x-2",children:(0,v.jsx)(qe.Z,{})})})]}),(0,v.jsxs)("div",{className:"w-full items-start gap-3 flex",children:[(0,v.jsxs)("div",{className:"grow shrink basis-0 flex-col items-start flex",children:[(0,v.jsx)("div",{className:"text-v2-lily/40 text-xs font-medium",children:d.ag._("Order Type")}),(0,v.jsx)("div",{className:"text-v2-lily/75 text-xs font-semibold",children:n.requestType})]}),(0,v.jsxs)("div",{className:"grow shrink basis-0 flex-col items-start flex",children:[(0,v.jsx)("div",{className:"text-v2-lily/40 text-xs font-medium",children:d.ag._("Deposit/Withdraw")}),(0,v.jsxs)("div",{className:"text-v2-lily/75 text-xs font-semibold",children:["Increase"===n.requestChange?"-$":"+$",new x.Z(n.collateralUsd.toString()).div(1e6).toFixed(2).toString()]})]}),(0,v.jsxs)("div",{className:"grow shrink basis-0 flex-col items-start flex",children:[(0,v.jsx)("div",{className:"text-v2-lily/40 text-xs font-medium",children:d.ag._("Price")}),(0,v.jsx)("div",{className:"text-v2-lily/75 text-xs font-semibold",children:"$"+new x.Z(n.price.toString()).div(1e6).toFixed(2).toString()})]})]}),(0,v.jsxs)("div",{className:"w-full items-start gap-3 flex",children:[(0,v.jsxs)("div",{className:"grow shrink basis-0 flex-col items-start flex",children:[(0,v.jsx)("div",{className:"text-v2-lily/40 text-xs font-medium",children:d.ag._("Size")}),(0,v.jsx)("div",{className:"text-v2-lily/75 text-xs font-semibold",children:"$"+new x.Z(n.sizeUsd.toString()).div(1e6).toFixed(2).toString()})]}),(0,v.jsxs)("div",{className:"grow shrink basis-0 flex-col items-start flex",children:[(0,v.jsx)("div",{className:"text-v2-lily/40 text-xs font-medium",children:d.ag._("Fee")}),(0,v.jsx)("div",{className:"text-v2-lily/75 text-xs font-semibold",children:"$"+new x.Z(n.feeUsd.toString()).div(1e6).toFixed(2).toString()})]}),(0,v.jsxs)("div",{className:(0,f.cn)("grow shrink basis-0 flex-col items-start flex",a?"":"invisible"),children:[(0,v.jsx)("div",{className:"text-v2-lily/40 text-xs font-medium",children:d.ag._("PnL")}),(0,v.jsx)("div",{className:(0,f.cn)("text-v2-lily/75 text-xs font-semibold",{"text-[rgba(39,174,96,1)]":null===a||void 0===a?void 0:a.gt(0),"text-[#EB5757]":null===a||void 0===a?void 0:a.lt(0),"text-v2-lily/50":null===a||void 0===a?void 0:a.eq(0)}),children:a?"$"+a.toFixed(2).toString():""})]})]}),(0,v.jsx)("div",{className:"text-center text-xxs text-v2-lily/30",children:(0,Q.Z)(n.createdAt,"H:mm dd/MM/yyyy (x)")})]}),(0,v.jsxs)("div",{id:"jupiter-perps-order-".concat(t),className:(0,f.cn)("hidden lg:flex justify-between items-center h-[62px] w-full min-w-[1092px]"),children:[(0,v.jsxs)("div",{className:"w-[30%] flex justify-between",children:[(0,v.jsxs)("div",{onClick:function(){return u()},className:"pl-2 py-3 flex flex-col items-start text-xs min-w-[150px]",children:[(0,v.jsxs)("span",{className:"font-semibold",children:[null===o||void 0===o?void 0:o.symbol,"-PERP"]}),(0,v.jsx)("div",{className:"text-center text-xxs text-v2-lily/30",children:(0,Q.Z)(n.createdAt,"H:mm dd/MM/yyyy (x)")})]}),(0,v.jsxs)("div",{className:"pl-2 py-3 flex flex-col justify-center text-xs min-w-[120px] text-white/[.75]",children:[n.requestChange," ",n.side]}),(0,v.jsx)("div",{className:"pl-2 py-3 flex flex-col justify-center text-xs min-w-[120px] text-white/[.75]",children:n.requestType})]}),(0,v.jsxs)("div",{className:"w-[65%] flex justify-evenly",children:[(0,v.jsxs)("div",{className:(0,f.cn)("pl-2 py-3 flex items-center text-xs min-w-[150px] text-white/[.75]"),children:["Increase"===n.requestChange?"-$":"+$",new x.Z(n.collateralUsd.toString()).div(1e6).toFixed(2).toString()]}),(0,v.jsx)("div",{className:(0,f.cn)("pl-2 py-3 flex items-center text-xs min-w-[90px] text-white/[.75]"),children:"$"+new x.Z(n.price.toString()).div(1e6).toFixed(2).toString()}),(0,v.jsx)("div",{className:(0,f.cn)("pl-2 py-3 flex items-center text-xs min-w-[90px] text-white/[.75]"),children:"$"+new x.Z(n.sizeUsd.toString()).div(1e6).toFixed(2).toString()}),(0,v.jsx)("div",{className:(0,f.cn)("pl-2 py-3 flex items-center text-xs min-w-[120px]",{"text-[rgba(39,174,96,1)]":null===a||void 0===a?void 0:a.gt(0),"text-[#EB5757]":null===a||void 0===a?void 0:a.lt(0),"text-v2-lily/50":null===a||void 0===a?void 0:a.eq(0)}),children:a?"$"+a.toFixed(2).toString():""}),(0,v.jsx)("div",{className:(0,f.cn)("pl-2 py-3 flex items-center text-xs min-w-[84px] text-white/[.75]"),children:"$"+new x.Z(n.feeUsd.toString()).div(1e6).toFixed(2).toString()})]}),(0,v.jsx)("div",{className:"w-[5%] flex justify-between",children:(0,v.jsx)("div",{className:"min-w-[42px] pl-2 py-3 flex items-center text-white/50 fill-current dark:text-white/50",children:(0,v.jsx)("a",{href:r(n.txId),target:"_blank",rel:"noreferrer",className:"space-x-2",children:(0,v.jsx)(qe.Z,{})})})})]})]})},Qe=function(e){var t=e.header;return(0,v.jsx)("span",{className:"text-xs font-semibold text-v2-lily border-b border-b-v2-lily/20 block w-full pt-3 pb-2",children:t})},Je=function(e){var t=e.tokenInfo;return(0,v.jsxs)("div",{className:"flex items-center space-x-2 text-xs font-semibold text-v2-lily/80 py-2",children:[(0,v.jsx)(te.Z,{info:t,width:18,height:18}),(0,v.jsxs)("span",{children:[t.symbol,"-PERP"]})]})};function Xe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,s)}return n}function et(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Xe(Object(n),!0).forEach((function(t){(0,le.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Xe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var tt=p()((function(){return Promise.all([n.e(1732),n.e(8275)]).then(n.bind(n,88275))}),{ssr:!1,loadableGenerated:{webpack:function(){return[88275]}}}),nt=function(e){var t=e.children;return(0,v.jsx)("div",{className:"text-xs font-semibold text-v2-lily/80 py-2",children:t})},st=function(e){var t,n,i,l,r,o,a,c,u=e.setPositionDirection,x=e.setShowPerpsShareDialog,m=(0,y.Os)(),p=m.wallet,g=m.connected,b=(0,h.tc)().tradeHistory,w=function(){var e=(0,h.tc)(),t=e.perpsTokens.nonStableTokens,n=e.tradeHistory,s=n.filter,i=n.setFilter,l=function(){i(et(et({},s),{},{requestChange:void 0}))},r=function(){i(et(et({},s),{},{side:void 0}))},o=t.map((function(e){var t=(null===s||void 0===s?void 0:s.mint)===e.address;return{label:(0,v.jsx)(Je,{tokenInfo:e}),selected:t,onClick:function(){i(et(et({},s),{},t?{mint:void 0}:{mint:e.address}))}}})),a=[{label:(0,v.jsx)(Qe,{header:d.ag._("Token")})}].concat((0,de.Z)(o),[{label:(0,v.jsx)(Qe,{header:d.ag._("Date")})},{label:(0,v.jsx)(tt,{}),className:"px-0"}]);return{actionFilterMenuItems:[{label:(0,v.jsx)(Qe,{header:d.ag._("Action")})},{label:(0,v.jsx)(nt,{children:d.ag._("Increase")}),selected:"Increase"===(null===s||void 0===s?void 0:s.requestChange),onClick:function(){"Increase"!==(null===s||void 0===s?void 0:s.requestChange)?i(et(et({},s),{},{requestChange:"Increase"})):l()}},{label:(0,v.jsx)(nt,{children:d.ag._("Decrease")}),selected:"Decrease"===(null===s||void 0===s?void 0:s.requestChange),onClick:function(){"Decrease"!==(null===s||void 0===s?void 0:s.requestChange)?i(et(et({},s),{},{requestChange:"Decrease"})):l()}},{label:(0,v.jsx)(Qe,{header:d.ag._("Side")})},{label:(0,v.jsx)(nt,{children:d.ag._("Long")}),selected:"Long"===(null===s||void 0===s?void 0:s.side),onClick:function(){"Long"!==(null===s||void 0===s?void 0:s.side)?i(et(et({},s),{},{side:"Long"})):r()}},{label:(0,v.jsx)(nt,{children:d.ag._("Short")}),selected:"Short"===(null===s||void 0===s?void 0:s.side),onClick:function(){"Short"!==(null===s||void 0===s?void 0:s.side)?i(et(et({},s),{},{side:"Short"})):r()}}],positionFilterMenuItems:a}}(),j=w.positionFilterMenuItems,N=w.actionFilterMenuItems,P=(0,ze.Y)({pageIndex:b.pageIndex,pageCount:b.pageCount,setPageIndex:b.setPageIndex}),k=P.pager,S=P.canPreviousPage,C=P.canNextPage,Z=P.gotoPage,_=(0,s.useMemo)((function(){var e,t,n,s;return null!==(e=b.data)&&void 0!==e&&null!==(t=e.data)&&void 0!==t&&t.trades&&g?null===(n=b.data)||void 0===n||null===(s=n.data)||void 0===s?void 0:s.trades:[]}),[g,null===(t=b.data)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.trades]),T=Boolean((null===(i=b.filter)||void 0===i?void 0:i.mint)||(null===(l=b.filter)||void 0===l?void 0:l.createdAtAfter)),M=Boolean((null===(r=b.filter)||void 0===r?void 0:r.requestChange)||(null===(o=b.filter)||void 0===o?void 0:o.side));return(0,v.jsxs)("div",{className:"flex-1 w-full min-w-[300px] bg-[#16202B]",children:[(0,v.jsxs)("div",{className:"flex flex-col  w-full text-xs xl:px-0 overflow-x-auto webkit-scrollbar rounded-lg relative min-h-[350px]",children:[null!==p&&void 0!==p&&p.adapter.publicKey?(0,v.jsxs)("div",{className:(0,f.cn)("hidden lg:flex text-xs dark:text-white-50 font-semibold dark:font-normal border-b border-v2-lily/5","w-full min-w-[1092px]"),children:[(0,v.jsxs)("div",{className:"w-[30%] flex justify-between",children:[(0,v.jsxs)("div",{className:"pl-2 py-3 flex items-center text-xs min-w-[150px] space-x-2",children:[(0,v.jsx)("p",{children:d.ag._("Position")}),(0,v.jsx)(Ge,{items:j,filterOn:T})]}),(0,v.jsxs)("div",{className:"pl-2 py-3 flex items-center text-xs min-w-[120px] space-x-2",children:[(0,v.jsx)("p",{children:d.ag._("Action")}),(0,v.jsx)(Ge,{items:N,filterOn:M})]}),(0,v.jsx)("div",{className:"pl-2 py-3 flex items-center text-xs min-w-[120px]",children:d.ag._("Order Type")})]}),(0,v.jsxs)("div",{className:"w-[65%] flex justify-evenly",children:[(0,v.jsx)("div",{className:"pl-2 py-3 flex items-center text-xs min-w-[150px]",children:d.ag._("Deposit / Withdraw")}),(0,v.jsx)("div",{className:"pl-2 py-3 flex items-center text-xs min-w-[90px]",children:d.ag._("Price")}),(0,v.jsx)("div",{className:"pl-2 py-3 flex items-center text-xs min-w-[90px]",children:d.ag._("Size")}),(0,v.jsx)("div",{className:"pl-2 py-3 flex items-center text-xs min-w-[120px]",children:d.ag._("PNL")}),(0,v.jsx)("div",{className:"pl-2 py-3 flex items-center text-xs min-w-[84px]",children:d.ag._("Fee")})]}),(0,v.jsx)("div",{className:"w-[5%] flex justify-between",children:(0,v.jsx)("div",{className:"pl-2 py-3 flex items-center text-xs min-w-[42px]",children:d.ag._("Tx")})})]}):null,(0,v.jsx)("div",{children:_.length>0?_.map((function(e,t){return(0,v.jsx)(Ye,{id:e.id,data:e,setPositionDirection:u,setShowPerpsShareDialog:x},t)})):null}),(0,v.jsx)("div",{className:"flex flex-1",children:0===_.length?(0,v.jsx)(Y,{loading:Boolean(null===(a=b.data)||void 0===a?void 0:a.isLoading),emptyText:(0,v.jsx)(W.cC,{id:"No trade history"}),className:"flex-1"}):null}),_.length>0&&null!==(c=b.data)&&void 0!==c&&c.isFetching?(0,v.jsx)("div",{className:"absolute top-0 left-0 bg-black/10 backdrop-blur-sm w-full h-full"}):null]}),b.pageCount>0?(0,v.jsx)(Be.Z,{canPreviousPage:S,gotoPage:Z,pageIndex:b.pageIndex,pager:k,canNextPage:C}):null]})},it=n(65558),lt=n.n(it),rt=n(9319),ot=n.n(rt),at=n(54566),ct=n(71130),dt=n(63153),ut=n(80989),xt=n(50944),mt=new x.Z(100),pt=function(e){var t,n,i,l,r,a=e.open,m=e.onClose,p=e.positionAccount,g=(0,h.tc)(),b=g.viewClient,w=g.slippage,j=g.oraclePrices,N=g.refreshPositionInfo,S=g.poolInfo,Z=g.isAnyFormSubmitting,_=g.setIsAnyFormSubmitting,T=(g.custodies,(0,y.Bn)()),M=T.connection,O=T.getTokenInfo,F=T.tokenMap,D=(0,y.Os)().wallet,A=(0,C.Z)().promptKeeperClosePositionNotification,q=(0,s.useMemo)((function(){var e;return null!==(e=O(p.custody.account.mint.toString()))&&void 0!==e?e:z.mq}),[O,p.custody.account.mint]),I=s.useRef(null);(0,L.O3)(I,(function(){var e;return null===(e=I.current)||void 0===e?void 0:e.close()}));var V=(0,s.useCallback)((function(){var e;null===(e=I.current)||void 0===e||e.close(),m()}),[m,I]);(0,s.useEffect)((function(){if(I.current&&(a?I.current.open||I.current.show():I.current.close()),a){var e=I.current;return null===e||void 0===e||e.addEventListener("close",V),function(){null===e||void 0===e||e.removeEventListener("close",V)}}}),[V,a]);var E=(0,s.useMemo)((function(){return O(p.collateralCustody.account.mint.toString())}),[O,p.collateralCustody.account.mint]),B=(0,s.useState)(!0),K=B[0],H=(B[1],(0,s.useMemo)((function(){return p.sizeUsd.div(1e6).toNearest(1e-4,x.Z.ROUND_DOWN).toString()}),[p.sizeUsd])),G=(0,re.cI)({defaultValues:{amount:H}}),Y=G.control,Q=G.handleSubmit,J=G.watch,ee=G.setValue,ne=G.formState,se=J("amount"),ie=(0,s.useCallback)((function(e){var t=new x.Z(H).mul(e).div(100).toString();ee("amount",t)}),[H,ee]),le=(0,s.useMemo)((function(){if((0,L.Hd)(se)&&H)return new x.Z(se).gt(H)}),[se,H]),de=(0,s.useMemo)((function(){return Boolean(p.accounting)}),[p.accounting]),ue=(0,s.useMemo)((function(){if(!(0,L.Hd)(se)||!p.accounting)return[!1,null,null];var e=new x.Z(0),t=p.sizeUsd.sub(new x.Z(se).mul(1e6)).lt(mt),n=t?p.sizeUsd:new x.Z(se).mul(1e6),s=p.accounting.unrealizedPNL;if(t)e=new x.Z(0);else if(K&&n&&!t){var i=n.div(p.sizeUsd);if(e=p.accounting.initialCollateral.mul(i).toDP(0),p.accounting.pnlAfterFeesUsd.lt(0)){var l=s.mul(-1).add(p.accounting.closePositionFeeUsd).mul(i).add(p.accounting.fundingFeeUsd);e=e.gt(l)?e.sub(l).toDP(0):new x.Z(0)}}return[t,e,n]}),[se,p.accounting,p.sizeUsd,K]),xe=ue[0],me=ue[1],pe=ue[2],fe=(0,u.a)([se,K,H,null===E||void 0===E?void 0:E.address,p.publicKey.toString()],(0,o.Z)(c().mark((function e(){var t,n,s,i,l,r,o;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(me&&pe&&(0,L.Hd)(se)&&!pe.lte(0)&&E&&b&&Ve&&Ee&&null!==S&&void 0!==S&&S.pool){e.next=2;break}return e.abrupt("return",null);case 2:if(!new x.Z(se).gt(H)){e.next=4;break}return e.abrupt("return",null);case 4:return e.next=6,b.getDecreasePosition({position:p,collateralUsdDelta:new(lt())(me.round().toFixed()),sizeUsdDelta:new(lt())(pe.round().toFixed()),tokenPrice:null===Ve||void 0===Ve?void 0:Ve.toNumber(),collateralTokenPrice:null===Ee||void 0===Ee?void 0:Ee.toNumber(),pool:S.pool});case 6:if(t=e.sent){e.next=9;break}throw new Error("Failed to get decrease position");case 9:return n=new x.Z(t.liquidationPrice.toString()),s=p.sizeUsd.sub(pe),i=new x.Z(t.collateralUsd.toString()),l=x.Z.max(0,new x.Z(t.impactFeeUsd.toString()).div(1e6)),r=(0,$.y)(l),o=l?"".concat(U.uf.format(l,r)," USD"):"-",e.abrupt("return",{liquidationPrice:xe?null:n,size:s,collateralUsd:i.div(1e6),fees:new x.Z(t.feeUsd.toString()).div(1e6),leverage:s.div(i).toNearest(.01,x.Z.ROUND_DOWN),transferToken:new x.Z(t.transferToken.toString()).div(Math.pow(10,E.decimals)),transferAmountUsd:new x.Z(t.transferAmountUsd.toString()).div(1e6).toDP(2),closeFee:new x.Z(t.closeBaseFeeUsd.toString()).div(1e6),impactFee:x.Z.max(0,new x.Z(t.impactFeeUsd.toString()).div(1e6)),impactPct:new x.Z(t.impactFeeBps.toString()).div(100),impactFeeUsdText:o,borrowFee:new x.Z(t.fundingFeeUsd.toString()).div(1e6)});case 16:case"end":return e.stop()}}),e)}))),{enabled:Boolean(b&&E),retry:3,retryDelay:500,refetchInterval:5e3}),he=fe.data,ve=fe.isLoading,ge=fe.isLoadingError,be=(0,s.useMemo)((function(){return!!he&&(!xe&&!K&&new x.Z(he.leverage).lt(1))}),[he,xe,K]),we=(0,s.useMemo)((function(){var e=[];return le&&e.push(d.ag._("Max close amount exceeded")),be&&e.push(d.ag._("Minimum 1x leverage")),e}),[le,be]),je=(0,s.useState)(E||null),ye=je[0],Ne=je[1],Se=(0,s.useState)(null),Ce=Se[0],Ze=Se[1];(0,s.useEffect)((function(){!ye&&E&&he&&Ze(he.transferToken)}),[E,he,null===he||void 0===he?void 0:he.transferAmountUsd,null===he||void 0===he?void 0:he.transferToken,ye]);var _e=(0,s.useState)(!1),Te=_e[0],Me=_e[1],Oe=s.useCallback((function(e){Me(!1),Ne(e)}),[]),Fe=(0,s.useMemo)((function(){return Array.from(F.keys())}),[F]),Le=(0,s.useMemo)((function(){return{isTokenSwapRequired:(null===E||void 0===E?void 0:E.address)!==(null===ye||void 0===ye?void 0:ye.address),amount:Ce&&ye&&E&&he?ot().BigInt(he.transferToken.mul(Math.pow(10,E.decimals)).toFixed()):ot().BigInt(0),fromTokenInfo:E}}),[E,he,Ce,ye]),De=(0,ut.Z)({disabled:!Le.isTokenSwapRequired,amount:Le.amount,fromTokenInfo:Le.fromTokenInfo,toTokenInfo:ye,slippage:w}),Ae=De.outAmount,qe=De.otherAmountThreshold,Re=De.isLoading,Ie=(0,s.useMemo)((function(){return le||ne.isSubmitting||be||Le.isTokenSwapRequired&&Re||!(0,L.Hd)(se)||Number(se)<=0}),[le,ne.isSubmitting,be,Le.isTokenSwapRequired,Re,se]),Ue=(0,s.useMemo)((function(){return j&&E?[j[q.address],j[E.address]]:[null,null]}),[j,E,q.address]),Ve=Ue[0],Ee=Ue[1],ze=(0,s.useCallback)(function(){var e=(0,o.Z)(c().mark((function e(t){var n,s,i,l,r,a;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Ie&&D){e.next=2;break}return e.abrupt("return");case 2:return _(!0),n=de&&me?new(lt())(me.round().toFixed()):new(lt())(0),s=de&&pe?new(lt())(pe.round().toFixed()):new(lt())(p.sizeUsd.round().toFixed()),i="long"===p.side?new(lt())(0):new(lt())("18446744073709551615"),e.prev=6,e.next=9,(0,P.e9)({wallet:D,connection:M,position:p,priceSlippage:i,collateralUsdDelta:n,sizeUsdDelta:s,desiredMint:Le.isTokenSwapRequired&&ye?new ce.PublicKey(ye.address):p.collateralCustody.account.mint,jupiterMinimumOut:Le.isTokenSwapRequired&&qe?new(lt())(qe.toString()):null});case 9:return l=e.sent,r=l.instructions,a=l.positionRequestKey,e.next=14,new Promise(function(){var e=(0,o.Z)(c().mark((function e(t,n){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A(r,a,(function(e){V(),N(),t(e)}),(function(e){n(e)}));case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 14:return e.abrupt("return",e.sent);case 17:e.prev=17,e.t0=e.catch(6),console.log("Failed to close position!",e.t0);case 20:return e.prev=20,_(!1),e.finish(20);case 23:case"end":return e.stop()}}),e,null,[[6,17,20,23]])})));return function(t){return e.apply(this,arguments)}}(),[me,M,Ie,de,V,qe,p,A,ye,N,_,pe,Le.isTokenSwapRequired,D]),Be=(0,s.useMemo)((function(){if(ye&&he)return Le.isTokenSwapRequired?Ae?new x.Z(Ae.toString()||0).div(Math.pow(10,ye.decimals)).toString():void 0:he.transferToken.toString()}),[he,Ae,ye,Le.isTokenSwapRequired]);return(0,v.jsx)(ke.Z,{open:a,onClose:m,children:(0,v.jsxs)("form",{className:"relative w-full lg:max-w-[400px] bg-v2-perps-modal rounded-lg",children:[(0,v.jsx)("div",{className:"p-4 lg:p-6 mb-2 lg:mb-0 font-semibold leading-none lg:text-lg text-v2-lily",children:d.ag._("Close Position")}),(0,v.jsx)("button",{type:"button",disabled:Z,className:"flex absolute top-5 lg:top-8 right-8 z-10 text-v2-lily/[.25] fill-current cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed",onClick:V,children:(0,v.jsx)(ae.Z,{width:12,height:12})}),Te?(0,v.jsx)("div",{className:"absolute top-0 left-0 w-full h-full z-50",children:(0,v.jsx)(dt.ZP,{onSubmit:Oe,onClose:function(){return Me(!1)},mintsList:Fe,suppressCloseModal:!0,customStyle:{width:"100%",height:"100%"}})}):null,(0,v.jsxs)("div",{className:"max-h-[80vh] overflow-y-auto",children:[(0,v.jsxs)("div",{className:"px-4 lg:px-6",children:[(0,v.jsxs)("div",{className:"rounded-lg bg-v2-lily/5 border border-v2-lily/[.15] p-4 lg:p-5",children:[(0,v.jsxs)("div",{className:"flex items-center justify-between text-sm font-semibold",children:[(0,v.jsxs)("div",{className:"flex space-x-2 items-center",children:[(0,v.jsx)(te.Z,{info:q,width:24,height:24}),(0,v.jsx)(W.cC,{id:"<0>{0} Price:</0>",values:{0:q.symbol},components:{0:(0,v.jsx)("span",{})}})]}),(0,v.jsxs)("span",{className:"text-sm font-semibold",children:[null===Ve||void 0===Ve?void 0:Ve.toFixed(2).toString()," USD"]})]}),(0,v.jsx)("div",{className:"border-b border-v2-lily/5 my-3 lg:my-4"}),(0,v.jsxs)("div",{className:"space-y-2",children:[(0,v.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,v.jsx)("span",{className:"text-white/40",children:d.ag._("Current Position Size")}),(0,v.jsxs)("span",{className:"text-white/[.75]",children:["$",p.sizeUsd.div(1e6).toFixed(2)]})]}),(0,v.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,v.jsx)("span",{className:"text-white/40",children:d.ag._("Entry Price")}),(0,v.jsxs)("span",{className:"text-white/[.75]",children:["$",p.price.div(1e6).toFixed(2)]})]}),(0,v.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,v.jsx)("span",{className:"text-white/40",children:d.ag._("Liquidation Price")}),(0,v.jsxs)("span",{className:"text-white/[.75]",children:["$",null===(t=p.accounting)||void 0===t?void 0:t.liquidationPrice.div(1e6).toFixed(2)]})]}),(0,v.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,v.jsx)("span",{className:"text-white/40",children:d.ag._("Current Leverage")}),(0,v.jsxs)("span",{className:"text-white/[.75]",children:[p.leverage.toFixed(2),"x"]})]}),(0,v.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,v.jsx)("span",{className:"text-white/40",children:d.ag._("Current P&L")}),(0,v.jsx)(Pe,{changePct:null===(n=p.accounting)||void 0===n?void 0:n.unrealizedPNLPct,pnl:null===(i=p.accounting)||void 0===i?void 0:i.unrealizedPNL})]})]})]}),(0,v.jsx)("div",{className:"mt-5",children:(0,v.jsxs)("div",{className:"flex justify-between items-end leading-none",children:[(0,v.jsx)("div",{className:"text-v2-lily text-sm font-semibold",children:d.ag._("Close size:")}),de?(0,v.jsxs)("div",{className:"flex space-x-1",children:[(0,v.jsx)("button",{type:"button",onClick:function(){return ie(25)},className:"border rounded-md border-v2-lily/10 hover:border-v2-lily/20 text-v2-lily/[0.35] hover:text-v2-lily/50 text-xxs px-1.5 py-0.5 font-semibold",children:"25%"}),(0,v.jsx)("button",{type:"button",onClick:function(){return ie(50)},className:"border rounded-md border-v2-lily/10 hover:border-v2-lily/20 text-v2-lily/[0.35] hover:text-v2-lily/50 text-xxs px-1.5 py-0.5 font-semibold",children:"50%"}),(0,v.jsx)("button",{type:"button",onClick:function(){return ie(75)},className:"border rounded-md border-v2-lily/10 hover:border-v2-lily/20 text-v2-lily/[0.35] hover:text-v2-lily/50 text-xxs px-1.5 py-0.5 font-semibold",children:"75%"}),(0,v.jsx)("button",{type:"button",onClick:function(){return ie(100)},className:"border rounded-md border-v2-lily/10 hover:border-v2-lily/20 text-v2-lily/[0.35] hover:text-v2-lily/50 text-xxs px-1.5 py-0.5 font-semibold",children:"100%"})]}):(0,v.jsx)("div",{className:"text-v2-lily text-xs font-semibold",children:d.ag._("Only full close possible")})]})}),(0,v.jsx)("div",{className:"mt-2 rounded-lg bg-v2-perps-input pl-2 pr-4 py-3.5 text-md text-right",children:(0,v.jsx)(re.Qr,{name:"amount",control:Y,render:function(e){var t=e.field,n=t.onChange,s=t.value;return(0,v.jsx)(oe.Z,{disabled:new x.Z(H).lte(0)&&!de,decimals:6,onChange:function(e){var t=e.value;e.floatValue&&new x.Z(t).greaterThan(H)?n(H):n(t)},value:de?s:H,className:(0,f.cn)("!outline-none !text-right w-full",de?"":"cursor-not-allowed"),placeholder:"0.00",suffix:" USD"})}})}),we.length>0?we.map((function(e,t){return(0,v.jsx)("div",{className:"text-xs mt-2 text-warning",children:e},t)})):null,(0,v.jsx)("div",{className:"mt-5",children:(0,v.jsx)("div",{className:"text-v2-lily text-sm font-semibold",children:d.ag._("Receive in:")})}),(0,v.jsxs)("div",{className:"mt-2 rounded-lg bg-v2-perps-input p-4 text-md text-right flex h-18",children:[(0,v.jsxs)("div",{className:(0,f.cn)("  px-2 py-1.5 rounded-lg  flex items-center"),children:[ye?(0,v.jsx)(te.Z,{info:ye,width:28,height:28}):null,(0,v.jsx)("span",{className:"ml-3 font-semibold text-sm",children:null===ye||void 0===ye?void 0:ye.symbol})]}),(0,L.Hd)(se)&&0!==Number(se)?(0,v.jsxs)("div",{className:"flex flex-col w-full relative",children:[ye?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(oe.Z,{className:"!text-base disabled:cursor-not-allowed !outline-none !text-right",disabled:!0,decimals:ye.decimals,value:Be||void 0,suffix:" "+ye.symbol}),(0,v.jsx)("div",{className:(0,f.cn)("text-xs text-black-35 dark:text-white-35 relative"),children:(0,v.jsx)(at.default,{tokenInfo:ye,amount:Number(Be)})})]}):null,ve||ge?(0,v.jsx)(R.O,{className:"absolute right-0 top-0 !h-full"}):null]}):(0,v.jsx)("div",{className:"w-full flex items-center justify-end text-xs text-white/50 cursor-not-allowed",children:d.ag._("Please enter close size")})]}),ge?(0,v.jsx)(ct.Z,{iconSize:14,className:"!text-warning !p-2 mt-2 rounded-lg bg-warning/10",message:(0,v.jsx)(W.cC,{id:"<0>Failed to simulate output amount, you can still attempt to close your position.</0>",components:{0:(0,v.jsx)("p",{})}})}):null,(0,v.jsxs)("div",{className:"mt-5 space-y-2",children:[(0,v.jsxs)("div",{className:"flex justify-between text-white/50 text-xs",children:[(0,v.jsx)("span",{children:d.ag._("Size")}),(0,v.jsx)("div",{children:null!==he&&void 0!==he&&he.size?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("span",{children:["$",p.sizeUsd.div(1e6).toFixed(2)]}),(0,v.jsx)("span",{className:"px-1 text-white/[.75]",children:"\u2192"}),(0,v.jsxs)("span",{className:"text-white/[.75]",children:["$",he.size.div(1e6).toFixed(2)]})]}):(0,v.jsxs)("span",{children:["$",p.sizeUsd.div(1e6).toFixed(2)]})})]}),(0,v.jsxs)("div",{className:"flex justify-between text-white/50 text-xs",children:[(0,v.jsx)("span",{children:d.ag._("Collateral")}),(0,v.jsx)("div",{children:null!==he&&void 0!==he&&he.collateralUsd?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("span",{children:["$",null===(l=p.accounting)||void 0===l?void 0:l.initialCollateral.div(1e6).toFixed(2)]}),(0,v.jsx)("span",{className:"px-1 text-white/[.75]",children:"\u2192"}),(0,v.jsxs)("span",{className:"text-white/[.75]",children:["$",he.collateralUsd.toFixed(2)]})]}):(0,v.jsxs)("span",{children:["$",null===(r=p.accounting)||void 0===r?void 0:r.initialCollateral.div(1e6).toFixed(2)]})})]}),K?null:(0,v.jsxs)("div",{className:"flex justify-between text-white/50 text-xs",children:[(0,v.jsx)("span",{children:d.ag._("Leverage")}),(0,v.jsxs)("div",{children:[(0,v.jsxs)("span",{children:[p.leverage.toFixed(2),"x"]}),(0,v.jsx)("span",{className:"px-1 text-white",children:"\u2192"}),(0,v.jsxs)("span",{className:"text-white",children:[null===he||void 0===he?void 0:he.leverage.toFixed(2),"x"]})]})]}),(0,v.jsxs)("div",{className:"flex items-center justify-between text-white/50 text-xs max-h-[16px] overflow-hidden",children:[(0,v.jsx)("span",{children:d.ag._("Close Base Fees")}),(0,v.jsxs)("span",{className:"flex items-center",children:["$",(0,v.jsx)(X.ZP,{value:(null===he||void 0===he?void 0:he.closeFee.toNumber())||0})]})]}),(0,v.jsx)("div",{className:"flex items-center justify-between text-white/50 text-xs max-h-[16px] overflow-hidden",children:(0,v.jsx)(xt.hb,{impactPct:(null===he||void 0===he?void 0:he.impactPct)||null,impactFeeUsdText:(null===he||void 0===he?void 0:he.impactFeeUsdText)||"",orderInfoLoading:ve})}),(0,v.jsxs)("div",{className:"flex items-center justify-between text-white/50 text-xs max-h-[16px] overflow-hidden",children:[(0,v.jsx)("span",{children:d.ag._("Borrow Fees")}),(0,v.jsxs)("span",{className:"flex items-center",children:["$",(0,v.jsx)(X.ZP,{value:(null===he||void 0===he?void 0:he.borrowFee.toNumber())||0})]})]})]})]}),(0,v.jsxs)("div",{className:"w-full text-xs flex p-6 space-x-3",children:[ne.isSubmitting?null:(0,v.jsx)("button",{type:"button",className:(0,f.cn)("w-full py-2.5 px-6 border rounded-lg border-v2-lily/10 text-v2-lily bg-v2-lily/5 hover:bg-v2-lily/10 text-sm font-semibold disabled:cursor-not-allowed disabled:opacity-20",{"opacity-50 curosr-not-allowed":ne.isSubmitting}),disabled:ne.isSubmitting,onClick:V,children:(0,v.jsx)("span",{children:d.ag._("Cancel")})}),(0,v.jsx)("button",{type:"button",className:(0,f.cn)("w-full py-2.5 px-6 border rounded-lg border-labs/20 text-labs hover:bg-labs/5 text-sm font-semibold disabled:cursor-not-allowed disabled:opacity-20",{"opacity-50 curosr-not-allowed":ne.isSubmitting||Ie}),disabled:Ie,onClick:Q(ze),children:ne.isSubmitting?(0,v.jsxs)("span",{className:"flex justify-center items-center",children:[(0,v.jsx)(k.Z,{className:"!h-4 !w-4",baseColor:"white",spinnerColor:"black"}),(0,v.jsx)("div",{className:"mr-2"}),d.ag._("Closing position")]}):(0,v.jsx)("span",{className:"text-center",children:d.ag._("Confirm")})})]})]})]})})},ft=function(e){var t=e.open,n=e.onClose,i=e.positionAccountPubkey,l=(0,h.tc)().userPositions,r=(0,s.useMemo)((function(){return null===l||void 0===l?void 0:l.find((function(e){return e.publicKey.equals(i)}))}),[i,l]);return r?(0,v.jsx)(pt,{open:t,onClose:n,positionAccount:r}):null},ht=n(13170),vt=n(94223),gt=n(38756),bt=n(13020),wt=n(69667),jt=n(35569),yt=function(e){var t,n,i=e.positionAccount,l=e.onClose,r=(0,y.y6)().tokenPriceMap,a=(0,h.tc)(),u=a.viewClient,m=a.oraclePrices,p=a.setIsAnyFormSubmitting,g=(0,C.Z)().promptKeeperIncreaseCollateralNotification,b=i.collateralCustody,w=i.custody,N=i.side,P=i.sizeUsd,S=i.accounting,Z=i.leverage,_=(0,y.Bn)(),T=_.connection,M=_.getTokenInfo,O=(_.tokenMap,(0,y.Os)().wallet),F=(0,re.cI)({defaultValues:{amount:{formattedValue:"",value:"",floatValue:0}}}),D=F.control,A=F.handleSubmit,q=F.watch,R=F.setValue,I=F.formState,V=q("amount"),E=(0,s.useMemo)((function(){return M(b.account.mint.toString())}),[M,b.account.mint]),z=(0,s.useMemo)((function(){if(!m||!E)return[null,null];var e=m[w.account.mint.toString()],t=m[E.address];return e&&t?[e,t]:[null,null]}),[m,E,w.account.mint]),B=z[0],K=z[1],$=(0,s.useState)(E||null),W=$[0],H=$[1],G=(0,s.useState)(!1),Y=G[0],Q=G[1],X=s.useCallback((function(e){Q(!1),H(e),R("amount",{formattedValue:"",value:"",floatValue:0})}),[R]),ee=(0,j.FB)((null===W||void 0===W?void 0:W.address)||"").balance,ne=(0,bt.Z)({fromPairTokenInfo:W,toPairTokenInfo:E,fromPairValue:V.value}),se=ne.isLoading,ie=ne.isTokenSwapRequired,le=ne.outAmount,ae=ne.otherAmountThreshold,ue=(ne.quoteResponseMeta,(0,s.useMemo)((function(){var e,t,n=null===(e=r[(null===W||void 0===W?void 0:W.address)||""])||void 0===e?void 0:e.usd,s=null===(t=r[(null===E||void 0===E?void 0:E.address)||""])||void 0===t?void 0:t.usd;return n&&s?{inTokenPrice:n,outTokenPrice:s,selectedTokenRate:s/n}:{inTokenPrice:null,outTokenPrice:null,selectedTokenRate:null}}),[W,E,r])),xe=ue.inTokenPrice,me=(ue.outTokenPrice,ue.selectedTokenRate),pe=(0,s.useMemo)((function(){if(!S||!B||!K||!W)return new x.Z(0);if(ie){if(!me)return new x.Z(0);var e=S.fundingFeeUsd.div(1e6).gte(50)?1.01:1.005;return S.fundingFeeUsd.div(1e6).mul(e).div(xe).toDP(W.decimals)}return S.fundingFeeUsd.div(1e6).div(K).toDP(W.decimals)}),[S,K,xe,ie,W,me,B]),fe=(0,s.useMemo)((function(){return B&&K&&S&&E?P.div(h.aY).sub(S.initialCollateral).add(S.fundingFeeUsd).div(K).toDP(E.decimals):new x.Z(0)}),[S,E,K,P,B]),he=(0,s.useMemo)((function(){if(!B||!K||!S||!E||!W)return new x.Z(0);var e=ie&&me,t=e?fe.div(1e6).mul(me):fe.div(1e6);return e?t.mul(.999).toDP(W.decimals):t.toDP(E.decimals)}),[B,K,S,E,W,ie,me,fe]),ve=(0,s.useCallback)((function(){R("amount",{formattedValue:pe.toFixed(),value:pe.toFixed(),floatValue:pe.toNumber()})}),[pe,R]),ge=(0,s.useCallback)((function(){R("amount",{formattedValue:he.toFixed(),value:he.toFixed(),floatValue:he.toNumber()})}),[he,R]),be=(0,s.useMemo)((function(){if(null===O||void 0===O||!O.adapter.connected)return!1;if((null===W||void 0===W?void 0:W.address)!==ht.W4.toBase58())return!1;var e=ee-ht.WO;return new x.Z(V.floatValue||0).gt(e)}),[ee,V.floatValue,null===W||void 0===W?void 0:W.address,null===O||void 0===O?void 0:O.adapter.connected]),we=(0,s.useMemo)((function(){return new x.Z(pe).gt(ee)}),[ee,pe]),je=(0,s.useMemo)((function(){return!!V.floatValue&&new x.Z(V.floatValue).gt(ee)}),[V,ee]),ye=(0,s.useMemo)((function(){if(V.floatValue){if(ie&&me){var e=fe.div(1e6).mul(me);return new x.Z(V.floatValue).gt(e)}return V.floatValue&&fe?new x.Z(V.floatValue).gt(fe.div(1e6)):void 0}}),[V.floatValue,ie,fe,me]),Ne=(0,s.useMemo)((function(){if(V.floatValue&&he)return new x.Z(V.floatValue).gt(he)}),[V,he]),ke=(0,s.useMemo)((function(){return Z.lte(h.aY)}),[Z]),Se=(0,s.useMemo)((function(){if(V.floatValue&&pe)return new x.Z(V.floatValue).lt(pe.mul(.999))}),[pe,V.floatValue]),Ce=(0,s.useMemo)((function(){var e=[];return we?(e.push(d.ag._("Minimum deposit required is greater than your balance.")),e):(je&&e.push(d.ag._("Insufficient balance.")),ye&&e.push(d.ag._("Minimum leverage of {MINIMUM_LEVERAGE}x is required",{MINIMUM_LEVERAGE:h.aY})),Ne&&e.push(d.ag._("Over allowed amount of {allowedMaxAmount} {0}",{0:null===W||void 0===W?void 0:W.symbol,allowedMaxAmount:he})),Se&&e.push(d.ag._("Minimum deposit of {0} {1} is required.",{0:U.uf.format(pe),1:null===W||void 0===W?void 0:W.symbol})),be&&e.push(d.ag._("We recommend having at least {MINIMUM_SOL_BALANCE} SOL for any transaction",{MINIMUM_SOL_BALANCE:ht.WO})),e)}),[he,je,Se,ye,pe,we,Ne,be,null===W||void 0===W?void 0:W.symbol]),Ze=(0,s.useMemo)((function(){return we||je||I.isSubmitting||Ne||he.lte(0)||Ce.length>0||ke||Se}),[we,je,I.isSubmitting,Ne,he,Ce.length,ke,Se]),_e=(0,s.useState)(null),Te=_e[0],Me=_e[1];(0,s.useEffect)((function(){!W&&E&&H(E)}),[E,W]),(0,s.useEffect)((function(){(0,o.Z)(c().mark((function e(){var t,n,s,l,r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(S&&V.floatValue&&E&&u&&!(Ce.length>0)&&B){e.next=3;break}return Me(null),e.abrupt("return");case 3:if(!ie||!se){e.next=5;break}return e.abrupt("return");case 5:if(!new x.Z(V.floatValue).gt(he)){e.next=7;break}return e.abrupt("return");case 7:return n=W&&ae?new(lt())(ae.toString()):new(lt())((0,L.ks)(V.floatValue,E.decimals)),e.next=10,u.getIncreasePosition({collateral:n,sizeUsdDelta:new(lt())(0),side:N,custody:w,positionAccount:i,collateralCustody:b,collateralTokenPrice:K.toNumber(),pool:i.pool,tokenPrice:B.toNumber()});case 10:if(t=e.sent){e.next=13;break}return e.abrupt("return");case 13:s=new x.Z(t.liquidationPrice.toString()),l=new x.Z(t.collateralUsd.toString()),r=function(){var e=new x.Z(t.collateralUsd.toString()).minus(S.initialCollateral.toString()).div(1e6);return new x.Z(S.positionValue.toString()).add(e)}(),Me({liquidationPrice:new x.Z(s.toString()).div(1e6),collateralUsd:l.div(1e6),leverage:new x.Z(P).div(l).toNearest(.01,x.Z.ROUND_DOWN),transferToken:new x.Z(0),transferAmountUsd:new x.Z(0),fundingFeeUsd:x.Z.max(0,new x.Z(S.fundingFeeUsd).minus(new x.Z(n.toString()).div(Math.pow(10,E.decimals)).mul(1e6).mul(B))),positionValue:r});case 17:case"end":return e.stop()}}),e)})))()}),[V,u,E,he,Ce,W,ae,ie,le,se,i,b.account,w.account,S,N,P,w,b,B,K]);var Oe=(0,s.useCallback)((0,o.Z)(c().mark((function e(){var t,n,s;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(O&&E&&W&&V.floatValue){e.next=2;break}return e.abrupt("return");case 2:return p(!0),e.prev=3,e.next=6,(0,gt.w)({wallet:O,connection:T,side:N,collateralCustody:b,positionCustody:w,inputMint:new ce.PublicKey(W.address),priceSlippage:new(lt())(0),collateralTokenDelta:new(lt())((0,L.ks)(Number(V.floatValue),W.decimals)),sizeUsdDelta:new(lt())(0),jupiterMinimumOut:ie&&ae?new(lt())(ae.toString()):null});case 6:return t=e.sent,n=t.instructions,s=t.positionRequestKey,e.next=11,new Promise(function(){var e=(0,o.Z)(c().mark((function e(t,i){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g(n,s,(function(e){l(),t(e)}),(function(e){i(e)}));case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 11:return e.abrupt("return",e.sent);case 14:e.prev=14,e.t0=e.catch(3),console.log("Failed to adjust collateral!",e.t0);case 17:return e.prev=17,p(!1),e.finish(17);case 20:case"end":return e.stop()}}),e,null,[[3,14,17,20]])}))),[b,E,T,w,V.floatValue,ie,l,ae,g,W,p,N,O]),Fe=(0,y.gZ)().userAccounts,Le=(0,s.useMemo)((function(){return[ht.W4.toString()].concat((0,de.Z)(Array.from(Fe.reduce((function(e,t){return t.info.amount.gtn(0)?e.add(t.info.mint.toString()):e}),new Set))))}),[Fe]);return(0,v.jsxs)(v.Fragment,{children:[Y?(0,v.jsx)("div",{className:"absolute top-0 left-0 w-full h-full z-50",children:(0,v.jsx)(dt.ZP,{onSubmit:X,onClose:function(){return Q(!1)},mintsList:Le,suppressCloseModal:!0,customStyle:{width:"100%",height:"100%"}})}):null,(0,v.jsxs)("div",{className:"px-6 mt-5",children:[(0,v.jsxs)("div",{className:"w-full flex justify-between text-xs",children:[(0,v.jsx)("div",{className:"text-v2-lily text-sm font-semibold",children:d.ag._("Position Value")}),(0,v.jsx)(Pe,{changePct:null===(t=i.accounting)||void 0===t?void 0:t.unrealizedPNLPct,pnl:null===(n=i.accounting)||void 0===n?void 0:n.unrealizedPNL})]}),(0,v.jsx)("div",{className:"rounded-lg bg-v2-perps-input px-4 py-3.5 text-md font-semibold text-right mt-2 cursor-not-allowed opacity-70",children:(0,v.jsxs)("div",{children:[U.uf.format(null===S||void 0===S?void 0:S.positionValue.div(1e6),2)," USD"]})}),(0,v.jsxs)("div",{className:"mt-5",children:[(0,v.jsx)("div",{className:"flex items-end leading-none",children:(0,v.jsx)("div",{className:"text-v2-lily text-sm font-semibold",children:d.ag._("Deposit Collateral")})}),(0,v.jsxs)("div",{className:"flex justify-between mt-2",children:[(0,v.jsx)("div",{className:"text-v2-lily/[.25] hover:text-v2-lily cursor-pointer text-xs",onClick:ve,children:pe.lte(0)?"":d.ag._("Min: {0} {1}",{0:U.uf.format(pe),1:null===W||void 0===W?void 0:W.symbol})}),(0,v.jsx)("div",{className:"text-v2-lily/[.25] hover:text-v2-lily cursor-pointer text-xs",onClick:ge,children:d.ag._("Max: {0} {1}",{0:U.uf.format(he),1:null===W||void 0===W?void 0:W.symbol})})]}),(0,v.jsx)("div",{className:"mt-2 rounded-lg bg-v2-perps-input pl-2 pr-4 py-3.5 text-md text-right",children:(0,v.jsx)(re.Qr,{name:"amount",control:D,render:function(e){var t=e.field,n=t.onChange,s=t.value;return(0,v.jsxs)("div",{className:"flex items-center justify-between text-md w-full",children:[(0,v.jsxs)("div",{className:(0,f.cn)("bg-white/10 px-2 py-1.5 rounded-lg flex items-center","hover:bg-black/10 cursor-pointer"),onClick:function(){return Q(!0)},children:[W?(0,v.jsx)(te.Z,{info:W,width:28,height:28}):null,(0,v.jsx)("span",{className:"ml-3",children:null===W||void 0===W?void 0:W.symbol}),(0,v.jsx)("div",{className:"ml-4 text-white/50 fill-current",children:(0,v.jsx)(wt.Z,{})})]}),(0,v.jsx)("div",{className:"flex flex-col",children:W?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(oe.Z,{decimals:W.decimals,onChange:n,value:s.value,className:"!text-xl disabled:cursor-not-allowed !outline-none",placeholder:"0.00"}),(0,v.jsx)("div",{className:(0,f.cn)("text-xs text-v2-lily/[.25] font-normal"),children:(0,v.jsx)(at.default,{tokenInfo:W,amount:s.floatValue})})]}):null})]})}})})]}),ke?(0,v.jsx)("span",{className:"my-2 text-v2-lily/50 text-xs",children:d.ag._("You're already at a minimum leverage of 1.10x, and cannot deposit more collateral.")}):(0,v.jsxs)("div",{className:"mt-2 flex whitespace-nowrap text-v2-lily/[.25] leading-none text-xs items-end",children:[(0,v.jsx)(vt.Z,{width:14,height:14}),(0,v.jsxs)("span",{className:"ml-1",children:[U.uf.format(ee)," ",null===W||void 0===W?void 0:W.symbol]})]}),Ce.length>0?Ce.map((function(e,t){return(0,v.jsx)("div",{className:"text-xs mt-2 text-warning",children:e},t)})):null,(0,v.jsx)("div",{className:"border-b border-v2-lily/5 my-4"}),(0,v.jsxs)("div",{className:"mt-5 space-y-3",children:[(0,v.jsxs)("div",{className:"flex justify-between text-xs text-white/50",children:[(0,v.jsx)("span",{children:d.ag._("Leverage")}),(0,v.jsxs)("div",{children:[(0,v.jsxs)("span",{children:[Z.toFixed(2),"x"]}),(0,v.jsx)("span",{children:Te?(0,v.jsxs)("span",{className:"ml-1 text-white/[.75]",children:[(0,v.jsx)("span",{className:"mx-0.5 text-white/[.75]",children:"\u2192"}),Te.leverage.toFixed(2),"x"]}):""})]})]}),(0,v.jsxs)("div",{className:"flex justify-between text-xs text-white/50",children:[(0,v.jsx)("span",{children:d.ag._("Liq. price")}),Te?(0,v.jsxs)("div",{children:[(0,v.jsxs)("span",{children:["$",U.uf.format(null===S||void 0===S?void 0:S.liquidationPrice.div(1e6),2)]}),Te.liquidationPrice?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("span",{className:"mx-0.5 text-white/[.75]",children:"\u2192"}),(0,v.jsxs)("span",{className:"text-white/[.75]",children:["$",U.uf.format(Te.liquidationPrice,2)]})]}):null]}):(0,v.jsxs)("div",{children:["$",U.uf.format(null===S||void 0===S?void 0:S.liquidationPrice.div(1e6),2)]})]}),(0,v.jsxs)("div",{className:"flex justify-between text-xs text-white/50",children:[(0,v.jsx)("span",{children:d.ag._("Collateral")}),(0,v.jsxs)("div",{children:[(0,v.jsxs)("span",{children:["$",U.uf.format(null===S||void 0===S?void 0:S.initialCollateral.div(1e6),2)]}),Te?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("span",{className:"mx-0.5 text-white/[.75]",children:"\u2192"}),(0,v.jsxs)("span",{className:"text-white/[.75]",children:["$",U.uf.format(Te.collateralUsd,2)]})]}):null]})]}),(0,v.jsxs)("div",{className:"flex justify-between text-xs text-white/50",children:[(0,v.jsx)(J.Z,{content:d.ag._("Borrow fees due are settled when depositing or withdrawing collateral."),children:(0,v.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,v.jsx)("span",{children:d.ag._("Borrow fees due")}),(0,v.jsx)(jt.Z,{width:14,height:14})]})}),(0,v.jsxs)("div",{children:[(0,v.jsxs)("span",{children:["$",U.uf.format(null===S||void 0===S?void 0:S.fundingFeeUsd.div(1e6),2)]}),Te?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("span",{className:"mx-0.5 text-white/[.75]",children:"\u2192"}),(0,v.jsxs)("span",{className:"text-white/[.75]",children:["$",U.uf.format(Te.fundingFeeUsd.div(1e6),2)]})]}):null]})]})]})]}),(0,v.jsxs)("div",{className:"w-full text-xs flex p-6 space-x-3",children:[I.isSubmitting?null:(0,v.jsx)("button",{type:"button",className:(0,f.cn)("w-full py-2.5 px-6 border rounded-lg border-v2-lily/10 text-v2-lily bg-v2-lily/5 hover:bg-v2-lily/10 text-sm font-semibold disabled:cursor-not-allowed disabled:opacity-20",{"opacity-50 curosr-not-allowed":I.isSubmitting}),disabled:I.isSubmitting,onClick:l,children:(0,v.jsx)("span",{children:d.ag._("Cancel")})}),(0,v.jsx)("button",{type:"button",className:(0,f.cn)("w-full py-2.5 px-6 border rounded-lg border-labs/20 text-labs hover:bg-labs/5 text-sm font-semibold disabled:cursor-not-allowed disabled:opacity-20",{"opacity-50 curosr-not-allowed":I.isSubmitting||Ze}),disabled:Ze,onClick:A(Oe),children:I.isSubmitting?(0,v.jsxs)("span",{className:"flex justify-center items-center",children:[(0,v.jsx)(k.Z,{className:"!h-4 !w-4",baseColor:"white",spinnerColor:"black"}),(0,v.jsx)("div",{className:"mr-2"}),d.ag._("Adding collateral")]}):(0,v.jsx)("span",{children:d.ag._("Deposit")})})]})]})},Nt=n(70006),Pt=function(e){var t,n,i,l,r,a,u=e.positionAccount,m=e.onClose,p=(0,h.tc)(),g=p.viewClient,b=p.oraclePrices,w=p.slippage,N=p.poolInfo,S=p.refreshPositionInfo,Z=p.setIsAnyFormSubmitting,_=(0,C.Z)().promptKeeperPartialClosePositionNotification,T=(0,y.Bn)(),M=T.connection,O=T.getTokenInfo,F=T.tokens,L=(0,y.Os)().wallet,D=(0,Nt.JT)().closeModal,A=u.custody,q=u.collateralCustody,R=(u.side,(0,re.cI)({defaultValues:{amount:{formattedValue:"",value:"",floatValue:0}}})),I=R.control,V=R.handleSubmit,E=R.watch,z=R.setValue,B=R.formState,K=E("amount"),$=(0,s.useMemo)((function(){return O(q.account.mint.toString())}),[O,q.account.mint]),W=(0,s.useMemo)((function(){return b&&$?[b[A.account.mint.toString()],b[$.address]]:[null,null]}),[b,A.account.mint,$]),H=W[0],G=W[1],Y=(0,s.useState)($||null),Q=Y[0],J=Y[1],X=(0,s.useState)(!1),ee=X[0],ne=X[1],se=s.useCallback((function(e){ne(!1),J(e)}),[]),ie=(0,j.FB)((null===Q||void 0===Q?void 0:Q.address)||"").balance,le=(0,s.useMemo)((function(){return H&&G&&u.accounting?function(){var e=x.Z.max(new x.Z(u.sizeUsd).div(h.jG),h.IH);if("long"===u.side){var t=new x.Z(u.accounting.initialCollateral).sub(e);return u.accounting.pnlAfterFeesUsd.lt(0)&&(t=t.add(u.accounting.pnlAfterFeesUsd)),new x.Z(t)}var n=new x.Z(u.accounting.initialCollateral).sub(e);return u.accounting.pnlAfterFeesUsd.lt(0)&&(n=n.add(u.accounting.pnlAfterFeesUsd)),new x.Z(n)}().div(1e6).toDP(4,x.Z.ROUND_DOWN):new x.Z(0)}),[H,G,u.accounting,u.sizeUsd,u.side]),ae=(0,s.useCallback)((function(){z("amount",{formattedValue:le.toString(),value:le.toString(),floatValue:le.toNumber()})}),[le,z]),de=(0,s.useMemo)((function(){if(K.floatValue&&le)return new x.Z(K.floatValue).gt(le)}),[K,le]),ue=(0,s.useMemo)((function(){if(!K.floatValue||!u.accounting)return!1;var e=new x.Z(u.accounting.fundingFeeUsd.toString()).div(1e6),t=new x.Z(u.accounting.initialCollateral).sub(K.floatValue).sub(e);return u.accounting.pnlAfterFeesUsd.lt(0)&&(t=t.add(u.accounting.pnlAfterFeesUsd)),t.lt(h.IH)}),[K.floatValue,u.accounting]),xe=(0,s.useMemo)((function(){var e=[];return le.lt(0)&&e.push(d.ag._("No more collateral can be withdrawn")),ue&&e.push(d.ag._("Minimum collateral of {MINIMUM_COLLATERAL_SIZE_USD} USD is required",{MINIMUM_COLLATERAL_SIZE_USD:h.IH})),de&&e.push(d.ag._("Withdrawal amount too close to liquidation price")),e}),[de,ue,le]),me=(0,s.useMemo)((function(){return B.isSubmitting||de||le.lte(0)||xe.length>0}),[B.isSubmitting,de,le,xe]),pe=(0,s.useState)(null),fe=pe[0],he=pe[1];(0,s.useEffect)((function(){!Q&&$&&J($)}),[$,fe,null===fe||void 0===fe?void 0:fe.transferAmountUsd,null===fe||void 0===fe?void 0:fe.transferToken,Q]);var ve=(0,s.useMemo)((function(){return{isTokenSwapRequired:(null===$||void 0===$?void 0:$.address)!==(null===Q||void 0===Q?void 0:Q.address),amount:Q&&$&&fe?ot().BigInt(fe.transferToken.mul(Math.pow(10,$.decimals)).toFixed()):ot().BigInt(0),fromTokenInfo:$}}),[$,fe,Q]),ge=(0,ut.Z)({disabled:!ve.isTokenSwapRequired,amount:ve.amount,fromTokenInfo:ve.fromTokenInfo,toTokenInfo:Q,slippage:w}),be=ge.outAmount,we=ge.otherAmountThreshold,je=(0,s.useMemo)((function(){if(Q&&fe)return ve.isTokenSwapRequired&&be?{floatValue:new x.Z(be.toString()||0).div(Math.pow(10,Q.decimals)).toNumber(),formattedValue:new x.Z(be.toString()||0).div(Math.pow(10,Q.decimals)).toFixed(),value:new x.Z(be.toString()||0).div(Math.pow(10,Q.decimals)).toFixed()}:{floatValue:fe.transferToken.toNumber(),formattedValue:fe.transferToken.toFixed(),value:fe.transferToken.toFixed()}}),[fe,be,Q,ve.isTokenSwapRequired]);(0,s.useEffect)((function(){(0,o.Z)(c().mark((function e(){var t,n,s,i;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(K.floatValue&&$&&g&&u.accounting&&!(xe.length>0)&&H&&G&&null!==N&&void 0!==N&&N.pool){e.next=3;break}return he(null),e.abrupt("return");case 3:if(!new x.Z(K.floatValue).gt(le)){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,g.getDecreasePosition({position:u,collateralUsdDelta:new(lt())(new x.Z(K.floatValue).mul(1e6).round().toString()),sizeUsdDelta:new(lt())(0),tokenPrice:null===H||void 0===H?void 0:H.toNumber(),collateralTokenPrice:null===G||void 0===G?void 0:G.toNumber(),pool:N.pool});case 7:if(t=e.sent){e.next=10;break}return e.abrupt("return");case 10:n=new x.Z(t.liquidationPrice.toString()),s=new x.Z(t.collateralUsd.toString()),i=function(){var e,n=new x.Z(t.collateralUsd.toString()).minus(null===(e=u.accounting)||void 0===e?void 0:e.initialCollateral).div(1e6);return new x.Z(u.accounting.positionValue.toString()).add(n)}(),he({liquidationPrice:n,collateralUsd:s,fees:new x.Z(t.feeUsd.toString()),leverage:new x.Z(u.sizeUsd.toString()).div(s).toNearest(.01,x.Z.ROUND_DOWN),transferToken:new x.Z(t.transferToken.toString()).div(Math.pow(10,$.decimals)),transferAmountUsd:new x.Z(t.transferAmountUsd.toString()),positionValue:i});case 14:case"end":return e.stop()}}),e)})))()}),[K,u,g,$,le,xe,H,G,null===N||void 0===N?void 0:N.pool]);var ye=(0,s.useCallback)(function(){var e=(0,o.Z)(c().mark((function e(t){var n,s,i;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(g&&L&&L.adapter.publicKey&&g&&$&&K.floatValue){e.next=2;break}return e.abrupt("return");case 2:return Z(!0),e.prev=3,e.next=6,(0,P.e9)({wallet:L,connection:M,position:u,collateralUsdDelta:new(lt())(new x.Z(K.floatValue).mul(1e6).round().toString()),sizeUsdDelta:new(lt())(0),desiredMint:ve.isTokenSwapRequired&&Q?new ce.PublicKey(Q.address):u.collateralCustody.account.mint,priceSlippage:new(lt())(0),jupiterMinimumOut:ve.isTokenSwapRequired&&we?new(lt())(we.toString()):null});case 6:return n=e.sent,s=n.instructions,i=n.positionRequestKey,D(),e.next=12,new Promise(function(){var e=(0,o.Z)(c().mark((function e(t,n){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_(s,i,(function(e){m(),t(e),S()}),(function(e){n(e)}));case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 12:return e.abrupt("return",e.sent);case 15:e.prev=15,e.t0=e.catch(3),console.log("Failed to adjust collateral!",e.t0);case 18:return e.prev=18,Z(!1),e.finish(18);case 21:case"end":return e.stop()}}),e,null,[[3,15,18,21]])})));return function(t){return e.apply(this,arguments)}}(),[D,$,M,K.floatValue,m,we,u,_,Q,S,Z,ve.isTokenSwapRequired,g,L]),Ne=(0,s.useMemo)((function(){return Array.from(F.map((function(e){return e.address})))}),[F]);return(0,v.jsxs)(v.Fragment,{children:[ee?(0,v.jsx)("div",{className:"absolute top-0 left-0 w-full h-full z-50",children:(0,v.jsx)(dt.ZP,{onSubmit:se,onClose:function(){return ne(!1)},mintsList:Ne,suppressCloseModal:!0,customStyle:{width:"100%",height:"100%"}})}):null,(0,v.jsxs)("div",{className:"px-6 mt-5",children:[(0,v.jsxs)("div",{className:"w-full flex justify-between text-xs",children:[(0,v.jsx)("div",{className:"text-v2-lily text-sm font-semibold",children:d.ag._("Position Value")}),(0,v.jsx)(Pe,{changePct:null===(t=u.accounting)||void 0===t?void 0:t.unrealizedPNLPct,pnl:null===(n=u.accounting)||void 0===n?void 0:n.unrealizedPNL})]}),(0,v.jsx)("div",{className:"rounded-lg bg-v2-perps-input px-4 py-3.5 text-md font-semibold text-right mt-2 cursor-not-allowed opacity-70",children:(0,v.jsxs)("div",{children:[null===(i=u.accounting)||void 0===i?void 0:i.positionValue.div(1e6).toFixed(2)," USD"]})}),(0,v.jsx)("div",{className:"mt-5",children:(0,v.jsxs)("div",{className:"flex justify-between items-end leading-none",children:[(0,v.jsx)("div",{className:"text-v2-lily text-sm font-semibold",children:d.ag._("Withdraw collateral in:")}),(0,v.jsx)("div",{className:"text-v2-lily/[.25] hover:text-v2-lily cursor-pointer text-xs",onClick:ae,children:le.lte(0)?"":d.ag._("Max: {allowedMaxAmount} USD",{allowedMaxAmount:le})})]})}),(0,v.jsx)("div",{className:"mt-2 rounded-lg bg-v2-perps-input pl-2 pr-4 py-3.5 text-md text-right",children:(0,v.jsx)(re.Qr,{name:"amount",control:I,render:function(e){var t=e.field,n=t.onChange,s=t.value;return(0,v.jsxs)("div",{className:"flex items-center justify-between text-md w-full",children:[(0,v.jsxs)("div",{className:"pl-2 py-1.5 rounded-lg flex items-center",children:[Q?(0,v.jsx)(te.Z,{info:Q,width:28,height:28}):null,(0,v.jsx)("span",{className:"ml-3 font-semibold text-sm",children:null===Q||void 0===Q?void 0:Q.symbol})]}),(0,v.jsxs)("div",{className:"flex flex-col",children:[(0,v.jsx)(oe.Z,{disabled:le.lte(0),decimals:6,onChange:n,value:s.value,className:"!text-xl disabled:cursor-not-allowed !outline-none",placeholder:"0.00",suffix:" USD"}),Q&&(0,v.jsx)(oe.Z,{className:"!text-xs !text-v2-lily/[.25] !font-normal",disabled:!0,decimals:Q.decimals,value:null===je||void 0===je?void 0:je.value,suffix:" "+Q.symbol})]})]})}})}),(0,v.jsxs)("div",{className:"mt-2 flex whitespace-nowrap text-v2-lily/[.25] leading-none text-xs items-end",children:[(0,v.jsx)(vt.Z,{width:14,height:14}),(0,v.jsxs)("span",{className:"ml-1",children:[ie," ",null===Q||void 0===Q?void 0:Q.symbol]})]}),xe.length>0?xe.map((function(e,t){return(0,v.jsx)("div",{className:"text-xs mt-2 text-warning",children:e},t)})):null,(0,v.jsx)("div",{className:"border-b border-v2-lily/5 my-4"}),(0,v.jsxs)("div",{className:"mt-5 space-y-3",children:[(0,v.jsxs)("div",{className:"flex justify-between text-xs text-white/50",children:[(0,v.jsx)("span",{children:d.ag._("Leverage")}),(0,v.jsxs)("div",{children:[(0,v.jsxs)("span",{children:[u.leverage.toFixed(2),"x"]}),(0,v.jsx)("span",{children:fe?(0,v.jsxs)("span",{className:"ml-1 text-white/[.75]",children:[(0,v.jsx)("span",{className:"mx-0.5 text-white/[.75]",children:"\u2192"}),fe.leverage.toFixed(2),"x"]}):""})]})]}),(0,v.jsxs)("div",{className:"flex justify-between text-xs text-white/50",children:[(0,v.jsx)("span",{children:d.ag._("Liq. Price")}),fe?(0,v.jsxs)("div",{children:[(0,v.jsxs)("span",{children:["$",U.uf.format(null===(r=u.accounting)||void 0===r?void 0:r.liquidationPrice.div(1e6),2)]}),fe.liquidationPrice?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("span",{className:"mx-0.5 text-white/[.75]",children:"\u2192"}),(0,v.jsxs)("span",{className:"text-white/[.75]",children:["$",U.uf.format(fe.liquidationPrice.div(1e6),2)]})]}):null]}):(0,v.jsxs)("div",{children:["$",U.uf.format(null===(l=u.accounting)||void 0===l?void 0:l.liquidationPrice.div(1e6),2)]})]}),(0,v.jsxs)("div",{className:"flex justify-between text-xs text-white/50",children:[(0,v.jsx)("span",{children:d.ag._("Collateral")}),(0,v.jsxs)("div",{children:[(0,v.jsxs)("span",{children:["$",U.uf.format(null===(a=u.accounting)||void 0===a?void 0:a.initialCollateral.div(1e6),2)]}),fe?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("span",{className:"mx-0.5 text-white/[.75]",children:"\u2192"}),(0,v.jsxs)("span",{className:"text-white/[.75]",children:["$",U.uf.format(fe.collateralUsd.div(1e6),2)]})]}):null]})]})]})]}),(0,v.jsxs)("div",{className:"w-full text-xs flex p-6 space-x-3",children:[B.isSubmitting?null:(0,v.jsx)("button",{type:"button",className:(0,f.cn)("w-full py-2.5 px-6 border rounded-lg border-v2-lily/10 text-v2-lily bg-v2-lily/5 hover:bg-v2-lily/10 text-sm font-semibold disabled:cursor-not-allowed disabled:opacity-20",{"opacity-50 curosr-not-allowed":B.isSubmitting}),disabled:B.isSubmitting,onClick:m,children:(0,v.jsx)("span",{children:d.ag._("Cancel")})}),(0,v.jsx)("button",{type:"button",className:(0,f.cn)("w-full py-2.5 px-6 border rounded-lg border-labs/20 text-labs hover:bg-labs/5 text-sm font-semibold disabled:cursor-not-allowed disabled:opacity-20",{"opacity-50 curosr-not-allowed":B.isSubmitting||me}),disabled:me,onClick:V(ye),children:B.isSubmitting?(0,v.jsxs)("span",{className:"flex justify-center items-center",children:[(0,v.jsx)(k.Z,{className:"!h-4 !w-4",baseColor:"white",spinnerColor:"black"}),(0,v.jsx)("div",{className:"mr-2"}),d.ag._("Withdrawing collateral")]}):(0,v.jsx)("span",{children:d.ag._("Withdraw")})})]})]})},kt=function(e){var t=e.open,n=e.onClose,i=e.positionAccount,l=(0,y.Bn)().getTokenInfo,r=(0,h.tc)(),o=r.oraclePrices,a=r.isAnyFormSubmitting,c=(0,s.useMemo)((function(){var e;return null!==(e=l(i.custody.account.mint.toString()))&&void 0!==e?e:z.mq}),[l,i.custody.account.mint]),u=s.useRef(null);(0,L.O3)(u,(function(){var e;return null===(e=u.current)||void 0===e?void 0:e.close()}));var x=(0,s.useCallback)((function(){var e;null===(e=u.current)||void 0===e||e.close(),n()}),[n,u]);(0,s.useEffect)((function(){if(u.current&&(t?u.current.open||u.current.show():u.current.close()),t){var e=u.current;return null===e||void 0===e||e.addEventListener("close",x),function(){null===e||void 0===e||e.removeEventListener("close",x)}}}),[x,t]);var m=(0,s.useState)("deposit"),p=m[0],g=m[1],b=(0,s.useMemo)((function(){return o&&o[c.address]}),[o,c.address]);return(0,v.jsx)(ke.Z,{open:t,onClose:n,children:(0,v.jsxs)("form",{className:"relative w-full lg:max-w-[400px] bg-v2-perps-modal rounded-lg",children:[(0,v.jsx)("div",{className:"p-4 lg:p-6 mb-2 lg:mb-0 font-semibold leading-none lg:text-lg text-v2-lily",children:d.ag._("Edit Collateral")}),(0,v.jsx)("button",{type:"button",disabled:a,className:"flex absolute top-5 lg:top-8 right-8 z-10 text-v2-lily/[.25] fill-current cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed",onClick:x,children:(0,v.jsx)(ae.Z,{width:12,height:12})}),(0,v.jsxs)("div",{className:"max-h-[80vh] overflow-y-auto",children:[(0,v.jsx)("div",{className:"px-6",children:(0,v.jsxs)("div",{className:"rounded-lg bg-v2-lily/5 border border-v2-lily/[.15] p-5",children:[(0,v.jsxs)("div",{className:"flex justify-between text-sm font-semibold",children:[(0,v.jsxs)("div",{className:"flex space-x-2 items-center",children:[(0,v.jsx)(te.Z,{info:c,width:24,height:24}),(0,v.jsx)(W.cC,{id:"<0>{0} Price:</0>",values:{0:c.symbol},components:{0:(0,v.jsx)("span",{})}})]}),(0,v.jsxs)("span",{className:"text-sm font-semibold",children:[U.uf.format(b||void 0,2)," USD"]})]}),(0,v.jsx)("div",{className:"border-b border-v2-lily/5 my-4"}),(0,v.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,v.jsx)("span",{className:"text-white/40",children:d.ag._("Current Position Size")}),(0,v.jsxs)("span",{className:"text-white/[.75]",children:["$",U.uf.format(i.sizeUsd.div(1e6),2)]})]})]})}),(0,v.jsxs)("div",{children:[(0,v.jsx)("div",{className:"flex flex-row items-center justify-between space-x-4 px-4 border-b-white/5 border-b h-[56px]",children:(0,v.jsxs)("div",{className:"flex flex-row w-full",children:[(0,v.jsx)("button",{type:"button",onClick:function(){return g("deposit")},className:(0,f.cn)("flex flex-row items-center justify-center px-3 pt-6 pb-4 font-semibold !outline-none","deposit"===p?"border-b border-b-labs text-labs":""),children:(0,v.jsx)("span",{className:"text-sm",children:d.ag._("Deposit")})}),(0,v.jsx)("button",{type:"button",onClick:function(){return g("withdraw")},className:(0,f.cn)("flex flex-row items-center justify-center px-3 pt-6 pb-4 font-semibold !outline-none","withdraw"===p?"border-b border-b-labs text-labs":""),children:(0,v.jsx)("span",{className:"text-sm",children:d.ag._("Withdraw")})})]})}),"deposit"===p?(0,v.jsx)(yt,{positionAccount:i,onClose:x}):(0,v.jsx)(Pt,{positionAccount:i,onClose:x})]})]})]})})},St=function(e){var t=e.open,n=e.onClose,i=e.positionAccountPubkey,l=(0,h.tc)().userPositions,r=(0,s.useMemo)((function(){return null===l||void 0===l?void 0:l.find((function(e){return e.publicKey.equals(i)}))}),[i,l]);return r?(0,v.jsx)(kt,{open:t,onClose:n,positionAccount:r}):null};function Ct(e){var t,n,s;return e?{floatValue:null!==(t=null===e||void 0===e?void 0:e.toNumber())&&void 0!==t?t:void 0,formattedValue:null!==(n=null===e||void 0===e?void 0:e.toString())&&void 0!==n?n:"",value:null!==(s=null===e||void 0===e?void 0:e.toString())&&void 0!==s?s:""}:{floatValue:void 0,formattedValue:"",value:""}}var Zt=function(e){var t,n,i,l,r,a,u=e.open,m=e.onClose,p=e.positionAccount,g=e.focusOn,b=(0,h.tc)(),w=b.viewClient,j=b.oraclePrices,N=b.setIsAnyFormSubmitting,P=b.isAnyFormSubmitting,S=(0,y.Bn)(),Z=S.connection,_=S.getTokenInfo,T=S.tokenMap,M=(0,y.Os)().wallet,O=(0,C.Z)().promptKeeperCreateTPSLNotification,F=(0,s.useMemo)((function(){var e;return null!==(e=_(p.custody.account.mint.toString()))&&void 0!==e?e:z.mq}),[_,p.custody.account.mint]),L=(0,s.useCallback)((function(){m()}),[m]),D=(0,s.useMemo)((function(){return _(p.collateralCustody.account.mint.toString())}),[_,p.collateralCustody.account.mint]),A=ye(p),q=A.hasTp,I=A.hasSl,V=(0,re.cI)({defaultValues:{tpPrice:Ct(q),slPrice:Ct(I)}}),E=V.control,B=V.handleSubmit,K=V.watch,$=V.setValue,H=V.formState,G=K("tpPrice"),Y=K("slPrice"),Q=Ne({positionAccount:p,tpPrice:G,slPrice:Y}),J=Q.showTPChanged,X=Q.showTPRemoved,ee=Q.showSLChanged,ne=Q.showSLRemoved,se=Q.minimumTPPrice,ie=Q.minimumSLPrice,le=Q.maximumSLPrice,de=Q.isWithinTPRange,ue=Q.isWithinSLRange,xe=Q.expectedPositionValueAtSL,me=Q.expectedPositionValueAtTP,pe=(0,s.useState)(null),fe=pe[0],he=pe[1],ve=(0,s.useMemo)((function(){var e=p.takeProfitPositionRequest||p.stopLossPositionRequest;if(e)return e}),[p.stopLossPositionRequest,p.takeProfitPositionRequest]);(0,s.useEffect)((function(){ve&&he(T.get(ve.account.mint.toString())||null),!fe&&D&&he(D)}),[D,ve,fe,T]);var ge=(0,s.useState)(!1),we=ge[0],je=ge[1],Se=s.useCallback((function(e){je(!1),he(e)}),[]),Ce=(0,s.useMemo)((function(){return Array.from(T.keys())}),[T]),Ze=(0,s.useMemo)((function(){return j&&j[F.address]?j[F.address]:null}),[j,F.address]),_e=(0,s.useMemo)((function(){return!H.isDirty||(!(!G.floatValue||de)||(!(!Y.floatValue||ue)||H.isSubmitting))}),[H.isDirty,H.isSubmitting,ue,de,Y.floatValue,G.floatValue]),Te=(0,s.useCallback)(function(){var e=(0,o.Z)(c().mark((function e(t){var n,s,i,l,r,a,u;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!_e&&M&&M.adapter.publicKey&&F&&w&&Ze&&fe){e.next=2;break}return e.abrupt("return");case 2:return N(!0),e.prev=3,n=t.tpPrice.floatValue?new(lt())(new x.Z(t.tpPrice.floatValue).mul(1e6).round().toFixed()):null,s=t.slPrice.floatValue?new(lt())(new x.Z(t.slPrice.floatValue).mul(1e6).round().toFixed()):null,i=J&&p.takeProfitPositionRequest&&n?{triggerPrice:n,positionRequestAccount:p.takeProfitPositionRequest.publicKey}:null,l=ee&&p.stopLossPositionRequest&&s?{triggerPrice:s,positionRequestAccount:p.stopLossPositionRequest.publicKey}:null,r=X&&p.takeProfitPositionRequest?{positionPubkey:p.publicKey,positionRequestPubkey:p.takeProfitPositionRequest.publicKey,positionRequestMint:p.takeProfitPositionRequest.account.mint}:null,a=ne&&p.stopLossPositionRequest?{positionPubkey:p.publicKey,positionRequestPubkey:p.stopLossPositionRequest.publicKey,positionRequestMint:p.stopLossPositionRequest.account.mint}:null,e.next=12,be({wallet:M,connection:Z,positionAccount:p,custody:p.custody.account,desiredMint:new ce.PublicKey(fe.address),tpPrice:q?null:n,slPrice:I?null:s,updateTPPrice:i,updateSLPrice:l,cancelTP:r,cancelSL:a});case 12:return u=e.sent,e.next=15,new Promise(function(){var e=(0,o.Z)(c().mark((function e(t,n){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O(u,(function(e){L(),t(e)}),(function(e){n(e)}),d.ag._("Adjusting Take Profit & Stop Loss..."));case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 15:return e.abrupt("return",e.sent);case 18:e.prev=18,e.t0=e.catch(3),console.log("Failed to submit TPSL!",e.t0);case 21:return e.prev=21,N(!1),e.finish(21);case 24:case"end":return e.stop()}}),e,null,[[3,18,21,24]])})));return function(t){return e.apply(this,arguments)}}(),[Z,I,q,_e,L,Ze,p,O,fe,N,ee,ne,J,X,F,w,M]),Me=(0,s.useMemo)((function(){return[]}),[]),Oe=(0,s.useCallback)((function(){se&&$("tpPrice",{floatValue:se.toNumber(),formattedValue:se.toFixed(2),value:se.toFixed(2)})}),[se,$]),Fe=(0,s.useCallback)((function(){ie&&$("slPrice",{floatValue:ie.toNumber(),formattedValue:ie.toFixed(2),value:ie.toFixed(2)})}),[ie,$]),Le=(0,s.useCallback)((function(){le&&$("slPrice",{floatValue:le.toNumber(),formattedValue:le.toFixed(2),value:le.toFixed(2)})}),[le,$]),De=(0,s.useRef)(),Ae=(0,s.useRef)();return(0,s.useEffect)((function(){var e,t;"tp"===g&&(null===(e=De.current)||void 0===e||e.focus()),"sl"===g&&(null===(t=Ae.current)||void 0===t||t.focus())}),[g]),(0,v.jsx)(ke.Z,{open:u,onClose:m,children:(0,v.jsxs)("form",{className:"relative w-full lg:max-w-[400px] bg-v2-perps-modal rounded-lg",children:[(0,v.jsx)("div",{className:"p-4 lg:p-6 mb-2 lg:mb-0 font-semibold leading-none lg:text-lg text-v2-lily",children:d.ag._("Take Profit & Stop Loss")}),(0,v.jsx)("button",{type:"button",disabled:P,className:"flex absolute top-5 lg:top-8 right-8 z-10 text-v2-lily/[.25] fill-current cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed",onClick:L,children:(0,v.jsx)(ae.Z,{width:12,height:12})}),we?(0,v.jsx)("div",{className:"absolute top-0 left-0 w-full h-full z-50",children:(0,v.jsx)(dt.ZP,{onSubmit:Se,onClose:function(){return je(!1)},mintsList:Ce,suppressCloseModal:!0,customStyle:{width:"100%",height:"100%"}})}):null,(0,v.jsxs)("div",{className:"max-h-[80vh] overflow-y-auto",children:[(0,v.jsxs)("div",{className:"px-6",children:[(0,v.jsxs)("div",{className:"rounded-lg bg-v2-lily/5 border border-v2-lily/[.15] p-5",children:[(0,v.jsxs)("div",{className:"flex justify-between text-sm font-semibold",children:[(0,v.jsxs)("div",{className:"flex space-x-2 items-center",children:[(0,v.jsx)(te.Z,{info:F,width:24,height:24}),(0,v.jsx)("span",{children:(0,v.jsx)(W.cC,{id:"Current Price:"})})]}),Ze?(0,v.jsxs)("span",{className:"text-sm font-semibold",children:[U.uf.format(Ze,2)," USD"]}):(0,v.jsx)(R.O,{className:"w-20 h-6"})]}),(0,v.jsx)("div",{className:"border-b border-v2-lily/5 my-4"}),(0,v.jsxs)("div",{className:"space-y-2",children:[(0,v.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,v.jsx)("span",{className:"text-white/40",children:d.ag._("Current Position Size")}),(0,v.jsxs)("span",{className:"text-white/[.75]",children:["$",U.uf.format(p.sizeUsd.div(1e6),2)]})]}),(0,v.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,v.jsx)("span",{className:"text-white/40",children:d.ag._("Entry Price")}),(0,v.jsxs)("span",{className:"text-white/[.75]",children:["$",U.uf.format(p.price.div(1e6),2)]})]}),(0,v.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,v.jsx)("span",{className:"text-white/40",children:d.ag._("Liquidation Price")}),(0,v.jsxs)("span",{className:"text-white/[.75]",children:["$",U.uf.format(null===(t=p.accounting)||void 0===t?void 0:t.liquidationPrice.div(1e6),2)]})]}),(0,v.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,v.jsx)("span",{className:"text-white/40",children:d.ag._("Leverage")}),(0,v.jsxs)("span",{className:"text-white/[.75]",children:[U.uf.format(p.leverage,2),"x"]})]}),(0,v.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,v.jsx)("span",{className:"text-white/40",children:d.ag._("Current P&L")}),p.accounting?(0,v.jsx)(Pe,{changePct:p.accounting.unrealizedPNLPct,pnl:p.accounting.unrealizedPNL}):null]}),(0,v.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,v.jsx)("span",{className:"text-white/40",children:d.ag._("Total Fees")}),(0,v.jsxs)("span",{className:"text-white/[.75]",children:["$",U.uf.format(null===(n=p.accounting)||void 0===n?void 0:n.totalFeeUsd.div(1e6))]})]}),(0,v.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,v.jsx)("span",{className:"text-white/40",children:d.ag._("Net P&L")}),(0,v.jsx)("span",{className:"text-white/[.75]",children:(0,v.jsx)(Pe,{changePct:null===(i=p.accounting)||void 0===i?void 0:i.pnlAfterFeesPct,pnl:null===(l=p.accounting)||void 0===l?void 0:l.pnlAfterFeesUsd})})]})]})]}),(0,v.jsx)("div",{className:"mt-5",children:(0,v.jsxs)("div",{className:"flex justify-between items-end leading-none",children:[(0,v.jsx)("div",{className:"text-v2-lily text-sm font-semibold",children:d.ag._("Take Profit Price:")}),me?(0,v.jsx)("div",{className:"text-v2-lily/[.25] hover:text-v2-lily text-xs",children:(0,v.jsx)(Pe,{changePct:me.pnlRate,pnl:me.pnl})}):null]})}),(0,v.jsx)("div",{className:"mt-2 rounded-lg bg-v2-perps-input pl-2 pr-4 py-3.5 text-md text-right",children:(0,v.jsx)(re.Qr,{name:"tpPrice",control:E,render:function(e){var t=e.field,n=t.onChange,s=t.value;return(0,v.jsx)(oe.Z,{ref:De,decimals:2,max:z.wN,onChange:n,value:s.value,className:"disabled:cursor-not-allowed !outline-none !text-right w-full !text-sm",placeholder:"0.00",suffix:" USD"})}})}),(0,v.jsxs)("div",{className:"mt-1 space-y-1",children:[me?(0,v.jsx)("p",{className:"text-xs text-v2-lily/30",children:d.ag._("Expected position value: ${0}",{0:me.positionValue.div(1e6).toNumber().toLocaleString(void 0,{compactDisplay:"short"})})}):null,J?(0,v.jsx)("p",{className:"text-xs text-v2-lily/30",children:d.ag._("Your existing Take Profit of ${hasTp} will be changed to ${0}",{0:null===(r=G.floatValue)||void 0===r?void 0:r.toLocaleString(void 0,{compactDisplay:"short"}),hasTp:q})}):null,X?(0,v.jsx)("p",{className:"text-xs text-v2-lily/30",children:d.ag._("Your will be removing your existing Take Profit at ${hasTp}.",{hasTp:q})}):null]}),G.floatValue&&!de&&se?(0,v.jsx)("div",{className:"text-xs mt-2 text-warning",children:(0,v.jsx)(W.cC,{id:"<0>Minimum Take Profit price is</0><1>${0}</1><2>.</2>",values:{0:null===se||void 0===se?void 0:se.toFixed(2)},components:{0:(0,v.jsx)("span",{}),1:(0,v.jsx)("button",{type:"button",onClick:Oe,className:"ml-1 underline decoration-dashed underline-offset-[3px] cursor-pointer"}),2:(0,v.jsx)("span",{})}})}):null,(0,v.jsx)("div",{className:"mt-5",children:(0,v.jsxs)("div",{className:"flex justify-between items-end leading-none",children:[(0,v.jsx)("div",{className:"text-v2-lily text-sm font-semibold",children:d.ag._("Stop Loss Price:")}),xe?(0,v.jsx)("div",{className:"text-v2-lily/[.25] hover:text-v2-lily text-xs",children:(0,v.jsx)(Pe,{changePct:xe.pnlRate,pnl:xe.pnl})}):null]})}),(0,v.jsx)("div",{className:"mt-2 rounded-lg bg-v2-perps-input pl-2 pr-4 py-3.5 text-md text-right",children:(0,v.jsx)(re.Qr,{name:"slPrice",control:E,render:function(e){var t=e.field,n=t.onChange,s=t.value;return(0,v.jsx)(oe.Z,{ref:Ae,decimals:2,max:z.wN,onChange:n,value:s.value,className:"disabled:cursor-not-allowed !outline-none !text-right w-full !text-sm",placeholder:"0.00",suffix:" USD"})}})}),(0,v.jsxs)("div",{className:"mt-1 space-y-1",children:[xe?(0,v.jsx)("span",{className:"text-xs text-v2-lily/30",children:d.ag._("Expected position value: ${0}",{0:xe.positionValue.div(1e6).toNumber().toLocaleString(void 0,{compactDisplay:"short"})})}):null,ee?(0,v.jsx)("p",{className:"text-xs text-v2-lily/30",children:d.ag._("Your existing Stop Loss of ${hasSl} will be changed to ${0}",{0:null===(a=Y.floatValue)||void 0===a?void 0:a.toLocaleString(void 0,{compactDisplay:"short"}),hasSl:I})}):null,ne?(0,v.jsx)("p",{className:"text-xs text-v2-lily/30",children:d.ag._("Your will be removing your existing Stop Loss at ${hasSl}.",{hasSl:I})}):null]}),Y.floatValue&&!ue&&ie&&le?(0,v.jsx)("div",{className:"text-xs mt-2 text-warning",children:(0,v.jsx)(W.cC,{id:"<0>Allowed Stop Loss price is between</0><1>${0}</1><2>and</2><3>${1}</3><4>.</4>",values:{0:U.uf.format(ie,2),1:U.uf.format(le,2)},components:{0:(0,v.jsx)("span",{}),1:(0,v.jsx)("button",{type:"button",onClick:Fe,className:"mx-1 underline decoration-dashed underline-offset-[3px] cursor-pointer"}),2:(0,v.jsx)("span",{}),3:(0,v.jsx)("button",{type:"button",onClick:Le,className:"ml-1 underline decoration-dashed underline-offset-[3px] cursor-pointer"}),4:(0,v.jsx)("span",{})}})}):null,Me.length>0?Me.map((function(e,t){return(0,v.jsx)("div",{className:"text-xs mt-2 text-warning",children:e},t)})):null,(0,v.jsx)("div",{children:(0,v.jsxs)("div",{className:"mt-5 pr-2 flex justify-between items-center",children:[(0,v.jsx)("div",{className:"flex-1 first-letter:text-v2-lily text-sm font-semibold h-full",children:d.ag._("Close position in:")}),(0,v.jsxs)("div",{className:"rounded-lg flex items-center",children:[fe?(0,v.jsx)(te.Z,{info:fe,width:28,height:28}):null,(0,v.jsx)("span",{className:"ml-3 font-semibold text-sm",children:null===fe||void 0===fe?void 0:fe.symbol})]})]})})]}),(0,v.jsx)("div",{className:"px-6",children:(0,v.jsx)("div",{className:"border-b border-v2-lily/5 my-3"})}),(0,v.jsx)("p",{className:"mt-2 mb-3 px-6 text-xs text-v2-lily/30",children:d.ag._("Take Profit and Stop Loss orders will remain in effect regardless of any changes to your collateral or position size.")}),(0,v.jsx)("p",{className:"mb-4 px-6 text-xs text-v2-lily/30",children:d.ag._("TP/SL will not be triggered if you close your ${0} Associated Token Account.",{0:null===D||void 0===D?void 0:D.symbol})}),(0,v.jsxs)("div",{className:"w-full text-xs flex pb-6 px-6 space-x-3",children:[H.isSubmitting?null:(0,v.jsx)("button",{type:"button",className:(0,f.cn)("w-full py-2.5 px-6 border rounded-lg border-v2-lily/10 text-v2-lily bg-v2-lily/5 hover:bg-v2-lily/10 text-sm font-semibold disabled:cursor-not-allowed disabled:opacity-20",{"opacity-50 curosr-not-allowed":H.isSubmitting}),disabled:H.isSubmitting,onClick:L,children:(0,v.jsx)("span",{children:d.ag._("Cancel")})}),(0,v.jsx)("button",{type:"button",className:(0,f.cn)("w-full py-2.5 px-6 border rounded-lg border-labs/20 text-labs hover:bg-labs/5 text-sm font-semibold disabled:cursor-not-allowed disabled:opacity-20",{"opacity-50 curosr-not-allowed":H.isSubmitting||_e}),disabled:_e,onClick:B(Te),children:H.isSubmitting?(0,v.jsxs)("span",{className:"flex justify-center items-center",children:[(0,v.jsx)(k.Z,{className:"!h-4 !w-4",baseColor:"white",spinnerColor:"black"}),(0,v.jsx)("div",{className:"mr-2"}),d.ag._("Setting up TP & SL")]}):(0,v.jsx)("span",{className:"text-center",children:d.ag._("Confirm")})})]})]})]})})},_t=function(e){var t=e.open,n=e.onClose,i=e.positionAccountPubkey,l=e.focusOn,r=(0,h.tc)().userPositions,o=(0,s.useMemo)((function(){return null===r||void 0===r?void 0:r.find((function(e){return e.publicKey.equals(i)}))}),[i,r]);return o?(0,v.jsx)(Zt,{open:t,onClose:n,positionAccount:o,focusOn:l}):null},Tt=function(e){var t=e.selectToPair,n=e.selected,i=(0,h.tc)(),l=i.perpsTokens,r=i.isAnyFormSubmitting,o=(0,s.useState)([]),a=o[0],c=o[1];return(0,s.useEffect)((function(){0===a.length&&c(l.nonStableTokens)}),[l.nonStableTokens,a.length]),(0,v.jsx)("div",{className:"flex w-full space-x-2 overflow-x-scroll hideScrollbar border-r border-r-v2-lily/10 h-full items-center px-2",children:a.map((function(e,s){var i=n.address===e.address,l=r;return(0,v.jsxs)("button",{type:"button",onClick:function(){return t(e)},disabled:l,className:(0,f.cn)("h-9 lg:h-10","flex items-center cursor-pointer fill-current font-semibold space-x-3 rounded-full pl-1.5 pr-2 text-sm border lg:border-2 border-transparent whitespace-nowrap text-white",{"hover:border-labs/50":!i&&!l,"cursor-not-allowed opacity-50":!i&&l,"border-labs bg-labs/10 text-labs":i}),children:[(0,v.jsx)(te.Z,{info:e,width:24,height:24}),(0,v.jsxs)("span",{children:[e.symbol,"-PERP"]})]},s)}))})},Mt=n(3082),Ot=function(){var e=(0,y.Bn)(),t=e.getTokenInfo,n=e.getTokenInfoFromSymbol,i=(0,Mt.useRouter)(),l=(0,s.useMemo)((function(){return i.query.inOut?i.query.inOut:z.yM}),[i.query.inOut]),r=(0,s.useMemo)((function(){return l.split("-")}),[l]),o=r[0],a=r[1],c=(0,s.useMemo)((function(){return n(o)||t(o)||z.mq}),[o,t,n]),d=(0,s.useMemo)((function(){return n(a)||z.mq}),[a,n]),u=(0,s.useMemo)((function(){return c.name&&d.name&&i.isReady}),[i.isReady,c,d]);return{inOut:l,fromPairTokenInfo:c,toPairTokenInfo:d,isReady:u}},Ft=function(){var e=(0,Mt.useRouter)();return(0,s.useMemo)((function(){if(e.isReady){var t=e.query.direction;if("long"!==t&&"short"!==t)return e.replace("/perps/long/SOL-SOL"),"long"}return e.query.direction}),[e])},Lt=p()((function(){return Promise.all([n.e(6981),n.e(3439)]).then(n.bind(n,23439))}),{ssr:!1,loadableGenerated:{webpack:function(){return[23439]}}}),Dt=p()((function(){return n.e(4710).then(n.bind(n,44710))}),{ssr:!1,loadableGenerated:{webpack:function(){return[44710]}}}),At=p()((function(){return n.e(807).then(n.bind(n,50807))}),{ssr:!1,loadableGenerated:{webpack:function(){return[50807]}}}),qt=p()((function(){return n.e(6959).then(n.bind(n,76959))}),{ssr:!1,loadableGenerated:{webpack:function(){return[76959]}}}),Rt=p()((function(){return Promise.all([n.e(2628),n.e(4440)]).then(n.bind(n,44440))}),{ssr:!1,loading:function(){return null},loadableGenerated:{webpack:function(){return[44440]}}}),It={So11111111111111111111111111111111111111112:{pythId:"SOLUSD",subscriptionId:I.vQ.SOL},"7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs":{pythId:"ETHUSD",subscriptionId:I.vQ.ETH},"3NZ9JMVBmGAqocybic2c7LQCJScmgsAZ6vQqTDzcqmJh":{pythId:"BTCUSD",subscriptionId:I.vQ.BTC}},Ut=function(e){var t=e.lastPrice,n=Ot(),i=n.fromPairTokenInfo,l=n.toPairTokenInfo,r=(0,h.tc)().oraclePrices,a=Ft(),m=(0,K.Ne)(z.yM),p=(0,s.useMemo)((function(){return r?r[l.address]:null}),[r,l.address]),g=(0,$.y)(p),b=(0,u.a)(["ohclvData-24h",l.address,g],(0,o.Z)(c().mark((function e(){var t,n,s,i;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l.address){e.next=2;break}return e.abrupt("return",null);case 2:return t=Math.round(Date.now()/1e3),new URLSearchParams({address:l.address,address_type:"token",type:"30m",time_from:String(t-86400),time_to:String(t)}),e.prev=4,e.next=7,fetch("https://worker.jup.ag/perps-tokens-stats");case 7:return n=e.sent,e.next=10,n.json();case 10:if(s=e.sent,i=s[l.address]){e.next=14;break}return e.abrupt("return",null);case 14:return e.abrupt("return",{lruPrice:i.lruPrice.toFixed(g),high24H:new x.Z(i.high24H),low24H:new x.Z(i.low24H)});case 17:return e.prev=17,e.t0=e.catch(4),e.abrupt("return",null);case 20:case"end":return e.stop()}}),e,null,[[4,17]])}))),{refetchInterval:6e4,initialData:null}).data,w=(0,s.useMemo)((function(){if(!b||!b.lruPrice||!p)return null;var e=function(){var e=b.lruPrice;return new x.Z(p).minus(e).div(e).mul(100)}();return{color:e.gt(0)?"rgba(39, 174, 96, 1)":"rgba(255, 87, 87, 1)",text:e.toFixed(2)+"%"}}),[b,p]),j=V.SX.tradeVolume.useQuery({mint:l.address}).data,y=(0,s.useMemo)((function(){return null!==t&&void 0!==t?t:p}),[t,p]),N=(0,s.useMemo)((function(){return y?"$"+U.uf.format(y,g):""}),[g,y]),P=s.useCallback((function(e){m(i,e,a)}),[m,i,a]);return(0,v.jsxs)("div",{className:(0,f.cn)("flex flex-col lg:flex-row lg:items-center justify-between bg-[#131B24] lg:h-[64px] w-full","border-b border-b-v2-lily/10"),children:[(0,v.jsxs)("div",{className:(0,f.cn)("flex flex-col justify-between items-center h-full overflow-x-scroll hideScrollbar pt-2 lg:pt-0"),children:[(0,v.jsx)(Tt,{selectToPair:P,selected:l}),(0,v.jsxs)("div",{className:"mt-2 flex items-center justify-between space-x-3 px-3 py-2 h-10 lg:hidden w-full border-t border-t-v2-lily/5",children:[(0,v.jsx)("div",{className:"flex lg:hidden text-xl text-white font-semibold",children:N&&y?(0,v.jsx)(E,{price:new x.Z(y),precision:g,children:N}):(0,v.jsx)(R.O,{className:"w-10 h-4 rounded-md"})}),(0,v.jsxs)("div",{className:"flex gap-3",children:[(0,v.jsxs)("div",{className:"flex flex-col text-center",children:[(0,v.jsx)("p",{className:"text-xxs md:text-xs text-white/30 whitespace-nowrap",children:d.ag._("24h Change")}),(0,v.jsx)("div",{className:"text-xs text-white",style:{color:null===w||void 0===w?void 0:w.color},children:null!==w&&void 0!==w&&w.text?w.text:(0,v.jsx)(R.O,{className:"w-10 h-4 rounded-md"})})]}),(0,v.jsxs)("div",{className:"flex flex-col text-center",children:[(0,v.jsx)("p",{className:"text-xxs md:text-xs text-white/30 whitespace-nowrap",children:d.ag._("24h Vol")}),(0,v.jsx)("div",{className:"text-xs text-white",children:j?(0,U.dN)(j.volume,2):(0,v.jsx)(R.O,{className:"w-10 h-4 rounded-md"})})]})]})]})]}),(0,v.jsxs)("div",{className:(0,f.cn)("hidden lg:flex min-w-[260px] lg:px-3 gap-3 xl:gap-7 pr-3","mt-3 justify-between 2xl:justify-end hideScrollbar","pt-3 lg:mt-0 lg:pt-0 lg:ml-auto border-t border-t-v2-lily/5 lg:border-none"),children:[(0,v.jsx)("div",{className:"hidden lg:flex items-center text-center leading-none font-semibold",children:(0,v.jsx)("div",{className:"text-lg text-white",children:N&&y?(0,v.jsx)(E,{price:new x.Z(y),precision:g,children:N}):(0,v.jsx)(R.O,{className:"w-10 h-4 rounded-md"})})}),(0,v.jsxs)("div",{className:"flex gap-3 xl:gap-7",children:[(0,v.jsxs)("div",{className:"flex flex-col text-center",children:[(0,v.jsx)("p",{className:"text-xs text-white/30 whitespace-nowrap",children:d.ag._("24h Change")}),(0,v.jsx)("div",{className:"text-xs text-white",style:{color:null===w||void 0===w?void 0:w.color},children:null!==w&&void 0!==w&&w.text?w.text:(0,v.jsx)(R.O,{className:"w-10 h-4 rounded-md"})})]}),(0,v.jsxs)("div",{className:"flex flex-col text-center",children:[(0,v.jsx)("p",{className:"text-xs text-white/30 whitespace-nowrap",children:d.ag._("24h Vol")}),(0,v.jsx)("div",{className:"text-xs text-white",children:j?"$".concat((0,U.dN)(j.volume,2)):(0,v.jsx)(R.O,{className:"w-10 h-4 rounded-md"})})]}),(0,v.jsxs)("div",{className:"hidden xl:flex flex-col text-center",children:[(0,v.jsx)("p",{className:"text-xs text-white/30 whitespace-nowrap",children:d.ag._("24h High")}),(0,v.jsx)("div",{className:"text-xs text-white",children:null!==b&&void 0!==b&&b.high24H?"$"+U.uf.format(b.high24H,g):(0,v.jsx)(R.O,{className:"w-10 h-4 rounded-md"})})]}),(0,v.jsxs)("div",{className:"hidden xl:flex flex-col text-center",children:[(0,v.jsx)("p",{className:"text-xs text-white/30 whitespace-nowrap",children:d.ag._("24h Low")}),(0,v.jsx)("div",{className:"text-xs text-white",children:null!==b&&void 0!==b&&b.low24H?"$"+U.uf.format(b.low24H,g):(0,v.jsx)(R.O,{className:"w-10 h-4 rounded-md"})})]})]})]})]})};function Vt(){return(0,v.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",viewBox:"0 0 24 24",children:(0,v.jsx)("path",{stroke:"rgb(86, 84, 82)",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M 12 20.696 V 14.12 m 0 -10.817 V 9.88 m 3.478 -4.4 L 12 2 L 8.522 5.478 m 0 13.044 L 12 22 l 3.478 -3.478"})})}var Et=function(e){(0,r.Z)(e);var t=(0,h.tc)(),n=t.perpsTokens,i=t.bottomTab,o=t.setBottomTab,a=t.oraclePrices,c=t.userPositions,u=(0,y.Bn)().getTokenInfo,m=Ot(),p=m.fromPairTokenInfo,f=m.toPairTokenInfo,b=m.isReady,j=Ft(),P=(0,K.Ne)(z.yM),k=(0,y.C9)(),S=(0,y.gZ)().fetchTokenAccounts;(0,s.useEffect)((function(){p&&f&&S([p.address,f.address])}),[p,f,S,k]);var C=(0,s.useCallback)((function(e){P(p,f,e)}),[p,P,f]),Z=(0,K.QY)(),_=(0,B.Z)();(0,I.Sv)(_),(0,s.useEffect)((function(){if(0!==n.stableTokens.length&&0!==n.nonStableTokens.length)if(Z.find((function(e){return e===p.address}))){var e=n.nonStableTokens.find((function(e){return e.address===f.address}));p.address&&e||P(p.address?p:n.nonStableTokens[0],n.nonStableTokens[0],j)}else P(n.nonStableTokens[0],n.nonStableTokens[0],j)}),[n,f,p,P,j,Z]);var T=(0,s.useState)(null),M=T[0],R=T[1],U=(0,s.useState)(null),V=U[0],E=U[1],W=(0,s.useState)(null),H=W[0],G=W[1],Y=(0,s.useState)(null),Q=Y[0],J=Y[1],X=(0,s.useCallback)((function(){J(null)}),[J]),ee=(0,s.useCallback)((function(e){var t=e.positionAccountPubkey;R({positionAccountPubkey:t})}),[]),te=(0,s.useCallback)((function(e){var t=e.positionAccountPubkey;E({positionAccountPubkey:t})}),[]),ne=(0,s.useCallback)((function(e){var t=e.positionAccountPubkey,n=e.focusOn;G({positionAccountPubkey:t,focusOn:n})}),[]),se=(0,L.Gc)(),ie=(0,s.useMemo)((function(){return"lg"===se||"xl"===se}),[se]),le=(0,s.useMemo)((function(){return"xs"===se||"sm"===se||"md"===se}),[se]),re=(0,s.useMemo)((function(){return a?a[f.address]:null}),[a,f.address]),oe=(0,$.y)(re),ae=(0,N.Dv)((0,s.useMemo)((function(){var e;return(0,I.EA)(null===(e=It[f.address])||void 0===e?void 0:e.subscriptionId)}),[f])),ce=(0,s.useMemo)((function(){return It[f.address]&&ie&&b&&oe>0}),[ie,b,oe,f.address]),de=(0,s.useMemo)((function(){return It[f.address]&&le&&b&&oe>0}),[le,b,oe,f.address]),ue=(0,s.useRef)(null),xe=(0,s.useRef)(null),me=(0,s.useMemo)((function(){return ce?ue:de?xe:void 0}),[ce,de]),pe=(0,F._)("jupiter-labs-perps-render-position-on-tv",!0),fe=(0,l.Z)(pe,2),he=fe[0],ve=fe[1],ge=(0,q.Me)(),be=(0,s.useMemo)((function(){return c&&he?c.map((function(e){var t,n=u(e.custody.account.mint.toString());if((null===n||void 0===n?void 0:n.address)!==f.address)return null;var s=new x.Z(e.price).div(1e6).toFixed(oe),i="long"===e.side?d.ag._("Long"):d.ag._("Short"),l=[],r=ye(e),o=r.hasTp,a=r.hasSl;return o&&l.push({id:"tp-".concat(e.side,"-").concat(n.symbol,"-").concat(e.price.toString()),publicKey:e.publicKey.toString(),label:"".concat(null===n||void 0===n?void 0:n.symbol,"-TP"),price:Number(o.toFixed(oe)),action:"tp",sizeUsd:e.sizeUsd.div(1e6).toDP(2).toString()}),a&&l.push({id:"sl-".concat(e.side,"-").concat(n.symbol,"-").concat(e.price.toString()),publicKey:e.publicKey.toString(),label:"".concat(null===n||void 0===n?void 0:n.symbol,"-SL"),price:Number(a.toFixed(oe)),action:"sl",sizeUsd:e.sizeUsd.div(1e6).toDP(2).toString()}),l.push({id:"lq-".concat(e.side,"-").concat(n.symbol,"-").concat(e.price.toString()),publicKey:e.publicKey.toString(),label:"".concat(null===n||void 0===n?void 0:n.symbol,"-").concat(i,"-Liq."),price:Number(null===(t=e.accounting)||void 0===t?void 0:t.liquidationPrice.div(1e6).toFixed(oe)),action:"lq",sizeUsd:e.sizeUsd.div(1e6).toDP(2).toString()}),l.push({id:"".concat(e.side,"-").concat(n.symbol,"-").concat(e.price.toString()),publicKey:e.publicKey.toString(),label:"".concat(null===n||void 0===n?void 0:n.symbol,"-").concat(i),price:Number(s),action:e.side,sizeUsd:e.sizeUsd.div(1e6).toDP(2).toString(),onCloseAction:ge}),l})).flat().filter(Boolean):[]}),[u,ge,oe,he,f.address,c]),we=(0,s.useMemo)((function(){var e=_?null===ae||void 0===ae?void 0:ae.price:re;return null!==ae&&void 0!==ae&&ae.price&&f&&e?d.ag._("{0} - {1}",{0:new x.Z(e).toFixed(oe),1:f.symbol}):d.ag._("Jupiter Perps")}),[_,null===ae||void 0===ae?void 0:ae.price,re,f,oe]),je=function(e){var t=e.resizeComponentRef,n=e.minHeight,i=void 0===n?0:n,l=e.maxHeight,r=void 0===l?1/0:l,o=(0,s.useCallback)((function(e,n,s){if(t&&t.current&&window){var l=window.getComputedStyle(t.current).height,o=parseInt(l,10);document.body.style.userSelect="none",document.body.style.pointerEvents="none";var a=function(n){n.preventDefault();var s="clientY"in n?n.clientY:n.touches[0].clientY,l=o+(s-e);t.current&&l>=i&&l<=r&&(t.current.style.height="".concat(l,"px"))};document.addEventListener(n,a,"touchmove"===n?{passive:!1}:void 0),document.addEventListener(s,(function e(){document.removeEventListener(n,a),document.removeEventListener(s,e),document.body.style.userSelect="",document.body.style.pointerEvents=""}))}}),[r,i,t]);return{onMouseDown:(0,s.useCallback)((function(e){o(e.clientY,"mousemove","mouseup")}),[o]),onTouchStart:(0,s.useCallback)((function(e){o(e.touches[0].clientY,"touchmove","touchend")}),[o])}}({resizeComponentRef:me,minHeight:200,maxHeight:.7*window.innerHeight}),Ne=je.onTouchStart,Pe=je.onMouseDown;return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(D.PB,{title:we}),M?(0,v.jsx)(St,{open:Boolean(M),onClose:function(){return R(null)},positionAccountPubkey:M.positionAccountPubkey}):null,V?(0,v.jsx)(ft,{open:Boolean(V),onClose:function(){return E(null)},positionAccountPubkey:V.positionAccountPubkey}):null,H?(0,v.jsx)(_t,{open:Boolean(H),onClose:function(){return G(null)},positionAccountPubkey:H.positionAccountPubkey,focusOn:H.focusOn}):null,Q?(0,v.jsx)(Rt,{open:Boolean(Q),info:Q,onClose:X}):null,(0,v.jsx)(qt,{}),(0,v.jsxs)("div",{className:"hidden lg:flex flex-1 min-h-full min-w-full",children:[(0,v.jsxs)("div",{className:"flex flex-col w-[calc(100vw-360px)]",children:[(0,v.jsx)(Ut,{lastPrice:null===ae||void 0===ae?void 0:ae.price}),me&&me.current?(0,A.createPortal)((0,v.jsx)(At,{renderingId:"perps",shadesClassName:"!bg-[#131B24]",datafeedObject:{pythId:It[f.address].pythId,symbol:It[f.address].pythId,tickerName:It[f.address].pythId,subscriptionId:It[f.address].subscriptionId},opt:{enableVolumeStudy:!1,showVolume:!1,showPriceSource:!1,showBarChange:!1},style:{background:"#131B24"},positions:be,hasFocus:_}),me.current):null,(0,v.jsx)("div",{ref:ue,className:"z-10 h-[50vh] bg-[#131B24] relative",children:(0,v.jsx)("div",{onMouseDown:Pe,className:"w-4 h-4 flex justify-center items-center absolute bottom-[-8px] left-1/2 transform -translate-x-1/2 z-50 cursor-row-resize",children:(0,v.jsx)(Vt,{})})}),(0,v.jsxs)(O,{activeTab:i,setActiveTab:o,showPositions:he,setShowPositions:ve,children:["Positions"===i?(0,v.jsx)(Fe,{onShowEditCollateralDialog:ee,onShowCloseConfirmationDialog:te,onShowEditTPSLDialog:ne,setPositionDirection:C,setShowPerpsShareDialog:J}):null,"Trade History"===i?(0,v.jsx)(st,{setPositionDirection:C,setShowPerpsShareDialog:J}):null,"Expired Orders"===i?(0,v.jsx)(Ee,{}):null]})]}),(0,v.jsx)("div",{className:"flex-1 w-[360px] min-w-[360px] lg:max-w-[360px]",children:ie&&(0,v.jsx)(Lt,{positionDirection:j,setPositionDirection:C,fromPairTokenInfo:p,toPairTokenInfo:f,onShowEditCollateralDialog:ee})})]}),(0,v.jsxs)("div",{className:"flex w-full lg:hidden flex-col",children:[(0,v.jsx)(Ut,{lastPrice:null===ae||void 0===ae?void 0:ae.price}),(0,v.jsx)("div",{ref:xe,className:"h-[30vh] bg-[#131B24]"}),(0,v.jsxs)("div",{className:"flex lg:hidden items-center justify-between w-full bg-[#16202B] px-2 py-2 relative",children:[(0,v.jsx)("div",{onTouchStart:Ne,className:"z-10 w-4 h-4 flex justify-center items-center absolute top-[-8px] left-1/2 transform -translate-x-1/2 touch-none",children:(0,v.jsx)(Vt,{})}),(0,v.jsxs)("div",{className:"flex whitespace-nowrap space-x-2 items-center text-xs text-v2-lily/50",children:[(0,v.jsx)(Dt,{active:he,onClick:function(){return ve((function(e){return!e}))}}),(0,v.jsx)("span",{children:d.ag._("Show Positions on Chart")})]}),(0,v.jsx)(w(),{href:"https://pyth.network/",rel:"noopener noreferrer",target:"_blank",className:"text-v2-lily/50 fill-current text-xxs",children:(0,v.jsx)(g,{width:60,height:20})})]}),(0,v.jsx)("div",{className:"w-full",children:le&&(0,v.jsx)(Lt,{positionDirection:j,setPositionDirection:C,fromPairTokenInfo:p,toPairTokenInfo:f,onShowEditCollateralDialog:ee})}),(0,v.jsx)("div",{children:(0,v.jsxs)(O,{activeTab:i,setActiveTab:o,showPositions:he,setShowPositions:ve,children:["Positions"===i?(0,v.jsx)(Fe,{onShowEditCollateralDialog:ee,onShowCloseConfirmationDialog:te,onShowEditTPSLDialog:ne,setPositionDirection:C,setShowPerpsShareDialog:J}):null,"Trade History"===i?(0,v.jsx)(st,{setPositionDirection:C,setShowPerpsShareDialog:J}):null,"Expired Orders"===i?(0,v.jsx)(Ee,{}):null]})})]})]})},zt=!0,Bt=function(){return(0,v.jsx)(i.Z,{children:(0,v.jsx)(Et,{})})}},31157:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/perps/[direction]/[inOut]",function(){return n(88987)}])}},function(e){e.O(0,[4508,9603,4931,4277,9438,3215,7369,1144,7821,7375,4518,6541,2358,1237,4300,3380,2029,9034,7970,5288,2096,9774,2888,179],(function(){return t=31157,e(e.s=t);var t}));var t=e.O();_N_E=t}]);
//# sourceMappingURL=[inOut]-035e4a8465c5c582.js.map