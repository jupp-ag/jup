"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2886],{43165:function(e,n,t){t.d(n,{Z:function(){return s}});var i=t(13498),r=t(20539),a=t(23877),u=t(33219),o=t(65055);function s(e,n){if((0,u.Z)(2,arguments),!n||"object"!==typeof n)return new Date(NaN);var t=n.years?(0,o.Z)(n.years):0,s=n.months?(0,o.Z)(n.months):0,c=n.weeks?(0,o.Z)(n.weeks):0,m=n.days?(0,o.Z)(n.days):0,l=n.hours?(0,o.Z)(n.hours):0,d=n.minutes?(0,o.Z)(n.minutes):0,p=n.seconds?(0,o.Z)(n.seconds):0,g=(0,a.Z)(e),y=s||t?(0,r.Z)(g,s+12*t):g,f=m||c?(0,i.Z)(y,m+7*c):y,h=d+60*l,w=p+60*h,A=1e3*w,M=new Date(f.getTime()+A);return M}},87148:function(e,n,t){t.d(n,{Z:function(){return r}});var i=t(93981);function r(e){var n=(0,i.useRef)();return(0,i.useEffect)((function(){n.current=e})),n.current}},39787:function(e,n,t){t.d(n,{DA:function(){return k},PN:function(){return O},xO:function(){return K}});var i=t(94728),r=t(57565),a=t(2712),u=t(41300),o=t(52466),s=t(48496),c=t(795).Buffer;const m=(0,o.struct)([(0,o.u8)("instruction")]);function l(e,n=u.H_){const t=[{pubkey:e,isSigner:!1,isWritable:!0}],r=c.alloc(m.span);return m.encode({instruction:s.c.SyncNative},r),new i.TransactionInstruction({keys:t,programId:n,data:r})}var d=t(26786),p=t(87260),g=t(795).Buffer,y=Object.defineProperty,f=Object.defineProperties,h=Object.getOwnPropertyDescriptors,w=Object.getOwnPropertySymbols,A=Object.prototype.hasOwnProperty,M=Object.prototype.propertyIsEnumerable,S=(e,n,t)=>n in e?y(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,b=(e,n)=>{for(var t in n||(n={}))A.call(n,t)&&S(e,t,n[t]);if(w)for(var t of w(n))M.call(n,t)&&S(e,t,n[t]);return e},P=(e,n)=>f(e,h(n)),I=(e,n,t)=>new Promise(((i,r)=>{var a=e=>{try{o(t.next(e))}catch(n){r(n)}},u=e=>{try{o(t.throw(e))}catch(n){r(n)}},o=e=>e.done?i(e.value):Promise.resolve(e.value).then(a,u);o((t=t.apply(e,n)).next())}));function B(e,n){return I(this,null,(function*(){return BigInt(yield e.getBalance(n))}))}function x(e,n){return I(this,null,(function*(){return BigInt((yield e.getTokenAccountBalance(n)).value.amount)}))}var K={version:"0.1.0",name:"dca",instructions:[{name:"openDca",accounts:[{name:"dca",isMut:!0,isSigner:!1},{name:"user",isMut:!0,isSigner:!0},{name:"inputMint",isMut:!1,isSigner:!1},{name:"outputMint",isMut:!1,isSigner:!1},{name:"userAta",isMut:!0,isSigner:!1},{name:"inAta",isMut:!0,isSigner:!1},{name:"outAta",isMut:!0,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1},{name:"tokenProgram",isMut:!1,isSigner:!1},{name:"associatedTokenProgram",isMut:!1,isSigner:!1},{name:"eventAuthority",isMut:!1,isSigner:!1},{name:"program",isMut:!1,isSigner:!1}],args:[{name:"applicationIdx",type:"u64"},{name:"inAmount",type:"u64"},{name:"inAmountPerCycle",type:"u64"},{name:"cycleFrequency",type:"i64"},{name:"minPrice",type:{option:"u64"}},{name:"maxPrice",type:{option:"u64"}},{name:"startAt",type:{option:"i64"}},{name:"closeWsolInAta",type:{option:"bool"}}]},{name:"openDcaV2",accounts:[{name:"dca",isMut:!0,isSigner:!1},{name:"user",isMut:!1,isSigner:!0},{name:"payer",isMut:!0,isSigner:!0},{name:"inputMint",isMut:!1,isSigner:!1},{name:"outputMint",isMut:!1,isSigner:!1},{name:"userAta",isMut:!0,isSigner:!1},{name:"inAta",isMut:!0,isSigner:!1},{name:"outAta",isMut:!0,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1},{name:"tokenProgram",isMut:!1,isSigner:!1},{name:"associatedTokenProgram",isMut:!1,isSigner:!1},{name:"eventAuthority",isMut:!1,isSigner:!1},{name:"program",isMut:!1,isSigner:!1}],args:[{name:"applicationIdx",type:"u64"},{name:"inAmount",type:"u64"},{name:"inAmountPerCycle",type:"u64"},{name:"cycleFrequency",type:"i64"},{name:"minPrice",type:{option:"u64"}},{name:"maxPrice",type:{option:"u64"}},{name:"startAt",type:{option:"i64"}}]},{name:"closeDca",accounts:[{name:"user",isMut:!0,isSigner:!0},{name:"dca",isMut:!0,isSigner:!1},{name:"inputMint",isMut:!1,isSigner:!1},{name:"outputMint",isMut:!1,isSigner:!1},{name:"inAta",isMut:!0,isSigner:!1},{name:"outAta",isMut:!0,isSigner:!1},{name:"userInAta",isMut:!0,isSigner:!1},{name:"userOutAta",isMut:!0,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1},{name:"tokenProgram",isMut:!1,isSigner:!1},{name:"associatedTokenProgram",isMut:!1,isSigner:!1},{name:"eventAuthority",isMut:!1,isSigner:!1},{name:"program",isMut:!1,isSigner:!1}],args:[]},{name:"withdraw",accounts:[{name:"user",isMut:!0,isSigner:!0},{name:"dca",isMut:!0,isSigner:!1},{name:"inputMint",isMut:!1,isSigner:!1},{name:"outputMint",isMut:!1,isSigner:!1},{name:"dcaAta",isMut:!0,isSigner:!1},{name:"userInAta",isMut:!0,isSigner:!1,isOptional:!0},{name:"userOutAta",isMut:!0,isSigner:!1,isOptional:!0},{name:"systemProgram",isMut:!1,isSigner:!1},{name:"tokenProgram",isMut:!1,isSigner:!1},{name:"associatedTokenProgram",isMut:!1,isSigner:!1},{name:"eventAuthority",isMut:!1,isSigner:!1},{name:"program",isMut:!1,isSigner:!1}],args:[{name:"withdrawParams",type:{defined:"WithdrawParams"}}]},{name:"deposit",accounts:[{name:"user",isMut:!0,isSigner:!0},{name:"dca",isMut:!0,isSigner:!1},{name:"inAta",isMut:!0,isSigner:!1},{name:"userInAta",isMut:!0,isSigner:!1},{name:"tokenProgram",isMut:!1,isSigner:!1},{name:"eventAuthority",isMut:!1,isSigner:!1},{name:"program",isMut:!1,isSigner:!1}],args:[{name:"depositIn",type:"u64"}]},{name:"withdrawFees",accounts:[{name:"admin",isMut:!0,isSigner:!0},{name:"mint",isMut:!1,isSigner:!1},{name:"feeAuthority",isMut:!1,isSigner:!1,docs:["CHECK"]},{name:"programFeeAta",isMut:!0,isSigner:!1},{name:"adminFeeAta",isMut:!0,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1},{name:"tokenProgram",isMut:!1,isSigner:!1},{name:"associatedTokenProgram",isMut:!1,isSigner:!1}],args:[{name:"amount",type:"u64"}]},{name:"initiateFlashFill",accounts:[{name:"keeper",isMut:!0,isSigner:!0},{name:"dca",isMut:!0,isSigner:!1},{name:"inputMint",isMut:!1,isSigner:!1,docs:["The token to borrow"]},{name:"keeperInAta",isMut:!0,isSigner:!1,docs:["The account to send borrowed tokens to"]},{name:"inAta",isMut:!0,isSigner:!1,docs:["The account to borrow from"]},{name:"outAta",isMut:!1,isSigner:!1,docs:["The account to repay to"]},{name:"instructionsSysvar",isMut:!1,isSigner:!1,docs:["Solana Instructions Sysvar"]},{name:"systemProgram",isMut:!1,isSigner:!1},{name:"tokenProgram",isMut:!1,isSigner:!1},{name:"associatedTokenProgram",isMut:!1,isSigner:!1}],args:[]},{name:"fulfillFlashFill",accounts:[{name:"keeper",isMut:!0,isSigner:!0},{name:"dca",isMut:!0,isSigner:!1},{name:"inputMint",isMut:!1,isSigner:!1},{name:"outputMint",isMut:!1,isSigner:!1},{name:"keeperInAta",isMut:!1,isSigner:!1},{name:"inAta",isMut:!1,isSigner:!1},{name:"outAta",isMut:!1,isSigner:!1},{name:"feeAuthority",isMut:!1,isSigner:!1,docs:["CHECK"]},{name:"feeAta",isMut:!0,isSigner:!1},{name:"instructionsSysvar",isMut:!1,isSigner:!1,docs:["Solana Instructions Sysvar"]},{name:"systemProgram",isMut:!1,isSigner:!1},{name:"tokenProgram",isMut:!1,isSigner:!1},{name:"associatedTokenProgram",isMut:!1,isSigner:!1},{name:"eventAuthority",isMut:!1,isSigner:!1},{name:"program",isMut:!1,isSigner:!1}],args:[{name:"repayAmount",type:"u64"}]},{name:"transfer",accounts:[{name:"keeper",isMut:!0,isSigner:!0},{name:"dca",isMut:!0,isSigner:!1},{name:"user",isMut:!0,isSigner:!1},{name:"outputMint",isMut:!1,isSigner:!1},{name:"dcaOutAta",isMut:!0,isSigner:!1},{name:"userOutAta",isMut:!0,isSigner:!1,isOptional:!0},{name:"intermediateAccount",isMut:!0,isSigner:!1,isOptional:!0},{name:"systemProgram",isMut:!1,isSigner:!1},{name:"tokenProgram",isMut:!1,isSigner:!1},{name:"associatedTokenProgram",isMut:!1,isSigner:!1},{name:"eventAuthority",isMut:!1,isSigner:!1},{name:"program",isMut:!1,isSigner:!1}],args:[]},{name:"endAndClose",accounts:[{name:"keeper",isMut:!0,isSigner:!0},{name:"dca",isMut:!0,isSigner:!1},{name:"inputMint",isMut:!1,isSigner:!1},{name:"outputMint",isMut:!1,isSigner:!1},{name:"inAta",isMut:!0,isSigner:!1},{name:"outAta",isMut:!0,isSigner:!1},{name:"user",isMut:!0,isSigner:!1},{name:"userOutAta",isMut:!0,isSigner:!1,isOptional:!0},{name:"initUserOutAta",isMut:!0,isSigner:!1,isOptional:!0},{name:"intermediateAccount",isMut:!0,isSigner:!1,isOptional:!0},{name:"systemProgram",isMut:!1,isSigner:!1},{name:"tokenProgram",isMut:!1,isSigner:!1},{name:"associatedTokenProgram",isMut:!1,isSigner:!1},{name:"eventAuthority",isMut:!1,isSigner:!1},{name:"program",isMut:!1,isSigner:!1}],args:[]}],accounts:[{name:"dca",type:{kind:"struct",fields:[{name:"user",type:"publicKey"},{name:"inputMint",type:"publicKey"},{name:"outputMint",type:"publicKey"},{name:"idx",type:"u64"},{name:"nextCycleAt",type:"i64"},{name:"inDeposited",type:"u64"},{name:"inWithdrawn",type:"u64"},{name:"outWithdrawn",type:"u64"},{name:"inUsed",type:"u64"},{name:"outReceived",type:"u64"},{name:"inAmountPerCycle",type:"u64"},{name:"cycleFrequency",type:"i64"},{name:"nextCycleAmountLeft",type:"u64"},{name:"inAccount",type:"publicKey"},{name:"outAccount",type:"publicKey"},{name:"minOutAmount",type:"u64"},{name:"maxOutAmount",type:"u64"},{name:"keeperInBalanceBeforeBorrow",type:"u64"},{name:"dcaOutBalanceBeforeSwap",type:"u64"},{name:"createdAt",type:"i64"},{name:"bump",type:"u8"}]}}],types:[{name:"WithdrawParams",type:{kind:"struct",fields:[{name:"withdrawAmount",type:"u64"},{name:"withdrawal",type:{defined:"Withdrawal"}}]}},{name:"Withdrawal",type:{kind:"enum",variants:[{name:"In"},{name:"Out"}]}}],events:[{name:"CollectedFee",fields:[{name:"userKey",type:"publicKey",index:!1},{name:"dcaKey",type:"publicKey",index:!1},{name:"mint",type:"publicKey",index:!1},{name:"amount",type:"u64",index:!1}]},{name:"Filled",fields:[{name:"userKey",type:"publicKey",index:!1},{name:"dcaKey",type:"publicKey",index:!1},{name:"inputMint",type:"publicKey",index:!1},{name:"outputMint",type:"publicKey",index:!1},{name:"inAmount",type:"u64",index:!1},{name:"outAmount",type:"u64",index:!1},{name:"feeMint",type:"publicKey",index:!1},{name:"fee",type:"u64",index:!1}]},{name:"Opened",fields:[{name:"userKey",type:"publicKey",index:!1},{name:"dcaKey",type:"publicKey",index:!1},{name:"inDeposited",type:"u64",index:!1},{name:"inputMint",type:"publicKey",index:!1},{name:"outputMint",type:"publicKey",index:!1},{name:"cycleFrequency",type:"i64",index:!1},{name:"inAmountPerCycle",type:"u64",index:!1},{name:"createdAt",type:"i64",index:!1}]},{name:"Closed",fields:[{name:"userKey",type:"publicKey",index:!1},{name:"dcaKey",type:"publicKey",index:!1},{name:"inDeposited",type:"u64",index:!1},{name:"inputMint",type:"publicKey",index:!1},{name:"outputMint",type:"publicKey",index:!1},{name:"cycleFrequency",type:"i64",index:!1},{name:"inAmountPerCycle",type:"u64",index:!1},{name:"createdAt",type:"i64",index:!1},{name:"totalInWithdrawn",type:"u64",index:!1},{name:"totalOutWithdrawn",type:"u64",index:!1},{name:"unfilledAmount",type:"u64",index:!1},{name:"userClosed",type:"bool",index:!1}]},{name:"Withdraw",fields:[{name:"dcaKey",type:"publicKey",index:!1},{name:"inAmount",type:"u64",index:!1},{name:"outAmount",type:"u64",index:!1},{name:"userWithdraw",type:"bool",index:!1}]},{name:"Deposit",fields:[{name:"dcaKey",type:"publicKey",index:!1},{name:"amount",type:"u64",index:!1}]}],errors:[{code:6e3,name:"InvalidAmount",msg:"Invalid deposit amount"},{code:6001,name:"InvalidCycleAmount",msg:"Invalid deposit amount"},{code:6002,name:"InvalidPair",msg:"Invalid pair"},{code:6003,name:"TooFrequent",msg:"Too frequent DCA cycle"},{code:6004,name:"InvalidMinPrice",msg:"Minimum price constraint must be greater than 0"},{code:6005,name:"InvalidMaxPrice",msg:"Maximum price constraint must be greater than 0"},{code:6006,name:"InAmountInsufficient",msg:"In amount needs to be more than in amount per cycle"},{code:6007,name:"Unauthorized",msg:"Wrong user"},{code:6008,name:"NoInATA",msg:"inAta not passed in"},{code:6009,name:"NoUserInATA",msg:"userInAta not passed in"},{code:6010,name:"NoOutATA",msg:"outAta not passed in"},{code:6011,name:"NoUserOutATA",msg:"userOutAta not passed in"},{code:6012,name:"InsufficientBalanceInProgram",msg:"Trying to withdraw more than available"},{code:6013,name:"InvalidDepositAmount",msg:"Deposit should be more than 0"},{code:6014,name:"UserInsufficientBalance",msg:"User has insufficient balance"},{code:6015,name:"UnauthorizedKeeper",msg:"Unauthorized Keeper"},{code:6016,name:"UnrecognizedProgram",msg:"Unrecognized Program"},{code:6017,name:"MathErrors",msg:"Calculation errors"},{code:6018,name:"KeeperNotTimeToFill",msg:"Not time to fill"},{code:6019,name:"OrderFillAmountWrong",msg:"Order amount wrong"},{code:6020,name:"SwapOutAmountBelowMinimum",msg:"Out amount below expectations"},{code:6021,name:"WrongAdmin",msg:"Wrong admin"},{code:6022,name:"MathOverflow",msg:"Overflow in arithmetic operation"},{code:6023,name:"AddressMismatch",msg:"Address Mismatch"},{code:6024,name:"ProgramMismatch",msg:"Program Mismatch"},{code:6025,name:"IncorrectRepaymentAmount",msg:"Incorrect Repayment Amount"},{code:6026,name:"CannotBorrowBeforeRepay",msg:"Cannot Borrow Before Repay"},{code:6027,name:"NoRepaymentInstructionFound",msg:"No Repayment Found"},{code:6028,name:"MissingSwapInstructions",msg:"Missing Swap Instruction"},{code:6029,name:"UnexpectedSwapProgram",msg:"Expected Instruction to use Jupiter Swap Program"},{code:6030,name:"UnknownInstruction",msg:"Unknown Instruction"},{code:6031,name:"MissingRepayInstructions",msg:"Missing Repay Instruction"},{code:6032,name:"KeeperShortchanged",msg:"Keeper Shortchanged"},{code:6033,name:"WrongSwapOutAccount",msg:"Jup Swap to Wrong Out Account"},{code:6034,name:"WrongTransferAmount",msg:"Transfer amount should be exactly account balance"},{code:6035,name:"InsufficientBalanceForRent",msg:"Insufficient balance for rent"},{code:6036,name:"UnexpectedSolBalance",msg:"Unexpected SOL amount in intermediate account"},{code:6037,name:"InsufficientWsolForTransfer",msg:"Too little WSOL to perform transfer"},{code:6038,name:"MissedInstruction",msg:"Did not call initiate_flash_fill"},{code:6039,name:"WrongProgram",msg:"Did not call this program's initiate_flash_fill"},{code:6040,name:"BalanceNotZero",msg:"Can't close account with balance"},{code:6041,name:"UnexpectedWSOLLeftover",msg:"Should not have WSOL leftover in DCA out-token account"},{code:6042,name:"IntermediateAccountNotSet",msg:"Should pass in a WSOL intermediate account when transferring SOL"},{code:6043,name:"UnexpectedSwapInstruction",msg:"Did not call jup swap"}]},O={testnet:new i.PublicKey("devBa82xDUtHW6hVF27uCFCf6hmV323aJg1Qf9bgwWf"),devnet:new i.PublicKey("Betam4GuxvAes2uQ5vX8SackcxL5pxRuHowM5m2Ykmcq"),"mainnet-beta":new i.PublicKey("DCA265Vj8a9CEuX1eb1LWRnDT7uK6q1xMipnNyatn23M")},v=(new i.PublicKey("JUP4Fb2cqiRUcaTHdrPC8h2gNsA2ETXiPDD33WcGuJB"),(e,n,t,...i)=>I(void 0,[e,n,t,...i],(function*(e,n,t,i=t,r=!0){try{const u=yield(0,a.Am)(n,t,r);if(yield e.getAccountInfo(u))return{ataPubKey:u,ix:void 0};return{ataPubKey:u,ix:(0,p.E)(i,u,t,n)}}catch(u){throw console.error("Error::getOrCreateATAInstruction",u),u}}))),k=class{constructor(e,n="mainnet-beta",t){this.connection=e;const i=new r.AnchorProvider(e,{},r.AnchorProvider.defaultOptions());this.program=new r.Program(K,null!=t?t:O[n],i)}getDcaPubKey(e,n,t,r){const a=r.toArrayLike(g,"le",8),[u]=i.PublicKey.findProgramAddressSync([g.from("dca"),e.toBuffer(),n.toBuffer(),t.toBuffer(),a],this.program.programId);return u}fetchDCA(e){return I(this,null,(function*(){const n=yield this.program.account.dca.fetch(e);return P(b({},n),{inBalance:n.inDeposited.sub(n.inUsed).sub(n.inWithdrawn),outBalance:n.outReceived.sub(n.outReceived)})}))}createDCA(e){return I(this,null,(function*(){let{user:n,inAmount:t,inAmountPerCycle:o,cycleSecondsApart:s,inputMint:c,outputMint:m,minOutAmountPerCycle:l,maxOutAmountPerCycle:d,startAt:p,userInTokenAccount:g}=e;if(t<o)throw new Error("inAmount must be greater than inAmountPerCycle");if(BigInt(s.toString())<BigInt(30))throw new Error("cycleSecondsApart must be at least 30 seconds");if(l&&d&&BigInt(l.toString())>BigInt(d.toString()))throw new Error("minOutAmountPerCycle must be less than maxOutAmountPerCycle");if(n=new i.PublicKey(n),c=new i.PublicKey(c),m=new i.PublicKey(m),g||(g=(0,a.MO)(c,n,!0)),c.equals(u.Gd)&&new r.BN((yield B(this.connection,n)).toString())<t)throw new Error("User does not have sufficient inputMint");if(!c.equals(u.Gd)&&new r.BN((yield x(this.connection,g)).toString())<t)throw new Error("User does not have sufficient inputMint");return this._createDCA(n,g,t,o,s,c,m,l,d,p)}))}_createDCA(e,n,t,i,o,s,c,m=null,d=null,p=null){return I(this,null,(function*(){const g=[];let y=!1;if(s.equals(u.Gd)){const{ataPubKey:n,ix:i}=yield v(this.connection,s,e),a=r.web3.SystemProgram.transfer({fromPubkey:e,lamports:new r.BN(t.toString()).toNumber(),toPubkey:n}),u=l(n);i&&(y=!0,g.push(i)),g.push(a),g.push(u)}if(!c.equals(u.Gd)){const{ataPubKey:n,ix:t}=yield v(this.connection,c,e);t&&g.push(t)}const f=new r.BN(parseInt((Date.now()/1e3).toString())),h=yield this.getDcaPubKey(e,s,c,f);return{tx:yield this.program.methods.openDca(f,new r.BN(t.toString()),new r.BN(i.toString()),new r.BN(o.toString()),m?new r.BN(m.toString()):new r.BN(0),d?new r.BN(d.toString()):new r.BN(0),p?new r.BN(p.toString()):new r.BN(0),y).accounts({user:e,dca:h,inputMint:s,outputMint:c,userAta:n,inAta:(0,a.MO)(s,h,!0),outAta:(0,a.MO)(c,h,!0)}).preInstructions(g).transaction(),dcaPubKey:h}}))}createDcaV2(e,n=!1,t){return I(this,null,(function*(){let{payer:o,user:s,inAmount:c,inAmountPerCycle:m,cycleSecondsApart:l,inputMint:d,outputMint:p,minOutAmountPerCycle:g,maxOutAmountPerCycle:y,startAt:f,userInTokenAccount:h}=e;if(c<m)throw new Error("inAmount must be greater than inAmountPerCycle");if(BigInt(l.toString())<BigInt(30))throw new Error("cycleSecondsApart must be at least 30 seconds");if(g&&y&&BigInt(g.toString())>BigInt(y.toString()))throw new Error("minOutAmountPerCycle must be less than maxOutAmountPerCycle");if(o=new i.PublicKey(o),s=new i.PublicKey(s),d=new i.PublicKey(d),p=new i.PublicKey(p),h||(h=(0,a.MO)(d,s,!0)),!n){if(d.equals(u.Gd)&&new r.BN((yield B(this.connection,s)).toString())<c)throw new Error("User does not have sufficient inputMint");if(!d.equals(u.Gd)&&(yield x(this.connection,h))<BigInt(c.toString()))throw new Error("User does not have sufficient inputMint")}return this._createDCAV2(o,s,h,c,m,l,d,p,g,y,f,t)}))}_createDCAV2(e,n,t,i,o,s,c,m,g=null,y=null,f=null,h){return I(this,null,(function*(){const w=[],A=[];if(c.equals(u.Gd)){const{ataPubKey:e,ix:t}=yield v(this.connection,c,n),a=r.web3.SystemProgram.transfer({fromPubkey:n,lamports:new r.BN(i.toString()).toNumber(),toPubkey:e}),u=l(e);t&&(w.push(t),A.push((0,d.Zu)(e,n,n))),w.push(a),w.push(u)}if(!m.equals(u.Gd))if(!1===h)w.push((0,p.E)(n,(0,a.MO)(m,n,!0),n,m));else if(!h){const{ix:e}=yield v(this.connection,m,n);e&&w.push(e)}const M=new r.BN(parseInt((Date.now()/1e3).toString())),S=yield this.getDcaPubKey(n,c,m,M);return{tx:yield this.program.methods.openDcaV2(M,new r.BN(i.toString()),new r.BN(o.toString()),new r.BN(s.toString()),g?new r.BN(g.toString()):new r.BN(0),y?new r.BN(y.toString()):new r.BN(0),f?new r.BN(f.toString()):new r.BN(0)).accounts({dca:S,user:n,payer:e,inputMint:c,outputMint:m,userAta:t,inAta:(0,a.MO)(c,S,!0),outAta:(0,a.MO)(m,S,!0)}).preInstructions(w).postInstructions(A).transaction(),dcaPubKey:S}}))}closeDCA(e){return I(this,arguments,(function*({user:e,dca:n}){e=new i.PublicKey(e),n=new i.PublicKey(n);const t=yield this.fetchDCA(n),r=t.inputMint,u=t.outputMint,o=(0,a.MO)(r,e,!0),s=(0,a.MO)(u,e,!0),c=(0,a.MO)(r,n,!0),m=(0,a.MO)(u,n,!0);return this._closeDCA(e,n,r,u,o,s,c,m)}))}_closeDCA(e,n,t,i,r,a,o,s){return I(this,null,(function*(){const c=[];t.equals(u.Gd)&&c.push((0,d.Zu)(r,e,e)),i.equals(u.Gd)&&c.push((0,d.Zu)(a,e,e));return{tx:yield this.program.methods.closeDca().accounts({user:e,dca:n,inputMint:t,outputMint:i,inAta:o,outAta:s,userInAta:r,userOutAta:a}).postInstructions(c).transaction()}}))}deposit(e){return I(this,null,(function*(){let{user:n,dca:t,amount:u}=e;n=new i.PublicKey(n),t=new i.PublicKey(t);const o=yield this.fetchDCA(t),s=(0,a.MO)(o.inputMint,n,!1),c=(0,a.MO)(o.inputMint,t,!0);return u=new r.BN(u.toString()),this._deposit(n,t,o.inputMint,s,c,u)}))}_deposit(e,n,t,i,a,o){return I(this,null,(function*(){const s=[];if(t.equals(u.Gd)){const{ataPubKey:n,ix:i}=yield v(this.connection,t,e),a=r.web3.SystemProgram.transfer({fromPubkey:e,lamports:new r.BN(o.toString()).toNumber(),toPubkey:n}),u=l(n);i&&s.push(i),s.push(a),s.push(u)}return{tx:yield this.program.methods.deposit(o).accounts({user:e,dca:n,userInAta:i,inAta:a}).preInstructions(s).transaction()}}))}withdraw(e){return I(this,arguments,(function*({user:e,dca:n,inputMint:t,outputMint:u,withdrawInAmount:o,withdrawOutAmount:s}){if(e=new i.PublicKey(e),n=new i.PublicKey(n),!t||!u)throw new Error("Need to supply at least input mint or output mint or both");if(t&&!o)throw new Error("withdrawInAmount not supplied");if(u&&!s)throw new Error("withdrawOutAmount not supplied");const c=yield this.fetchDCA(n);if(o&&!new i.PublicKey(t).equals(c.inputMint))throw new Error("Wrong inputMint supplied");if(s&&!new i.PublicKey(u).equals(c.outputMint))throw new Error("Wrong outputMint supplied");const m=(0,a.MO)(c.inputMint,n,!0),l=(0,a.MO)(c.outputMint,n,!0),d=(0,a.MO)(c.inputMint,e,!1),p=(0,a.MO)(c.outputMint,e,!1);return o=o?new r.BN(o.toString()):new r.BN(0),s=s?new r.BN(s.toString()):new r.BN(0),t=c.inputMint,u=c.outputMint,this._withdraw(e,n,t,u,m,l,d,p,o,s)}))}_withdraw(e,n,t,i,a,o,s,c,m,l){return I(this,null,(function*(){const p={in:{}},g={out:{}};let y;const f=[];if(t&&m&&t.equals(u.Gd)){if(!s)throw new Error("userInAta not supplied");f.push((0,d.Zu)(s,e,e))}if(i&&l&&i.equals(u.Gd)){if(!c)throw new Error("userOutAta not supplied");f.push((0,d.Zu)(c,e,e))}if(m.gt(new r.BN(0))&&l.gt(new r.BN(0))){const r={withdrawAmount:m,withdrawal:p},u=yield this.program.methods.withdraw(r).accounts({user:e,dca:n,inputMint:t,outputMint:i,dcaAta:a,userInAta:s,userOutAta:c}).instruction(),d={withdrawAmount:l,withdrawal:g};y=yield this.program.methods.withdraw(d).accounts({user:e,dca:n,inputMint:t,outputMint:i,dcaAta:o,userInAta:s,userOutAta:c}).preInstructions([u]).postInstructions(f).transaction()}else if(m.gt(new r.BN(0))){const r={withdrawAmount:m,withdrawal:p};y=yield this.program.methods.withdraw(r).accounts({user:e,dca:n,inputMint:t,outputMint:i,dcaAta:a,userInAta:s,userOutAta:c}).postInstructions(f).transaction()}else{if(!l.gt(new r.BN(0)))throw new Error("Unexpected error - no amount specified for withdrawal");{const r={withdrawAmount:l,withdrawal:g};y=yield this.program.methods.withdraw(r).accounts({user:e,dca:n,inputMint:t,outputMint:i,dcaAta:o,userInAta:s,userOutAta:c}).postInstructions(f).transaction()}}return{tx:y}}))}getAll(){return I(this,null,(function*(){return this.program.account.dca.all()}))}getCurrentByUser(e,n,t){return I(this,null,(function*(){const i=yield this.program.account.dca.all([{memcmp:{offset:8,bytes:e.toBase58()}}]);return n&&t?i.filter((e=>e.account.inputMint.equals(n)||e.account.outputMint.equals(t))):n?(console.log("has input mint"),i.filter((e=>e.account.inputMint.equals(n)))):t?i.filter((e=>e.account.outputMint.equals(t))):i}))}getClosedByUser(e,n,t,a,u){return I(this,null,(function*(){let o=`https://dca-api.jup.ag/user/${e.toString()}/dca?status=1`;a&&(o+=`&input-mint=${a.toBase58()}`),u&&(o+=`&output-mint=${u.toBase58()}`),n&&(o+=`&before=${n.toISOString()}`),t&&(o+=`&limit=${t}`);const s=yield fetch(o);return(yield s.json()).data.dcaAccounts.map((e=>{let n=[];return e.fills.forEach((e=>{n.push({userKey:new i.PublicKey(e.userKey),dcaKey:new i.PublicKey(e.dcaKey),inputMint:new i.PublicKey(e.inputMint),outputMint:new i.PublicKey(e.inputMint),inAmount:e.inAmount,outAmount:e.outAmount,feeMint:new i.PublicKey(e.feeMint),fee:e.fee,txId:e.txId,confirmedAt:new Date(Date.parse(e.confirmedAt))})})),{publicKey:new i.PublicKey(e.dcaKey),account:{createdAt:new r.BN(Math.floor(Date.parse(e.createdAt)/1e3)),updatedAt:new r.BN(Math.floor(Date.parse(e.updatedAt)/1e3)),user:new i.PublicKey(e.userKey),inputMint:new i.PublicKey(e.inputMint),outputMint:new i.PublicKey(e.outputMint),inDeposited:new r.BN(e.inDeposited),inAmountPerCycle:new r.BN(e.inAmountPerCycle),cycleFrequency:new r.BN(e.cycleFrequency),inFilled:new r.BN(e.inDeposited).sub(new r.BN(e.inWithdrawn)),outReceived:new r.BN(e.outWithdrawn),inWithdrawn:new r.BN(e.inWithdrawn),outWithdrawn:new r.BN(e.outWithdrawn),unfilledAmount:new r.BN(e.unfilledAmount),closeTxHash:e.closeTxHash,openTxHash:e.openTxHash,status:e.status,userClosed:e.userClosed},fills:n}}))}))}getBalancesByAccount(e){return I(this,null,(function*(){const n=yield this.fetchDCA(e),t=yield(0,a.ih)(this.connection,n.inputMint),i=yield x(this.connection,n.inAccount),r=yield(0,a.ih)(this.connection,n.outputMint),u=yield x(this.connection,n.outAccount);return{in:P(b({},t),{dcaInAta:n.inAccount,dcaBalance:i}),out:P(b({},r),{dcaOutAta:n.outAccount,dcaBalance:u}),stats:{inDeposited:BigInt(n.inDeposited.toString()),inWithdrawn:BigInt(n.inWithdrawn.toString()),outWithdrawn:BigInt(n.outWithdrawn.toString()),inUsed:BigInt(n.inUsed.toString()),outReceived:BigInt(n.outReceived.toString())}}}))}withdrawFees(e){return I(this,arguments,(function*({admin:e,mint:n,amount:t}){e=new i.PublicKey(e),n=new i.PublicKey(n),t=new r.BN(t.toString());let[u]=yield i.PublicKey.findProgramAddressSync([g.from("fee")],this.program.programId);const o=(0,a.MO)(n,u,!0),s=(0,a.MO)(n,e,!1);return{tx:yield this.program.methods.withdrawFees(new r.BN(t.toString())).accounts({admin:e,mint:n,feeAuthority:u,programFeeAta:o,adminFeeAta:s}).transaction()}}))}getFillHistory(e){return I(this,null,(function*(){try{e=e.toString();const n=yield fetch(`https://dca-api.jup.ag/dca/${e}/fills`);return(yield n.json()).data.fills.map((e=>({userKey:new i.PublicKey(e.userKey),dcaKey:new i.PublicKey(e.dcaKey),inputMint:new i.PublicKey(e.inputMint),outputMint:new i.PublicKey(e.outputMint),inAmount:e.inAmount,outAmount:e.outAmount,feeMint:new i.PublicKey(e.feeMint),fee:e.fee,txId:e.txId,confirmedAt:new Date(1e3*e.confirmedAt)})))}catch(n){return console.error(n),[]}}))}getAvailableTokens(){return I(this,null,(function*(){const e=yield fetch("https://cache.jup.ag/top-tokens");return(yield e.json()).map((e=>new i.PublicKey(e)))}))}}},41300:function(e,n,t){t.d(n,{Gd:function(){return u},H_:function(){return r},_u:function(){return a}});var i=t(94728);const r=new i.PublicKey("TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA"),a=(new i.PublicKey("TokenzQdBNbLqP5VEhdkAS6EPFLC1PHnBqCXEpPxuEb"),new i.PublicKey("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL")),u=new i.PublicKey("So11111111111111111111111111111111111111112");new i.PublicKey("9pan9bMn5HatX4EJdBwg9VgCa7Uz5HL8N1m5D3NdXejP")},32050:function(e,n,t){t.d(n,{$O:function(){return o},Gl:function(){return c},Or:function(){return u},We:function(){return r},iK:function(){return a},iT:function(){return s}});class i extends Error{constructor(e){super(e)}}class r extends i{constructor(){super(...arguments),this.name="TokenAccountNotFoundError"}}class a extends i{constructor(){super(...arguments),this.name="TokenInvalidAccountError"}}class u extends i{constructor(){super(...arguments),this.name="TokenInvalidAccountOwnerError"}}class o extends i{constructor(){super(...arguments),this.name="TokenInvalidAccountSizeError"}}class s extends i{constructor(){super(...arguments),this.name="TokenInvalidMintError"}}class c extends i{constructor(){super(...arguments),this.name="TokenOwnerOffCurveError"}}},4040:function(e,n,t){var i;t.d(n,{Q:function(){return i},t:function(){return r}}),function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Mint=1]="Mint",e[e.Account=2]="Account"}(i||(i={}));const r=1},87260:function(e,n,t){t.d(n,{E:function(){return u}});var i=t(94728),r=t(41300),a=t(795).Buffer;function u(e,n,t,u,o=r.H_,s=r._u){const c=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:i.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!1}];return new i.TransactionInstruction({keys:c,programId:s,data:a.alloc(0)})}},26786:function(e,n,t){t.d(n,{Zu:function(){return c}});var i=t(52466),r=t(94728),a=t(41300);var u=t(48496),o=t(795).Buffer;const s=(0,i.struct)([(0,i.u8)("instruction")]);function c(e,n,t,i=[],c=a.H_){const m=function(e,n,t){if(t.length){e.push({pubkey:n,isSigner:!1,isWritable:!1});for(const n of t)e.push({pubkey:n.publicKey,isSigner:!0,isWritable:!1})}else e.push({pubkey:n,isSigner:!0,isWritable:!1});return e}([{pubkey:e,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0}],t,i),l=o.alloc(s.span);return s.encode({instruction:u.c.CloseAccount},l),new r.TransactionInstruction({keys:m,programId:c,data:l})}},48496:function(e,n,t){var i;t.d(n,{c:function(){return i}}),function(e){e[e.InitializeMint=0]="InitializeMint",e[e.InitializeAccount=1]="InitializeAccount",e[e.InitializeMultisig=2]="InitializeMultisig",e[e.Transfer=3]="Transfer",e[e.Approve=4]="Approve",e[e.Revoke=5]="Revoke",e[e.SetAuthority=6]="SetAuthority",e[e.MintTo=7]="MintTo",e[e.Burn=8]="Burn",e[e.CloseAccount=9]="CloseAccount",e[e.FreezeAccount=10]="FreezeAccount",e[e.ThawAccount=11]="ThawAccount",e[e.TransferChecked=12]="TransferChecked",e[e.ApproveChecked=13]="ApproveChecked",e[e.MintToChecked=14]="MintToChecked",e[e.BurnChecked=15]="BurnChecked",e[e.InitializeAccount2=16]="InitializeAccount2",e[e.SyncNative=17]="SyncNative",e[e.InitializeAccount3=18]="InitializeAccount3",e[e.InitializeMultisig2=19]="InitializeMultisig2",e[e.InitializeMint2=20]="InitializeMint2",e[e.GetAccountDataSize=21]="GetAccountDataSize",e[e.InitializeImmutableOwner=22]="InitializeImmutableOwner",e[e.AmountToUiAmount=23]="AmountToUiAmount",e[e.UiAmountToAmount=24]="UiAmountToAmount",e[e.InitializeMintCloseAuthority=25]="InitializeMintCloseAuthority",e[e.TransferFeeExtension=26]="TransferFeeExtension",e[e.ConfidentialTransferExtension=27]="ConfidentialTransferExtension",e[e.DefaultAccountStateExtension=28]="DefaultAccountStateExtension",e[e.Reallocate=29]="Reallocate",e[e.MemoTransferExtension=30]="MemoTransferExtension",e[e.CreateNativeMint=31]="CreateNativeMint",e[e.InitializeNonTransferableMint=32]="InitializeNonTransferableMint",e[e.InterestBearingMintExtension=33]="InterestBearingMintExtension"}(i||(i={}))},47338:function(e,n,t){t.d(n,{D0:function(){return p},lZ:function(){return d},p0:function(){return l}});var i,r=t(52466),a=t(78200),u=t(41300),o=t(32050),s=t(4040),c=t(89402),m=t(795).Buffer;!function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initialized=1]="Initialized",e[e.Frozen=2]="Frozen"}(i||(i={}));const l=(0,r.struct)([(0,a.ZL)("mint"),(0,a.ZL)("owner"),(0,a.AW)("amount"),(0,r.u32)("delegateOption"),(0,a.ZL)("delegate"),(0,r.u8)("state"),(0,r.u32)("isNativeOption"),(0,a.AW)("isNative"),(0,a.AW)("delegatedAmount"),(0,r.u32)("closeAuthorityOption"),(0,a.ZL)("closeAuthority")]),d=l.span;async function p(e,n,t,i=u.H_){return g(n,await e.getAccountInfo(n,t),i)}function g(e,n,t=u.H_){if(!n)throw new o.We;if(!n.owner.equals(t))throw new o.Or;if(n.data.length<d)throw new o.$O;const r=l.decode(n.data.slice(0,d));let a=m.alloc(0);if(n.data.length>d){if(n.data.length===c.Wx)throw new o.$O;if(n.data[d]!=s.Q.Account)throw new o.iK;a=n.data.slice(d+s.t)}return{address:e,mint:r.mint,owner:r.owner,amount:r.amount,delegate:r.delegateOption?r.delegate:null,delegatedAmount:r.delegatedAmount,isInitialized:r.state!==i.Uninitialized,isFrozen:r.state===i.Frozen,isNative:!!r.isNativeOption,rentExemptReserve:r.isNativeOption?r.isNative:null,closeAuthority:r.closeAuthorityOption?r.closeAuthority:null,tlvData:a}}},2712:function(e,n,t){t.d(n,{Am:function(){return y},MO:function(){return f},ih:function(){return g},qT:function(){return d}});var i=t(52466),r=t(78200),a=t(94728),u=t(41300),o=t(32050),s=t(4040),c=t(47338),m=t(89402),l=t(795).Buffer;const d=(0,i.struct)([(0,i.u32)("mintAuthorityOption"),(0,r.ZL)("mintAuthority"),(0,r.AW)("supply"),(0,i.u8)("decimals"),(0,r.Xg)("isInitialized"),(0,i.u32)("freezeAuthorityOption"),(0,r.ZL)("freezeAuthority")]),p=d.span;async function g(e,n,t,i=u.H_){return function(e,n,t=u.H_){if(!n)throw new o.We;if(!n.owner.equals(t))throw new o.Or;if(n.data.length<p)throw new o.$O;const i=d.decode(n.data.slice(0,p));let r=l.alloc(0);if(n.data.length>p){if(n.data.length<=c.lZ)throw new o.$O;if(n.data.length===m.Wx)throw new o.$O;if(n.data[c.lZ]!=s.Q.Mint)throw new o.iT;r=n.data.slice(c.lZ+s.t)}return{address:e,mintAuthority:i.mintAuthorityOption?i.mintAuthority:null,supply:i.supply,decimals:i.decimals,isInitialized:i.isInitialized,freezeAuthority:i.freezeAuthorityOption?i.freezeAuthority:null,tlvData:r}}(n,await e.getAccountInfo(n,t),i)}async function y(e,n,t=!1,i=u.H_,r=u._u){if(!t&&!a.PublicKey.isOnCurve(n.toBuffer()))throw new o.Gl;const[s]=await a.PublicKey.findProgramAddress([n.toBuffer(),i.toBuffer(),e.toBuffer()],r);return s}function f(e,n,t=!1,i=u.H_,r=u._u){if(!t&&!a.PublicKey.isOnCurve(n.toBuffer()))throw new o.Gl;const[s]=a.PublicKey.findProgramAddressSync([n.toBuffer(),i.toBuffer(),e.toBuffer()],r);return s}},89402:function(e,n,t){t.d(n,{Wx:function(){return u}});var i=t(52466),r=t(78200);const a=(0,i.struct)([(0,i.u8)("m"),(0,i.u8)("n"),(0,r.Xg)("isInitialized"),(0,r.ZL)("signer1"),(0,r.ZL)("signer2"),(0,r.ZL)("signer3"),(0,r.ZL)("signer4"),(0,r.ZL)("signer5"),(0,r.ZL)("signer6"),(0,r.ZL)("signer7"),(0,r.ZL)("signer8"),(0,r.ZL)("signer9"),(0,r.ZL)("signer10"),(0,r.ZL)("signer11")]),u=a.span}}]);
//# sourceMappingURL=2886-c946b1df9de531db.js.map