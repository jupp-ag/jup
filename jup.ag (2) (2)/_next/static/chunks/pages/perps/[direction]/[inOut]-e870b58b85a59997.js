(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4364,4566],{54566:function(e,t,n){"use strict";n.r(t);var i=n(93981),s=n(13838),l=n(65838),r=n(25546),o=n(29541);t.default=function(e){var t,n=e.tokenInfo,a=e.amount,c=e.maxDecimals,u=e.prefix,d=(0,l.y6)(),x=d.tokenPriceMap,m=d.getUSDValue,f=n.address;(0,i.useEffect)((function(){f&&m([f])}),[f,m]);var p=f&&(null===(t=x[f])||void 0===t?void 0:t.usd)||0,h=new s.Z(a||0).mul(p).toNumber();return!h||h<=0?(0,o.jsx)(o.Fragment,{children:""}):c&&new s.Z(h).lte(.1)?(0,o.jsxs)(o.Fragment,{children:[u,"$",parseFloat(r.uf.format(h,c))]}):(0,o.jsxs)(o.Fragment,{children:[u,"$",r.uf.format(h,2)]})}},80751:function(e,t,n){"use strict";var i=n(12197),s=n(93981),l=n(29541);t.Z=function(e){var t=e.open,n=e.onClose,r=e.children,o=(0,i.Gc)(),a=((0,s.useMemo)((function(){return"xs"===o||"sm"===o||"md"===o}),[o]),(0,s.useRef)(null));(0,i.O3)(a,(function(){var e;return null===(e=a.current)||void 0===e?void 0:e.close()}));var c=(0,s.useCallback)((function(){var e;null===(e=a.current)||void 0===e||e.close(),n()}),[n,a]);return(0,s.useEffect)((function(){if(a.current&&(t?a.current.open||a.current.show():a.current.close()),t){var e=a.current;return null===e||void 0===e||e.addEventListener("close",c),function(){null===e||void 0===e||e.removeEventListener("close",c)}}}),[c,t]),(0,l.jsx)("dialog",{ref:a,className:"fixed z-40 top-0 rounded-lg bg-black/30 backdrop-blur-sm animate-fade-in flex items-center justify-center",children:r})}},32529:function(e,t,n){"use strict";n.d(t,{Y:function(){return o}});var i=n(70107),s=n(96343),l=n(93981);function r(e,t){return Array(t-e+1).fill(void 0).map((function(t,n){return e+n}))}function o(e){var t=e.pageIndex,n=void 0===t?0:t,o=e.pageCount,a=void 0===o?0:o,c=e.setPageIndex,u=(0,s.XA)(),d=l.useMemo((function(){var e=n+1;return u?a<=5?r(1,a):e<=2?[].concat((0,i.Z)(r(1,3)),["...",a]):e>=a-2?[1,"..."].concat((0,i.Z)(r(a-2,a))):[1,"...",e,"...",a]:a<=8?r(1,a):e<=2?[].concat((0,i.Z)(r(1,3)),["...",a]):e>=a-2?[1,"..."].concat((0,i.Z)(r(a-2,a))):[1,"..."].concat((0,i.Z)(r(e,e+2)),["...",a])}),[n,u,a]),x=(0,l.useMemo)((function(){return n>0}),[n]),m=(0,l.useMemo)((function(){return n<a-1}),[n,a]),f=(0,l.useCallback)((function(e){return c(e)}),[c]);return{pager:d,canPreviousPage:x,canNextPage:m,gotoPage:f}}},17639:function(e,t,n){"use strict";var i=n(7761),s=(n(93981),n(18112)),l=n(11017),r=n(89388),o=n(29541);t.Z=function(e){var t=e.canPreviousPage,n=e.gotoPage,a=e.pageIndex,c=e.pager,u=e.canNextPage;return(0,o.jsxs)("div",{className:"flex flex-row justify-between px-2 py-5 lg:px-6 mb-20",children:[(0,o.jsxs)("button",{type:"button",disabled:!t,onClick:function(){return n(a-1)},className:"flex flex-row items-center text-[#E8F9FF] cursor-pointer disabled:cursor-not-allowed text-opacity-50 hover:text-opacity-100",children:[(0,o.jsx)(s.Z,{width:12,height:12}),(0,o.jsx)("span",{className:"ml-2 text-xs",children:i.ag._("Previous")})]}),(0,o.jsx)("div",{className:"flex-row space-x-2 flex",children:c.map((function(e,t){var i=e===a+1,s="".concat(e,"-").concat(t);return"string"===typeof e?(0,o.jsx)("div",{className:"flex flex-row items-center justify-center text-xs",children:e},s):(0,o.jsx)("div",{onClick:function(){return n(e-1)},className:(0,r.cn)("h-10 w-10 text-xs rounded-lg flex flex-row items-center justify-center text-[#E8F9FF]/50 hover:text-v2-primary cursor-pointer",{"!text-v2-primary border bg-v2-primary/10 border-v2-primary/50 font-semibold":i}),children:e},s)}))}),(0,o.jsxs)("button",{type:"button",disabled:!u,onClick:function(){return n(a+1)},className:"flex flex-row items-center text-[#E8F9FF] cursor-pointer disabled:cursor-not-allowed text-opacity-50 hover:text-opacity-100",children:[(0,o.jsx)("span",{className:"mr-2 text-xs",children:i.ag._("Next")}),(0,o.jsx)(l.Z,{width:12,height:12})]})]})}},69825:function(e,t,n){"use strict";var i=n(63956),s=n(54423),l=n(93981),r=n(87821),o=n(65838),a=n(25546),c=n(89388),u=n(29541),d=["testId","name","onChange","value","disabled","decimals","onMouseOver","onFocus","onKeyDown","className","placeholder","onBlur","suffix","max","autofocus","style","enableDynamicSizing"];function x(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}var m=l.forwardRef((function(e,t){e.testId;var n=e.name,m=e.onChange,f=e.value,p=e.disabled,h=void 0!==p&&p,v=e.decimals,g=void 0===v?6:v,w=e.onMouseOver,b=e.onFocus,j=e.onKeyDown,y=e.className,N=e.placeholder,P=e.onBlur,S=e.suffix,k=e.max,C=e.autofocus,Z=void 0!==C&&C,M=e.style,L=e.enableDynamicSizing,T=(0,s.Z)(e,d),_=(0,o.MG)().constants.MAX_INPUT_LIMIT,O=l.useMemo((function(){return T.isAllowed||function(e){var t=e.floatValue;return k?!t||t<=Number(k):!t||t<=_}}),[_,T.isAllowed,k]),F=String(f).length>=9?"text-base md:text-xl":"text-xl",q=","===a.A5?".":",",D=","===a.A5?",":".",V=l.useRef(null),A=(0,l.useState)(M),I=A[0],U=A[1];return(0,l.useEffect)((function(){var e;L&&U(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x(Object(n),!0).forEach((function(t){(0,i.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({width:null===(e=V.current)||void 0===e?void 0:e.clientWidth},M))}),[f,M,L]),(0,u.jsx)(r.Z,{onKeyDown:j,autoComplete:"off",name:n,inputMode:"decimal",onBlur:P,"data-lpignore":"true",decimalSeparator:D,value:null!==f&&void 0!==f?f:"",allowedDecimalSeparators:[".",","],thousandSeparator:q,decimalScale:g,allowNegative:!1,allowLeadingZeros:!1,disabled:h,isAllowed:O,onValueChange:function(e){e.value!==(null===f||void 0===f?void 0:f.toString())&&m&&m(e)},isNumericString:!0,placeholder:h?"":null!==N&&void 0!==N?N:"0.00",className:(0,c.cn)("h-full w-full bg-transparent disabled:cursor-not-allowed disabled:opacity-100 disabled:text-black dark:text-white text-right font-semibold dark:placeholder:text-white/25",F,y),onMouseOver:w,onFocus:b,getInputRef:t,suffix:S,autoFocus:Z,style:I})}));t.Z=m},3561:function(e,t,n){"use strict";n(93981);var i=n(29541);t.Z=function(e){var t=e.fill,n=void 0===t?"white":t,s=e.width,l=void 0===s?12:s,r=e.height,o=void 0===r?12:r;return(0,i.jsxs)("svg",{width:l,height:o,viewBox:"0 0 12 12",fill:n,xmlns:"http://www.w3.org/2000/svg",children:[(0,i.jsx)("g",{clipPath:"url(#clip0_9115_125056)",children:(0,i.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 6C12 9.31371 9.31371 12 6 12C2.68629 12 0 9.31371 0 6C0 2.68629 2.68629 0 6 0C9.31371 0 12 2.68629 12 6ZM5.95362 7.63052C5.60347 7.63083 5.31644 7.35363 5.30407 7.0038L5.15183 2.7132C5.14549 2.53686 5.21146 2.36591 5.33389 2.23905C5.45631 2.11218 5.62504 2.04082 5.80138 2.04082H6.10586C6.2822 2.04082 6.45093 2.11218 6.57336 2.23905C6.69578 2.36591 6.76175 2.53686 6.75541 2.7132L6.60317 7.0038C6.5908 7.35363 6.30377 7.63083 5.95362 7.63052ZM5.95352 10.0669C6.45812 10.0669 6.86694 9.65807 6.86694 9.15347C6.86694 8.64887 6.45812 8.24004 5.95352 8.24004C5.44891 8.24004 5.04009 8.64887 5.04009 9.15347C5.04009 9.65807 5.44891 10.0669 5.95352 10.0669Z",fill:n})}),(0,i.jsx)("defs",{children:(0,i.jsx)("clipPath",{id:"clip0_9115_125056",children:(0,i.jsx)("rect",{width:"12",height:"12",fill:n})})})]})}},18112:function(e,t,n){"use strict";var i=n(63956),s=n(54423),l=(n(93981),n(29541)),r=["className"];function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){(0,i.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}t.Z=function(e){e.className;var t=(0,s.Z)(e,r);return(0,l.jsx)("svg",a(a({width:"53",height:"52",viewBox:"0 0 53 52",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t),{},{children:(0,l.jsx)("path",{d:"M17.3336 23.8334H43.7062V28.1667H17.3336L28.9555 39.7887L25.8919 42.8524L9.03955 26L25.8919 9.14771L28.9555 12.2114L17.3336 23.8334Z",fill:"currentColor"})}))}},11017:function(e,t,n){"use strict";n(93981);var i=n(29541);t.Z=function(e){var t=e.className,n=void 0===t?"":t,s=e.width,l=void 0===s?8:s,r=e.height,o=void 0===r?7:r;return(0,i.jsx)("svg",{className:n,xmlns:"http://www.w3.org/2000/svg",width:l,height:o,fill:"none",viewBox:"0 0 8 7",children:(0,i.jsx)("path",{fill:"currentColor",fillRule:"evenodd",d:"M5.647 3.674H.69c-.91 0-.91-1.38 0-1.38h4.957L3.89.537c-.659-.659.314-1.631.973-.972l2.949 2.949c.25.25.25.69 0 .972l-2.95 2.95c-.658.627-1.63-.346-.972-.973l1.757-1.788z",clipRule:"evenodd"})})}},74222:function(e,t,n){"use strict";n.r(t),n.d(t,{__N_SSG:function(){return rn},default:function(){return on}});var i=n(93981),s=n(19424),l=n(97620),r=n(47338),o=n(27195),a=n(8857),c=n.n(a),u=n(7761),d=n(45009),x=n(13838),m=n(39268),f=n.n(m),p=n(89388),h=n(21382),v=n(29541),g=function(e){var t=e.width,n=void 0===t?120:t,i=e.height,s=void 0===i?40:i;return(0,v.jsxs)("svg",{width:n,height:s,fill:"inherit",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 370.99 127.93",children:[(0,v.jsx)("path",{stroke:"currentColor",d:"m127.92,47.62v-31.17h14.43c2.05,0,3.83.39,5.34,1.18s2.7,1.88,3.56,3.27c.86,1.4,1.29,3.02,1.29,4.85s-.43,3.46-1.29,4.85c-.86,1.4-2.06,2.49-3.58,3.27-1.53.79-3.3,1.18-5.32,1.18h-9.75v12.56h-4.68Zm4.68-16.52h9.26c1.84,0,3.3-.48,4.39-1.45s1.63-2.25,1.63-3.85-.54-2.88-1.63-3.83c-1.08-.95-2.55-1.42-4.39-1.42h-9.26v10.55Z"}),(0,v.jsx)("path",{stroke:"currentColor",d:"m166,48.07c-2.2,0-4.19-.52-5.99-1.56-1.8-1.04-3.21-2.45-4.25-4.23-1.04-1.78-1.56-3.77-1.56-5.97s.52-4.19,1.56-5.97c1.04-1.78,2.46-3.2,4.25-4.25,1.8-1.05,3.79-1.58,5.99-1.58s4.23.53,6.01,1.58c1.78,1.06,3.19,2.47,4.23,4.25,1.04,1.78,1.56,3.77,1.56,5.97s-.52,4.19-1.56,5.97-2.45,3.19-4.23,4.23-3.78,1.56-6.01,1.56Zm0-3.92c1.4,0,2.66-.35,3.79-1.05,1.13-.7,2.02-1.64,2.67-2.83.65-1.19.98-2.52.98-4.01s-.33-2.77-1-3.94c-.67-1.17-1.56-2.12-2.67-2.83-1.11-.71-2.37-1.07-3.76-1.07s-2.65.36-3.76,1.07c-1.11.71-2,1.65-2.67,2.83-.67,1.17-1,2.49-1,3.94s.33,2.82.98,4.01,1.54,2.13,2.67,2.83,2.39,1.05,3.79,1.05Z"}),(0,v.jsx)("path",{stroke:"currentColor",d:"m186.71,47.62l-6.32-22.67h4.32l4.41,16.66,5.17-16.66h3.83l5.17,16.66,4.41-16.66h4.19l-6.37,22.67h-4.27l-5.08-16.61-5.12,16.61h-4.32Z"}),(0,v.jsx)("path",{stroke:"currentColor",d:"m226.34,48.02c-2.23,0-4.24-.52-6.04-1.56-1.8-1.04-3.22-2.45-4.27-4.23-1.05-1.78-1.58-3.77-1.58-5.97s.5-4.13,1.51-5.9c1.01-1.77,2.38-3.18,4.1-4.23,1.72-1.05,3.64-1.58,5.74-1.58s3.98.53,5.61,1.58c1.63,1.06,2.93,2.48,3.9,4.28.96,1.8,1.45,3.82,1.45,6.08v1.25h-17.86c.24,1.25.71,2.36,1.4,3.34.7.98,1.59,1.75,2.67,2.32,1.08.56,2.26.85,3.54.85,1.1,0,2.16-.17,3.18-.51,1.02-.34,1.88-.84,2.56-1.49l2.85,2.81c-1.34,1.01-2.71,1.76-4.12,2.25-1.41.49-2.96.74-4.65.74Zm-7.39-13.63h13.4c-.18-1.19-.59-2.23-1.23-3.14-.64-.91-1.42-1.62-2.36-2.14-.94-.52-1.95-.78-3.05-.78s-2.17.25-3.12.76c-.95.51-1.74,1.21-2.38,2.12-.64.91-1.06,1.97-1.27,3.18Z"}),(0,v.jsx)("path",{stroke:"currentColor",d:"m241.89,47.62v-22.67h4.45v2.9c.71-1.07,1.6-1.91,2.65-2.52,1.05-.61,2.25-.91,3.59-.91.92.03,1.68.16,2.27.4v4.01c-.42-.18-.85-.3-1.29-.38-.45-.07-.89-.11-1.34-.11-1.31,0-2.47.35-3.48,1.05s-1.81,1.71-2.4,3.05v15.19h-4.45Z"}),(0,v.jsx)("path",{stroke:"currentColor",d:"m268.87,48.02c-2.23,0-4.24-.52-6.04-1.56-1.79-1.04-3.22-2.45-4.27-4.23-1.06-1.78-1.58-3.77-1.58-5.97s.51-4.13,1.51-5.9c1.01-1.77,2.38-3.18,4.1-4.23,1.72-1.05,3.64-1.58,5.75-1.58s3.98.53,5.61,1.58c1.63,1.06,2.93,2.48,3.9,4.28s1.45,3.82,1.45,6.08v1.25h-17.86c.24,1.25.71,2.36,1.4,3.34.7.98,1.59,1.75,2.67,2.32,1.08.56,2.26.85,3.54.85,1.1,0,2.16-.17,3.18-.51,1.02-.34,1.88-.84,2.56-1.49l2.85,2.81c-1.34,1.01-2.71,1.76-4.12,2.25s-2.96.74-4.65.74Zm-7.39-13.63h13.4c-.18-1.19-.59-2.23-1.22-3.14-.64-.91-1.43-1.62-2.36-2.14-.94-.52-1.95-.78-3.05-.78s-2.17.25-3.12.76c-.95.51-1.74,1.21-2.38,2.12-.64.91-1.06,1.97-1.27,3.18Z"}),(0,v.jsx)("path",{stroke:"currentColor",d:"m294.88,47.98c-2.11,0-4.04-.52-5.79-1.56-1.75-1.04-3.13-2.44-4.14-4.21-1.01-1.77-1.51-3.75-1.51-5.95s.51-4.17,1.54-5.92c1.02-1.75,2.41-3.15,4.16-4.19,1.75-1.04,3.7-1.56,5.83-1.56,1.25,0,2.45.19,3.61.58,1.16.39,2.23.95,3.21,1.69v-10.42l4.45-.85v32.02h-4.41v-2.18c-1.93,1.69-4.25,2.54-6.95,2.54Zm.58-3.87c1.3,0,2.5-.24,3.58-.71,1.08-.47,2-1.16,2.74-2.05v-10.2c-.74-.83-1.65-1.49-2.74-1.98s-2.28-.73-3.58-.73c-1.43,0-2.72.34-3.88,1.02-1.16.68-2.08,1.61-2.76,2.78-.68,1.17-1.02,2.5-1.02,3.99s.34,2.82,1.02,4.01c.68,1.19,1.6,2.13,2.76,2.83,1.16.7,2.45,1.05,3.88,1.05Z"}),(0,v.jsx)("path",{stroke:"currentColor",d:"m322.58,47.62v-31.17l4.45-.85v11.49c1.9-1.66,4.2-2.49,6.9-2.49,2.14,0,4.08.52,5.81,1.56,1.74,1.04,3.11,2.43,4.12,4.19,1.01,1.75,1.51,3.73,1.51,5.92s-.51,4.18-1.54,5.95c-1.02,1.77-2.4,3.17-4.14,4.21-1.74,1.04-3.69,1.56-5.86,1.56-1.25,0-2.46-.2-3.63-.6-1.17-.4-2.25-.97-3.23-1.72v1.96h-4.41Zm10.78-3.52c1.45,0,2.75-.34,3.9-1.02,1.14-.68,2.05-1.61,2.74-2.78.68-1.17,1.02-2.5,1.02-3.99s-.34-2.82-1.02-4.01c-.68-1.19-1.6-2.12-2.74-2.81-1.14-.68-2.44-1.02-3.9-1.02-1.28,0-2.47.24-3.56.71-1.1.47-2.02,1.14-2.76,2v10.24c.74.83,1.67,1.48,2.78,1.96,1.11.48,2.29.71,3.54.71Z"}),(0,v.jsx)("path",{stroke:"currentColor",d:"m351.35,57.2c-.47,0-.92-.02-1.34-.07s-.76-.11-1.02-.2v-3.92c.53.12,1.19.18,1.96.18,2.08,0,3.58-1.11,4.5-3.34l.98-2.18-9.08-22.71h4.94l6.59,17.28,7.3-17.28h4.81l-10.95,25.47c-.71,1.6-1.47,2.9-2.27,3.9-.8.99-1.72,1.72-2.76,2.18-1.04.46-2.26.69-3.65.69Z"}),(0,v.jsx)("path",{stroke:"currentColor",d:"m143.02,97.41v-8.49h20.13c3.08,0,5.48-.87,7.2-2.62,1.72-1.75,2.59-4.05,2.59-6.9s-.86-5.2-2.59-6.9-4.13-2.55-7.2-2.55h-26.54v42.39h-8.69v-51.17h35.23c2.9,0,5.48.43,7.76,1.28,2.27.85,4.19,2.05,5.76,3.59,1.56,1.54,2.76,3.42,3.59,5.62.83,2.21,1.24,4.69,1.24,7.46s-.42,5.19-1.24,7.42c-.83,2.23-2.03,4.15-3.59,5.77-1.56,1.61-3.48,2.86-5.76,3.76-2.27.9-4.86,1.35-7.76,1.35h-20.13Z"}),(0,v.jsx)("path",{stroke:"currentColor",d:"m210.01,112.33v-20.03l-26.61-31.14h11.79l19.51,23.13,19.58-23.13h11.17l-26.69,31.14v20.03h-8.75,0Z"}),(0,v.jsx)("path",{stroke:"currentColor",d:"m275.64,112.33v-42.4h-23.06v-8.77h54.9v8.77h-23.09v42.4h-8.75Z"}),(0,v.jsx)("path",{stroke:"currentColor",d:"m362.27,61.16h8.72v51.17h-8.72v-51.17Z"}),(0,v.jsx)("path",{stroke:"currentColor",d:"m324.63,112.33v-22.7h32.45v-7.77h-32.45v-20.7h-8.72v51.17h8.72Z"}),(0,v.jsx)("path",{stroke:"currentColor",d:"m51.17,0c-9.32,0-18.06,2.49-25.59,6.85-4.82,2.78-9.14,6.33-12.79,10.48C4.83,26.35,0,38.2,0,51.17v38.38l12.79,12.79v-51.17c0-11.36,4.94-21.58,12.79-28.61,3.69-3.3,8.03-5.9,12.79-7.58,4-1.42,8.31-2.19,12.79-2.19,21.19,0,38.38,17.18,38.38,38.38s-17.18,38.38-38.38,38.38v12.79c28.26,0,51.17-22.91,51.17-51.17S79.44,0,51.17,0Z"}),(0,v.jsx)("path",{stroke:"currentColor",d:"m63.96,51.17c0,7.06-5.73,12.79-12.79,12.79v12.79c14.13,0,25.59-11.46,25.59-25.59s-11.46-25.59-25.59-25.59c-4.66,0-9.03,1.24-12.79,3.43-7.65,4.42-12.79,12.69-12.79,22.16v63.97l11.5,11.5,1.29,1.29V51.17c0-7.06,5.73-12.79,12.79-12.79s12.79,5.73,12.79,12.79Z"})]})},w=n(64508),b=n.n(w),j=n(96343),y=n(65838),N=n(3011),P=n(78877),S=n(85394),k=n(33715),C=n(6340),Z=function(){var e=(0,y.Os)().wallet,t=(0,h.tc)(),n=t.userPositions,s=t.refreshPositionInfo,r=(0,y.Bn)().connection,a=(0,C.Z)().promptKeeperCloseAllPositionNotification,d=(0,N.KO)(k.l.isClosingAllPositions),x=(0,l.Z)(d,2),m=x[0],f=x[1],p=(0,i.useCallback)((0,o.Z)(c().mark((function t(){var i;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n&&0!==(null===n||void 0===n?void 0:n.length)){t.next=2;break}return t.abrupt("return");case 2:if(e){t.next=4;break}throw new Error("Wallet not connected");case 4:return f(!0),t.prev=5,t.next=8,Promise.all(n.map((function(t){return(0,P._L)(e,r,t)})));case 8:return i=t.sent,t.next=11,a(i.filter(Boolean));case 11:t.next=16;break;case 13:t.prev=13,t.t0=t.catch(5),console.log("Failed to close all positions!",t.t0);case 16:return t.prev=16,s(),f(!1),t.finish(16);case 20:case"end":return t.stop()}}),t,null,[[5,13,16,20]])}))),[r,a,s,f,n,e]);return(0,v.jsx)("button",{type:"button",className:"rounded-lg whitespace-nowrap px-2 py-1.5 text-white/50 text-xs bg-white/5 border border-[rgba(255,255,255,0.02)] hover:bg-white/10 disabled:opacity-50",disabled:m||0===(null===n||void 0===n?void 0:n.length),onClick:p,children:m?(0,v.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,v.jsx)(S.Z,{width:8,height:8}),(0,v.jsx)("span",{children:u.ag._("Closing...")})]}):u.ag._("Close All")})},M=f()((function(){return n.e(4710).then(n.bind(n,44710))}),{ssr:!1,loadableGenerated:{webpack:function(){return[44710]}}}),L=function(){return(0,v.jsx)("div",{className:"border-l border-l-v2-lily/5 h-full"})},T=function(e){var t=e.title,n=e.active,i=e.onClick;return(0,v.jsx)("button",{type:"button",onClick:i,className:(0,p.cn)("leading-none flex items-center font-semibold text-xs text-white/20 whitespace-nowrap","hover:!text-v2-lily",{"!text-v2-lily":n}),children:t})},_=function(e){var t=e.activeTab,n=e.setActiveTab,s=e.className,r=e.showPositions,o=e.setShowPositions,a=e.children,c=(0,h.tc)().userPositions,d=(0,i.useMemo)((function(){return(null===c||void 0===c?void 0:c.length)||0}),[null===c||void 0===c?void 0:c.length]),x=(0,j.XA)(),m=i.useState(!1),f=(0,l.Z)(m,2),w=f[0],y=f[1],N=(0,i.useRef)(null),P=(0,i.useRef)(null);return(0,i.useEffect)((function(){function e(){var e,t=(null===(e=P.current)||void 0===e?void 0:e.offsetTop)||0;N.current&&x&&window.scrollY>t?y(!0):y(!1)}return window.addEventListener("scroll",e),function(){window.removeEventListener("scroll",e)}}),[x]),(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{ref:P,className:"w-full"}),(0,v.jsx)("div",{className:(0,p.cn)(w?"pt-[44px]":"")}),(0,v.jsx)("div",{ref:N,className:(0,p.cn)("flex w-full lg:mx-auto bg-[#16202B] relative",s,w?"fixed top-0 w-full z-50":""),children:(0,v.jsx)("div",{className:"w-full max-w-full overflow-hidden",children:(0,v.jsxs)("div",{className:"lg:flex flex-row justify-between w-full border-b border-v2-lily/5",children:[(0,v.jsxs)("div",{className:"flex justify-between",children:[(0,v.jsxs)("div",{className:"flex space-x-6 justify-start items-center overflow-y-auto p-3 w-full",children:[(0,v.jsx)(T,{title:d>0?u.ag._("Positions ({0})",{0:null===c||void 0===c?void 0:c.length}):u.ag._("Positions"),active:"Positions"===t,onClick:function(){return n("Positions")}}),(0,v.jsx)(T,{title:u.ag._("Trade History"),active:"Trade History"===t,onClick:function(){return n("Trade History")}})]}),(0,v.jsx)("div",{className:"flex 2xl:hidden items-center pr-2",children:(0,v.jsx)(Z,{})})]}),(0,v.jsxs)("div",{className:"hidden lg:flex items-center px-2 gap-x-2",children:[(0,v.jsxs)("div",{className:"flex whitespace-nowrap space-x-2 items-center text-xs text-v2-lily/50",children:[(0,v.jsx)(M,{active:r,onClick:function(){return o((function(e){return!e}))}}),(0,v.jsx)("span",{children:u.ag._("Show Positions on Chart")})]}),(0,v.jsx)(L,{}),(0,v.jsx)(b(),{href:"https://pyth.network/",rel:"noopener noreferrer",target:"_blank",className:(0,p.cn)(" items-center space-x-2 justify-end px-4 py-2 text-v2-lily/50 fill-current text-xxs","pl-4"),children:(0,v.jsx)(g,{width:60,height:20})})]})]})})}),a]})},O=n(56100),F=n(6397),q=n(3082),D=function(){var e=(0,y.Bn)().tokenMap,t=(0,h.tc)().perpsTokens.nonStableTokens,n=(0,j.OC)({itemsCount:20}).data;return(0,i.useMemo)((function(){var i=Object.values(t).map((function(e){return e.address})),s=[];s=n?n.concat(i):Array.from(e.keys()).slice(0,20).concat(i);var l=new Set;return s.forEach((function(e){return l.add(e)})),Array.from(l)}),[t,e,n])},V=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"SOL-SOL",t="perps",n=(0,q.useRouter)(),s=n.isReady,r=n.query,o=n.replace,a=(0,y.Bn)(),c=a.getTokenSlug;return i.useCallback((function(n,i,a){if(s)if(n&&i){var u=c(n),d=c(i);if("string"===typeof r.inOut){var x=r.inOut.split("-"),m=(0,l.Z)(x,2),f=m[0],p=m[1],h=r.direction;f===u&&p===d&&h===a||o({pathname:"/".concat(t,"/").concat(a,"/").concat(u,"-").concat(d)},void 0,{scroll:!1,shallow:!0})}}else o({pathname:"/".concat(t,"/").concat(a,"/").concat(e)},void 0,{scroll:!1,shallow:!0})}),[s,c,r.inOut,r.direction,o,e])},A=n(73360),I=n(71048),U=n(69825),R=n(43231),E=n(65558),z=n.n(E),B=n(12197),K=n(54566),$=n(31781),W=function(e){var t=e.disabled,n=e.amount,s=e.fromTokenInfo,l=e.toTokenInfo,r=e.slippage,o=(0,i.useMemo)((function(){return Math.ceil(100*Number(r))}),[r]),a=(0,i.useMemo)((function(){return{amount:n,inputMint:t||null===s||void 0===s||!s.address?void 0:new R.PublicKey(s.address),outputMint:t||null===l||void 0===l||!l.address?void 0:new R.PublicKey(l.address),slippageBps:o,maxAccounts:45,disabledProgramIds:["jupoNjAxXgZ4rjzxzPMP4oxduvQsQtZzyknqvzYNrNu"]}}),[n,t,s,l,o]),c=(0,$.OO)(a),u=c.quoteResponseMeta,d=c.loading,x=c.refresh,m=c.error,f=c.lastRefreshTimestamp,p=(0,i.useMemo)((function(){return{outAmount:null===u||void 0===u?void 0:u.quoteResponse.outAmount,otherAmountThreshold:null===u||void 0===u?void 0:u.quoteResponse.otherAmountThreshold,isLoading:!t&&d}}),[t,d,u]),h=p.outAmount,v=p.otherAmountThreshold;return{isLoading:p.isLoading,outAmount:h,otherAmountThreshold:v,quoteResponseMeta:u,useJupError:m,refresh:x,lastRefreshTimestamp:f}},H=n(9319),G=n.n(H),Y=n(49729),J=n(12866),Q=n(74518),X=function(e){var t=e.changePct,n=e.pnl;if(!t||!n)return(0,v.jsx)(O.O,{className:"!w-12 !h-4"});var i=n.abs().div(1e6).toFixed(2),s=t.toDP(2).abs().toFixed(2);return(0,v.jsx)("p",{className:(0,p.cn)("text-xs",n.gt(0)?"text-perps-green":"text-perps-red"),children:n.gt(0)?"+$".concat(i," (+").concat(s,"%)"):"-$".concat(i," (-").concat(s,"%)")})},ee=n(88381),te=n(80751),ne=n(25546),ie=n(71130),se=new x.Z(100),le=function(e){var t,n,s,l,r,a,m,f,g=e.open,w=e.onClose,b=e.positionAccount,j=(0,h.tc)(),N=j.viewClient,k=j.slippage,Z=j.oraclePrices,M=j.refreshPositionInfo,L=(0,y.Bn)(),T=L.connection,_=L.getTokenInfo,q=L.tokenMap,D=(0,y.Os)().wallet,V=(0,C.Z)().promptKeeperClosePositionNotification,E=(0,i.useMemo)((function(){var e;return null!==(e=_(b.custody.account.mint.toString()))&&void 0!==e?e:F.mq}),[_,b.custody.account.mint]),$=i.useRef(null);(0,B.O3)($,(function(){var e;return null===(e=$.current)||void 0===e?void 0:e.close()}));var H=(0,i.useCallback)((function(){var e;null===(e=$.current)||void 0===e||e.close(),w()}),[w,$]);(0,i.useEffect)((function(){if($.current&&(g?$.current.open||$.current.show():$.current.close()),g){var e=$.current;return null===e||void 0===e||e.addEventListener("close",H),function(){null===e||void 0===e||e.removeEventListener("close",H)}}}),[H,g]);var le=(0,i.useMemo)((function(){return _(b.collateralCustody.account.mint.toString())}),[_,b.collateralCustody.account.mint]),re=(0,i.useState)(!0),oe=re[0],ae=(re[1],(0,i.useMemo)((function(){return b.sizeUsd.div(1e6).toNearest(1e-4,x.Z.ROUND_DOWN).toString()}),[b.sizeUsd])),ce=(0,I.cI)({defaultValues:{amount:ae}}),ue=ce.control,de=ce.handleSubmit,xe=ce.watch,me=ce.setValue,fe=ce.formState,pe=xe("amount"),he=(0,i.useCallback)((function(e){var t=new x.Z(ae).mul(e).div(100).toString();me("amount",t)}),[ae,me]),ve=(0,i.useMemo)((function(){if((0,B.Hd)(pe)&&ae)return new x.Z(pe).gt(ae)}),[pe,ae]),ge=(0,i.useMemo)((function(){return Boolean(b.accounting)}),[b.accounting]),we=(0,i.useMemo)((function(){if(!(0,B.Hd)(pe)||!b.accounting)return[!1,null,null];var e=new x.Z(0),t=b.sizeUsd.sub(new x.Z(pe).mul(1e6)).lt(se),n=t?b.sizeUsd:new x.Z(pe).mul(1e6),i=b.accounting.unrealizedPNL;if(t)e=new x.Z(0);else if(oe&&n&&!t){var s=n.div(b.sizeUsd);if(e=b.accounting.initialCollateral.mul(s),b.accounting.pnlAfterFeesUsd.lt(0)){var l=i.mul(-1).add(b.accounting.closePositionFeeUsd).mul(s).add(b.accounting.fundingFeeUsd);e=e.gt(l)?e.sub(l):new x.Z(0)}}return[t,e,n]}),[pe,b.accounting,b.sizeUsd,oe]),be=we[0],je=we[1],ye=we[2],Ne=(0,d.a)([be,null===je||void 0===je?void 0:je.toString(),null===ye||void 0===ye?void 0:ye.toString(),E.address,pe,oe,ae,null===le||void 0===le?void 0:le.address,b.publicKey.toString()],(0,o.Z)(c().mark((function e(){var t,n,i,s;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(je&&ye&&(0,B.Hd)(pe)&&!ye.lte(0)&&le&&N){e.next=2;break}return e.abrupt("return",null);case 2:if(!new x.Z(pe).gt(ae)){e.next=4;break}return e.abrupt("return",null);case 4:return e.next=6,N.getDecreasePosition({position:b,collateralUsdDelta:new(z())(je.round().toFixed()),sizeUsdDelta:new(z())(ye.round().toFixed())});case 6:if(t=e.sent){e.next=9;break}throw new Error("Failed to get decrease position");case 9:return n=new x.Z(t.liquidationPrice.toString()),i=b.sizeUsd.sub(ye),s=new x.Z(t.collateralUsd.toString()),e.abrupt("return",{liquidationPrice:be?null:n,size:i,collateralUsd:s.div(1e6),fees:new x.Z(t.feeUsd.toString()).div(1e6),leverage:i.div(s).toNearest(.01,x.Z.ROUND_DOWN),transferToken:new x.Z(t.transferToken.toString()).div(Math.pow(10,le.decimals)),transferAmountUsd:new x.Z(t.transferAmountUsd.toString()).div(1e6).toDP(2)});case 13:case"end":return e.stop()}}),e)}))),{enabled:Boolean(N&&le),retry:3,retryDelay:500}),Pe=Ne.data,Se=Ne.isLoading,ke=Ne.isLoadingError,Ce=(0,i.useMemo)((function(){return!!Pe&&(!be&&!oe&&new x.Z(Pe.leverage).lt(1))}),[Pe,be,oe]),Ze=(0,i.useMemo)((function(){var e=[];return ve&&e.push(u.ag._("Max close amount exceeded")),Ce&&e.push(u.ag._("Minimum 1x leverage")),e}),[ve,Ce]),Me=(0,i.useState)(le||null),Le=Me[0],Te=Me[1],_e=(0,i.useState)(null),Oe=_e[0],Fe=_e[1];(0,i.useEffect)((function(){!Le&&le&&Pe&&Fe(Pe.transferToken)}),[le,Pe,null===Pe||void 0===Pe?void 0:Pe.transferAmountUsd,null===Pe||void 0===Pe?void 0:Pe.transferToken,Le]);var qe=(0,i.useState)(!1),De=qe[0],Ve=qe[1],Ae=i.useCallback((function(e){Ve(!1),Te(e)}),[]),Ie=(0,i.useMemo)((function(){return Array.from(q.keys())}),[q]),Ue=(0,i.useMemo)((function(){return{isTokenSwapRequired:(null===le||void 0===le?void 0:le.address)!==(null===Le||void 0===Le?void 0:Le.address),amount:Oe&&Le&&le&&Pe?G().BigInt(Pe.transferToken.mul(Math.pow(10,le.decimals)).toFixed()):G().BigInt(0),fromTokenInfo:le}}),[le,Pe,Oe,Le]),Re=W({disabled:!Ue.isTokenSwapRequired,amount:Ue.amount,fromTokenInfo:Ue.fromTokenInfo,toTokenInfo:Le,slippage:k}),Ee=Re.outAmount,ze=Re.otherAmountThreshold,Be=Re.isLoading,Ke=(0,i.useMemo)((function(){return ve||fe.isSubmitting||Ce||Ue.isTokenSwapRequired&&Be||!(0,B.Hd)(pe)||Number(pe)<=0}),[ve,fe.isSubmitting,Ce,Ue.isTokenSwapRequired,Be,pe]),$e=(0,i.useMemo)((function(){var e,t;return Z&&Z[E.address]?"long"===b.side?null===(e=Z[E.address])||void 0===e?void 0:e.decreaseLong:null===(t=Z[E.address])||void 0===t?void 0:t.decreaseShort:null}),[Z,b.side,E.address]),We=(0,i.useCallback)(function(){var e=(0,o.Z)(c().mark((function e(t){var n,i,s,l,r,a;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Ke&&D){e.next=2;break}return e.abrupt("return");case 2:return n=ge&&je?new(z())(je.round().toFixed()):new(z())(0),i=ge&&ye?new(z())(ye.round().toFixed()):new(z())(b.sizeUsd.round().toFixed()),s="long"===b.side?new(z())(0):new(z())("18446744073709551615"),e.prev=5,e.next=8,(0,P.e9)({wallet:D,connection:T,position:b,priceSlippage:s,collateralUsdDelta:n,sizeUsdDelta:i,desiredMint:Ue.isTokenSwapRequired&&Le?new R.PublicKey(Le.address):b.collateralCustody.account.mint,jupiterMinimumOut:Ue.isTokenSwapRequired&&ze?new(z())(ze.toString()):null});case 8:return l=e.sent,r=l.instructions,a=l.positionRequestKey,e.next=13,new Promise(function(){var e=(0,o.Z)(c().mark((function e(t,n){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,V(r,a,(function(e){H(),M(),t(e)}),(function(e){n(e)}));case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 13:return e.abrupt("return",e.sent);case 16:e.prev=16,e.t0=e.catch(5),console.log("Failed to close position!",e.t0);case 19:case"end":return e.stop()}}),e,null,[[5,16]])})));return function(t){return e.apply(this,arguments)}}(),[Ke,D,ge,je,b,T,ye,Ue.isTokenSwapRequired,Le,ze,V,H,M]),He=(0,i.useMemo)((function(){if(Le&&Pe)return Ue.isTokenSwapRequired?Ee?new x.Z(Ee.toString()||0).div(Math.pow(10,Le.decimals)).toString():void 0:Pe.transferToken.toString()}),[Pe,Ee,Le,Ue.isTokenSwapRequired]);return(0,v.jsx)(te.Z,{open:g,onClose:w,children:(0,v.jsxs)("form",{className:"relative w-full lg:max-w-[400px] bg-v2-perps-modal rounded-lg",children:[(0,v.jsx)("div",{className:"p-4 lg:p-6 mb-2 lg:mb-0 font-semibold leading-none lg:text-lg text-v2-lily",children:u.ag._("Close Position")}),(0,v.jsx)("div",{className:"flex absolute top-5 lg:top-8 right-8 z-10 text-v2-lily/[.25] fill-current cursor-pointer",onClick:H,children:(0,v.jsx)(J.Z,{width:12,height:12})}),De?(0,v.jsx)("div",{className:"absolute top-0 left-0 w-full h-full z-50",children:(0,v.jsx)(Y.Z,{onSubmit:Ae,onClose:function(){return Ve(!1)},mintsList:Ie,suppressCloseModal:!0,customStyle:{width:"100%",height:"100%"}})}):null,(0,v.jsxs)("div",{className:"max-h-[80vh] overflow-y-auto",children:[(0,v.jsxs)("div",{className:"px-4 lg:px-6",children:[(0,v.jsxs)("div",{className:"rounded-lg bg-v2-lily/5 border border-v2-lily/[.15] p-4 lg:p-5",children:[(0,v.jsxs)("div",{className:"flex items-center justify-between text-sm font-semibold",children:[(0,v.jsxs)("div",{className:"flex space-x-2 items-center",children:[(0,v.jsx)(Q.Z,{info:E,width:24,height:24}),(0,v.jsx)(A.cC,{id:"<0>{0} Price:</0>",values:{0:E.symbol},components:{0:(0,v.jsx)("span",{})}})]}),(0,v.jsxs)("span",{className:"text-sm font-semibold",children:[null===$e||void 0===$e?void 0:$e.toFixed(2).toString()," USD"]})]}),(0,v.jsx)("div",{className:"border-b border-v2-lily/5 my-3 lg:my-4"}),(0,v.jsxs)("div",{className:"space-y-2",children:[(0,v.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,v.jsx)("span",{className:"text-white/40",children:u.ag._("Current Position Size")}),(0,v.jsxs)("span",{className:"text-white/[.75]",children:["$",b.sizeUsd.div(1e6).toFixed(2)]})]}),(0,v.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,v.jsx)("span",{className:"text-white/40",children:u.ag._("Entry Price")}),(0,v.jsxs)("span",{className:"text-white/[.75]",children:["$",b.price.div(1e6).toFixed(2)]})]}),(0,v.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,v.jsx)("span",{className:"text-white/40",children:u.ag._("Liquidation Price")}),(0,v.jsxs)("span",{className:"text-white/[.75]",children:["$",null===(t=b.accounting)||void 0===t?void 0:t.liquidationPrice.div(1e6).toFixed(2)]})]}),(0,v.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,v.jsx)("span",{className:"text-white/40",children:u.ag._("Current Leverage")}),(0,v.jsxs)("span",{className:"text-white/[.75]",children:[b.leverage.toFixed(2),"x"]})]}),(0,v.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,v.jsx)("span",{className:"text-white/40",children:u.ag._("Current P&L")}),(0,v.jsx)(X,{changePct:null===(n=b.accounting)||void 0===n?void 0:n.unrealizedPNLPct,pnl:null===(s=b.accounting)||void 0===s?void 0:s.unrealizedPNL})]}),(0,v.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,v.jsx)("span",{className:"text-white/40",children:u.ag._("Total Fees")}),(0,v.jsxs)("span",{className:"text-white/[.75]",children:["$",ne.uf.format(null===(l=b.accounting)||void 0===l?void 0:l.totalFeeUsd.div(1e6))]})]}),(0,v.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,v.jsx)("span",{className:"text-white/40",children:u.ag._("Net P&L")}),(0,v.jsx)("span",{className:"text-white/[.75]",children:(0,v.jsx)(X,{changePct:null===(r=b.accounting)||void 0===r?void 0:r.pnlAfterFeesPct,pnl:null===(a=b.accounting)||void 0===a?void 0:a.pnlAfterFeesUsd})})]})]})]}),(0,v.jsx)("div",{className:"mt-5",children:(0,v.jsxs)("div",{className:"flex justify-between items-end leading-none",children:[(0,v.jsx)("div",{className:"text-v2-lily text-sm font-semibold",children:u.ag._("Close size:")}),ge?(0,v.jsxs)("div",{className:"flex space-x-1",children:[(0,v.jsx)("button",{type:"button",onClick:function(){return he(25)},className:"border rounded-md border-v2-lily/10 hover:border-v2-lily/20 text-v2-lily/[0.35] hover:text-v2-lily/50 text-xxs px-1.5 py-0.5 font-semibold",children:"25%"}),(0,v.jsx)("button",{type:"button",onClick:function(){return he(50)},className:"border rounded-md border-v2-lily/10 hover:border-v2-lily/20 text-v2-lily/[0.35] hover:text-v2-lily/50 text-xxs px-1.5 py-0.5 font-semibold",children:"50%"}),(0,v.jsx)("button",{type:"button",onClick:function(){return he(75)},className:"border rounded-md border-v2-lily/10 hover:border-v2-lily/20 text-v2-lily/[0.35] hover:text-v2-lily/50 text-xxs px-1.5 py-0.5 font-semibold",children:"75%"}),(0,v.jsx)("button",{type:"button",onClick:function(){return he(100)},className:"border rounded-md border-v2-lily/10 hover:border-v2-lily/20 text-v2-lily/[0.35] hover:text-v2-lily/50 text-xxs px-1.5 py-0.5 font-semibold",children:"100%"})]}):(0,v.jsx)("div",{className:"text-v2-lily text-xs font-semibold",children:u.ag._("Only full close possible")})]})}),(0,v.jsx)("div",{className:"mt-2 rounded-lg bg-v2-perps-input pl-2 pr-4 py-3.5 text-md text-right",children:(0,v.jsx)(I.Qr,{name:"amount",control:ue,render:function(e){var t=e.field,n=t.onChange,i=t.value;return(0,v.jsx)(U.Z,{disabled:new x.Z(ae).lte(0)&&!ge,decimals:6,onChange:function(e){var t=e.value;e.floatValue&&new x.Z(t).greaterThan(ae)?n(ae):n(t)},value:ge?i:ae,className:(0,p.cn)("!outline-none !text-right w-full",ge?"":"cursor-not-allowed"),placeholder:"0.00",suffix:" USD"})}})}),Ze.length>0?Ze.map((function(e,t){return(0,v.jsx)("div",{className:"text-xs mt-2 text-warning",children:e},t)})):null,(0,v.jsx)("div",{className:"mt-5",children:(0,v.jsx)("div",{className:"text-v2-lily text-sm font-semibold",children:u.ag._("Receive in:")})}),(0,v.jsxs)("div",{className:"mt-2 rounded-lg bg-v2-perps-input p-4 text-md text-right flex h-18",children:[(0,v.jsxs)("div",{className:(0,p.cn)("  px-2 py-1.5 rounded-lg  flex items-center"),children:[(0,v.jsx)("div",{className:"w-7 h-7",children:Le?(0,v.jsx)(Q.Z,{info:Le,width:28,height:28}):null}),(0,v.jsx)("span",{className:"ml-3 font-semibold text-sm",children:null===Le||void 0===Le?void 0:Le.symbol})]}),(0,B.Hd)(pe)&&0!==Number(pe)?(0,v.jsxs)("div",{className:"flex flex-col w-full relative",children:[(0,v.jsx)(U.Z,{className:"!text-base disabled:cursor-not-allowed !outline-none !text-right",disabled:!0,decimals:null===Le||void 0===Le?void 0:Le.decimals,value:He||void 0,suffix:" "+(null===Le||void 0===Le?void 0:Le.symbol)}),Le?(0,v.jsx)("div",{className:(0,p.cn)("text-xs text-black-35 dark:text-white-35 relative"),children:(0,v.jsx)(K.default,{tokenInfo:Le,amount:Number(He)})}):null,Se||ke?(0,v.jsx)(O.O,{className:"absolute right-0 top-0 !h-full"}):null]}):(0,v.jsx)("div",{className:"w-full flex items-center justify-end text-xs text-white/50 cursor-not-allowed",children:u.ag._("Please enter close size")})]}),ke?(0,v.jsx)(ie.Z,{iconSize:14,className:"!text-warning !p-2 mt-2 rounded-lg bg-warning/10",message:(0,v.jsx)(A.cC,{id:"<0>Failed to simulate output amount, you can still attempt to close your position.</0>",components:{0:(0,v.jsx)("p",{})}})}):null,(0,v.jsxs)("div",{className:"mt-5 space-y-2",children:[(0,v.jsxs)("div",{className:"flex justify-between text-white/50 text-xs",children:[(0,v.jsx)("span",{children:u.ag._("Size")}),(0,v.jsx)("div",{children:null!==Pe&&void 0!==Pe&&Pe.size?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("span",{children:["$",b.sizeUsd.div(1e6).toFixed(2)]}),(0,v.jsx)("span",{className:"px-1 text-white/[.75]",children:"\u2192"}),(0,v.jsxs)("span",{className:"text-white/[.75]",children:["$",Pe.size.div(1e6).toFixed(2)]})]}):(0,v.jsxs)("span",{children:["$",b.sizeUsd.div(1e6).toFixed(2)]})})]}),(0,v.jsxs)("div",{className:"flex justify-between text-white/50 text-xs",children:[(0,v.jsx)("span",{children:u.ag._("Collateral")}),(0,v.jsx)("div",{children:null!==Pe&&void 0!==Pe&&Pe.collateralUsd?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("span",{children:["$",null===(m=b.accounting)||void 0===m?void 0:m.initialCollateral.div(1e6).toFixed(2)]}),(0,v.jsx)("span",{className:"px-1 text-white/[.75]",children:"\u2192"}),(0,v.jsxs)("span",{className:"text-white/[.75]",children:["$",Pe.collateralUsd.toFixed(2)]})]}):(0,v.jsxs)("span",{children:["$",null===(f=b.accounting)||void 0===f?void 0:f.initialCollateral.div(1e6).toFixed(2)]})})]}),oe?null:(0,v.jsxs)("div",{className:"flex justify-between text-white/50 text-xs",children:[(0,v.jsx)("span",{children:u.ag._("Leverage")}),(0,v.jsxs)("div",{children:[(0,v.jsxs)("span",{children:[b.leverage.toFixed(2),"x"]}),(0,v.jsx)("span",{className:"px-1 text-white",children:"\u2192"}),(0,v.jsxs)("span",{className:"text-white",children:[null===Pe||void 0===Pe?void 0:Pe.leverage.toFixed(2),"x"]})]})]}),(0,v.jsxs)("div",{className:"flex items-center justify-between text-white/50 text-xs max-h-[16px] overflow-hidden",children:[(0,v.jsx)("span",{children:u.ag._("Close & Borrow Fees")}),(0,v.jsxs)("span",{className:"flex items-center",children:["$",(0,v.jsx)(ee.ZP,{value:(null===Pe||void 0===Pe?void 0:Pe.fees.toNumber())||0})]})]})]})]}),(0,v.jsxs)("div",{className:"w-full text-xs flex p-6 space-x-3",children:[fe.isSubmitting?null:(0,v.jsx)("button",{type:"button",className:(0,p.cn)("w-full py-2.5 px-6 border rounded-lg border-v2-lily/10 text-v2-lily bg-v2-lily/5 hover:bg-v2-lily/10 text-sm font-semibold disabled:cursor-not-allowed disabled:opacity-20",{"opacity-50 curosr-not-allowed":fe.isSubmitting}),disabled:fe.isSubmitting,onClick:H,children:(0,v.jsx)("span",{children:u.ag._("Cancel")})}),(0,v.jsx)("button",{type:"button",className:(0,p.cn)("w-full py-2.5 px-6 border rounded-lg border-labs/20 text-labs hover:bg-labs/5 text-sm font-semibold disabled:cursor-not-allowed disabled:opacity-20",{"opacity-50 curosr-not-allowed":fe.isSubmitting||Ke}),disabled:Ke,onClick:de(We),children:fe.isSubmitting?(0,v.jsxs)("span",{className:"flex justify-center items-center",children:[(0,v.jsx)(S.Z,{className:"!h-4 !w-4",baseColor:"white",spinnerColor:"black"}),(0,v.jsx)("div",{className:"mr-2"}),u.ag._("Closing position")]}):(0,v.jsx)("span",{className:"text-center",children:u.ag._("Confirm")})})]})]})]})})},re=function(e){var t=e.open,n=e.onClose,s=e.positionAccountPubkey,l=(0,h.tc)().userPositions,r=(0,i.useMemo)((function(){return null===l||void 0===l?void 0:l.find((function(e){return e.publicKey.equals(s)}))}),[s,l]);return r?(0,v.jsx)(le,{open:t,onClose:n,positionAccount:r}):null},oe=n(70107),ae=n(94223),ce=n(63956),ue=n(57565),de=n(67982),xe=n(13170),me=n(8770),fe=n(50992),pe=n(795).Buffer;function he(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function ve(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?he(Object(n),!0).forEach((function(t){(0,ce.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):he(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ge(e){return we.apply(this,arguments)}function we(){return(we=(0,o.Z)(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",be(ve(ve({},t),{},{requestType:"market",triggerAboveThreshold:null,triggerPrice:null})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function be(e){return je.apply(this,arguments)}function je(){return(je=(0,o.Z)(c().mark((function e(t){var n,i,s,r,o,a,u,d,x,m,f,p,v,g,w,b,j,y,N,P,S,k,C,Z,M,L;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.wallet,i=t.connection,s=t.side,r=t.collateralCustody,o=t.positionCustody,a=t.inputMint,u=t.requestType,d=t.sizeUsdDelta,x=t.collateralTokenDelta,m=t.priceSlippage,f=t.triggerAboveThreshold,p=t.jupiterMinimumOut,v=t.triggerPrice,g=n.adapter.publicKey){e.next=4;break}throw new Error("Wallet not connected");case 4:return w=(0,me.h)(n,i),e.next=7,(0,fe.c1)(a,g,i);case 7:if(b=e.sent,j=(0,l.Z)(b,2),y=j[0],N=j[1],P=R.PublicKey.findProgramAddressSync([pe.from("position"),g.toBuffer(),h.FW.toBuffer(),o.publicKey.toBuffer(),r.publicKey.toBuffer(),"long"===s?[1]:[2]],w.programId)[0],S=new ue.BN(Math.floor(1e9*Math.random())),k=R.PublicKey.findProgramAddressSync([pe.from("position_request"),P.toBuffer(),S.toArrayLike(pe,"le",8),[1]],w.programId)[0],C=R.PublicKey.findProgramAddressSync([k.toBuffer(),de.TOKEN_PROGRAM_ID.toBuffer(),a.toBuffer()],de.ASSOCIATED_TOKEN_PROGRAM_ID)[0],Z=[],M=[],e.prev=17,a.equals(xe.W4)&&(N&&Z.push(N),Z.push(R.SystemProgram.transfer({fromPubkey:g,toPubkey:y,lamports:BigInt(x.toString())})),Z.push(de.Token.createSyncNativeInstruction(de.TOKEN_PROGRAM_ID,y)),M.push(de.Token.createCloseAccountInstruction(de.TOKEN_PROGRAM_ID,y,g,g,[]))),"market"!==u){e.next=27;break}if(m){e.next=22;break}throw"Slippage not set";case 22:return e.next=24,w.methods.createIncreasePositionMarketRequest({sizeUsdDelta:d,collateralTokenDelta:x,side:"long"===s?{long:{}}:{short:{}},priceSlippage:m,jupiterMinimumOut:p,counter:S}).accounts({owner:g,fundingAccount:y,perpetuals:h.TJ,pool:h.FW,position:P,positionRequest:k,positionRequestAta:C,custody:o.publicKey,collateralCustody:r.publicKey,inputMint:a,referral:null}).instruction();case 24:L=e.sent,e.next=30;break;case 27:return e.next=29,w.methods.createIncreasePositionRequest({collateralTokenDelta:x,sizeUsdDelta:d,side:"long"===s?{long:{}}:{short:{}},requestType:{trigger:{}},priceSlippage:m,jupiterMinimumOut:p,triggerPrice:v,triggerAboveThreshold:f,counter:S}).accounts({owner:g,fundingAccount:y,perpetuals:h.TJ,pool:h.FW,position:P,positionRequest:k,positionRequestAta:C,custody:o.publicKey,custodyOracleAccount:o.account.oracle.oracleAccount,collateralCustody:r.publicKey,inputMint:a,referral:null}).instruction();case 29:L=e.sent;case 30:return e.abrupt("return",{instructions:[].concat(Z,[L],M),positionRequestKey:k});case 33:throw e.prev=33,e.t0=e.catch(17),console.log(e.t0),e.t0;case 37:case"end":return e.stop()}}),e,null,[[17,33]])})))).apply(this,arguments)}function ye(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Ne(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ye(Object(n),!0).forEach((function(t){(0,ce.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ye(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Pe=function(e){var t=e.fromPairTokenInfo,n=e.toPairTokenInfo,s=e.fromPairValue,l=(0,h.tc)().slippage,r=(0,i.useMemo)((function(){return!(!t||!n)&&t.address!==n.address}),[t,n]),o=(0,i.useMemo)((function(){return(0,B.Hd)(s)&&t?G().BigInt(new x.Z(s).mul(Math.pow(10,t.decimals)).round().toFixed()||0):G().BigInt(0)}),[s,t]),a=W({disabled:!r,amount:o,fromTokenInfo:t,toTokenInfo:n,slippage:l}),c=a.isLoading,d=a.outAmount,m=a.otherAmountThreshold,f=a.quoteResponseMeta,p=a.useJupError,v=a.refresh,g=a.lastRefreshTimestamp,w=(0,i.useMemo)((function(){if(r&&p)return u.ag._("We're having trouble finding route for this trade. Please try again with different amount or other token.")}),[p,r]);return{isLoading:!!r&&c,isTokenSwapRequired:r,outAmount:d,otherAmountThreshold:m,quoteResponseMeta:f,hasJupiterError:w,refresh:v,lastRefreshTimestamp:g}},Se=n(40558),ke=n(35569),Ce=n(69667),Ze=function(e){var t,n,s=e.positionAccount,l=e.onClose,r=(0,y.y6)().tokenPriceMap,a=(0,h.tc)(),d=a.viewClient,m=a.oraclePrices,f=(0,C.Z)().promptKeeperIncreaseCollateralNotification,g=s.collateralCustody,w=s.custody,b=s.side,N=s.sizeUsd,P=s.accounting,k=s.leverage,Z=(0,y.Bn)(),M=Z.connection,L=Z.getTokenInfo,T=(Z.tokenMap,(0,y.Os)().wallet),_=(0,I.cI)({defaultValues:{amount:{formattedValue:"",value:"",floatValue:0}}}),O=_.control,F=_.handleSubmit,q=_.watch,D=_.setValue,V=_.formState,A=q("amount"),E=(0,i.useMemo)((function(){return L(g.account.mint.toString())}),[L,g.account.mint]),$=(0,i.useMemo)((function(){if(!m||!E)return[null,null];var e=m[w.account.mint.toString()],t=m[E.address];return e&&t?"long"===b?[e.increaseLong,t.increaseLong]:[e.increaseShort,t.increaseShort]:[null,null]}),[m,E,w.account.mint,b]),W=$[0],H=$[1],G=(0,i.useState)(E||null),J=G[0],ee=G[1],te=(0,i.useState)(!1),ie=te[0],se=te[1],le=i.useCallback((function(e){se(!1),ee(e),D("amount",{formattedValue:"",value:"",floatValue:0})}),[D]),re=(0,j.FB)((null===J||void 0===J?void 0:J.address)||"").balance,ce=Pe({fromPairTokenInfo:J,toPairTokenInfo:E,fromPairValue:A.value}),ue=ce.isLoading,de=ce.isTokenSwapRequired,me=ce.outAmount,fe=ce.otherAmountThreshold,pe=(ce.quoteResponseMeta,(0,i.useMemo)((function(){var e,t,n=null===(e=r[(null===J||void 0===J?void 0:J.address)||""])||void 0===e?void 0:e.usd,i=null===(t=r[(null===E||void 0===E?void 0:E.address)||""])||void 0===t?void 0:t.usd;return n&&i?{inTokenPrice:n,outTokenPrice:i,selectedTokenRate:i/n}:{inTokenPrice:null,outTokenPrice:null,selectedTokenRate:null}}),[J,E,r])),he=pe.inTokenPrice,ve=(pe.outTokenPrice,pe.selectedTokenRate),we=(0,i.useMemo)((function(){if(!P||!W||!H||!J)return new x.Z(0);if(de){if(!ve)return new x.Z(0);var e=P.fundingFeeUsd.div(1e6).gte(50)?1.01:1.005;return P.fundingFeeUsd.div(1e6).mul(e).div(he).toDP(J.decimals)}return P.fundingFeeUsd.div(1e6).div(H).toDP(J.decimals)}),[P,H,he,de,J,ve,W]),be=(0,i.useMemo)((function(){return W&&H&&P&&E?N.div(h.aY).sub(P.initialCollateral).add(P.fundingFeeUsd).div(H).toDP(E.decimals):new x.Z(0)}),[P,E,H,N,W]),je=(0,i.useMemo)((function(){if(!W||!H||!P||!E||!J)return new x.Z(0);var e=de&&ve,t=e?be.div(1e6).mul(ve):be.div(1e6);return e?t.mul(.999).toDP(J.decimals):t.toDP(E.decimals)}),[W,H,P,E,J,de,ve,be]),ye=(0,i.useCallback)((function(){D("amount",{formattedValue:we.toFixed(),value:we.toFixed(),floatValue:we.toNumber()})}),[we,D]),Ne=(0,i.useCallback)((function(){D("amount",{formattedValue:je.toFixed(),value:je.toFixed(),floatValue:je.toNumber()})}),[je,D]),Ze=(0,i.useMemo)((function(){if(null===T||void 0===T||!T.adapter.connected)return!1;if((null===J||void 0===J?void 0:J.address)!==xe.W4.toBase58())return!1;var e=re-xe.WO;return new x.Z(A.floatValue||0).gt(e)}),[re,A.floatValue,null===J||void 0===J?void 0:J.address,null===T||void 0===T?void 0:T.adapter.connected]),Me=(0,i.useMemo)((function(){return new x.Z(we).gt(re)}),[re,we]),Le=(0,i.useMemo)((function(){return!!A.floatValue&&new x.Z(A.floatValue).gt(re)}),[A,re]),Te=(0,i.useMemo)((function(){if(A.floatValue){if(de&&ve){var e=be.div(1e6).mul(ve);return new x.Z(A.floatValue).gt(e)}return A.floatValue&&be?new x.Z(A.floatValue).gt(be.div(1e6)):void 0}}),[A.floatValue,de,be,ve]),_e=(0,i.useMemo)((function(){if(A.floatValue&&je)return new x.Z(A.floatValue).gt(je)}),[A,je]),Oe=(0,i.useMemo)((function(){return k.lte(h.aY)}),[k]),Fe=(0,i.useMemo)((function(){if(A.floatValue&&we)return new x.Z(A.floatValue).lt(we.mul(.999))}),[we,A.floatValue]),qe=(0,i.useMemo)((function(){var e=[];return Me?(e.push(u.ag._("Minimum deposit required is greater than your balance.")),e):(Le&&e.push(u.ag._("Insufficient balance.")),Te&&e.push(u.ag._("Minimum leverage of {MINIMUM_LEVERAGE}x is required",{MINIMUM_LEVERAGE:h.aY})),_e&&e.push(u.ag._("Over allowed amount of {allowedMaxAmount} {0}",{0:null===J||void 0===J?void 0:J.symbol,allowedMaxAmount:je})),Fe&&e.push(u.ag._("Minimum deposit of {0} {1} is required.",{0:ne.uf.format(we),1:null===J||void 0===J?void 0:J.symbol})),Ze&&e.push(u.ag._("We recommend having at least {MINIMUM_SOL_BALANCE} SOL for any transaction",{MINIMUM_SOL_BALANCE:xe.WO})),e)}),[je,Le,Fe,Te,we,Me,_e,Ze,null===J||void 0===J?void 0:J.symbol]),De=(0,i.useMemo)((function(){return Me||Le||V.isSubmitting||_e||je.lte(0)||qe.length>0||Oe||Fe}),[Me,Le,V.isSubmitting,_e,je,qe.length,Oe,Fe]),Ve=(0,i.useState)(null),Ae=Ve[0],Ie=Ve[1];(0,i.useEffect)((function(){!J&&E&&ee(E)}),[E,J]),(0,i.useEffect)((function(){(0,o.Z)(c().mark((function e(){var t,n,i,l,r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(P&&A.floatValue&&E&&d&&!(qe.length>0)&&W){e.next=3;break}return Ie(null),e.abrupt("return");case 3:if(!de||!ue){e.next=5;break}return e.abrupt("return");case 5:if(!new x.Z(A.floatValue).gt(je)){e.next=7;break}return e.abrupt("return");case 7:return n=J&&fe?new(z())(fe.toString()):new(z())((0,B.ks)(A.floatValue,E.decimals)),e.next=10,d.getIncreasePosition({collateral:n,sizeUsdDelta:new(z())(0),side:b,custody:w,positionAccount:s,collateralCustody:g});case 10:if(t=e.sent){e.next=13;break}return e.abrupt("return");case 13:i=new x.Z(t.liquidationPrice.toString()),l=new x.Z(t.collateralUsd.toString()),r=function(){var e=new x.Z(t.collateralUsd.toString()).minus(P.initialCollateral.toString()).div(1e6);return new x.Z(P.positionValue.toString()).add(e)}(),Ie({liquidationPrice:new x.Z(i.toString()).div(1e6),collateralUsd:l.div(1e6),leverage:new x.Z(N).div(l).toNearest(.01,x.Z.ROUND_DOWN),transferToken:new x.Z(0),transferAmountUsd:new x.Z(0),fundingFeeUsd:x.Z.max(0,new x.Z(P.fundingFeeUsd).minus(new x.Z(n.toString()).div(Math.pow(10,E.decimals)).mul(1e6).mul(W))),positionValue:r});case 17:case"end":return e.stop()}}),e)})))()}),[A,d,E,je,qe,J,fe,de,me,ue,s,g.account,w.account,P,b,N,w,g,W]);var Ue=(0,i.useCallback)((0,o.Z)(c().mark((function e(){var t,n,i;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(T&&E&&J&&A.floatValue){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,ge({wallet:T,connection:M,side:b,collateralCustody:g,positionCustody:w,inputMint:new R.PublicKey(J.address),priceSlippage:new(z())(0),collateralTokenDelta:new(z())((0,B.ks)(Number(A.floatValue),J.decimals)),sizeUsdDelta:new(z())(0),jupiterMinimumOut:de&&fe?new(z())(fe.toString()):null});case 5:return t=e.sent,n=t.instructions,i=t.positionRequestKey,e.next=10,new Promise(function(){var e=(0,o.Z)(c().mark((function e(t,s){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f(n,i,(function(e){l(),t(e)}),(function(e){s(e)}));case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 10:return e.abrupt("return",e.sent);case 13:e.prev=13,e.t0=e.catch(2),console.log("Failed to adjust collateral!",e.t0);case 16:case"end":return e.stop()}}),e,null,[[2,13]])}))),[T,E,A.floatValue,J,de,fe,M,b,g,w,f,l]),Re=(0,y.gZ)().userAccounts,Ee=(0,i.useMemo)((function(){return[xe.W4.toString()].concat((0,oe.Z)(Array.from(Re.reduce((function(e,t){return t.info.amount.gtn(0)?e.add(t.info.mint.toString()):e}),new Set))))}),[Re]);return(0,v.jsxs)(v.Fragment,{children:[ie?(0,v.jsx)("div",{className:"absolute top-0 left-0 w-full h-full z-50",children:(0,v.jsx)(Y.Z,{onSubmit:le,onClose:function(){return se(!1)},mintsList:Ee,suppressCloseModal:!0,customStyle:{width:"100%",height:"100%"}})}):null,(0,v.jsxs)("div",{className:"px-6 mt-5",children:[(0,v.jsxs)("div",{className:"w-full flex justify-between text-xs",children:[(0,v.jsx)("div",{className:"text-v2-lily text-sm font-semibold",children:u.ag._("Position Value")}),(0,v.jsx)(X,{changePct:null===(t=s.accounting)||void 0===t?void 0:t.unrealizedPNLPct,pnl:null===(n=s.accounting)||void 0===n?void 0:n.unrealizedPNL})]}),(0,v.jsx)("div",{className:"rounded-lg bg-v2-perps-input px-4 py-3.5 text-md font-semibold text-right mt-2 cursor-not-allowed opacity-70",children:(0,v.jsxs)("div",{children:[ne.uf.format(null===P||void 0===P?void 0:P.positionValue.div(1e6),2)," USD"]})}),(0,v.jsxs)("div",{className:"mt-5",children:[(0,v.jsx)("div",{className:"flex items-end leading-none",children:(0,v.jsx)("div",{className:"text-v2-lily text-sm font-semibold",children:u.ag._("Deposit Collateral")})}),(0,v.jsxs)("div",{className:"flex justify-between mt-2",children:[(0,v.jsx)("div",{className:"text-v2-lily/[.25] hover:text-v2-lily cursor-pointer text-xs",onClick:ye,children:we.lte(0)?"":u.ag._("Min: {0} {1}",{0:ne.uf.format(we),1:null===J||void 0===J?void 0:J.symbol})}),(0,v.jsx)("div",{className:"text-v2-lily/[.25] hover:text-v2-lily cursor-pointer text-xs",onClick:Ne,children:u.ag._("Max: {0} {1}",{0:ne.uf.format(je),1:null===J||void 0===J?void 0:J.symbol})})]}),(0,v.jsx)("div",{className:"mt-2 rounded-lg bg-v2-perps-input pl-2 pr-4 py-3.5 text-md text-right",children:(0,v.jsx)(I.Qr,{name:"amount",control:O,render:function(e){var t=e.field,n=t.onChange,i=t.value;return(0,v.jsxs)("div",{className:"flex items-center justify-between text-md w-full",children:[(0,v.jsxs)("div",{className:(0,p.cn)("bg-white/10 px-2 py-1.5 rounded-lg flex items-center","hover:bg-black/10 cursor-pointer"),onClick:function(){return se(!0)},children:[(0,v.jsx)("div",{className:"w-7 h-7",children:J?(0,v.jsx)(Q.Z,{info:J,width:28,height:28}):null}),(0,v.jsx)("span",{className:"ml-3",children:null===J||void 0===J?void 0:J.symbol}),(0,v.jsx)("div",{className:"ml-4 text-white/50 fill-current",children:(0,v.jsx)(Ce.Z,{})})]}),(0,v.jsxs)("div",{className:"flex flex-col",children:[(0,v.jsx)(U.Z,{decimals:null===J||void 0===J?void 0:J.decimals,onChange:n,value:i.value,className:"!text-xl disabled:cursor-not-allowed !outline-none",placeholder:"0.00"}),J?(0,v.jsx)("div",{className:(0,p.cn)("text-xs text-v2-lily/[.25] font-normal"),children:(0,v.jsx)(K.default,{tokenInfo:J,amount:i.floatValue})}):null]})]})}})})]}),Oe?(0,v.jsx)("span",{className:"my-2 text-v2-lily/50 text-xs",children:u.ag._("You're already at a minimum leverage of 1.10x, and cannot deposit more collateral.")}):(0,v.jsxs)("div",{className:"mt-2 flex whitespace-nowrap text-v2-lily/[.25] leading-none text-xs items-end",children:[(0,v.jsx)(ae.Z,{width:14,height:14}),(0,v.jsxs)("span",{className:"ml-1",children:[ne.uf.format(re)," ",null===J||void 0===J?void 0:J.symbol]})]}),qe.length>0?qe.map((function(e,t){return(0,v.jsx)("div",{className:"text-xs mt-2 text-warning",children:e},t)})):null,(0,v.jsx)("div",{className:"border-b border-v2-lily/5 my-4"}),(0,v.jsxs)("div",{className:"mt-5 space-y-3",children:[(0,v.jsxs)("div",{className:"flex justify-between text-xs text-white/50",children:[(0,v.jsx)("span",{children:u.ag._("Leverage")}),(0,v.jsxs)("div",{children:[(0,v.jsxs)("span",{children:[k.toFixed(2),"x"]}),(0,v.jsx)("span",{children:Ae?(0,v.jsxs)("span",{className:"ml-1 text-white/[.75]",children:[(0,v.jsx)("span",{className:"mx-0.5 text-white/[.75]",children:"\u2192"}),Ae.leverage.toFixed(2),"x"]}):""})]})]}),(0,v.jsxs)("div",{className:"flex justify-between text-xs text-white/50",children:[(0,v.jsx)("span",{children:u.ag._("Liq. price")}),Ae?(0,v.jsxs)("div",{children:[(0,v.jsxs)("span",{children:["$",ne.uf.format(null===P||void 0===P?void 0:P.liquidationPrice.div(1e6),2)]}),Ae.liquidationPrice?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("span",{className:"mx-0.5 text-white/[.75]",children:"\u2192"}),(0,v.jsxs)("span",{className:"text-white/[.75]",children:["$",ne.uf.format(Ae.liquidationPrice,2)]})]}):null]}):(0,v.jsxs)("div",{children:["$",ne.uf.format(null===P||void 0===P?void 0:P.liquidationPrice.div(1e6),2)]})]}),(0,v.jsxs)("div",{className:"flex justify-between text-xs text-white/50",children:[(0,v.jsx)("span",{children:u.ag._("Collateral")}),(0,v.jsxs)("div",{children:[(0,v.jsxs)("span",{children:["$",ne.uf.format(null===P||void 0===P?void 0:P.initialCollateral.div(1e6),2)]}),Ae?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("span",{className:"mx-0.5 text-white/[.75]",children:"\u2192"}),(0,v.jsxs)("span",{className:"text-white/[.75]",children:["$",ne.uf.format(Ae.collateralUsd,2)]})]}):null]})]}),(0,v.jsxs)("div",{className:"flex justify-between text-xs text-white/50",children:[(0,v.jsx)(Se.Z,{content:u.ag._("Borrow fees due are settled when depositing or withdrawing collateral."),children:(0,v.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,v.jsx)("span",{children:u.ag._("Borrow fees due")}),(0,v.jsx)(ke.Z,{width:14,height:14})]})}),(0,v.jsxs)("div",{children:[(0,v.jsxs)("span",{children:["$",ne.uf.format(null===P||void 0===P?void 0:P.fundingFeeUsd.div(1e6),2)]}),Ae?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("span",{className:"mx-0.5 text-white/[.75]",children:"\u2192"}),(0,v.jsxs)("span",{className:"text-white/[.75]",children:["$",ne.uf.format(Ae.fundingFeeUsd.div(1e6),2)]})]}):null]})]})]})]}),(0,v.jsxs)("div",{className:"w-full text-xs flex p-6 space-x-3",children:[V.isSubmitting?null:(0,v.jsx)("button",{type:"button",className:(0,p.cn)("w-full py-2.5 px-6 border rounded-lg border-v2-lily/10 text-v2-lily bg-v2-lily/5 hover:bg-v2-lily/10 text-sm font-semibold disabled:cursor-not-allowed disabled:opacity-20",{"opacity-50 curosr-not-allowed":V.isSubmitting}),disabled:V.isSubmitting,onClick:l,children:(0,v.jsx)("span",{children:u.ag._("Cancel")})}),(0,v.jsx)("button",{type:"button",className:(0,p.cn)("w-full py-2.5 px-6 border rounded-lg border-labs/20 text-labs hover:bg-labs/5 text-sm font-semibold disabled:cursor-not-allowed disabled:opacity-20",{"opacity-50 curosr-not-allowed":V.isSubmitting||De}),disabled:De,onClick:F(Ue),children:V.isSubmitting?(0,v.jsxs)("span",{className:"flex justify-center items-center",children:[(0,v.jsx)(S.Z,{className:"!h-4 !w-4",baseColor:"white",spinnerColor:"black"}),(0,v.jsx)("div",{className:"mr-2"}),u.ag._("Adding collateral")]}):(0,v.jsx)("span",{children:u.ag._("Deposit")})})]})]})},Me=n(62812),Le=function(e){var t,n,s,l,r,a,d=e.positionAccount,m=e.onClose,f=(0,h.tc)(),g=f.viewClient,w=f.oraclePrices,b=f.slippage,N=(0,C.Z)().promptKeeperPartialClosePositionNotification,k=(0,y.Bn)(),Z=k.connection,M=k.getTokenInfo,L=k.tokens,T=(0,y.Os)().wallet,_=(0,Me.JT)().closeModal,O=d.custody,F=d.collateralCustody,q=(0,I.cI)({defaultValues:{amount:{formattedValue:"",value:"",floatValue:0}}}),D=q.control,V=q.handleSubmit,A=q.watch,E=q.setValue,B=q.formState,K=A("amount"),$=(0,i.useMemo)((function(){return M(F.account.mint.toString())}),[M,F.account.mint]),H=(0,i.useMemo)((function(){return w&&$?"long"===d.side?[null===(e=w[O.account.mint.toString()])||void 0===e?void 0:e.decreaseLong,null===(t=w[$.address])||void 0===t?void 0:t.decreaseLong]:[null===(n=w[O.account.mint.toString()])||void 0===n?void 0:n.decreaseShort,null===(i=w[$.address])||void 0===i?void 0:i.decreaseShort]:[null,null];var e,t,n,i}),[w,d.side,O.account.mint,$]),J=H[0],ee=H[1],te=(0,i.useState)($||null),ie=te[0],se=te[1],le=(0,i.useState)(!1),re=le[0],oe=le[1],ce=i.useCallback((function(e){oe(!1),se(e)}),[]),ue=(0,j.FB)((null===ie||void 0===ie?void 0:ie.address)||"").balance,de=(0,i.useMemo)((function(){return J&&ee&&d.accounting?function(){var e=x.Z.max(new x.Z(d.sizeUsd).div(h.jG),h.IH);if("long"===d.side){var t=new x.Z(d.accounting.initialCollateral).sub(e);return d.accounting.pnlAfterFeesUsd.lt(0)&&(t=t.add(d.accounting.pnlAfterFeesUsd)),new x.Z(t)}var n=new x.Z(d.accounting.initialCollateral).sub(e);return d.accounting.pnlAfterFeesUsd.lt(0)&&(n=n.add(d.accounting.pnlAfterFeesUsd)),new x.Z(n)}().div(1e6).toDP(4,x.Z.ROUND_DOWN):new x.Z(0)}),[J,ee,d.accounting,d.sizeUsd,d.side]),xe=(0,i.useCallback)((function(){E("amount",{formattedValue:de.toString(),value:de.toString(),floatValue:de.toNumber()})}),[de,E]),me=(0,i.useMemo)((function(){if(K.floatValue&&de)return new x.Z(K.floatValue).gt(de)}),[K,de]),fe=(0,i.useMemo)((function(){if(!K.floatValue||!d.accounting)return!1;var e=new x.Z(d.accounting.fundingFeeUsd.toString()).div(1e6),t=new x.Z(d.accounting.initialCollateral).sub(K.floatValue).sub(e);return d.accounting.pnlAfterFeesUsd.lt(0)&&(t=t.add(d.accounting.pnlAfterFeesUsd)),t.lt(h.IH)}),[K.floatValue,d.accounting]),pe=(0,i.useMemo)((function(){var e=[];return de.lt(0)&&e.push(u.ag._("No more collateral can be withdrawn")),fe&&e.push(u.ag._("Minimum collateral of {MINIMUM_COLLATERAL_SIZE_USD} USD is required",{MINIMUM_COLLATERAL_SIZE_USD:h.IH})),me&&e.push(u.ag._("Withdrawal amount too close to liquidation price")),e}),[me,fe,de]),he=(0,i.useMemo)((function(){return B.isSubmitting||me||de.lte(0)||pe.length>0}),[B.isSubmitting,me,de,pe]),ve=(0,i.useState)(null),ge=ve[0],we=ve[1];(0,i.useEffect)((function(){!ie&&$&&se($)}),[$,ge,null===ge||void 0===ge?void 0:ge.transferAmountUsd,null===ge||void 0===ge?void 0:ge.transferToken,ie]);var be=(0,i.useMemo)((function(){return{isTokenSwapRequired:(null===$||void 0===$?void 0:$.address)!==(null===ie||void 0===ie?void 0:ie.address),amount:ie&&$&&ge?G().BigInt(ge.transferToken.mul(Math.pow(10,$.decimals)).toFixed()):G().BigInt(0),fromTokenInfo:$}}),[$,ge,ie]),je=W({disabled:!be.isTokenSwapRequired,amount:be.amount,fromTokenInfo:be.fromTokenInfo,toTokenInfo:ie,slippage:b}),ye=je.outAmount,Ne=je.otherAmountThreshold,Pe=(0,i.useMemo)((function(){if(ie&&ge)return be.isTokenSwapRequired&&ye?{floatValue:new x.Z(ye.toString()||0).div(Math.pow(10,ie.decimals)).toNumber(),formattedValue:new x.Z(ye.toString()||0).div(Math.pow(10,ie.decimals)).toFixed(),value:new x.Z(ye.toString()||0).div(Math.pow(10,ie.decimals)).toFixed()}:{floatValue:ge.transferToken.toNumber(),formattedValue:ge.transferToken.toFixed(),value:ge.transferToken.toFixed()}}),[ge,ye,ie,be.isTokenSwapRequired]);(0,i.useEffect)((function(){(0,o.Z)(c().mark((function e(){var t,n,i,s;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(K.floatValue&&$&&g&&d.accounting&&!(pe.length>0)){e.next=3;break}return we(null),e.abrupt("return");case 3:if(!new x.Z(K.floatValue).gt(de)){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,g.getDecreasePosition({position:d,collateralUsdDelta:new(z())(new x.Z(K.floatValue).mul(1e6).round().toString()),sizeUsdDelta:new(z())(0)});case 7:if(t=e.sent){e.next=10;break}return e.abrupt("return");case 10:n=new x.Z(t.liquidationPrice.toString()),i=new x.Z(t.collateralUsd.toString()),s=function(){var e,n=new x.Z(t.collateralUsd.toString()).minus(null===(e=d.accounting)||void 0===e?void 0:e.initialCollateral).div(1e6);return new x.Z(d.accounting.positionValue.toString()).add(n)}(),we({liquidationPrice:n,collateralUsd:i,fees:new x.Z(t.feeUsd.toString()),leverage:new x.Z(d.sizeUsd.toString()).div(i).toNearest(.01,x.Z.ROUND_DOWN),transferToken:new x.Z(t.transferToken.toString()).div(Math.pow(10,$.decimals)),transferAmountUsd:new x.Z(t.transferAmountUsd.toString()),positionValue:s});case 14:case"end":return e.stop()}}),e)})))()}),[K,d,g,$,de,pe]);var Se=(0,i.useCallback)(function(){var e=(0,o.Z)(c().mark((function e(t){var n,i,s;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(g&&T&&T.adapter.publicKey&&g&&$&&K.floatValue){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,(0,P.e9)({wallet:T,connection:Z,position:d,collateralUsdDelta:new(z())(new x.Z(K.floatValue).mul(1e6).round().toString()),sizeUsdDelta:new(z())(0),desiredMint:be.isTokenSwapRequired&&ie?new R.PublicKey(ie.address):d.collateralCustody.account.mint,priceSlippage:new(z())(0),jupiterMinimumOut:be.isTokenSwapRequired&&Ne?new(z())(Ne.toString()):null});case 5:return n=e.sent,i=n.instructions,s=n.positionRequestKey,_(),e.next=11,new Promise(function(){var e=(0,o.Z)(c().mark((function e(t,n){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N(i,s,(function(e){m(),t(e)}),(function(e){n(e)}));case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 11:return e.abrupt("return",e.sent);case 14:e.prev=14,e.t0=e.catch(2),console.log("Failed to adjust collateral!",e.t0);case 17:case"end":return e.stop()}}),e,null,[[2,14]])})));return function(t){return e.apply(this,arguments)}}(),[g,T,$,K.floatValue,d,Z,be.isTokenSwapRequired,ie,Ne,_,N,m]),ke=(0,i.useMemo)((function(){return Array.from(L.map((function(e){return e.address})))}),[L]);return(0,v.jsxs)(v.Fragment,{children:[re?(0,v.jsx)("div",{className:"absolute top-0 left-0 w-full h-full z-50",children:(0,v.jsx)(Y.Z,{onSubmit:ce,onClose:function(){return oe(!1)},mintsList:ke,suppressCloseModal:!0,customStyle:{width:"100%",height:"100%"}})}):null,(0,v.jsxs)("div",{className:"px-6 mt-5",children:[(0,v.jsxs)("div",{className:"w-full flex justify-between text-xs",children:[(0,v.jsx)("div",{className:"text-v2-lily text-sm font-semibold",children:u.ag._("Position Value")}),(0,v.jsx)(X,{changePct:null===(t=d.accounting)||void 0===t?void 0:t.unrealizedPNLPct,pnl:null===(n=d.accounting)||void 0===n?void 0:n.unrealizedPNL})]}),(0,v.jsx)("div",{className:"rounded-lg bg-v2-perps-input px-4 py-3.5 text-md font-semibold text-right mt-2 cursor-not-allowed opacity-70",children:(0,v.jsxs)("div",{children:[null===(s=d.accounting)||void 0===s?void 0:s.positionValue.div(1e6).toFixed(2)," USD"]})}),(0,v.jsx)("div",{className:"mt-5",children:(0,v.jsxs)("div",{className:"flex justify-between items-end leading-none",children:[(0,v.jsx)("div",{className:"text-v2-lily text-sm font-semibold",children:u.ag._("Withdraw collateral in:")}),(0,v.jsx)("div",{className:"text-v2-lily/[.25] hover:text-v2-lily cursor-pointer text-xs",onClick:xe,children:de.lte(0)?"":u.ag._("Max: {allowedMaxAmount} USD",{allowedMaxAmount:de})})]})}),(0,v.jsx)("div",{className:"mt-2 rounded-lg bg-v2-perps-input pl-2 pr-4 py-3.5 text-md text-right",children:(0,v.jsx)(I.Qr,{name:"amount",control:D,render:function(e){var t=e.field,n=t.onChange,i=t.value;return(0,v.jsxs)("div",{className:"flex items-center justify-between text-md w-full",children:[(0,v.jsxs)("div",{className:"pl-2 py-1.5 rounded-lg flex items-center",children:[(0,v.jsx)("div",{className:"w-7 h-7",children:ie?(0,v.jsx)(Q.Z,{info:ie,width:28,height:28}):null}),(0,v.jsx)("span",{className:"ml-3 font-semibold text-sm",children:null===ie||void 0===ie?void 0:ie.symbol})]}),(0,v.jsxs)("div",{className:"flex flex-col",children:[(0,v.jsx)(U.Z,{disabled:de.lte(0),decimals:6,onChange:n,value:i.value,className:"!text-xl disabled:cursor-not-allowed !outline-none",placeholder:"0.00",suffix:" USD"}),(0,v.jsx)(U.Z,{className:"!text-xs !text-v2-lily/[.25] !font-normal",disabled:!0,decimals:null===ie||void 0===ie?void 0:ie.decimals,value:null===Pe||void 0===Pe?void 0:Pe.value,suffix:" "+(null===ie||void 0===ie?void 0:ie.symbol)})]})]})}})}),(0,v.jsxs)("div",{className:"mt-2 flex whitespace-nowrap text-v2-lily/[.25] leading-none text-xs items-end",children:[(0,v.jsx)(ae.Z,{width:14,height:14}),(0,v.jsxs)("span",{className:"ml-1",children:[ue," ",null===ie||void 0===ie?void 0:ie.symbol]})]}),pe.length>0?pe.map((function(e,t){return(0,v.jsx)("div",{className:"text-xs mt-2 text-warning",children:e},t)})):null,(0,v.jsx)("div",{className:"border-b border-v2-lily/5 my-4"}),(0,v.jsxs)("div",{className:"mt-5 space-y-3",children:[(0,v.jsxs)("div",{className:"flex justify-between text-xs text-white/50",children:[(0,v.jsx)("span",{children:u.ag._("Leverage")}),(0,v.jsxs)("div",{children:[(0,v.jsxs)("span",{children:[d.leverage.toFixed(2),"x"]}),(0,v.jsx)("span",{children:ge?(0,v.jsxs)("span",{className:"ml-1 text-white/[.75]",children:[(0,v.jsx)("span",{className:"mx-0.5 text-white/[.75]",children:"\u2192"}),ge.leverage.toFixed(2),"x"]}):""})]})]}),(0,v.jsxs)("div",{className:"flex justify-between text-xs text-white/50",children:[(0,v.jsx)("span",{children:u.ag._("Liq. Price")}),ge?(0,v.jsxs)("div",{children:[(0,v.jsxs)("span",{children:["$",ne.uf.format(null===(r=d.accounting)||void 0===r?void 0:r.liquidationPrice.div(1e6),2)]}),ge.liquidationPrice?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("span",{className:"mx-0.5 text-white/[.75]",children:"\u2192"}),(0,v.jsxs)("span",{className:"text-white/[.75]",children:["$",ne.uf.format(ge.liquidationPrice.div(1e6),2)]})]}):null]}):(0,v.jsxs)("div",{children:["$",ne.uf.format(null===(l=d.accounting)||void 0===l?void 0:l.liquidationPrice.div(1e6),2)]})]}),(0,v.jsxs)("div",{className:"flex justify-between text-xs text-white/50",children:[(0,v.jsx)("span",{children:u.ag._("Collateral")}),(0,v.jsxs)("div",{children:[(0,v.jsxs)("span",{children:["$",ne.uf.format(null===(a=d.accounting)||void 0===a?void 0:a.initialCollateral.div(1e6),2)]}),ge?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("span",{className:"mx-0.5 text-white/[.75]",children:"\u2192"}),(0,v.jsxs)("span",{className:"text-white/[.75]",children:["$",ne.uf.format(ge.collateralUsd.div(1e6),2)]})]}):null]})]})]})]}),(0,v.jsxs)("div",{className:"w-full text-xs flex p-6 space-x-3",children:[B.isSubmitting?null:(0,v.jsx)("button",{type:"button",className:(0,p.cn)("w-full py-2.5 px-6 border rounded-lg border-v2-lily/10 text-v2-lily bg-v2-lily/5 hover:bg-v2-lily/10 text-sm font-semibold disabled:cursor-not-allowed disabled:opacity-20",{"opacity-50 curosr-not-allowed":B.isSubmitting}),disabled:B.isSubmitting,onClick:m,children:(0,v.jsx)("span",{children:u.ag._("Cancel")})}),(0,v.jsx)("button",{type:"button",className:(0,p.cn)("w-full py-2.5 px-6 border rounded-lg border-labs/20 text-labs hover:bg-labs/5 text-sm font-semibold disabled:cursor-not-allowed disabled:opacity-20",{"opacity-50 curosr-not-allowed":B.isSubmitting||he}),disabled:he,onClick:V(Se),children:B.isSubmitting?(0,v.jsxs)("span",{className:"flex justify-center items-center",children:[(0,v.jsx)(S.Z,{className:"!h-4 !w-4",baseColor:"white",spinnerColor:"black"}),(0,v.jsx)("div",{className:"mr-2"}),u.ag._("Withdrawing collateral")]}):(0,v.jsx)("span",{children:u.ag._("Withdraw")})})]})]})},Te=function(e){var t=e.open,n=e.onClose,s=e.positionAccount,l=(0,y.Bn)().getTokenInfo,r=(0,h.tc)().oraclePrices,o=(0,i.useMemo)((function(){var e;return null!==(e=l(s.custody.account.mint.toString()))&&void 0!==e?e:F.mq}),[l,s.custody.account.mint]),a=i.useRef(null);(0,B.O3)(a,(function(){var e;return null===(e=a.current)||void 0===e?void 0:e.close()}));var c=(0,i.useCallback)((function(){var e;null===(e=a.current)||void 0===e||e.close(),n()}),[n,a]);(0,i.useEffect)((function(){if(a.current&&(t?a.current.open||a.current.show():a.current.close()),t){var e=a.current;return null===e||void 0===e||e.addEventListener("close",c),function(){null===e||void 0===e||e.removeEventListener("close",c)}}}),[c,t]);var d=(0,i.useState)("deposit"),x=d[0],m=d[1],f=(0,i.useMemo)((function(){var e;return r&&(null===(e=r[o.address])||void 0===e?void 0:e.increaseLong)}),[r,o.address]);return(0,v.jsx)(te.Z,{open:t,onClose:n,children:(0,v.jsxs)("form",{className:"relative w-full lg:max-w-[400px] bg-v2-perps-modal rounded-lg",children:[(0,v.jsx)("div",{className:"p-4 lg:p-6 mb-2 lg:mb-0 font-semibold leading-none lg:text-lg text-v2-lily",children:u.ag._("Edit Collateral")}),(0,v.jsx)("div",{className:"flex absolute top-5 lg:top-8 right-8 z-10 text-v2-lily/[.25] fill-current cursor-pointer",onClick:c,children:(0,v.jsx)(J.Z,{width:12,height:12})}),(0,v.jsxs)("div",{className:"max-h-[80vh] overflow-y-auto",children:[(0,v.jsx)("div",{className:"px-6",children:(0,v.jsxs)("div",{className:"rounded-lg bg-v2-lily/5 border border-v2-lily/[.15] p-5",children:[(0,v.jsxs)("div",{className:"flex justify-between text-sm font-semibold",children:[(0,v.jsxs)("div",{className:"flex space-x-2 items-center",children:[(0,v.jsx)(Q.Z,{info:o,width:24,height:24}),(0,v.jsx)(A.cC,{id:"<0>{0} Price:</0>",values:{0:o.symbol},components:{0:(0,v.jsx)("span",{})}})]}),(0,v.jsxs)("span",{className:"text-sm font-semibold",children:[ne.uf.format(f||void 0,2)," USD"]})]}),(0,v.jsx)("div",{className:"border-b border-v2-lily/5 my-4"}),(0,v.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,v.jsx)("span",{className:"text-white/40",children:u.ag._("Current Position Size")}),(0,v.jsxs)("span",{className:"text-white/[.75]",children:["$",ne.uf.format(s.sizeUsd.div(1e6),2)]})]})]})}),(0,v.jsxs)("div",{children:[(0,v.jsx)("div",{className:"flex flex-row items-center justify-between space-x-4 px-4 border-b-white/5 border-b h-[56px]",children:(0,v.jsxs)("div",{className:"flex flex-row w-full",children:[(0,v.jsx)("button",{type:"button",onClick:function(){return m("deposit")},className:(0,p.cn)("flex flex-row items-center justify-center px-3 pt-6 pb-4 font-semibold !outline-none","deposit"===x?"border-b border-b-labs text-labs":""),children:(0,v.jsx)("span",{className:"text-sm",children:u.ag._("Deposit")})}),(0,v.jsx)("button",{type:"button",onClick:function(){return m("withdraw")},className:(0,p.cn)("flex flex-row items-center justify-center px-3 pt-6 pb-4 font-semibold !outline-none","withdraw"===x?"border-b border-b-labs text-labs":""),children:(0,v.jsx)("span",{className:"text-sm",children:u.ag._("Withdraw")})})]})}),"deposit"===x?(0,v.jsx)(Ze,{positionAccount:s,onClose:c}):(0,v.jsx)(Le,{positionAccount:s,onClose:c})]})]})]})})},_e=function(e){var t=e.open,n=e.onClose,s=e.positionAccountPubkey,l=(0,h.tc)().userPositions,r=(0,i.useMemo)((function(){return null===l||void 0===l?void 0:l.find((function(e){return e.publicKey.equals(s)}))}),[s,l]);return r?(0,v.jsx)(Te,{open:t,onClose:n,positionAccount:r}):null},Oe=function(e){var t=e.selectToPair,n=e.selected,s=(0,h.tc)().perpsTokens,l=(0,i.useState)([]),r=l[0],o=l[1];return(0,i.useEffect)((function(){0===r.length&&o(s.nonStableTokens)}),[s.nonStableTokens,r.length]),(0,v.jsx)("div",{className:"flex w-full space-x-2 overflow-x-scroll hideScrollbar border-r border-r-v2-lily/10 h-full items-center px-2",children:r.map((function(e,i){return(0,v.jsxs)("button",{type:"button",onClick:function(){return t(e)},className:(0,p.cn)("h-9 lg:h-10","flex items-center cursor-pointer fill-current font-semibold space-x-3 rounded-full pl-1.5 pr-2 text-sm border lg:border-2 border-transparent whitespace-nowrap",n.address===e.address?"border-labs bg-labs/10 text-labs":"text-white hover:border-labs/50"),children:[(0,v.jsx)("div",{className:"h-6 w-6",children:(0,v.jsx)(Q.Z,{info:e,width:24,height:24})}),(0,v.jsxs)("span",{children:[e.symbol,"-PERP"]})]},i)}))})},Fe=n(55766),qe=function(e,t,n){if(!Fe.jU)return[t,function(){}];var s=(0,i.useState)((function(){try{var i=sessionStorage.getItem(e);return"string"!==typeof i?(sessionStorage.setItem(e,n?String(t):JSON.stringify(t)),t):n?i:JSON.parse(i||"null")}catch(s){return t}})),l=s[0],r=s[1];return(0,i.useEffect)((function(){try{var t=n?String(l):JSON.stringify(l);sessionStorage.setItem(e,t)}catch(s){}})),[l,r]},De=n(10496),Ve=n(36232),Ae=n(99438),Ie=n(1622),Ue=n(16330),Re=function(e){var t=e.width,n=void 0===t?16:t,i=e.height,s=void 0===i?8:i,l=e.fill,r=void 0===l?"rgba(39, 174, 96, 1)":l,o=e.className;return(0,v.jsx)("svg",{width:n,height:s,className:o,viewBox:"0 0 16 8",fill:"inherit",xmlns:"http://www.w3.org/2000/svg",children:(0,v.jsx)("path",{d:"M10 0C9.63183 0 9.33335 0.298477 9.33335 0.666667C9.33335 1.03486 9.63183 1.33333 10 1.33333H13.0572L8.94953 5.44102C8.80974 5.5808 8.73289 5.65692 8.67344 5.70739L8.66669 5.71306L8.65993 5.70739C8.60048 5.65692 8.52363 5.5808 8.38384 5.44101L6.54397 3.60114C6.42502 3.48216 6.30915 3.36626 6.20301 3.27616C6.08645 3.1772 5.93852 3.07082 5.74538 3.00807C5.47758 2.92106 5.18912 2.92106 4.92133 3.00807C4.72819 3.07082 4.58026 3.1772 4.46369 3.27616C4.35755 3.36627 4.2417 3.48215 4.12274 3.60113L0.861949 6.86193C0.6016 7.12228 0.6016 7.54439 0.861949 7.80474C1.1223 8.06509 1.54441 8.06509 1.80476 7.80474L5.05051 4.55899C5.19029 4.4192 5.26715 4.34308 5.3266 4.29261L5.33335 4.28694L5.34011 4.29261C5.39956 4.34308 5.47641 4.4192 5.6162 4.55898L7.45608 6.39887C7.57504 6.51786 7.69089 6.63373 7.79703 6.72384C7.91359 6.8228 8.06152 6.92918 8.25466 6.99193C8.52246 7.07894 8.81092 7.07894 9.07871 6.99193C9.27185 6.92918 9.41978 6.8228 9.53635 6.72384C9.64249 6.63373 9.75834 6.51785 9.87731 6.39886L14 2.27614V5.33333C14 5.70152 14.2985 6 14.6667 6C15.0349 6 15.3334 5.70152 15.3334 5.33333V0.666667C15.3334 0.298477 15.0349 0 14.6667 0H10Z",fill:r})})},Ee=function(e){var t=e.width,n=void 0===t?16:t,i=e.height,s=void 0===i?8:i,l=e.fill,r=void 0===l?"rgba(255, 87, 87, 1)":l,o=e.className;return(0,v.jsx)("svg",{width:n,height:s,className:o,viewBox:"0 0 16 8",fill:"inherit",xmlns:"http://www.w3.org/2000/svg",children:(0,v.jsx)("path",{d:"M1.30473 0.195262C1.04438 -0.0650874 0.622268 -0.0650874 0.361919 0.195262C0.101569 0.455612 0.101569 0.877722 0.361919 1.13807L3.6227 4.39886C3.74166 4.51785 3.85752 4.63373 3.96366 4.72384C4.08023 4.8228 4.22816 4.92918 4.4213 4.99193C4.68909 5.07894 4.97755 5.07894 5.24535 4.99193C5.43849 4.92918 5.58642 4.8228 5.70298 4.72384C5.80913 4.63373 5.92498 4.51785 6.04394 4.39887L7.88381 2.55899C8.0236 2.4192 8.10045 2.34308 8.1599 2.29261L8.16666 2.28694L8.17341 2.29261C8.23286 2.34308 8.30971 2.4192 8.4495 2.55898L12.5572 6.66667H9.49999C9.1318 6.66667 8.83332 6.96514 8.83332 7.33333C8.83332 7.70152 9.1318 8 9.49999 8H14.1667C14.5348 8 14.8333 7.70152 14.8333 7.33333V2.66667C14.8333 2.29848 14.5348 2 14.1667 2C13.7985 2 13.5 2.29848 13.5 2.66667V5.72386L9.37727 1.60114C9.25832 1.48215 9.14246 1.36627 9.03631 1.27616C8.91975 1.1772 8.77182 1.07082 8.57868 1.00807C8.31089 0.921056 8.02242 0.921056 7.75463 1.00807C7.56149 1.07082 7.41356 1.1772 7.297 1.27616C7.19086 1.36626 7.07502 1.48213 6.95607 1.60111L5.11616 3.44102C4.97638 3.5808 4.89953 3.65692 4.84008 3.70739L4.83332 3.71306L4.82657 3.70739C4.76712 3.65692 4.69026 3.5808 4.55048 3.44102L1.30473 0.195262Z",fill:r})})};function ze(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Be(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ze(Object(n),!0).forEach((function(t){(0,ce.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ze(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ke=(0,i.memo)((function(e){var t=e.collateralInput,n=e.orderInfoLoading;return(0,v.jsxs)("div",{className:"flex flex-col lg:flex-row justify-between lg:items-center",children:[(0,v.jsx)("span",{className:"text-xs text-white/40 ",children:u.ag._("Collateral")}),(0,v.jsx)(Se.Z,{variant:"dark",content:(0,v.jsxs)("div",{className:"space-y-2",children:[(0,v.jsx)("p",{className:"text-xs",children:u.ag._("When opening a position, a snapshot will be taken and collateral will be calculated in USD.")}),(0,v.jsx)("p",{className:"text-xs",children:u.ag._("Depending on the token selection, token may be swapped via Jupiter's best possible rate.")})]}),children:(0,v.jsx)("div",{translate:"no",className:"text-xs text-white/75 mt-0.5",children:t&&!n?(0,v.jsxs)("span",{children:[ne.uf.format(t,2)," USD"]}):!t||null!==t&&void 0!==t&&t.eq(0)?(0,v.jsx)("span",{className:"text-white/75 text-xs h-[14px]",children:"-"}):(0,v.jsx)(O.O,{className:"h-[14px] !w-20"})})})]})})),$e=(0,i.memo)((function(e){var t=e.sizeUsd,n=e.collateralInput,i=e.orderInfoLoading;return(0,v.jsxs)("div",{className:"flex flex-col lg:flex-row justify-between lg:items-center",children:[(0,v.jsx)("span",{className:"text-xs text-white/40 leading-none",children:u.ag._("Size in USD")}),(0,v.jsx)("div",{translate:"no",className:"text-xs text-white/75 mt-0.5",children:t&&!i?(0,v.jsx)("span",{translate:"no",className:"text-xs h-[14px] text-white/75",children:(0,v.jsxs)("span",{children:[ne.uf.format(t,2)," USD"]})}):!n||null!==n&&void 0!==n&&n.eq(0)?(0,v.jsx)("span",{className:"text-white/75 text-xs h-[14px]",children:"-"}):(0,v.jsx)(O.O,{className:"h-[14px] !w-20"})})]})})),We=(0,i.memo)((function(e){e.positionInfo;var t=e.orderInfo,n=e.orderInfoLoading;return(0,v.jsxs)("div",{className:"flex flex-col lg:flex-row justify-between lg:items-center",children:[(0,v.jsx)("span",{className:"text-xs text-white/40",children:u.ag._("Entry price")}),(0,v.jsx)("span",{className:"text-xs text-white/75",children:t.entryPriceTextWithShifting&&!n?t.entryPriceTextWithShifting:(0,v.jsx)(O.O,{className:"!w-16 !h-4"})})]})})),He=(0,i.memo)((function(e){e.positionInfo;var t=e.orderInfo,n=e.orderInfoLoading;return(0,v.jsxs)("div",{className:"flex flex-col lg:flex-row justify-between lg:items-center",children:[(0,v.jsxs)("span",{className:"flex items-center leading-none",children:[(0,v.jsx)("span",{className:(0,p.cn)("inline-block lg:hidden text-xs",t.isNewLiquidationWorse?"text-warning":"text-white/40"),children:u.ag._("Liquidation")}),(0,v.jsx)("span",{className:(0,p.cn)("hidden lg:inline-block text-xs",t.isNewLiquidationWorse?"text-warning":"text-white/40"),children:u.ag._("Liquidation price")}),t.isNewLiquidationWorse&&!n?(0,v.jsx)(Se.Z,{buttonContentClassName:"ml-1 inline-block",content:u.ag._("Your new order and outstanding borrow fees is resulting in a worse liquidation price, try increasing your collateral, or reduce your leverage."),children:(0,v.jsx)(ke.Z,{width:14,height:14,className:"text-warning"})}):null]}),(0,v.jsx)("span",{className:(0,p.cn)("text-xs mt-1",t.isNewLiquidationWorse?"text-warning":"text-white/75"),children:t.liquidationPriceTextWithShifting&&!n?t.liquidationPriceTextWithShifting:(0,v.jsx)(O.O,{className:"!w-16 !h-4"})})]})})),Ge=(0,i.memo)((function(e){e.positionInfo;var t=e.orderInfo,n=e.orderInfoLoading;return(0,v.jsxs)("div",{className:"flex flex-col lg:flex-row justify-between lg:items-center",children:[(0,v.jsx)("span",{className:"text-xs text-white/40 whitespace-nowrap",children:u.ag._("Open fee (0.1%)")}),(0,v.jsx)("span",{className:"text-xs text-white/75",children:t.feeUsdText&&!n?"".concat(t.feeUsdText):(0,v.jsx)(O.O,{className:"!w-16 !h-4"})})]})})),Ye=(0,i.memo)((function(e){var t=e.positionInfo,n=e.orderInfo,i=e.orderInfoLoading;return(0,v.jsxs)("div",{className:(0,p.cn)("flex flex-col lg:flex-row justify-between lg:items-center text-xs",t.insufficientNewCollateral&&n.isNewLiquidationWorse?"text-warning":"text-white/40"),children:[(0,v.jsxs)("span",{className:"inline-block lg:flex lg:flex-row lg:items-center leading-none",children:[u.ag._("Borrow fees due"),(0,v.jsx)("div",{className:"ml-1 inline-block",children:(0,v.jsx)(Se.Z,{content:u.ag._("Borrow fees due are settled when you make changes to your existing position."),children:(0,v.jsx)(ke.Z,{width:14,height:14,className:"inline-block mb-0.5 md:mb-0"})})})]}),(0,v.jsx)("span",{className:(0,p.cn)("text-xs",t.insufficientNewCollateral&&n.isNewLiquidationWorse?"text-warning":"text-white/75"),children:n.outstandingFundingFeeUsdText&&!i?"".concat(n.outstandingFundingFeeUsdText):(0,v.jsx)(O.O,{className:"!w-16 !h-4"})})]})})),Je=(0,i.memo)((function(e){var t=e.positionInfo,n=(e.orderInfo,e.orderInfoLoading);return(0,v.jsxs)("div",{className:"flex flex-col lg:flex-row justify-between lg:items-center gap-x-4",children:[(0,v.jsxs)("div",{className:"flex items-center text-xs text-white/40 lg:h-5",children:[(0,v.jsx)("span",{className:"text-xs text-white/40 mr-1",children:u.ag._("Borrow rate")}),(0,v.jsx)(Se.Z,{variant:"dark",placement:"top",content:(0,v.jsx)("p",{className:"flex items-center text-xs",children:(0,v.jsx)(A.cC,{id:"The borrow rate is calculated as (assets borrowed) / (total assets in pool) * {0}% per hour.",values:{0:t.hourlyFundingBps.div(100).toString()}})}),children:(0,v.jsx)(ke.Z,{width:14,height:14})})]}),(0,v.jsx)("span",{className:"flex items-center text-xs text-white/75",children:t.borrowFeeText&&!n?t.borrowFeeText:(0,v.jsx)(O.O,{className:"!w-16 !h-4"})})]})})),Qe=(0,i.memo)((function(e){var t=e.positionInfo,n=(e.orderInfo,e.orderInfoLoading);return(0,v.jsxs)("div",{className:"flex flex-col lg:flex-row justify-between lg:items-center gap-x-4",children:[(0,v.jsx)("span",{className:"block lg:hidden text-xs text-white/40",children:u.ag._("Available liq.")}),(0,v.jsx)("span",{className:"hidden lg:block text-xs text-white/40",children:u.ag._("Available liquidity")}),(0,v.jsx)("span",{className:"text-xs text-white/75",children:t.availableLiquidityText&&!n?t.availableLiquidityText:(0,v.jsx)(O.O,{className:"!w-16 !h-4"})})]})})),Xe=(0,i.memo)((function(e){return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{className:"hidden lg:block rounded-lg p-3 w-full",children:(0,v.jsx)("div",{className:"border border-white/5 rounded-lg p-3 w-full",children:(0,v.jsxs)("div",{className:"space-y-1",children:[(0,v.jsx)(We,Be({},e)),(0,v.jsx)(He,Be({},e)),(0,v.jsx)(Ge,Be({},e)),e.orderInfo.outstandingFundingFeeUsdText?(0,v.jsx)(Ye,Be({},e)):null,(0,v.jsx)(Je,Be({},e)),(0,v.jsx)(Qe,Be({},e))]})})}),(0,v.jsx)("div",{className:"block lg:hidden px-1.5 pt-3 min-h-full bg-[#1E2A36] w-full !min-w-[110px] max-w-[30vw]",children:(0,v.jsxs)("div",{className:"space-y-3",children:[(0,v.jsx)(Ke,Be({},e)),(0,v.jsx)($e,Be({},e)),(0,v.jsx)(We,Be({},e)),(0,v.jsx)(He,Be({},e)),(0,v.jsx)(Ge,Be({},e)),e.orderInfo.outstandingFundingFeeUsdText?(0,v.jsx)(Ye,Be({},e)):null,(0,v.jsx)(Je,Be({},e)),(0,v.jsx)(Qe,Be({},e))]})})]})})),et=n(14640),tt=n(3561),nt=n(24684),it=n(85653),st=n(41264),lt=n(94107),rt=n(6901),ot={entryPrice:new x.Z(0),entryPriceText:"",entryPriceTextWithShifting:"",liquidationPrice:null,liquidationPriceText:"",liquidationPriceTextWithShifting:"",feeUsd:new x.Z(0),feeUsdText:"",outstandingFundingFeeUsd:null,outstandingFundingFeeUsdText:"",isNewLiquidationWorse:!1},at={entryPrice:new x.Z(0),entryPriceText:"",hourlyFundingBps:new x.Z(0),borrowFee:new x.Z(0),borrowFeeText:"",availableLiquidity:new x.Z(0),availableLiquidityText:"",maxPositionUsd:new x.Z(0),insufficientNewCollateral:!1},ct=f()((function(){return Promise.all([n.e(3016),n.e(2215),n.e(9804)]).then(n.bind(n,87015))}),{ssr:!1,loadableGenerated:{webpack:function(){return[87015]}}}),ut=function(e){var t,n=e.setPositionDirection,s=e.positionDirection,r=e.fromPairTokenInfo,a=e.toPairTokenInfo,d=e.onShowEditCollateralDialog,m=V(F.yM),f=(0,y.Os)().wallet,g=(0,h.tc)(),w=g.viewClient,b=g.userPositions,N=g.perpsTokens,P=g.oraclePrices,k=g.slippage,Z=g.custodies,M=g.poolInfo,L=g.refreshPositionInfo,T=(0,y.Bn)(),_=T.connection,O=T.getTokenInfo,q=(0,i.useState)(!0),U=q[0],E=q[1],K=(0,i.useState)(ot),$=K[0],W=K[1],H=(0,i.useState)(at),G=H[0],Y=H[1],J=qe("PERPS_LEVERAGE_COOKIE",h.aY.toString()),Q=(0,l.Z)(J,2),X=Q[0],ee=Q[1],te=(0,I.cI)({defaultValues:{fromPair:F.Lr,fromPairValue:"",toPair:F.Lr,toPairValue:"",leverage:X}}),se=te.control,le=te.handleSubmit,re=te.watch,ce=te.setValue,ue=te.formState,de=re(),me=D(),fe=(0,j.FB)(de.fromPair).balance,pe=Number(de.fromPairValue)>fe,he=(0,y.iG)(),ve=(0,i.useMemo)((function(){var e,t=null===(e=he.account)||void 0===e?void 0:e.account.lamports;return!t||t<xe.WO}),[he.account]),we=(0,i.useMemo)((function(){if(!P)return null;var e=P[a.address];return e?"long"===s?e.increaseLong:e.increaseShort:null}),[P,s,a.address]),be=(0,i.useMemo)((function(){if((0,B.Hd)(de.toPairValue)&&we)return new x.Z(de.toPairValue).mul(new x.Z(we))}),[we,de.toPairValue]),je=function(e){var t=(0,h.tc)(),n=t.perpsTokens,s=t.custodies,l=(0,y.Bn)().getTokenInfo;return(0,i.useMemo)((function(){return n.stableTokens?n.stableTokens.map((function(t){var n=s.find((function(e){return e.account.mint.toString()===t.address}));if(!n)return null;if(e&&new x.Z(n.account.assets.owned.sub(n.account.assets.locked).toString()).div(1e6).lt(e))return null;var i=n.account.assets.owned.gtn(0)&&n.account.assets.locked.gtn(0)?new x.Z(n.account.assets.locked.toString()).div(n.account.assets.owned.toString()).mul(1e4):new x.Z(0);return{mint:n.account.mint.toString(),utilizationBps:i}})).filter(Boolean).sort((function(e,t){return e.utilizationBps.toNumber()-t.utilizationBps.toNumber()})).map((function(e){return Ne(Ne({},e),{},{tokenInfo:l(e.mint)})})):[]}),[n.stableTokens,s,e,l])}(be),ye=(0,i.useMemo)((function(){var e=(null===b||void 0===b?void 0:b.find((function(e){return e.custody.account.mint.toString()===a.address&&e.side===s})))||null,t=Z.find((function(e){return e.account.mint.toBase58()===a.address})),n=function(){if("long"===s)return a;if("short"===s){if(e)return O(e.collateralCustody.account.mint.toString());var t=je.find((function(e){return"Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"===e.mint})),n=je.find((function(e){return"EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"===e.mint}));return null!==t&&void 0!==t&&t.utilizationBps.lt(5e3)?t.tokenInfo:null===n||void 0===n?void 0:n.tokenInfo}}(),i=Z.find((function(e){return e.account.mint.toBase58()===(null===n||void 0===n?void 0:n.address)})),l=P&&n&&P[n.address]||null;return{hasExistingPosition:e,poolCustodyAccount:t,collateralTokenInfo:n,collateralCustodyAccount:i,collateralTokenPrice:"long"===s?null===l||void 0===l?void 0:l.increaseLong:null===l||void 0===l?void 0:l.increaseShort}}),[b,Z,P,s,a,je,O]),Se=ye.hasExistingPosition,ke=ye.poolCustodyAccount,Ce=ye.collateralTokenInfo,Ze=ye.collateralTokenPrice,Me=ye.collateralCustodyAccount,Le=Pe({fromPairTokenInfo:r,toPairTokenInfo:Ce,fromPairValue:de.fromPairValue}),Te=Le.isLoading,_e=Le.isTokenSwapRequired,Oe=Le.outAmount,Fe=Le.otherAmountThreshold,ze=Le.quoteResponseMeta,Be=Le.hasJupiterError,We=Le.lastRefreshTimestamp,He=Le.refresh;(0,st.i)({isSubmitting:ue.isSubmitting,lastRefreshTimestamp:We,value:Number(de.fromPairValue),refresh:He});var Ge=(0,i.useRef)(!1),Ye=(0,i.useCallback)((function(e){if(Ge.current=!1,(0,B.Hd)(e)){var t=Ce&&Ze&&we?_e?Oe?new x.Z(Oe.toString()).div(Math.pow(10,Ce.decimals)).mul(Ze).div(we):null:new x.Z(e).mul(Ze).div(we):null;if(t&&de.leverage){var n=new x.Z(de.leverage).div(new x.Z(1).add(new x.Z(de.leverage).mul(h.jV/1e4)));if(!Ge.current){var i=new x.Z(t).mul(n).toDP(a.decimals).toFixed();ce("toPairValue",i)}}else ce("toPairValue","")}}),[Ce,_e,Oe,ce,a.decimals,we,de.leverage,Ze]);(0,i.useEffect)((function(){mt(de.leverage)}),[ce,de.fromPair,de.toPair]),(0,i.useEffect)((function(){ce("fromPair",r.address),ce("toPair",a.address)}),[r.address,a.address,ce]);var Je=i.useCallback((function(e){m(e,a,s),W(ot),Y(at),ce("fromPairValue",""),ce("toPairValue","")}),[s,m,ce,a]),Qe=i.useCallback((function(e){m(r,e,s),W(ot),Y(at),ce("fromPairValue",""),ce("toPairValue","")}),[m,r,s,ce]),ut=(0,i.useCallback)((function(e){var t;e.preventDefault(),t=de.fromPair===xe.W4.toBase58()?String(fe>xe.WO?fe-xe.WO:0):String(fe),ce("fromPairValue",t),Ye(t)}),[de.fromPair,ce,Ye,fe]),dt=(0,i.useMemo)((function(){if(null===f||void 0===f||!f.adapter.connected)return!1;if((null===r||void 0===r?void 0:r.address)!==xe.W4.toBase58())return!1;if(!(0,B.Hd)(de.fromPairValue))return!1;var e=fe-xe.WO;return new x.Z(de.fromPairValue||0).gt(e)}),[fe,null===r||void 0===r?void 0:r.address,null===f||void 0===f?void 0:f.adapter.connected,de.fromPairValue]),xt=Boolean(Oe);(0,i.useEffect)((function(){_e&&xt&&!Te&&!Ge.current&&Ye(de.fromPairValue)}),[Te,_e,de.fromPairValue,xt,Ye]);var mt=(0,i.useCallback)((function(e){if(ce("leverage",e),ee(e),Ge.current=!1,Number(de.fromPairValue)&&Number(e)&&we&&Ce&&Ze&&!Te){var t=_e&&Oe?new x.Z(Oe.toString()).div(Math.pow(10,Ce.decimals)).mul(Ze):new x.Z(de.fromPairValue).mul(Ze),n=new x.Z(e).div(new x.Z(1).add(new x.Z(e).mul(h.jV/1e4))),i=new x.Z(t).div(we).mul(n).toDP(a.decimals).toFixed();ce("toPairValue",i)}else ce("toPairValue","")}),[Ce,Te,_e,Oe,ce,a.decimals,we,de.fromPairValue,Ze,ee]),ft=(0,i.useCallback)((function(e){if(Number(e)&&Number(de.fromPairValue)&&we&&Ce&&Ze&&!Te){Ge.current=!0;var t=_e?Oe?new x.Z(Oe.toString()).div(Math.pow(10,Ce.decimals)).mul(Ze).div(we):null:new x.Z(de.fromPairValue).mul(Ze).div(we);if(t){var n=new x.Z(e).div(t).toDP(1),i=new x.Z(n).mul(new x.Z(1).add(new x.Z(n).mul(h.jV/1e4)));i.lte(h.aY)?mt(h.aY.toString()):i.gt(h.jG)?mt(h.jG.toString()):ce("leverage",i.toString())}else ce("leverage","")}else ce("leverage","")}),[Ce,Te,_e,Oe,ce,we,de.fromPairValue,Ze,mt]),pt=(0,rt.y)(we),ht=(0,i.useCallback)((0,o.Z)(c().mark((function e(){var t,n,i,l,o,d,m,f,p,h,g,b,j,y,N,P,S,k,C,Z,L,T,_,O,F,q;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(w&&we&&je&&Ce&&Ze&&ke&&Me&&M&&(!Se||(null===Se||void 0===Se?void 0:Se.custody.account.mint.toString())===a.address)){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,n=null!==Se&&void 0!==Se&&null!==(t=Se.accounting)&&void 0!==t&&t.fundingFeeUsd?new x.Z(Se.accounting.fundingFeeUsd).div(1e6):null,i=n?"".concat(ne.uf.format(n,pt)," USD"):"",l=function(){var e;if(null!==Se&&void 0!==Se&&null!==(e=Se.accounting)&&void 0!==e&&e.fundingFeeUsd){var t=new x.Z(Se.accounting.fundingFeeUsd),n=new x.Z(we).mul(1e6).toDP(0);return new(z())(t.div(n).mul(Math.pow(10,Ce.decimals)).toDP(0).toString())}return new(z())(0)}(),o=de.fromPairValue?_e?Oe?new(z())(new x.Z(Oe.toString()).toFixed(0)).sub(l):new(z())(0):new(z())(new x.Z(de.fromPairValue).mul(Math.pow(10,r.decimals)).toFixed(0)).sub(l):"long"===s?new(z())(new x.Z(.9).div(we).mul(Math.pow(10,a.decimals)).toFixed(0)):new(z())(9e5),d=(0,B.Hd)(de.toPairValue)?new(z())(new x.Z(de.toPairValue).mul(we).mul(1e6).toDP(0).toFixed(0)):new(z())(1e6),e.next=10,w.getIncreasePosition({collateral:o,sizeUsdDelta:d,side:s,custody:ke,positionAccount:Se,collateralCustody:Me});case 10:if(m=e.sent){e.next=13;break}return e.abrupt("return");case 13:f=we?we.toDP(4):new x.Z(0),p="$"+ne.uf.format(f.toNumber(),pt),h=f?de.fromPairValue&&Se&&Se.sizeUsd.gt(0)&&m.price.gtn(0)?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("span",{children:["$",ne.uf.format(new x.Z(Se.price.toString()).div(1e6).toNumber(),pt)]}),(0,v.jsx)("br",{className:"block lg:hidden"}),(0,v.jsx)("span",{children:" \u2192 "}),(0,v.jsxs)("span",{children:["$",ne.uf.format(new x.Z(m.price.toString()).div(1e6).toNumber(),pt)]})]}):p:"",g=(0,B.Hd)(de.fromPairValue)&&m.liquidationPrice?new x.Z((0,B.lt)(m.liquidationPrice,6)).toDP(4):null,b=null!==g&&void 0!==g&&g.gt(0)?"$"+ne.uf.format(g.toNumber(),pt):"-",j=!1,y=function(){if(!f)return"";if(!de.fromPairValue)return b;if(null!==Se&&void 0!==Se&&Se.accounting){var e=new x.Z(Se.accounting.liquidationPrice.toString());return j="long"===s?new x.Z(m.liquidationPrice.toString()).gt(e):new x.Z(m.liquidationPrice.toString()).lt(e),(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("span",{children:["$",ne.uf.format(new x.Z(e.toString()).div(1e6).toNumber(),pt)]}),(0,v.jsx)("br",{className:"block lg:hidden"}),(0,v.jsx)("span",{children:" \u2192 "}),(0,v.jsxs)("span",{children:["$",ne.uf.format(new x.Z(m.liquidationPrice.toString()).div(1e6).toNumber(),pt)]})]})}return b}(),N=(0,B.Hd)(de.fromPairValue)?new x.Z(m.feeUsd.toString()).div(1e6).minus(n||0):null,P=(0,rt.y)(N),S=N&&N.gt(1e-6)?"".concat(ne.uf.format(N,P)," USD"):"-",k=new x.Z(Me.account.assets.owned.toString()).sub(Me.account.assets.locked.toString()).mul(new x.Z(Ze)).div(new x.Z(10).pow(Ce.decimals)),C="long"===s?new x.Z(ke.account.pricing.maxGlobalLongSizes.toString()).minus(ke.account.assets.guaranteedUsd.toString()).div(1e6):new x.Z(ke.account.pricing.maxGlobalShortSizes.toString()).minus(ke.account.assets.globalShortSizes.toString()).div(1e6),Z=M.maxPositionUsd.gt(0)?M.maxPositionUsd.minus(Se?Se.sizeUsd.div(1e6):0):new x.Z(Number.MAX_VALUE),L=x.Z.min(k,C,Z),T=L?"$"+ne.uf.format(x.Z.max(L,0).toDP(2).toNumber(),pt):"",_=Me.account.assets.owned.gtn(0)&&Me.account.assets.locked.gtn(0)?new x.Z(Me.account.assets.locked.toString()).div(Me.account.assets.owned.toString()):new x.Z(0),O=new x.Z(Me.account.fundingRateState.hourlyFundingBps.toString()),F=new x.Z(O.div(100)).mul(_),q=u.ag._("{0}% / hr",{0:F.toDP(4).toString()}),W({entryPrice:f,entryPriceText:p,entryPriceTextWithShifting:h,liquidationPrice:g,liquidationPriceText:b,liquidationPriceTextWithShifting:y,feeUsd:N,feeUsdText:S,outstandingFundingFeeUsd:n,outstandingFundingFeeUsdText:i,isNewLiquidationWorse:j}),Y({entryPrice:f,entryPriceText:p,hourlyFundingBps:O,borrowFee:F,borrowFeeText:q,availableLiquidity:L,availableLiquidityText:T,maxPositionUsd:Z,insufficientNewCollateral:o.ltn(0)}),e.next=39;break;case 36:e.prev=36,e.t0=e.catch(2),console.log("Tradepage:",e.t0);case 39:return e.prev=39,E(!1),e.finish(39);case 42:case"end":return e.stop()}}),e,null,[[2,36,39,42]])}))),[Me,Ce,Ze,r.decimals,Se,_e,Oe,ke,M,s,pt,je,a.address,a.decimals,we,w,de.fromPairValue,de.toPairValue]),vt=(0,i.useState)(""),gt=vt[0],wt=vt[1];(0,De.Z)((function(){var e;wt([de.fromPairValue,de.toPairValue,de.leverage,s.toString(),null===we||void 0===we?void 0:we.toString(),null===b||void 0===b||null===(e=b.map((function(e){return e.publicKey.toString()})))||void 0===e?void 0:e.join(",")].join(""))}),500,[de.fromPairValue,de.toPairValue,de.leverage,s.toString(),null===we||void 0===we?void 0:we.toString(),null===b||void 0===b||null===(t=b.map((function(e){return e.publicKey.toString()})))||void 0===t?void 0:t.join(",")]),(0,j.aM)(["perps-fetchViews",gt],(0,o.Z)(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ht();case 2:return e.abrupt("return",null);case 3:case"end":return e.stop()}}),e)}))),{enabled:Boolean(w),refetchInterval:5e3,refetchIntervalInBackground:!1,keepPreviousData:!0,retry:!0,retryDelay:2e3}),(0,i.useEffect)((function(){E(!0)}),[r,a,de.fromPairValue,de.leverage,s]);var bt=(0,i.useMemo)((function(){if(be&&!G.maxPositionUsd.eq(0))return be.gt(G.maxPositionUsd)}),[G.maxPositionUsd,be]),jt=(0,i.useMemo)((function(){if(we&&(0,B.Hd)(de.toPairValue)&&be&&!G.availableLiquidity.eq(0))return be.gt(G.availableLiquidity)}),[G.availableLiquidity,be,we,de.toPairValue]),yt=(0,i.useMemo)((function(){if((0,B.Hd)(de.leverage))return Number(de.leverage)<h.aY}),[de.leverage]),Nt=(0,i.useMemo)((function(){if((0,B.Hd)(de.fromPairValue)&&Ce&&Ze&&we)return _e?Oe?new x.Z(Oe.toString()).div(Math.pow(10,Ce.decimals)).mul(Ze):null:new x.Z(de.fromPairValue).mul(Ze)}),[Ce,Ze,_e,Oe,we,de.fromPairValue]),Pt=(0,i.useMemo)((function(){if((0,B.Hd)(de.fromPairValue)&&Ce&&we&&Nt)return new x.Z(Nt.toFixed(4)).lt(h.IH)}),[de.fromPairValue,Ce,we,Nt]),St=(0,i.useMemo)((function(){return(null===be||void 0===be?void 0:be.gt(0))&&!je}),[be,je]),kt=(0,i.useMemo)((function(){return!de.fromPairValue||!de.toPairValue||U||ve||pe||ue.isSubmitting||U||jt||bt||yt||Pt||St||dt||Boolean(Be)}),[de.fromPairValue,de.toPairValue,U,ve,pe,ue.isSubmitting,jt,bt,yt,Pt,St,dt,Be]),Ct=i.useMemo((function(){if(!de.fromPairValue)return"long"===s?u.ag._("Enter Long Amount"):u.ag._("Enter Short Amount");if(G.availableLiquidity.lte(0)||U)return u.ag._("Loading...");if(de.fromPairValue){if(yt)return u.ag._("Minimum {MINIMUM_LEVERAGE}x Leverage",{MINIMUM_LEVERAGE:h.aY});if(bt||jt)return G.maxPositionUsd.gt(G.availableLiquidity)?u.ag._("Exceeds available liquidity"):u.ag._("Exceeds position limit");if(pe||ve)return u.ag._("Insufficient {0}",{0:ve?"SOL":r.symbol});if(Pt)return u.ag._("Minimum {MINIMUM_COLLATERAL_SIZE_USD} USD collateral",{MINIMUM_COLLATERAL_SIZE_USD:h.IH});if(St)return u.ag._("Insufficient pool collateral");if(dt)return u.ag._("Insufficient SOL");if(ue.isSubmitting)return(0,v.jsxs)("span",{className:"flex justify-center items-center",children:[(0,v.jsx)(S.Z,{className:"!h-4 !w-4",baseColor:"white",spinnerColor:"black"}),(0,v.jsx)("div",{className:"mr-2"}),ue.isSubmitting?u.ag._("Submitting Order"):u.ag._("Loading")]})}return"long"===s?u.ag._("Long {0}",{0:a.symbol}):u.ag._("Short {0}",{0:a.symbol})}),[de.fromPairValue,s,G.availableLiquidity,G.maxPositionUsd,U,a.symbol,yt,bt,jt,pe,ve,r.symbol,Pt,St,dt,ue.isSubmitting]),Zt=(0,C.Z)().promptKeeperOpenPositionNotification,Mt=i.useCallback(function(){var e=(0,o.Z)(c().mark((function e(t){var n,i,l,a;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!kt&&we&&f&&f.adapter.publicKey&&w&&Me&&ke){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,n="long"===s?new(z())(new x.Z(we).mul(1e6).mul(100+k).div(100).round().toFixed()):new(z())(new x.Z(we).mul(1e6).mul(100-k).div(100).round().toFixed()),e.next=6,ge({wallet:f,connection:_,side:s,collateralCustody:Me,positionCustody:ke,inputMint:new R.PublicKey(r.address),priceSlippage:n,collateralTokenDelta:new(z())(new x.Z(t.fromPairValue).mul(Math.pow(10,r.decimals)).toDP(0).toFixed()),sizeUsdDelta:new(z())(new x.Z(t.toPairValue).mul(we).mul(1e6).round().toFixed()),jupiterMinimumOut:_e&&Fe?new(z())(Fe.toString()):null});case 6:if(i=e.sent,l=i.instructions,a=i.positionRequestKey,l.length){e.next=11;break}throw new Error("Failed to create transaction");case 11:return e.next=13,new Promise(function(){var e=(0,o.Z)(c().mark((function e(t,n){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Zt(l,a,(function(){L(),t(!0)}),n);case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 13:return e.abrupt("return",e.sent);case 16:e.prev=16,e.t0=e.catch(2),console.log("Failed to open position!",e.t0);case 19:case"end":return e.stop()}}),e,null,[[2,16]])})));return function(t){return e.apply(this,arguments)}}(),[Me,_,r,kt,_e,Fe,ke,s,Zt,k,we,w,f,L]);(0,nt.Gl)(Te||!_e||null===ze||void 0===ze?void 0:ze.quoteResponse,r.address,(null===Ce||void 0===Ce?void 0:Ce.address)||"");var Lt=(0,et.Z)({selectedRoute:ze,hasEnoughSOL:!ve}).errors,Tt=(0,i.useMemo)((function(){var e=[];return dt&&e.push(u.ag._("We recommend having at least {MINIMUM_SOL_BALANCE} SOL for any transaction",{MINIMUM_SOL_BALANCE:xe.WO})),e}),[dt]);(0,i.useEffect)((function(){W(ot),Y(at)}),[s]);var _t=(0,i.useCallback)((function(){var e=new x.Z(de.leverage).sub(.1).toDP(1);e.lte(h.aY)||mt(e.toString())}),[mt,de.leverage]),Ot=(0,i.useCallback)((function(){var e=new x.Z(de.leverage).add(.1).toDP(1);e.gte(h.jG)||mt(e.toString())}),[mt,de.leverage]),Ft=(0,i.useCallback)((function(){if(G.availableLiquidity&&we){var e=new x.Z(G.availableLiquidity).div(we).mul(.995).toString();ce("toPairValue",e),ft(e)}}),[ft,G.availableLiquidity,ce,we]),qt=(0,y.C9)();return(0,v.jsx)(v.Fragment,{children:(0,v.jsxs)("form",{onSubmit:le(Mt),className:"flex lg:flex-col",children:[(0,v.jsxs)("div",{className:"bg-[#304256] flex flex-col justify-between !w-[calc(100%-110px)] lg:!w-full",children:[(0,v.jsxs)("div",{className:"flex flex-row items-center justify-between space-x-1 lg:space-x-4 px-2 lg:px-4 h-[52px] lg:h-[56px]",children:[(0,v.jsxs)("div",{className:"flex items-center rounded-full bg-[#19232D]",children:[(0,v.jsxs)("button",{type:"button",onClick:function(){return n("long")},className:(0,p.cn)("w-[70px] h-7 lg:h-auto lg:w-20","flex flex-row items-center justify-center font-semibold space-x-2 text-white/50 fill-current border-2 border-transparent rounded-full","px-2 py-1 lg:m-1","long"===s?" !border-perps-green bg-perps-green/10 !text-perps-green":""),children:[(0,v.jsx)("span",{className:"text-xs lg:text-sm leading-none",children:u.ag._("Long")}),(0,v.jsx)(Re,{fill:"inherit",className:"hidden lg:block"})]}),(0,v.jsxs)("button",{type:"button",onClick:function(){return n("short")},className:(0,p.cn)("w-[70px] h-7 lg:h-auto lg:w-20","flex flex-row items-center justify-center font-semibold space-x-2 text-white/50 fill-current border-2 border-transparent rounded-full","px-2 py-1 lg:m-1","short"===s?"!border-perps-red bg-perps-red/10 !text-perps-red":""),children:[(0,v.jsx)("span",{className:"text-xs lg:text-sm leading-none",children:u.ag._("Short")}),(0,v.jsx)(Ee,{fill:"inherit",className:"hidden lg:block"})]})]}),(0,v.jsx)("div",{className:"flex items-center h-7",children:(0,v.jsx)(it.Z,{isLoading:Te,refresh:function(){E(!0),qt([r.address,(null===Ce||void 0===Ce?void 0:Ce.address)||a.address]),He()}})})]}),(0,v.jsxs)("div",{className:"mt-1",children:[(0,v.jsxs)("div",{className:"text-white text-xs font-[500] flex flex-row justify-between px-2 lg:px-4",children:[(0,v.jsx)("p",{children:(0,v.jsx)(A.cC,{id:"You're Paying"})}),(0,v.jsxs)("div",{onClick:ut,className:"flex flex-row items-center space-x-2 text-white/25 fill-current cursor-pointer",children:[(0,v.jsx)(ae.Z,{width:10,height:10}),(0,v.jsx)(Ie.Z,{mintAddress:r.address})]})]}),(0,v.jsx)("div",{className:"px-2",children:(0,v.jsx)("div",{className:(0,p.cn)("bg-[#19232D] rounded-xl relative h-14","mt-1 pl-3 pr-2 py-2","lg:p-4 lg:mt-3"),children:(0,v.jsx)(Ve.Z,{control:se,pair:r,pairName:"fromPairValue",onSubmit:Je,mintsList:me,modalId:"PAIRS_SELECT_FROM_PAIR_MODAL_ID",onChangeWithoutEffect:Ye})})}),(0,v.jsx)("div",{className:"px-2",children:[].concat((0,oe.Z)(Lt),[Be],(0,oe.Z)(Tt)).filter(Boolean).length>0&&(0,v.jsx)("div",{className:"bg-jupiter-red text-white px-3 py-2 rounded-lg text-xs mt-2",children:[].concat((0,oe.Z)(Lt),[Be],(0,oe.Z)(Tt)).filter(Boolean).map((function(e){return(0,v.jsxs)("span",{className:"flex space-x-2 items-center",children:[(0,v.jsx)(tt.Z,{}),(0,v.jsx)("span",{children:e})]},e)}))})}),(0,v.jsx)("div",{className:"mt-2 text-white text-xs font-[500] flex flex-row px-2 lg:px-4",children:(0,v.jsx)(A.cC,{id:"<0>Size of</0><1>{0}</1>",values:{0:"long"===s?"Long":"Short"},components:{0:(0,v.jsx)("span",{}),1:(0,v.jsx)("span",{className:"ml-0.5"})}})}),(0,v.jsx)("div",{className:"px-2 lg:px-3",children:(0,v.jsx)("div",{className:(0,p.cn)("bg-[#19232D] rounded-xl relative","mt-1 p-2 py-3","lg:mt-3 lg:p-4"),children:(0,v.jsx)(Ve.Z,{disableTokenSelect:!0,control:se,pair:a,pairName:"toPairValue",onSubmit:Qe,mintsList:(0,i.useMemo)((function(){return N.nonStableTokens.map((function(e){return e.address}))}),[N]),modalId:"PAIRS_SELECT_TO_PAIR_MODAL_ID",onChangeWithoutEffect:ft,hideUSDValue:!0})})}),(0,v.jsxs)("div",{className:"mt-2 px-2 lg:px-4 w-full h-auto justify-between items-center",children:[(0,v.jsx)("span",{className:"text-xs",children:u.ag._("Leverage")}),(0,v.jsxs)("div",{className:"mt-2 rounded-xl bg-black/50 w-full flex items-center justify-center p-3 !h-[38px] lg:!h-[56px] relative",children:[(0,v.jsx)("button",{type:"button",onClick:_t,className:"absolute top-1 left-2.5 text-lg px-1 lg:p-2 text-v2-lily/75",children:"-"}),(0,v.jsx)(I.Qr,{name:"leverage",control:se,render:function(e){var t=e.field,n=t.onChange,i=t.value;return(0,v.jsx)(Ue.Z,{decimals:1,onChange:n,value:i,disabled:ue.isSubmitting,className:"font-semibold text-white text-xs lg:text-sm !text-center w-full h-full",onChangeWithoutEffect:function(e){return mt(e.split("x")[0])},customWithValueLimit:function(e){return!!e&&e<=h.jG},suffix:"x"})}}),(0,v.jsx)("button",{type:"button",onClick:Ot,className:"absolute top-1 right-2.5 text-lg px-1 lg:p-2 text-v2-lily/75",children:"+"})]})]}),(0,v.jsx)("div",{className:"pt-4 w-full flex flex-row",children:(0,v.jsx)(ct,{value:Number(de.leverage),setValue:function(e){ce("leverage",String(e)),mt(String(e))},activeColors:"long"===s?"#32DF7B":"#EB5757",borderColor:"long"===s?"#28A95E":"#B53B3B",className:"px-4 lg:px-6"})}),(0,v.jsxs)("div",{className:"border-t border-t-black/10 lg:pt-4 px-2 lg:px-4",children:[(0,v.jsx)("div",{className:"hidden lg:block",children:(0,v.jsx)(Ke,{collateralInput:Nt,orderInfoLoading:U})}),(0,v.jsx)("div",{className:"hidden lg:block",children:(0,v.jsx)($e,{sizeUsd:be,collateralInput:Nt,orderInfoLoading:U})}),bt||jt?(0,v.jsx)(ie.Z,{iconSize:14,className:"!text-jupiter-primary !p-2 rounded-lg bg-jupiter-primary/5",message:(0,v.jsxs)("div",{children:[G.maxPositionUsd.gt(G.availableLiquidity)?(0,v.jsx)("p",{children:u.ag._("Due to AUM cap, your desired size exceeds available liquidity of ${0}.",{0:ne.uf.format(G.availableLiquidity,0)})}):(0,v.jsx)("p",{children:u.ag._("A position cannot exceed ${0}.",{0:ne.uf.format(G.maxPositionUsd,0)})}),(0,v.jsx)("p",{onClick:Ft,className:"underline cursor-pointer",children:u.ag._("Click here to reduce automatically")})]})}):null,Se&&G.insufficientNewCollateral&&$.isNewLiquidationWorse?(0,v.jsx)(ie.Z,{iconSize:14,className:"!text-warning !p-2 rounded-lg bg-warning/10",message:(0,v.jsx)(A.cC,{id:"<0>Borrow fees due of {0}, your new order will result in a worse liquidation price, try increasing your collateral, reduce leverage, or </0><1>manage collateral</1>.",values:{0:$.outstandingFundingFeeUsdText},components:{0:(0,v.jsx)("p",{}),1:(0,v.jsx)("button",{type:"button",className:"underline decoration-dashed decoration-1 underline-offset-[3px] decoration-warning",onClick:function(){return d({positionAccountPubkey:Se.publicKey})}})}})}):null]}),(0,v.jsx)("div",{className:"mt-3 px-2 lg:px-4 pb-4",children:null!==f&&void 0!==f&&f.adapter.publicKey?(0,v.jsx)("button",{type:"submit",className:(0,p.cn)("font-semibold w-full  rounded-lg items-center p-px border-none",{"bg-perps-green text-[#155530] hover:bg-opacity-80":"long"===s,"bg-perps-red text-[#371111] hover:bg-opacity-80":"short"===s,"opacity-50 cursor-not-allowed":kt}),disabled:kt,children:(0,v.jsx)("div",{className:(0,p.cn)("flex items-center justify-center rounded-lg","lg:px-8 lg:py-4","p-3"),children:(0,v.jsx)("span",{className:"text-center",children:Ct})})}):(0,v.jsx)(lt.uS,{buttonClassName:"w-full !bg-transparent",overrideContent:(0,v.jsx)(Ae.Z,{className:"w-full",size:"md",children:(0,v.jsx)("span",{children:(0,v.jsx)(A.cC,{id:"Connect Wallet"})})})})})]})]}),(0,v.jsx)(Xe,{positionDirection:s,positionInfo:G,toPairTokenInfo:a,orderInfo:$,orderInfoLoading:U,collateralInput:Nt,sizeUsd:be})]})})},dt=n(87648),xt=n(68586),mt=n(72997),ft=n(89953),pt=n(20787),ht=n(11352),vt=function(e){var t=e.price,n=e.precision,s=e.children,l=(0,i.useState)(""),r=l[0],o=l[1],a=(0,ne.D9)(null===t||void 0===t?void 0:t.toDP(n)),c=(0,i.useRef)(Date.now());return(0,i.useEffect)((function(){var e=null===t||void 0===t?void 0:t.toDP(n);if(a)return null!==e&&void 0!==e&&e.gt(a)?(o("text-green-500"),void(c.current=Date.now())):null!==e&&void 0!==e&&e.lt(a)?(o("text-red-500"),void(c.current=Date.now())):void(null!==e&&void 0!==e&&e.eq(a)&&Date.now()-c.current>1e3&&o(""));Date.now()-c.current>1e3&&o("")}),[t]),(0,v.jsx)("span",{className:(0,p.cn)("transition-all duration-100 text-white",r),children:s})},gt=n(3380),wt=n(99384),bt=function(e){var t=e.loading,n=e.emptyText,i=(0,y.Os)().wallet;return(0,v.jsx)("div",{className:"flex flex-col items-center space-y-2 rounded-lg mt-4 bg-white-5 py-[60px] justify-start dark:border-white-10 mx-5 lg:mx-0",children:null!==i&&void 0!==i&&i.adapter.publicKey?(0,v.jsx)(v.Fragment,{children:t?(0,v.jsxs)("div",{className:"flex items-center",children:[(0,v.jsx)("div",{className:"mr-2 fill-current animate-spin",children:(0,v.jsx)(wt.Z,{width:8,height:8})}),(0,v.jsx)("div",{className:"text-sm dark:text-white/50",children:(0,v.jsx)(A.cC,{id:"Loading data"})})]}):(0,v.jsx)("div",{className:"text-sm dark:text-white/50",children:n})}):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{className:"text-sm dark:text-white/50",children:(0,v.jsx)(A.cC,{id:"Connect your wallet to see your Trades"})}),(0,v.jsx)(gt.T,{})]})})},jt=n(14518),yt=function(e,t){var n=ne.uf.format(e.abs().div(1e6),t);return e.gt(0)?"+$".concat(n):"-$".concat(n)},Nt=function(e){var t=e.positionAccount;if(!t.accounting)return(0,v.jsx)(O.O,{className:"!w-24 !h-9"});var n=t.accounting,i=n.unrealizedPNL,s=n.unrealizedPNLPct,l=n.positionValue,r=n.initialCollateral,o=n.fundingFeeUsd,a=n.openPositionFeeUsd,c=n.closePositionFeeUsd,d=n.pnlAfterFeesUsd,x=(0,rt.y)(l);return(0,v.jsxs)("div",{className:(0,p.cn)("text-sm text-v2-lily"),children:[(0,v.jsx)("div",{className:"flex",children:(0,v.jsx)(Se.Z,{variant:"dark",placement:"top",content:(0,v.jsxs)("div",{className:"flex flex-col text-white cursor-help",children:[(0,v.jsx)("p",{children:u.ag._("Net Value:")}),(0,v.jsx)("p",{className:"mb-4",children:u.ag._("Initial collateral + PnL - Fees")}),(0,v.jsxs)("div",{className:"flex justify-between mb-1",children:[(0,v.jsx)("span",{className:"text-white/50",children:u.ag._("Initial Collateral:")}),(0,v.jsxs)("span",{children:["$",r.add(a).div(1e6).toFixed(x)]})]}),(0,v.jsxs)("div",{className:"flex justify-between mb-1",children:[(0,v.jsx)("span",{className:"text-white/50",children:u.ag._("PnL:")}),(0,v.jsx)("span",{children:yt(i,x)})]}),(0,v.jsxs)("div",{className:"flex justify-between mb-1",children:[(0,v.jsx)("span",{className:"text-white/50",children:u.ag._("Borrow Fee:")}),(0,v.jsxs)("span",{children:["-$",o.div(1e6).toFixed(x)]})]}),(0,v.jsxs)("div",{className:"flex justify-between mb-1",children:[(0,v.jsx)("span",{className:"text-white/50",children:u.ag._("Open Fee (0.1%):")}),(0,v.jsxs)("span",{children:["-$",a.div(1e6).toFixed(x)]})]}),(0,v.jsxs)("div",{className:"flex justify-between mb-1",children:[(0,v.jsx)("span",{className:"text-white/50",children:u.ag._("Close Fee (0.1%):")}),(0,v.jsxs)("span",{children:["-$",c.div(1e6).toFixed(x)]})]}),(0,v.jsxs)("div",{className:"flex justify-between",children:[(0,v.jsx)("span",{className:"text-white/50",children:u.ag._("PnL After Fees:")}),(0,v.jsx)("span",{children:yt(d,x)})]})]}),children:(0,v.jsxs)("span",{className:"underline decoration-dashed decoration-1 underline-offset-[3px] decoration-white/50 cursor-help",children:["$",ne.uf.format(l.div(1e6),x)]})})}),(0,v.jsx)(X,{changePct:s,pnl:i})]})};function Pt(e){return St.apply(this,arguments)}function St(){return(St=(0,o.Z)(c().mark((function e(t){var n,i,s,l,r,o,a,u;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.wallet,i=t.connection,s=t.positionAccount,l=t.positionRequestAccount,r=t.sizeUsdDelta,o=t.triggerPrice,a=n.adapter.publicKey){e.next=4;break}throw new Error("Wallet not connected");case 4:return u=(0,me.h)(n,i),e.prev=5,e.next=8,u.methods.updateDecreasePositionRequest({sizeUsdDelta:r,triggerPrice:o}).accounts({owner:a,perpetuals:h.TJ,pool:h.FW,position:s.publicKey,positionRequest:l,custody:s.custody.publicKey,custodyOracleAccount:s.custody.account.oracle.oracleAccount}).instruction();case 8:return e.abrupt("return",e.sent);case 11:throw e.prev=11,e.t0=e.catch(5),console.log(e.t0),e.t0;case 15:case"end":return e.stop()}}),e,null,[[5,11]])})))).apply(this,arguments)}function kt(e){return Ct.apply(this,arguments)}function Ct(){return(Ct=(0,o.Z)(c().mark((function e(t){var n,i,s,r,o,a,u,d,x,m,f,p,v,g,w,b,j,y,N,P;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.wallet,i=t.connection,s=t.cancelTP,r=t.cancelSL,e.prev=1,o=n.adapter.publicKey){e.next=5;break}throw new Error("Wallet not connected");case 5:if(a=(0,me.h)(n,i),u=[],d=[],!s){e.next=21;break}return e.next=11,(0,fe.c1)(s.positionRequestMint,o,i);case 11:return x=e.sent,m=(0,l.Z)(x,2),f=m[0],p=m[1],v=R.PublicKey.findProgramAddressSync([s.positionRequestPubkey.toBuffer(),de.TOKEN_PROGRAM_ID.toBuffer(),s.positionRequestMint.toBuffer()],de.ASSOCIATED_TOKEN_PROGRAM_ID)[0],p&&u.push(p),e.next=19,a.methods.closePositionRequest({}).accounts({keeper:null,owner:o,ownerAta:f,pool:h.FW,positionRequest:s.positionRequestPubkey,positionRequestAta:v,position:s.positionPubkey}).instruction();case 19:g=e.sent,d.push(g);case 21:if(!r){e.next=34;break}return e.next=24,(0,fe.c1)(r.positionRequestMint,o,i);case 24:return w=e.sent,b=(0,l.Z)(w,2),j=b[0],y=b[1],N=R.PublicKey.findProgramAddressSync([r.positionRequestPubkey.toBuffer(),de.TOKEN_PROGRAM_ID.toBuffer(),r.positionRequestMint.toBuffer()],de.ASSOCIATED_TOKEN_PROGRAM_ID)[0],y&&u.push(y),e.next=32,a.methods.closePositionRequest({}).accounts({keeper:null,owner:o,ownerAta:j,pool:h.FW,positionRequest:r.positionRequestPubkey,positionRequestAta:N,position:r.positionPubkey}).instruction();case 32:P=e.sent,d.push(P);case 34:return e.abrupt("return",{preInstructions:u,instructions:d});case 37:throw e.prev=37,e.t0=e.catch(1),console.log(e.t0),e.t0;case 41:case"end":return e.stop()}}),e,null,[[1,37]])})))).apply(this,arguments)}function Zt(e){return Mt.apply(this,arguments)}function Mt(){return(Mt=(0,o.Z)(c().mark((function e(t){var n,i,s,l,r,o,a,u,d,x,m,f,p,h,v,g,w,b,j,y;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.wallet,i=t.connection,s=t.positionAccount,t.custody,l=t.desiredMint,r=t.tpPrice,o=t.slPrice,a=t.updateTPPrice,u=t.updateSLPrice,d=t.cancelTP,x=t.cancelSL,e.prev=1,n.adapter.publicKey){e.next=5;break}throw new Error("Wallet not connected");case 5:if(!([r,o,a,u,d,x].filter(Boolean).length>2)){e.next=7;break}throw new Error("Only two actions can be performed at a time");case 7:if(m=[],f=[],!r&&!o){e.next=17;break}return e.next=12,(0,P.Zn)({wallet:n,connection:i,positionAccount:s,desiredMint:l,tpPrice:r,slPrice:o});case 12:p=e.sent,h=p.preInstructions,v=p.instructions,h&&m.push.apply(m,(0,oe.Z)(h)),v&&f.push.apply(f,(0,oe.Z)(v));case 17:if(!a){e.next=22;break}return e.next=20,Pt({wallet:n,connection:i,positionAccount:s,positionRequestAccount:a.positionRequestAccount,sizeUsdDelta:new ue.BN(0),triggerPrice:a.triggerPrice});case 20:g=e.sent,f.push(g);case 22:if(!u){e.next=27;break}return e.next=25,Pt({wallet:n,connection:i,positionAccount:s,positionRequestAccount:u.positionRequestAccount,sizeUsdDelta:new ue.BN(0),triggerPrice:u.triggerPrice});case 25:w=e.sent,f.push(w);case 27:if(!d&&!x){e.next=35;break}return e.next=30,kt({wallet:n,connection:i,cancelTP:d,cancelSL:x});case 30:b=e.sent,j=b.preInstructions,y=b.instructions,j&&m.push.apply(m,(0,oe.Z)(j)),y&&f.push.apply(f,(0,oe.Z)(y));case 35:return e.abrupt("return",[].concat(m,f));case 38:throw e.prev=38,e.t0=e.catch(1),console.log(e.t0),e.t0;case 42:case"end":return e.stop()}}),e,null,[[1,38]])})))).apply(this,arguments)}var Lt=n(39694),Tt=n.n(Lt)()((function(e){var t,n,i,s;return{hasTp:null!==(t=e.takeProfitPositionRequest)&&void 0!==t&&t.account.triggerPrice?new x.Z(null===(n=e.takeProfitPositionRequest)||void 0===n?void 0:n.account.triggerPrice.toString()).div(1e6):null,hasSl:null!==(i=e.stopLossPositionRequest)&&void 0!==i&&i.account.triggerPrice?new x.Z(null===(s=e.stopLossPositionRequest)||void 0===s?void 0:s.account.triggerPrice.toString()).div(1e6):null}})),_t=function(e){var t,n,s=e.positionAccount,l=e.tpPrice,r=e.slPrice,o=(0,h.tc)().oraclePrices,a=(0,i.useMemo)((function(){return"long"===s.side}),[s.side]),c=(0,i.useMemo)((function(){var e,t,n=s.custody.account.mint.toString();return o&&o[n]?a?null===(e=o[n])||void 0===e?void 0:e.decreaseLong:null===(t=o[n])||void 0===t?void 0:t.decreaseShort:null}),[s.custody.account.mint,o,a]),u=(0,i.useMemo)((function(){return c?c.toNearest(.01,x.Z.ROUND_DOWN):null}),[c]),d=(0,i.useMemo)((function(){var e,t;return c&&null!==(e=s.accounting)&&void 0!==e&&e.liquidationPrice?(a?new x.Z(null===(t=s.accounting)||void 0===t?void 0:t.liquidationPrice.div(1e6).toFixed(2)):c).toNearest(.01,x.Z.ROUND_DOWN):null}),[c,null===(t=s.accounting)||void 0===t?void 0:t.liquidationPrice,a]),m=(0,i.useMemo)((function(){var e,t;return c&&null!==(e=s.accounting)&&void 0!==e&&e.liquidationPrice?(a?c:new x.Z(null===(t=s.accounting)||void 0===t?void 0:t.liquidationPrice.div(1e6).toFixed(2))).toNearest(.01,x.Z.ROUND_DOWN):null}),[c,null===(n=s.accounting)||void 0===n?void 0:n.liquidationPrice,a]),f=(0,i.useMemo)((function(){return!(!l.floatValue||!u)&&(a?new x.Z(l.floatValue).gte(u):new x.Z(l.floatValue).lte(u))}),[u,a,l.floatValue]),p=(0,i.useMemo)((function(){return!!(r.floatValue&&d&&m)&&(a?new x.Z(r.floatValue).gte(d)&&new x.Z(r.floatValue).lte(m):new x.Z(r.floatValue).lte(m)&&new x.Z(r.floatValue).gte(d))}),[m,d,a,r]),v=(0,i.useCallback)((function(e){if(!s.accounting)return null;var t=e.sub(s.price).mul(a?1:-1),n=new x.Z(s.sizeUsd.toString()).div(new x.Z(s.price.toString())).mul(t),i=new x.Z(n).minus(s.accounting.totalFeeUsd);return{positionValue:new x.Z(s.sizeUsd.toString()).add(i),pnlRate:i.div(new x.Z(s.accounting.initialCollateral.toString())).mul(100),pnl:i}}),[a,s.accounting,s.price,s.sizeUsd]),g=(0,i.useMemo)((function(){return l.floatValue&&f?v(new x.Z(l.floatValue).mul(1e6)):null}),[l.floatValue,f,v]),w=(0,i.useMemo)((function(){return r.floatValue&&p?v(new x.Z(r.floatValue).mul(1e6)):null}),[r.floatValue,p,v]),b=Tt(s),j=b.hasTp,y=b.hasSl;return{showTPChanged:(0,i.useMemo)((function(){return!(null===j||void 0===j||!j.gt(0)||!l.floatValue||new x.Z(l.floatValue).eq(j)||!f)}),[j,f,l.floatValue]),showTPRemoved:(0,i.useMemo)((function(){return!(null===j||void 0===j||!j.gt(0)||l.floatValue)}),[j,l.floatValue]),showSLChanged:(0,i.useMemo)((function(){return!(null===y||void 0===y||!y.gt(0)||!r.floatValue||new x.Z(r.floatValue).eq(y)||!p)}),[y,p,r.floatValue]),showSLRemoved:(0,i.useMemo)((function(){return!(null===y||void 0===y||!y.gt(0)||r.floatValue)}),[y,r.floatValue]),minimumTPPrice:u,minimumSLPrice:d,maximumSLPrice:m,isWithinTPRange:f,isWithinSLRange:p,expectedPositionValueAtSL:w,expectedPositionValueAtTP:g}};function Ot(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Ft(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ot(Object(n),!0).forEach((function(t){(0,ce.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ot(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function qt(e){var t,n,i;return e?{floatValue:null!==(t=null===e||void 0===e?void 0:e.toNumber())&&void 0!==t?t:void 0,formattedValue:null!==(n=null===e||void 0===e?void 0:e.toString())&&void 0!==n?n:"",value:null!==(i=null===e||void 0===e?void 0:e.toString())&&void 0!==i?i:""}:{floatValue:void 0,formattedValue:"",value:""}}var Dt=function(e){var t=e.open,n=e.onClose,s=e.positionAccount,l=e.type,r=(0,h.tc)(),a=r.viewClient,d=r.oraclePrices,x=(0,y.Bn)(),m=x.connection,f=x.getTokenInfo,g=x.tokenMap,w=(0,y.Os)().wallet,b=(0,C.Z)().promptKeeperCreateTPSLNotification,j=(0,i.useMemo)((function(){return f(s.custody.account.mint.toString())}),[f,s.custody.account.mint]),N=i.useRef(null);(0,B.O3)(N,(function(){var e;return null===(e=N.current)||void 0===e?void 0:e.close()}));var P=(0,i.useCallback)((function(){var e;null===(e=N.current)||void 0===e||e.close(),n()}),[n,N]);(0,i.useEffect)((function(){if(N.current&&(t?N.current.open||N.current.show():N.current.close()),t){var e=N.current;return null===e||void 0===e||e.addEventListener("close",P),function(){null===e||void 0===e||e.removeEventListener("close",P)}}}),[P,t]);var k=(0,i.useMemo)((function(){return f(s.collateralCustody.account.mint.toString())}),[f,s.collateralCustody.account.mint]),Z=Tt(s),M=Z.hasTp,L=Z.hasSl,T=(0,I.cI)({defaultValues:{tpPrice:qt(M),slPrice:qt(L)}}),_=T.control,O=T.handleSubmit,F=T.watch,q=(T.setValue,T.formState),D=F("tpPrice"),V=F("slPrice"),E=_t({positionAccount:s,tpPrice:D,slPrice:V}),z=E.expectedPositionValueAtSL,K=E.expectedPositionValueAtTP,$=(0,i.useState)(null),W=$[0],H=$[1],G=(0,i.useMemo)((function(){var e=s.takeProfitPositionRequest||s.stopLossPositionRequest;if(e)return e}),[s.stopLossPositionRequest,s.takeProfitPositionRequest]);(0,i.useEffect)((function(){G&&H(g.get(G.account.mint.toString())||null),!W&&k&&H(k)}),[k,G,W,g]);var Y=(0,i.useMemo)((function(){var e,t,n=s.custody.account.mint.toString();return d&&d[n]?"long"===s.side?null===(e=d[n])||void 0===e?void 0:e.decreaseLong:null===(t=d[n])||void 0===t?void 0:t.decreaseShort:null}),[d,s.custody.account.mint,s.side]),Q=(0,i.useMemo)((function(){return q.isSubmitting}),[q.isSubmitting]),ee=(0,i.useCallback)((0,o.Z)(c().mark((function e(){var t,n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(w&&w.adapter.publicKey&&j&&a&&Y&&W){e.next=2;break}return e.abrupt("return");case 2:if(e.prev=2,t="tp"===l&&s.takeProfitPositionRequest?{cancelTP:{positionPubkey:s.publicKey,positionRequestPubkey:s.takeProfitPositionRequest.publicKey,positionRequestMint:s.takeProfitPositionRequest.account.mint},cancelSL:null}:"sl"===l&&s.stopLossPositionRequest?{cancelTP:null,cancelSL:{positionPubkey:s.publicKey,positionRequestPubkey:s.stopLossPositionRequest.publicKey,positionRequestMint:s.stopLossPositionRequest.account.mint}}:void 0){e.next=6;break}throw new Error("No cancel action found!");case 6:return e.next=8,Zt(Ft({wallet:w,connection:m,positionAccount:s,custody:s.custody.account,desiredMint:new R.PublicKey(W.address),tpPrice:null,slPrice:null,updateTPPrice:null,updateSLPrice:null},t));case 8:return n=e.sent,e.next=11,new Promise(function(){var e=(0,o.Z)(c().mark((function e(t,i){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b(n,(function(e){P(),t(e)}),(function(e){i(e)}),"tp"===l?u.ag._("Removing Take Profit..."):u.ag._("Removing Stop Loss..."));case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 11:return e.abrupt("return",e.sent);case 14:e.prev=14,e.t0=e.catch(2),console.log("Failed to submit position request!",e.t0);case 17:case"end":return e.stop()}}),e,null,[[2,14]])}))),[w,j,a,Y,W,m,s,l,b,P]);return(0,v.jsx)(te.Z,{open:t,onClose:n,children:(0,v.jsxs)("form",{className:"relative w-full lg:max-w-[400px] bg-v2-perps-modal rounded-lg",children:[(0,v.jsx)("div",{className:"p-6 font-semibold text-lg text-v2-lily",children:"tp"===l?u.ag._("Remove Take Profit"):u.ag._("Remove Stop Loss")}),(0,v.jsx)("div",{className:"flex absolute top-5 lg:top-8 right-8 z-10 text-v2-lily/[.25] fill-current cursor-pointer",onClick:P,children:(0,v.jsx)(J.Z,{width:12,height:12})}),(0,v.jsxs)("div",{className:"max-h-[80vh] overflow-y-auto",children:[(0,v.jsxs)("div",{className:"px-6",children:[(0,v.jsx)("div",{className:"flex text-sm whitespace-nowrap flex-wrap text-v2-lily/50",children:(0,v.jsx)(A.cC,{id:"<0>{0}</0><1>{1}?</1>",values:{0:u.ag._("Are you sure you want to remove your"),1:"tp"===l?u.ag._("take profit"):u.ag._("stop loss")},components:{0:(0,v.jsx)("p",{}),1:(0,v.jsx)("p",{className:"mx-1"})}})}),"tp"===l?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{className:"mt-5",children:(0,v.jsxs)("div",{className:"flex justify-between items-end leading-none",children:[(0,v.jsx)("div",{className:"text-v2-lily text-sm font-semibold",children:u.ag._("Take Profit Price:")}),K?(0,v.jsx)("div",{className:"text-v2-lily/[.25] hover:text-v2-lily text-xs",children:(0,v.jsx)(X,{changePct:K.pnlRate,pnl:K.pnl})}):null]})}),(0,v.jsx)("div",{className:"mt-2 rounded-lg bg-v2-perps-input pl-2 pr-4 py-3.5 text-md text-right",children:(0,v.jsx)(I.Qr,{name:"tpPrice",control:_,render:function(e){var t=e.field,n=t.onChange,i=t.value;return(0,v.jsx)(U.Z,{disabled:!0,decimals:6,onChange:n,value:i.value,className:"disabled:cursor-not-allowed !outline-none !text-right w-full !text-sm",placeholder:"0.00",suffix:" USD"})}})}),(0,v.jsx)("div",{className:"mt-1 space-y-1",children:K?(0,v.jsx)("p",{className:"text-xs text-v2-lily/30",children:u.ag._("Expected position value: ${0}",{0:K.positionValue.div(1e6).toFixed(2)})}):null})]}):null,"sl"===l?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{className:"mt-5",children:(0,v.jsxs)("div",{className:"flex justify-between items-end leading-none",children:[(0,v.jsx)("div",{className:"text-v2-lily text-sm font-semibold",children:u.ag._("Stop Loss Price:")}),z?(0,v.jsx)("div",{className:"text-v2-lily/[.25] hover:text-v2-lily text-xs",children:(0,v.jsx)(X,{changePct:z.pnlRate,pnl:z.pnl})}):null]})}),(0,v.jsx)("div",{className:"mt-2 rounded-lg bg-v2-perps-input pl-2 pr-4 py-3.5 text-md text-right",children:(0,v.jsx)(I.Qr,{name:"slPrice",control:_,render:function(e){var t=e.field,n=t.onChange,i=t.value;return(0,v.jsx)(U.Z,{disabled:!0,decimals:6,onChange:n,value:i.value,className:"disabled:cursor-not-allowed !outline-none !text-right w-full !text-sm",placeholder:"0.00",suffix:" USD"})}})}),(0,v.jsx)("div",{className:"mt-1 space-y-1",children:z?(0,v.jsx)("span",{className:"text-xs text-v2-lily/30",children:u.ag._("Expected position value: ${0}",{0:z.positionValue.div(1e6).toFixed(2)})}):null})]}):null]}),(0,v.jsxs)("div",{className:"w-full text-xs flex p-6 space-x-3",children:[q.isSubmitting?null:(0,v.jsx)("button",{type:"button",className:(0,p.cn)("w-full py-2.5 px-6 border rounded-lg border-v2-lily/10 text-v2-lily bg-v2-lily/5 hover:bg-v2-lily/10 text-sm font-semibold disabled:cursor-not-allowed disabled:opacity-20",{"opacity-50 curosr-not-allowed":q.isSubmitting}),disabled:q.isSubmitting,onClick:P,children:(0,v.jsx)("span",{children:u.ag._("Cancel")})}),(0,v.jsx)("button",{type:"button",className:(0,p.cn)("w-full py-2.5 px-6 border rounded-lg border-labs/20 text-labs hover:bg-labs/5 text-sm font-semibold disabled:cursor-not-allowed disabled:opacity-20",{"opacity-50 curosr-not-allowed":q.isSubmitting||Q}),disabled:Q,onClick:O(ee),children:q.isSubmitting?(0,v.jsxs)("span",{className:"flex justify-center items-center",children:[(0,v.jsx)(S.Z,{className:"!h-4 !w-4",baseColor:"white",spinnerColor:"black"}),(0,v.jsx)("div",{className:"mr-2"}),"tp"===l?u.ag._("Removing Take Profit"):u.ag._("Removing Stop Loss")]}):(0,v.jsx)("span",{className:"text-center",children:u.ag._("Confirm")})})]})]})]})})},Vt=function(e){var t=e.width,n=void 0===t?15:t,i=e.height,s=void 0===i?15:i;return(0,v.jsx)("svg",{width:n,height:s,viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,v.jsx)("path",{id:"Icon",d:"M11.9999 6.66665L9.33319 3.99998M1.6665 14.3333L3.92275 14.0826C4.19841 14.052 4.33624 14.0367 4.46507 13.995C4.57936 13.958 4.68814 13.9057 4.78843 13.8396C4.90147 13.765 4.99953 13.6669 5.19565 13.4708L13.9999 4.66665C14.7362 3.93027 14.7362 2.73636 13.9999 1.99998C13.2635 1.2636 12.0696 1.2636 11.3332 1.99998L2.52899 10.8042C2.33287 11.0003 2.23481 11.0983 2.16026 11.2114C2.09413 11.3117 2.04185 11.4205 2.00485 11.5347C1.96314 11.6636 1.94783 11.8014 1.9172 12.0771L1.6665 14.3333Z",stroke:"currentColor",strokeWidth:"1.3",strokeLinecap:"round",strokeLinejoin:"round"})})},At=function(e){var t=e.width,n=void 0===t?12:t,i=e.height,s=void 0===i?12:i;return(0,v.jsx)("svg",{width:n,height:s,viewBox:"0 0 12 12",fill:"inherit",fillOpacity:0,xmlns:"http://www.w3.org/2000/svg",children:(0,v.jsx)("path",{d:"M5 1.5H8M2 3H11M10 3L9.64936 8.25964C9.59675 9.04877 9.57044 9.44333 9.40001 9.7425C9.24996 10.0059 9.02362 10.2176 8.75083 10.3498C8.44098 10.5 8.04555 10.5 7.25467 10.5H5.74533C4.95445 10.5 4.55902 10.5 4.24917 10.3498C3.97638 10.2176 3.75004 10.0059 3.59999 9.7425C3.42956 9.44333 3.40325 9.04877 3.35064 8.25965L3 3M5.5 5.25V7.75M7.5 5.25V7.75",stroke:"currentColor",strokeWidth:"1.3",strokeLinecap:"round",strokeLinejoin:"round"})})},It=n(86150),Ut=function(e){var t,n,s,r,o,a,c,d,m,f,g,w,b,j,P,S,C,Z,M,L=e.positionAccount,T=e.onSelectMarket,_=e.onShowEditCollateralDialog,F=e.onShowCloseConfirmationDialog,q=e.onShowEditTPSLDialog,D=e.setShowPerpsShareDialog,V=(0,h.tc)().oraclePrices,I=(0,y.Bn)().getTokenInfo,U=(0,i.useMemo)((function(){return I(L.custody.account.mint.toString())}),[I,L.custody.account.mint]),R=(0,N.KO)(k.l.isClosingAllPositions),E=(0,l.Z)(R,1)[0],z=(0,i.useCallback)((function(){L&&!E&&F({positionAccountPubkey:L.publicKey})}),[E,F,L]),B=null!==(t=L.accounting)&&void 0!==t&&t.unrealizedPNL.abs().gt(100)?2:4,K=(0,i.useState)(!1),$=K[0],W=K[1],H=(0,i.useMemo)((function(){var e;return V&&(null===(e=V[L.custody.account.mint.toString()])||void 0===e?void 0:e.buyLp)}),[V,L.custody.account.mint]),G=(0,rt.y)(H),Y=(0,i.useCallback)((function(){U&&H&&L.accounting&&D({symbol:null===U||void 0===U?void 0:U.symbol,leverage:L.leverage.toFixed(2),side:L.side,entryPrice:ne.uf.format(L.price.div(1e6),G),markPrice:ne.uf.format(H,G),openedDate:(0,jt.Z)(new Date(1e3*L.position.openTime.toNumber()),"MMM dd, kk:mm O"),pnlPercentage:L.accounting.unrealizedPNL.gt(0)?L.accounting.unrealizedPNLPct.toDP(2):L.accounting.unrealizedPNLPct.toDP(2).mul(-1)})}),[U,H,L.accounting,L.leverage,L.side,L.price,L.position.openTime,D,G]),J=(0,i.useMemo)((function(){return L?L.sizeUsd.div(L.price):null}),[L]);return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("div",{className:(0,p.cn)("hidden 2xl:flex","justify-between items-center rounded-lg h-[72px] min-w-[1092px] border-b border-b-v2-lily/[0.02] overflow-x-hidden"),children:[(0,v.jsxs)("div",{onClick:function(){return T(L)},className:"cursor-pointer pl-2 py-3 flex text-white/[.75] items-center text-xs w-[130px]",children:[(0,v.jsx)(Q.Z,{info:U}),(0,v.jsxs)("div",{className:"ml-2",children:[(0,v.jsx)(Se.Z,{variant:"dark",placement:"top",content:(0,v.jsxs)("div",{className:"leading-none space-y-2",children:[(0,v.jsx)("p",{className:"text-xs",children:(0,v.jsx)(A.cC,{id:"Click on a row to select the position's market, then use the trade box to increase your position size if needed."})}),(0,v.jsx)("p",{className:"text-xs",children:(0,v.jsx)(A.cC,{id:'Use the "Close" button to reduce your position size, or to set stop-loss / take-profit orders.'})})]}),children:(0,v.jsx)("p",{className:"underline font-semibold decoration-dashed decoration-1 underline-offset-[3px] decoration-white/50 text-sm text-v2-lily",children:null===U||void 0===U?void 0:U.symbol})}),(0,v.jsxs)("p",{className:"text-xs text-white/75",children:[L.leverage.toFixed(2),"x ",L.side]})]})]}),(0,v.jsx)("div",{className:"pl-2 py-3 flex text-white/[.75] items-center text-xs w-[128px]",children:(0,v.jsx)(Nt,{positionAccount:L})}),(0,v.jsxs)("div",{className:"pl-2 py-3 flex flex-col text-xs w-[70px]",children:[(0,v.jsx)("span",{className:"text-white/[.75]",children:L.sizeUsd?"$"+L.sizeUsd.div(1e6).toFixed(2):(0,v.jsx)(O.O,{className:"!h-4 !w-10"})}),(0,v.jsx)("span",{className:"text-v2-lily/40 whitespace-nowrap flex",children:J?(0,v.jsxs)(v.Fragment,{children:[(0,ee.M)({value:J.toDP(null===U||void 0===U?void 0:U.decimals).toNumber()}),(0,v.jsx)("span",{className:"ml-0.5",children:null===U||void 0===U?void 0:U.symbol})]}):(0,v.jsx)(O.O,{className:"!h-4 !w-10"})})]}),(0,v.jsx)("div",{className:"pl-2 py-3 flex text-white/[.75] items-center text-xs w-[120px] space-x-2",children:(0,v.jsx)("div",{className:"flex items-center cursor-help text-xs space-x-2",children:null!==(n=L.accounting)&&void 0!==n&&n.initialCollateral.gt(0)?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(Se.Z,{variant:"dark",placement:"top",content:(0,v.jsxs)("div",{className:"leading-none",children:[(0,v.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,v.jsx)("div",{className:"text-white/75",children:u.ag._("Initial Collateral:")}),(0,v.jsxs)("div",{children:["$",null===(s=L.accounting)||void 0===s?void 0:s.initialCollateral.div(1e6).toFixed(B)]})]}),(0,v.jsxs)("div",{className:"flex justify-between text-xs mt-2",children:[(0,v.jsx)("div",{className:"text-white/75",children:u.ag._("Borrow Fee:")}),(0,v.jsxs)("div",{children:["-$",null===(r=L.accounting)||void 0===r?void 0:r.fundingFeeUsd.div(1e6).toFixed(B)]})]}),(0,v.jsxs)("div",{className:"flex justify-between text-xs mt-2",children:[(0,v.jsx)("div",{className:"text-white/75",children:u.ag._("Borrow Fee / Hour:")}),(0,v.jsxs)("div",{children:["-$",null===(o=L.accounting)||void 0===o?void 0:o.borrowFeePerHourForPosition.div(1e6).toFixed(B)]})]}),(0,v.jsx)("div",{className:"mt-4",children:(0,v.jsx)("p",{className:"text-xs",children:(0,v.jsx)(A.cC,{id:"Use the Edit Collateral icon to deposit or withdraw collateral."})})})]}),children:(0,v.jsx)("span",{children:"$"+(null===(a=L.accounting)||void 0===a?void 0:a.initialCollateral.div(1e6).toFixed(2))})}),(0,v.jsx)("button",{type:"button",className:"rounded-lg px-2 py-1.5 text-white/50 text-xs bg-white/5 border border-[rgba(255,255,255,0.02)] hover:bg-white/10",onClick:function(){return _({positionAccountPubkey:L.publicKey})},children:u.ag._("Edit")})]}):(0,v.jsx)(O.O,{className:"!h-4 !w-12"})})}),(0,v.jsx)("div",{className:"pl-2 py-3 flex text-white/[.75] items-center justify-center text-xs w-[144px]",children:L.price?(0,v.jsxs)("div",{className:"flex space-x-1",children:[(0,v.jsx)("span",{children:"$"+ne.uf.format(L.price.div(1e6),G)}),(0,v.jsx)("span",{className:"text-v2-lily/40",children:"/"}),(0,v.jsx)("span",{className:"text-v2-lily/40",children:H?ne.uf.format(H,G):(0,v.jsx)(O.O,{className:"!h-4 !w-12"})})]}):(0,v.jsx)(O.O,{className:"!h-4 !w-12"})}),(0,v.jsx)(Se.Z,{variant:"dark",placement:"top",content:(0,v.jsx)("div",{className:"leading-none",children:(0,v.jsxs)("div",{className:"text-xs",children:[(0,v.jsx)("div",{children:u.ag._("Liquidation Price calculation:")}),(0,v.jsxs)("div",{className:"mt-2 text-white/75",children:["Liquidation Price =",(0,v.jsx)("br",{}),"(Position Price) + (Collateral - Fees - Size / Max Leverage) * Position Price / Size"]})]})}),children:(0,v.jsx)("div",{className:"pl-2 py-3 flex items-center text-xs w-[70px] cursor-help text-perps-warning justify-center",children:null!==(c=L.accounting)&&void 0!==c&&c.liquidationPrice?"$".concat(ne.uf.format(null===(d=L.accounting)||void 0===d?void 0:d.liquidationPrice.div(1e6),G)):null})}),$?(0,v.jsx)(Dt,{open:"tp"===$||"sl"===$,onClose:function(){return W(!1)},positionAccount:L,type:$}):null,(0,v.jsx)("div",{className:"pl-2 py-3 flex text-white/[.75] items-center justify-center text-xs w-[95px] decoration-white/30 space-x-2 relative",children:null!==(m=L.takeProfitPositionRequest)&&void 0!==m&&m.account.triggerPrice?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("span",{children:["$",ne.uf.format(new x.Z(L.takeProfitPositionRequest.account.triggerPrice.toString()).div(1e6),2)]}),(0,v.jsx)("div",{onClick:function(){return q({positionAccountPubkey:L.publicKey,focusOn:"tp"})},className:"cursor-pointer text-white/30 hover:text-white/70 fill-current w-4 h-4 flex items-center justify-center",children:(0,v.jsx)(Vt,{width:16,height:16})}),(0,v.jsx)("div",{onClick:function(){return W("tp")},className:"cursor-pointer text-white/30 hover:text-white/70 fill-current w-4 h-4 flex items-center justify-center",children:(0,v.jsx)(At,{width:16,height:16})})]}):(0,v.jsx)("div",{className:"w-full flex justify-center",children:(0,v.jsx)("button",{onClick:function(){return q({positionAccountPubkey:L.publicKey,focusOn:"tp"})},type:"button",className:"text-xs rounded-lg px-2 py-1.5 border border-v2-lily/5 text-perps-green bg-perps-green/5 hover:bg-perps-green/20",children:u.ag._("Add TP")})})}),(0,v.jsx)("div",{className:"pl-2 py-3 flex text-white/[.75] items-center justify-center text-xs w-[95px] decoration-white/30 space-x-2",children:null!==(f=L.stopLossPositionRequest)&&void 0!==f&&f.account.triggerPrice?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("span",{children:["$",ne.uf.format(new x.Z(L.stopLossPositionRequest.account.triggerPrice.toString()).div(1e6),2)]}),(0,v.jsx)("div",{onClick:function(){return q({positionAccountPubkey:L.publicKey,focusOn:"sl"})},className:"cursor-pointer text-white/30 hover:text-white/70 fill-current w-4 h-4 flex items-center justify-center",children:(0,v.jsx)(Vt,{width:16,height:16})}),(0,v.jsx)("div",{onClick:function(){return W("sl")},className:"cursor-pointer text-white/30 hover:text-white/70 fill-current w-4 h-4 flex items-center justify-center",children:(0,v.jsx)(At,{width:16,height:16})})]}):(0,v.jsx)("div",{className:"w-full flex justify-center",children:(0,v.jsx)("button",{type:"button",onClick:function(){return q({positionAccountPubkey:L.publicKey,focusOn:"sl"})},className:"text-xs rounded-lg px-2 py-1.5 border border-v2-lily/5 text-perps-red bg-perps-red/5 hover:bg-perps-red/20",children:u.ag._("Add SL")})})}),(0,v.jsxs)("div",{className:"flex justify-center text-xs w-[100px] pl-4 xl:pl-0 pr-4",children:[(0,v.jsx)("button",{type:"button",onClick:Y,className:"rounded-lg px-2 py-1.5 text-white/50 fill-current text-xs bg-white/5 border border-[rgba(255,255,255,0.02)] hover:bg-white/10",children:(0,v.jsx)(It.Z,{width:12,height:12})}),(0,v.jsx)("button",{type:"button",className:"ml-1 rounded-lg px-2 py-1.5 text-white/50 text-xs bg-white/5 border border-[rgba(255,255,255,0.02)] hover:bg-white/10 disabled:opacity-50",onClick:z,disabled:E,children:u.ag._("Close")})]})]}),(0,v.jsxs)("div",{className:(0,p.cn)("block 2xl:hidden","mt-5 px-3 pb-5 border-b border-b-v2-lily/5 overflow-x-hidden"),children:[(0,v.jsxs)("div",{onClick:function(){return T(L)},className:"cursor-pointer flex text-white/[.75] items-center text-xs",children:[(0,v.jsx)("div",{className:"flex lg:hidden",children:(0,v.jsx)(Q.Z,{info:U,width:16,height:16})}),(0,v.jsx)("div",{className:"hidden lg:flex",children:(0,v.jsx)(Q.Z,{info:U,width:32,height:32})}),(0,v.jsxs)("span",{className:"ml-2 font-semibold text-sm text-v2-lily",children:[null===U||void 0===U?void 0:U.symbol,"-PERP"]}),(0,v.jsxs)("span",{className:"ml-2 text-xs text-v2-lily/40",children:[L.leverage.toFixed(2),"x ",L.side]}),(0,v.jsxs)("button",{type:"button",onClick:Y,className:"ml-auto rounded-full border border-labs/10  p-1 fill-current space-x-1 flex items-center px-2 py-1.5 bg-labs/10 text-labs hover:bg-labs/20",children:[(0,v.jsx)(It.Z,{width:12,height:12}),(0,v.jsx)("span",{children:u.ag._("Share")})]})]}),(0,v.jsxs)("div",{className:"mt-3 flex justify-between",children:[(0,v.jsxs)("div",{className:"basis-5/12 flex flex-col",children:[(0,v.jsx)("span",{className:"text-xs text-v2-lily/40",children:u.ag._("Value")}),(0,v.jsx)("span",{className:"text-sm font-semibold",children:(0,v.jsx)(Nt,{positionAccount:L})})]}),(0,v.jsxs)("div",{className:"basis-3/12 flex flex-col mt-1",children:[(0,v.jsx)("span",{className:"text-xs text-v2-lily/40",children:u.ag._("Size")}),(0,v.jsxs)("div",{className:"flex flex-col",children:[(0,v.jsx)("span",{className:"text-white/[.75]",children:L.sizeUsd?"$"+L.sizeUsd.div(1e6).toFixed(2):(0,v.jsx)(O.O,{className:"!h-4 !w-10"})}),(0,v.jsx)("span",{className:"text-v2-lily/40",children:J?(0,v.jsxs)(v.Fragment,{children:[(0,ee.M)({value:J.toDP(null===U||void 0===U?void 0:U.decimals).toNumber()}),(0,v.jsx)("span",{className:"ml-0.5",children:null===U||void 0===U?void 0:U.symbol})]}):(0,v.jsx)(O.O,{className:"!h-4 !w-10"})})]})]}),(0,v.jsxs)("div",{className:"basis-4/12 flex flex-col items-end",children:[(0,v.jsx)("span",{className:"text-xs text-v2-lily/40",children:u.ag._("Collateral")}),(0,v.jsx)("span",{className:"text-xs font-semibold text-v2-lily/75 mt-1",children:null!==(g=L.accounting)&&void 0!==g&&g.initialCollateral.gt(0)?(0,v.jsx)(v.Fragment,{children:(0,v.jsx)(Se.Z,{variant:"dark",placement:"top",content:(0,v.jsxs)("div",{className:"leading-none",children:[(0,v.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,v.jsx)("div",{className:"text-white/75",children:u.ag._("Initial Collateral:")}),(0,v.jsxs)("div",{children:["$",null===(w=L.accounting)||void 0===w?void 0:w.initialCollateral.div(1e6).toFixed(B)]})]}),(0,v.jsxs)("div",{className:"flex justify-between text-xs mt-2",children:[(0,v.jsx)("div",{className:"text-white/75",children:u.ag._("Borrow Fee:")}),(0,v.jsxs)("div",{children:["-$",null===(b=L.accounting)||void 0===b?void 0:b.fundingFeeUsd.div(1e6).toFixed(B)]})]}),(0,v.jsxs)("div",{className:"flex justify-between text-xs mt-2",children:[(0,v.jsx)("div",{className:"text-white/75",children:u.ag._("Borrow Fee / Hour:")}),(0,v.jsxs)("div",{children:["-$",null===(j=L.accounting)||void 0===j?void 0:j.borrowFeePerHourForPosition.div(1e6).toFixed(B)]})]}),(0,v.jsx)("div",{className:"mt-4",children:(0,v.jsx)("p",{className:"text-xs",children:(0,v.jsx)(A.cC,{id:"Use the Edit Collateral icon to deposit or withdraw collateral."})})})]}),children:(0,v.jsx)("span",{children:"$"+(null===(P=L.accounting)||void 0===P?void 0:P.initialCollateral.div(1e6).toFixed(2))})})}):(0,v.jsx)(O.O,{className:"!h-4 !w-12"})})]})]}),(0,v.jsxs)("div",{className:"mt-3 flex w-full justify-between",children:[(0,v.jsxs)("div",{className:"basis-5/12 flex flex-col",children:[(0,v.jsx)("span",{className:"text-xs text-v2-lily/40",children:u.ag._("Entry Price")}),(0,v.jsx)("span",{className:"text-xs font-semibold text-v2-lily/75 mt-1",children:L.price?(0,v.jsx)("div",{className:"flex space-x-1",children:(0,v.jsx)("span",{children:"$"+ne.uf.format(L.price.div(1e6),G)})}):(0,v.jsx)(O.O,{className:"!h-4 !w-12"})})]}),(0,v.jsxs)("div",{className:"basis-3/12 flex flex-col",children:[(0,v.jsx)("span",{className:"text-xs text-v2-lily/40",children:u.ag._("Mark Price")}),(0,v.jsx)("span",{className:"text-xs font-semibold text-v2-lily/75 mt-1",children:H?ne.uf.format(H,G):(0,v.jsx)(O.O,{className:"!h-4 !w-12"})})]}),(0,v.jsxs)("div",{className:"basis-4/12 flex flex-col items-end",children:[(0,v.jsx)("span",{className:"text-xs text-v2-lily/40",children:u.ag._("Liq. Price")}),(0,v.jsx)("span",{className:"text-xs font-semibold",children:(0,v.jsx)(Se.Z,{variant:"dark",placement:"top",content:(0,v.jsx)("div",{className:"leading-none",children:(0,v.jsxs)("div",{className:"text-xs",children:[(0,v.jsx)("div",{children:u.ag._("Liquidation Price calculation:")}),(0,v.jsxs)("div",{className:"mt-2 text-white/75",children:["Liquidation Price =",(0,v.jsx)("br",{}),"(Position Price) + (Collateral - Fees - Size / Max Leverage) * Position Price / Size"]})]})}),children:(0,v.jsx)("div",{className:"flex items-center text-xs cursor-help text-perps-warning/75",children:null!==(S=L.accounting)&&void 0!==S&&S.liquidationPrice?"$".concat(ne.uf.format(null===(C=L.accounting)||void 0===C?void 0:C.liquidationPrice.div(1e6),G)):null})})})]})]}),(0,v.jsxs)("div",{className:"w-full mt-3 py-2 flex justify-between items-center lg:justify-start bg-black/50 rounded-lg",children:[(0,v.jsxs)("div",{className:"basis-6/12 md:basis-5/12",children:[(0,v.jsx)("span",{className:"text-v2-lily/40 pl-4",children:u.ag._("Take Profit")}),null!==(Z=L.takeProfitPositionRequest)&&void 0!==Z&&Z.account.triggerPrice?(0,v.jsxs)("span",{className:"ml-3 text-perps-green",children:["$",ne.uf.format(new x.Z(L.takeProfitPositionRequest.account.triggerPrice.toString()).div(1e6),2)]}):(0,v.jsx)("span",{className:"ml-3 text-v2-lily/40",children:"-"})]}),(0,v.jsxs)("div",{className:"basis-6/12 md:basis-3/12",children:[(0,v.jsx)("span",{className:"text-v2-lily/40",children:u.ag._("Stop Loss")}),null!==(M=L.stopLossPositionRequest)&&void 0!==M&&M.account.triggerPrice?(0,v.jsxs)("span",{className:"ml-3 text-perps-red",children:["$",ne.uf.format(new x.Z(L.stopLossPositionRequest.account.triggerPrice.toString()).div(1e6),2)]}):(0,v.jsx)("span",{className:"ml-3 text-v2-lily/40",children:"-"})]}),(0,v.jsx)("div",{className:"hidden min-w-[400px]:basis-4/12"})]}),(0,v.jsxs)("div",{className:"w-full mt-3 flex justify-between space-x-2",children:[(0,v.jsx)("button",{type:"button",className:"flex flex-1 border border-v2-lily/5 rounded-lg p-3 justify-center bg-v2-lily/[.02] hover:bg-v2-lily/5",onClick:function(){return q({positionAccountPubkey:L.publicKey})},children:u.ag._("TP/SL")}),(0,v.jsx)("button",{type:"button",className:"flex flex-1 border border-v2-lily/5 rounded-lg p-3 justify-center bg-v2-lily/[.02] hover:bg-v2-lily/5",onClick:function(){return _({positionAccountPubkey:L.publicKey})},children:u.ag._("Edit Collateral")}),(0,v.jsx)("button",{type:"button",className:"flex flex-1 border border-v2-lily/5 rounded-lg p-3 justify-center bg-v2-lily/[.02] hover:bg-v2-lily/5 disabled:opacity-50",onClick:z,disabled:E,children:u.ag._("Market Close")})]})]})]})},Rt=function(e){var t=e.onShowEditCollateralDialog,n=e.onShowCloseConfirmationDialog,s=e.onShowEditTPSLDialog,l=e.setPositionDirection,r=e.setShowPerpsShareDialog,o=(0,y.Os)().wallet,a=(0,h.tc)(),c=a.userPositions,u=a.userPositionsFetched,d=(0,y.Bn)().getTokenInfo,x=(0,i.useMemo)((function(){return c?c.sort((function(e,t){return e.sizeUsd.gt(t.sizeUsd)?-1:1})):null}),[c]),m=x&&Object.keys(x).length>0,f=V(),g=(0,i.useCallback)((function(e){var t=d(e.custody.account.mint.toString()),n=d(e.custody.account.mint.toString());t&&n&&(f(t,n,e.side),l(e.side))}),[f,d,l]);return(0,v.jsx)("div",{className:"flex-1 w-full min-w-[300px] overflow-hidden bg-[#16202B] pb-20",children:(0,v.jsxs)("div",{className:"w-full text-xs xl:px-0 overflow-x-auto webkit-scrollbar",children:[null!==o&&void 0!==o&&o.adapter.publicKey?(0,v.jsxs)("div",{className:(0,p.cn)("text-xs dark:text-white-50 justify-between font-semibold dark:font-normal border-y border-[rgba(255,255,255,0.02)]","hidden 2xl:flex w-full"),children:[(0,v.jsx)("div",{className:"pl-4 py-3 flex items-center text-xs w-[130px]",children:"Position"}),(0,v.jsx)("div",{className:"pl-2 py-3 flex items-center text-xs w-[128px]",children:"Value"}),(0,v.jsx)("div",{className:"pl-2 py-3 flex items-center text-xs w-[70px]",children:"Size"}),(0,v.jsx)("div",{className:"pl-2 py-3 flex items-center text-xs w-[120px]",children:"Collateral"}),(0,v.jsx)("div",{className:"pl-2 py-3 flex items-center text-xs w-[144px] justify-center",children:"Entry / Mark Price"}),(0,v.jsx)("div",{className:"pl-2 py-3 flex items-center text-xs w-[70px] justify-center",children:"Liq. Price"}),(0,v.jsx)("div",{className:"pl-2 py-3 flex items-center text-xs w-[95px] justify-center",children:"Take Profit"}),(0,v.jsx)("div",{className:"pl-2 py-3 flex items-center text-xs w-[95px] justify-center",children:"Stop Loss"}),(0,v.jsx)("div",{className:"py-3 flex items-center justify-end pr-4 text-xs w-[100px]",children:(0,v.jsx)(Z,{})})]}):null,m?null:(0,v.jsx)(bt,{loading:!u,emptyText:(0,v.jsx)(A.cC,{id:"No positions"})}),m?(0,v.jsx)("div",{className:"overflow-auto webkit-scrollbar bg-[#16202B]",children:x.map((function(e,i){return(0,v.jsx)(Ut,{id:e.publicKey.toString(),positionAccount:e,onSelectMarket:g,onShowCloseConfirmationDialog:n,onShowEditCollateralDialog:t,onShowEditTPSLDialog:s,setShowPerpsShareDialog:r},i)}))}):null]})})},Et=n(24628),zt=function(e){var t=e.id,n=e.data,s=e.setPositionDirection,l=(e.setShowPerpsShareDialog,(0,y.Bn)().getTokenInfo),r=(0,y.oP)().getExplorer,o=(0,i.useMemo)((function(){return l(n.mint.toString())}),[l,n.mint]),a=n.pnlUsd?new x.Z(n.pnlUsd.toString()).div(1e6).toDP(2):null,c=V(),d=(0,i.useCallback)((function(){if(n.inOutTokenMint&&o){var e=l(n.inOutTokenMint.toString());e&&o&&(c(e,o,"Long"===n.side?"long":"short"),s("Long"===n.side?"long":"short"))}}),[n.inOutTokenMint,n.side,o,l,c,s]);return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("div",{id:"jupiter-perps-order-mobile-".concat(t),className:"flex lg:hidden w-full px-3 py-4 bg-[#16202B] border-t border-cyan-50 border-opacity-5 flex-col justify-center items-start gap-3",children:[(0,v.jsxs)("div",{className:"flex justify-between items-center w-full gap-2",onClick:function(){return d()},children:[(0,v.jsxs)("div",{className:"items-center gap-2 flex",children:[(0,v.jsx)("div",{className:"w-4 h-4 relative",children:(0,v.jsx)(Q.Z,{info:o,width:16,height:16})}),(0,v.jsx)("div",{className:"items-center gap-1 flex",children:(0,v.jsxs)("div",{translate:"no",className:"text-v2-lily text-sm font-semibold",children:[null===o||void 0===o?void 0:o.symbol,"-PERP"]})}),(0,v.jsx)("div",{className:"px-2 py-0.5 bg-perps-red bg-opacity-20 rounded-2xl border border-perps-red border-opacity-20 items-center flex",children:(0,v.jsxs)("div",{className:"text-center text-perps-red text-[11px] font-medium",children:[n.requestChange," ",n.side]})})]}),(0,v.jsx)("div",{className:"flex items-center text-v2-lily/50",children:(0,v.jsx)("a",{href:r(n.txId),target:"_blank",rel:"noreferrer",className:"space-x-2",children:(0,v.jsx)(Et.Z,{})})})]}),(0,v.jsxs)("div",{className:"w-full items-start gap-3 flex",children:[(0,v.jsxs)("div",{className:"grow shrink basis-0 flex-col items-start flex",children:[(0,v.jsx)("div",{className:"text-v2-lily/40 text-xs font-medium",children:u.ag._("Order Type")}),(0,v.jsx)("div",{className:"text-v2-lily/75 text-xs font-semibold",children:n.requestType})]}),(0,v.jsxs)("div",{className:"grow shrink basis-0 flex-col items-start flex",children:[(0,v.jsx)("div",{className:"text-v2-lily/40 text-xs font-medium",children:u.ag._("Deposit/Withdraw")}),(0,v.jsxs)("div",{className:"text-v2-lily/75 text-xs font-semibold",children:["Increase"===n.requestChange?"-$":"+$",new x.Z(n.collateralUsd.toString()).div(1e6).toFixed(2).toString()]})]}),(0,v.jsxs)("div",{className:"grow shrink basis-0 flex-col items-start flex",children:[(0,v.jsx)("div",{className:"text-v2-lily/40 text-xs font-medium",children:u.ag._("Price")}),(0,v.jsx)("div",{className:"text-v2-lily/75 text-xs font-semibold",children:"$"+new x.Z(n.price.toString()).div(1e6).toFixed(2).toString()})]})]}),(0,v.jsxs)("div",{className:"w-full items-start gap-3 flex",children:[(0,v.jsxs)("div",{className:"grow shrink basis-0 flex-col items-start flex",children:[(0,v.jsx)("div",{className:"text-v2-lily/40 text-xs font-medium",children:u.ag._("Size")}),(0,v.jsx)("div",{className:"text-v2-lily/75 text-xs font-semibold",children:"$"+new x.Z(n.sizeUsd.toString()).div(1e6).toFixed(2).toString()})]}),(0,v.jsxs)("div",{className:"grow shrink basis-0 flex-col items-start flex",children:[(0,v.jsx)("div",{className:"text-v2-lily/40 text-xs font-medium",children:u.ag._("Fee")}),(0,v.jsx)("div",{className:"text-v2-lily/75 text-xs font-semibold",children:"$"+new x.Z(n.feeUsd.toString()).div(1e6).toFixed(2).toString()})]}),(0,v.jsxs)("div",{className:(0,p.cn)("grow shrink basis-0 flex-col items-start flex",a?"":"invisible"),children:[(0,v.jsx)("div",{className:"text-v2-lily/40 text-xs font-medium",children:u.ag._("PnL")}),(0,v.jsx)("div",{className:(0,p.cn)("text-v2-lily/75 text-xs font-semibold",{"text-[rgba(39,174,96,1)]":null===a||void 0===a?void 0:a.gt(0),"text-[#EB5757]":null===a||void 0===a?void 0:a.lt(0),"text-v2-lily/50":null===a||void 0===a?void 0:a.eq(0)}),children:a?"$"+a.toFixed(2).toString():""})]})]}),(0,v.jsx)("div",{className:"text-center text-xxs text-v2-lily/30",children:(0,jt.Z)(n.createdAt,"H:mm dd/MM/yyyy (x)")})]}),(0,v.jsxs)("div",{id:"jupiter-perps-order-".concat(t),className:(0,p.cn)("hidden lg:flex justify-between items-center h-[62px] w-full min-w-[1092px]"),children:[(0,v.jsxs)("div",{className:"w-[30%] flex justify-between",children:[(0,v.jsxs)("div",{onClick:function(){return d()},className:"pl-2 py-3 flex flex-col items-start text-xs min-w-[150px]",children:[(0,v.jsxs)("span",{className:"font-semibold",children:[null===o||void 0===o?void 0:o.symbol,"-PERP"]}),(0,v.jsx)("div",{className:"text-center text-xxs text-v2-lily/30",children:(0,jt.Z)(n.createdAt,"H:mm dd/MM/yyyy (x)")})]}),(0,v.jsxs)("div",{className:"pl-2 py-3 flex flex-col justify-center text-xs min-w-[120px] text-white/[.75]",children:[n.requestChange," ",n.side]}),(0,v.jsx)("div",{className:"pl-2 py-3 flex flex-col justify-center text-xs min-w-[120px] text-white/[.75]",children:n.requestType})]}),(0,v.jsxs)("div",{className:"w-[65%] flex justify-evenly",children:[(0,v.jsxs)("div",{className:(0,p.cn)("pl-2 py-3 flex items-center text-xs min-w-[150px] text-white/[.75]"),children:["Increase"===n.requestChange?"-$":"+$",new x.Z(n.collateralUsd.toString()).div(1e6).toFixed(2).toString()]}),(0,v.jsx)("div",{className:(0,p.cn)("pl-2 py-3 flex items-center text-xs min-w-[90px] text-white/[.75]"),children:"$"+new x.Z(n.price.toString()).div(1e6).toFixed(2).toString()}),(0,v.jsx)("div",{className:(0,p.cn)("pl-2 py-3 flex items-center text-xs min-w-[90px] text-white/[.75]"),children:"$"+new x.Z(n.sizeUsd.toString()).div(1e6).toFixed(2).toString()}),(0,v.jsx)("div",{className:(0,p.cn)("pl-2 py-3 flex items-center text-xs min-w-[120px]",{"text-[rgba(39,174,96,1)]":null===a||void 0===a?void 0:a.gt(0),"text-[#EB5757]":null===a||void 0===a?void 0:a.lt(0),"text-v2-lily/50":null===a||void 0===a?void 0:a.eq(0)}),children:a?"$"+a.toFixed(2).toString():""}),(0,v.jsx)("div",{className:(0,p.cn)("pl-2 py-3 flex items-center text-xs min-w-[84px] text-white/[.75]"),children:"$"+new x.Z(n.feeUsd.toString()).div(1e6).toFixed(2).toString()})]}),(0,v.jsx)("div",{className:"w-[5%] flex justify-between",children:(0,v.jsx)("div",{className:"min-w-[42px] pl-2 py-3 flex items-center text-white/50 fill-current dark:text-white/50",children:(0,v.jsx)("a",{href:r(n.txId),target:"_blank",rel:"noreferrer",className:"space-x-2",children:(0,v.jsx)(Et.Z,{})})})})]})]})},Bt=n(32529),Kt=n(17639),$t=function(e){var t,n,s=e.setPositionDirection,l=e.setShowPerpsShareDialog,r=(0,y.Os)().wallet,o=(0,h.tc)().tradeHistory,a=(0,i.useMemo)((function(){var e,t,n,i;return null!==(e=o.data)&&void 0!==e&&null!==(t=e.data)&&void 0!==t&&t.trades?null===(n=o.data)||void 0===n||null===(i=n.data)||void 0===i?void 0:i.trades:[]}),[o]),c=(0,Bt.Y)({pageIndex:o.pageIndex,pageCount:o.pageCount,setPageIndex:o.setPageIndex}),d=c.pager,x=c.canPreviousPage,m=c.canNextPage,f=c.gotoPage;return(0,v.jsxs)("div",{className:"w-full min-w-[300px] bg-[#16202B] h-full",children:[(0,v.jsxs)("div",{className:"w-full text-xs xl:px-0 overflow-x-auto webkit-scrollbar rounded-lg relative",children:[null!==r&&void 0!==r&&r.adapter.publicKey?(0,v.jsxs)("div",{className:(0,p.cn)("hidden lg:flex text-xs dark:text-white-50 font-semibold dark:font-normal border-b border-v2-lily/5","w-full min-w-[1092px]"),children:[(0,v.jsxs)("div",{className:"w-[30%] flex justify-between",children:[(0,v.jsx)("div",{className:"pl-2 py-3 flex items-center text-xs min-w-[150px]",children:u.ag._("Position")}),(0,v.jsx)("div",{className:"pl-2 py-3 flex items-center text-xs min-w-[120px]",children:u.ag._("Action")}),(0,v.jsx)("div",{className:"pl-2 py-3 flex items-center text-xs min-w-[120px]",children:u.ag._("Order Type")})]}),(0,v.jsxs)("div",{className:"w-[65%] flex justify-evenly",children:[(0,v.jsx)("div",{className:"pl-2 py-3 flex items-center text-xs min-w-[150px]",children:u.ag._("Deposit / Withdraw")}),(0,v.jsx)("div",{className:"pl-2 py-3 flex items-center text-xs min-w-[90px]",children:u.ag._("Price")}),(0,v.jsx)("div",{className:"pl-2 py-3 flex items-center text-xs min-w-[90px]",children:u.ag._("Size")}),(0,v.jsx)("div",{className:"pl-2 py-3 flex items-center text-xs min-w-[120px]",children:u.ag._("PNL")}),(0,v.jsx)("div",{className:"pl-2 py-3 flex items-center text-xs min-w-[84px]",children:u.ag._("Fee")})]}),(0,v.jsx)("div",{className:"w-[5%] flex justify-between",children:(0,v.jsx)("div",{className:"pl-2 py-3 flex items-center text-xs min-w-[42px]",children:u.ag._("Tx")})})]}):null,(0,v.jsxs)("div",{children:[0===a.length?(0,v.jsx)(bt,{loading:Boolean(null===(t=o.data)||void 0===t?void 0:t.isLoading),emptyText:(0,v.jsx)(A.cC,{id:"No trade history"})}):null,a.length>0?a.map((function(e,t){return(0,v.jsx)(zt,{id:e.id,data:e,setPositionDirection:s,setShowPerpsShareDialog:l},t)})):null,a.length>0&&null!==(n=o.data)&&void 0!==n&&n.isFetching?(0,v.jsx)("div",{className:"absolute top-0 left-0 bg-black/10 backdrop-blur-sm w-full h-full"}):null]})]}),o.pageCount>0?(0,v.jsx)(Kt.Z,{canPreviousPage:x,gotoPage:f,pageIndex:o.pageIndex,pager:d,canNextPage:m}):null]})};function Wt(e){var t,n,i;return e?{floatValue:null!==(t=null===e||void 0===e?void 0:e.toNumber())&&void 0!==t?t:void 0,formattedValue:null!==(n=null===e||void 0===e?void 0:e.toString())&&void 0!==n?n:"",value:null!==(i=null===e||void 0===e?void 0:e.toString())&&void 0!==i?i:""}:{floatValue:void 0,formattedValue:"",value:""}}var Ht=function(e){var t,n,s,l,r,a,d=e.open,m=e.onClose,f=e.positionAccount,g=e.focusOn,w=(0,h.tc)(),b=w.viewClient,j=w.oraclePrices,N=(0,y.Bn)(),P=N.connection,k=N.getTokenInfo,Z=N.tokenMap,M=(0,y.Os)().wallet,L=(0,C.Z)().promptKeeperCreateTPSLNotification,T=(0,i.useMemo)((function(){var e;return null!==(e=k(f.custody.account.mint.toString()))&&void 0!==e?e:F.mq}),[k,f.custody.account.mint]),_=(0,i.useCallback)((function(){m()}),[m]),q=(0,i.useMemo)((function(){return k(f.collateralCustody.account.mint.toString())}),[k,f.collateralCustody.account.mint]),D=Tt(f),V=D.hasTp,E=D.hasSl,B=(0,I.cI)({defaultValues:{tpPrice:Wt(V),slPrice:Wt(E)}}),K=B.control,$=B.handleSubmit,W=B.watch,H=B.setValue,G=B.formState,ee=W("tpPrice"),ie=W("slPrice"),se=_t({positionAccount:f,tpPrice:ee,slPrice:ie}),le=se.showTPChanged,re=se.showTPRemoved,oe=se.showSLChanged,ae=se.showSLRemoved,ce=se.minimumTPPrice,ue=se.minimumSLPrice,de=se.maximumSLPrice,xe=se.isWithinTPRange,me=se.isWithinSLRange,fe=se.expectedPositionValueAtSL,pe=se.expectedPositionValueAtTP,he=(0,i.useState)(null),ve=he[0],ge=he[1],we=(0,i.useMemo)((function(){var e=f.takeProfitPositionRequest||f.stopLossPositionRequest;if(e)return e}),[f.stopLossPositionRequest,f.takeProfitPositionRequest]);(0,i.useEffect)((function(){we&&ge(Z.get(we.account.mint.toString())||null),!ve&&q&&ge(q)}),[q,we,ve,Z]);var be=(0,i.useState)(!1),je=be[0],ye=be[1],Ne=i.useCallback((function(e){ye(!1),ge(e)}),[]),Pe=(0,i.useMemo)((function(){return Array.from(Z.keys())}),[Z]),Se=(0,i.useMemo)((function(){var e,t;return j&&j[T.address]?"long"===f.side?null===(e=j[T.address])||void 0===e?void 0:e.decreaseLong:null===(t=j[T.address])||void 0===t?void 0:t.decreaseShort:null}),[j,f.side,T.address]),ke=(0,i.useMemo)((function(){return!G.isDirty||(!(!ee.floatValue||xe)||(!(!ie.floatValue||me)||G.isSubmitting))}),[G.isDirty,G.isSubmitting,me,xe,ie.floatValue,ee.floatValue]),Ce=(0,i.useCallback)(function(){var e=(0,o.Z)(c().mark((function e(t){var n,i,s,l,r,a,d;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!ke&&M&&M.adapter.publicKey&&T&&b&&Se&&ve){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,n=t.tpPrice.floatValue?new(z())(new x.Z(t.tpPrice.floatValue).mul(1e6).round().toFixed()):null,i=t.slPrice.floatValue?new(z())(new x.Z(t.slPrice.floatValue).mul(1e6).round().toFixed()):null,s=le&&f.takeProfitPositionRequest&&n?{triggerPrice:n,positionRequestAccount:f.takeProfitPositionRequest.publicKey}:null,l=oe&&f.stopLossPositionRequest&&i?{triggerPrice:i,positionRequestAccount:f.stopLossPositionRequest.publicKey}:null,r=re&&f.takeProfitPositionRequest?{positionPubkey:f.publicKey,positionRequestPubkey:f.takeProfitPositionRequest.publicKey,positionRequestMint:f.takeProfitPositionRequest.account.mint}:null,a=ae&&f.stopLossPositionRequest?{positionPubkey:f.publicKey,positionRequestPubkey:f.stopLossPositionRequest.publicKey,positionRequestMint:f.stopLossPositionRequest.account.mint}:null,e.next=11,Zt({wallet:M,connection:P,positionAccount:f,custody:f.custody.account,desiredMint:new R.PublicKey(ve.address),tpPrice:V?null:n,slPrice:E?null:i,updateTPPrice:s,updateSLPrice:l,cancelTP:r,cancelSL:a});case 11:return d=e.sent,e.next=14,new Promise(function(){var e=(0,o.Z)(c().mark((function e(t,n){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L(d,(function(e){_(),t(e)}),(function(e){n(e)}),u.ag._("Adjusting Take Profit & Stop Loss..."));case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 14:return e.abrupt("return",e.sent);case 17:e.prev=17,e.t0=e.catch(2),console.log("Failed to submit TPSL!",e.t0);case 20:case"end":return e.stop()}}),e,null,[[2,17]])})));return function(t){return e.apply(this,arguments)}}(),[ke,M,T,b,Se,ve,le,f,oe,re,ae,P,V,E,L,_]),Ze=(0,i.useMemo)((function(){return[]}),[]),Me=(0,i.useCallback)((function(){ce&&H("tpPrice",{floatValue:ce.toNumber(),formattedValue:ce.toFixed(2),value:ce.toFixed(2)})}),[ce,H]),Le=(0,i.useCallback)((function(){ue&&H("slPrice",{floatValue:ue.toNumber(),formattedValue:ue.toFixed(2),value:ue.toFixed(2)})}),[ue,H]),Te=(0,i.useCallback)((function(){de&&H("slPrice",{floatValue:de.toNumber(),formattedValue:de.toFixed(2),value:de.toFixed(2)})}),[de,H]),_e=(0,i.useRef)(),Oe=(0,i.useRef)();return(0,i.useEffect)((function(){var e,t;"tp"===g&&(null===(e=_e.current)||void 0===e||e.focus()),"sl"===g&&(null===(t=Oe.current)||void 0===t||t.focus())}),[g]),(0,v.jsx)(te.Z,{open:d,onClose:m,children:(0,v.jsxs)("form",{className:"relative w-full lg:max-w-[400px] bg-v2-perps-modal rounded-lg",children:[(0,v.jsx)("div",{className:"p-4 lg:p-6 mb-2 lg:mb-0 font-semibold leading-none lg:text-lg text-v2-lily",children:u.ag._("Take Profit & Stop Loss")}),(0,v.jsx)("div",{className:"flex absolute top-5 lg:top-8 right-8 z-10 text-v2-lily/[.25] fill-current cursor-pointer",onClick:_,children:(0,v.jsx)(J.Z,{width:12,height:12})}),je?(0,v.jsx)("div",{className:"absolute top-0 left-0 w-full h-full z-50",children:(0,v.jsx)(Y.Z,{onSubmit:Ne,onClose:function(){return ye(!1)},mintsList:Pe,suppressCloseModal:!0,customStyle:{width:"100%",height:"100%"}})}):null,(0,v.jsxs)("div",{className:"max-h-[80vh] overflow-y-auto",children:[(0,v.jsxs)("div",{className:"px-6",children:[(0,v.jsxs)("div",{className:"rounded-lg bg-v2-lily/5 border border-v2-lily/[.15] p-5",children:[(0,v.jsxs)("div",{className:"flex justify-between text-sm font-semibold",children:[(0,v.jsxs)("div",{className:"flex space-x-2 items-center",children:[(0,v.jsx)(Q.Z,{info:T,width:24,height:24}),(0,v.jsx)("span",{children:(0,v.jsx)(A.cC,{id:"Current Price:"})})]}),Se?(0,v.jsxs)("span",{className:"text-sm font-semibold",children:[ne.uf.format(Se,2)," USD"]}):(0,v.jsx)(O.O,{className:"w-20 h-6"})]}),(0,v.jsx)("div",{className:"border-b border-v2-lily/5 my-4"}),(0,v.jsxs)("div",{className:"space-y-2",children:[(0,v.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,v.jsx)("span",{className:"text-white/40",children:u.ag._("Current Position Size")}),(0,v.jsxs)("span",{className:"text-white/[.75]",children:["$",ne.uf.format(f.sizeUsd.div(1e6),2)]})]}),(0,v.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,v.jsx)("span",{className:"text-white/40",children:u.ag._("Entry Price")}),(0,v.jsxs)("span",{className:"text-white/[.75]",children:["$",ne.uf.format(f.price.div(1e6),2)]})]}),(0,v.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,v.jsx)("span",{className:"text-white/40",children:u.ag._("Liquidation Price")}),(0,v.jsxs)("span",{className:"text-white/[.75]",children:["$",ne.uf.format(null===(t=f.accounting)||void 0===t?void 0:t.liquidationPrice.div(1e6),2)]})]}),(0,v.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,v.jsx)("span",{className:"text-white/40",children:u.ag._("Leverage")}),(0,v.jsxs)("span",{className:"text-white/[.75]",children:[ne.uf.format(f.leverage,2),"x"]})]}),(0,v.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,v.jsx)("span",{className:"text-white/40",children:u.ag._("Current P&L")}),f.accounting?(0,v.jsx)(X,{changePct:f.accounting.unrealizedPNLPct,pnl:f.accounting.unrealizedPNL}):null]}),(0,v.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,v.jsx)("span",{className:"text-white/40",children:u.ag._("Total Fees")}),(0,v.jsxs)("span",{className:"text-white/[.75]",children:["$",ne.uf.format(null===(n=f.accounting)||void 0===n?void 0:n.totalFeeUsd.div(1e6))]})]}),(0,v.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,v.jsx)("span",{className:"text-white/40",children:u.ag._("Net P&L")}),(0,v.jsx)("span",{className:"text-white/[.75]",children:(0,v.jsx)(X,{changePct:null===(s=f.accounting)||void 0===s?void 0:s.pnlAfterFeesPct,pnl:null===(l=f.accounting)||void 0===l?void 0:l.pnlAfterFeesUsd})})]})]})]}),(0,v.jsx)("div",{className:"mt-5",children:(0,v.jsxs)("div",{className:"flex justify-between items-end leading-none",children:[(0,v.jsx)("div",{className:"text-v2-lily text-sm font-semibold",children:u.ag._("Take Profit Price:")}),pe?(0,v.jsx)("div",{className:"text-v2-lily/[.25] hover:text-v2-lily text-xs",children:(0,v.jsx)(X,{changePct:pe.pnlRate,pnl:pe.pnl})}):null]})}),(0,v.jsx)("div",{className:"mt-2 rounded-lg bg-v2-perps-input pl-2 pr-4 py-3.5 text-md text-right",children:(0,v.jsx)(I.Qr,{name:"tpPrice",control:K,render:function(e){var t=e.field,n=t.onChange,i=t.value;return(0,v.jsx)(U.Z,{ref:_e,decimals:2,max:F.wN,onChange:n,value:i.value,className:"disabled:cursor-not-allowed !outline-none !text-right w-full !text-sm",placeholder:"0.00",suffix:" USD"})}})}),(0,v.jsxs)("div",{className:"mt-1 space-y-1",children:[pe?(0,v.jsx)("p",{className:"text-xs text-v2-lily/30",children:u.ag._("Expected position value: ${0}",{0:pe.positionValue.div(1e6).toNumber().toLocaleString(void 0,{compactDisplay:"short"})})}):null,le?(0,v.jsx)("p",{className:"text-xs text-v2-lily/30",children:u.ag._("Your existing Take Profit of ${hasTp} will be changed to ${0}",{0:null===(r=ee.floatValue)||void 0===r?void 0:r.toLocaleString(void 0,{compactDisplay:"short"}),hasTp:V})}):null,re?(0,v.jsx)("p",{className:"text-xs text-v2-lily/30",children:u.ag._("Your will be removing your existing Take Profit at ${hasTp}.",{hasTp:V})}):null]}),ee.floatValue&&!xe&&ce?(0,v.jsx)("div",{className:"text-xs mt-2 text-warning",children:(0,v.jsx)(A.cC,{id:"<0>Minimum Take Profit price is</0><1>${0}</1><2>.</2>",values:{0:null===ce||void 0===ce?void 0:ce.toFixed(2)},components:{0:(0,v.jsx)("span",{}),1:(0,v.jsx)("button",{type:"button",onClick:Me,className:"ml-1 underline decoration-dashed underline-offset-[3px] cursor-pointer"}),2:(0,v.jsx)("span",{})}})}):null,(0,v.jsx)("div",{className:"mt-5",children:(0,v.jsxs)("div",{className:"flex justify-between items-end leading-none",children:[(0,v.jsx)("div",{className:"text-v2-lily text-sm font-semibold",children:u.ag._("Stop Loss Price:")}),fe?(0,v.jsx)("div",{className:"text-v2-lily/[.25] hover:text-v2-lily text-xs",children:(0,v.jsx)(X,{changePct:fe.pnlRate,pnl:fe.pnl})}):null]})}),(0,v.jsx)("div",{className:"mt-2 rounded-lg bg-v2-perps-input pl-2 pr-4 py-3.5 text-md text-right",children:(0,v.jsx)(I.Qr,{name:"slPrice",control:K,render:function(e){var t=e.field,n=t.onChange,i=t.value;return(0,v.jsx)(U.Z,{ref:Oe,decimals:2,max:F.wN,onChange:n,value:i.value,className:"disabled:cursor-not-allowed !outline-none !text-right w-full !text-sm",placeholder:"0.00",suffix:" USD"})}})}),(0,v.jsxs)("div",{className:"mt-1 space-y-1",children:[fe?(0,v.jsx)("span",{className:"text-xs text-v2-lily/30",children:u.ag._("Expected position value: ${0}",{0:fe.positionValue.div(1e6).toNumber().toLocaleString(void 0,{compactDisplay:"short"})})}):null,oe?(0,v.jsx)("p",{className:"text-xs text-v2-lily/30",children:u.ag._("Your existing Stop Loss of ${hasSl} will be changed to ${0}",{0:null===(a=ie.floatValue)||void 0===a?void 0:a.toLocaleString(void 0,{compactDisplay:"short"}),hasSl:E})}):null,ae?(0,v.jsx)("p",{className:"text-xs text-v2-lily/30",children:u.ag._("Your will be removing your existing Stop Loss at ${hasSl}.",{hasSl:E})}):null]}),ie.floatValue&&!me&&ue&&de?(0,v.jsx)("div",{className:"text-xs mt-2 text-warning",children:(0,v.jsx)(A.cC,{id:"<0>Allowed Stop Loss price is between</0><1>${0}</1><2>and</2><3>${1}</3><4>.</4>",values:{0:ne.uf.format(ue,2),1:ne.uf.format(de,2)},components:{0:(0,v.jsx)("span",{}),1:(0,v.jsx)("button",{type:"button",onClick:Le,className:"mx-1 underline decoration-dashed underline-offset-[3px] cursor-pointer"}),2:(0,v.jsx)("span",{}),3:(0,v.jsx)("button",{type:"button",onClick:Te,className:"ml-1 underline decoration-dashed underline-offset-[3px] cursor-pointer"}),4:(0,v.jsx)("span",{})}})}):null,Ze.length>0?Ze.map((function(e,t){return(0,v.jsx)("div",{className:"text-xs mt-2 text-warning",children:e},t)})):null,(0,v.jsx)("div",{children:(0,v.jsxs)("div",{className:"mt-5 pr-2 flex justify-between items-center",children:[(0,v.jsx)("div",{className:"flex-1 first-letter:text-v2-lily text-sm font-semibold h-full",children:u.ag._("Close position in:")}),(0,v.jsxs)("div",{className:"rounded-lg flex items-center",children:[(0,v.jsx)("div",{className:"w-7 h-7",children:ve?(0,v.jsx)(Q.Z,{info:ve,width:28,height:28}):null}),(0,v.jsx)("span",{className:"ml-3 font-semibold text-sm",children:null===ve||void 0===ve?void 0:ve.symbol})]})]})})]}),(0,v.jsx)("div",{className:"px-6",children:(0,v.jsx)("div",{className:"border-b border-v2-lily/5 my-3"})}),(0,v.jsx)("p",{className:"mt-2 mb-3 px-6 text-xs text-v2-lily/30",children:u.ag._("Take Profit and Stop Loss orders will remain in effect regardless of any changes to your collateral or position size.")}),(0,v.jsx)("p",{className:"mb-4 px-6 text-xs text-v2-lily/30",children:u.ag._("TPSL will not be executed if your token account is closed.")}),(0,v.jsxs)("div",{className:"w-full text-xs flex pb-6 px-6 space-x-3",children:[G.isSubmitting?null:(0,v.jsx)("button",{type:"button",className:(0,p.cn)("w-full py-2.5 px-6 border rounded-lg border-v2-lily/10 text-v2-lily bg-v2-lily/5 hover:bg-v2-lily/10 text-sm font-semibold disabled:cursor-not-allowed disabled:opacity-20",{"opacity-50 curosr-not-allowed":G.isSubmitting}),disabled:G.isSubmitting,onClick:_,children:(0,v.jsx)("span",{children:u.ag._("Cancel")})}),(0,v.jsx)("button",{type:"button",className:(0,p.cn)("w-full py-2.5 px-6 border rounded-lg border-labs/20 text-labs hover:bg-labs/5 text-sm font-semibold disabled:cursor-not-allowed disabled:opacity-20",{"opacity-50 curosr-not-allowed":G.isSubmitting||ke}),disabled:ke,onClick:$(Ce),children:G.isSubmitting?(0,v.jsxs)("span",{className:"flex justify-center items-center",children:[(0,v.jsx)(S.Z,{className:"!h-4 !w-4",baseColor:"white",spinnerColor:"black"}),(0,v.jsx)("div",{className:"mr-2"}),u.ag._("Setting up TP & SL")]}):(0,v.jsx)("span",{className:"text-center",children:u.ag._("Confirm")})})]})]})]})})},Gt=function(e){var t=e.open,n=e.onClose,s=e.positionAccountPubkey,l=e.focusOn,r=(0,h.tc)().userPositions,o=(0,i.useMemo)((function(){return null===r||void 0===r?void 0:r.find((function(e){return e.publicKey.equals(s)}))}),[s,r]);return o?(0,v.jsx)(Ht,{open:t,onClose:n,positionAccount:o,focusOn:l}):null},Yt=n(53672),Jt=function(){var e=(0,q.useRouter)();return(0,i.useMemo)((function(){if(e.isReady){var t=e.query.direction;if("long"!==t&&"short"!==t)return e.replace("/perps/long/SOL-SOL"),"long"}return e.query.direction}),[e])},Qt=f()((function(){return n.e(4710).then(n.bind(n,44710))}),{ssr:!1,loadableGenerated:{webpack:function(){return[44710]}}}),Xt=f()((function(){return n.e(807).then(n.bind(n,50807))}),{ssr:!1,loadableGenerated:{webpack:function(){return[50807]}}}),en=f()((function(){return n.e(6959).then(n.bind(n,76959))}),{ssr:!1,loadableGenerated:{webpack:function(){return[76959]}}}),tn=f()((function(){return Promise.all([n.e(2628),n.e(4440)]).then(n.bind(n,44440))}),{ssr:!1,loading:function(){return null},loadableGenerated:{webpack:function(){return[44440]}}}),nn={So11111111111111111111111111111111111111112:{pythId:"SOLUSD",subscriptionId:pt.vQ.SOL},"7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs":{pythId:"ETHUSD",subscriptionId:pt.vQ.ETH},"3NZ9JMVBmGAqocybic2c7LQCJScmgsAZ6vQqTDzcqmJh":{pythId:"BTCUSD",subscriptionId:pt.vQ.BTC}},sn=function(e){var t=e.lastPrice,n=(0,Yt.Z)(),s=n.fromPairTokenInfo,l=n.toPairTokenInfo,r=(0,h.tc)().oraclePrices,a=Jt(),m=V(F.yM),f=(0,i.useMemo)((function(){if(!r)return null;var e=r[l.address];return e?"long"===a?e.increaseLong:e.increaseShort:null}),[r,a,l.address]),g=(0,rt.y)(f),w=(0,d.a)(["ohclvData-24h",l.address,g],(0,o.Z)(c().mark((function e(){var t,n,i,s;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l.address){e.next=2;break}return e.abrupt("return",null);case 2:return t=Math.round(Date.now()/1e3),new URLSearchParams({address:l.address,address_type:"token",type:"30m",time_from:String(t-86400),time_to:String(t)}),e.prev=4,e.next=7,fetch("https://worker.jup.ag/perps-tokens-stats");case 7:return n=e.sent,e.next=10,n.json();case 10:if(i=e.sent,s=i[l.address]){e.next=14;break}return e.abrupt("return",null);case 14:return e.abrupt("return",{lruPrice:s.lruPrice.toFixed(g),high24H:new x.Z(s.high24H),low24H:new x.Z(s.low24H)});case 17:return e.prev=17,e.t0=e.catch(4),e.abrupt("return",null);case 20:case"end":return e.stop()}}),e,null,[[4,17]])}))),{refetchInterval:6e4,initialData:null}).data,b=(0,i.useMemo)((function(){if(!w||!w.lruPrice||!f)return null;var e=function(){var e=w.lruPrice;return new x.Z(f).minus(e).div(e).mul(100)}();return{color:e.gt(0)?"rgba(39, 174, 96, 1)":"rgba(255, 87, 87, 1)",text:e.toFixed(2)+"%"}}),[w,f]),j=ht.SX.tradeVolume.useQuery({mint:l.address}).data,y=(0,i.useMemo)((function(){return null!==t&&void 0!==t?t:f}),[t,f]),N=(0,i.useMemo)((function(){return y?"$"+ne.uf.format(y,g):""}),[g,y]),P=i.useCallback((function(e){m(s,e,a)}),[m,s,a]);return(0,v.jsxs)("div",{className:(0,p.cn)("flex flex-col lg:flex-row lg:items-center justify-between bg-[#131B24] lg:h-[64px] w-full","border-b border-b-v2-lily/10"),children:[(0,v.jsxs)("div",{className:(0,p.cn)("flex flex-col justify-between items-center h-full overflow-x-scroll hideScrollbar pt-2 lg:pt-0"),children:[(0,v.jsx)(Oe,{selectToPair:P,selected:l}),(0,v.jsxs)("div",{className:"mt-2 flex items-center justify-between space-x-3 px-3 py-2 h-10 lg:hidden w-full border-t border-t-v2-lily/5",children:[(0,v.jsx)("div",{className:"flex lg:hidden text-xl text-white font-semibold",children:N&&y?(0,v.jsx)(vt,{price:new x.Z(y),precision:g,children:N}):(0,v.jsx)(O.O,{className:"w-10 h-4 rounded-md"})}),(0,v.jsxs)("div",{className:"flex gap-3",children:[(0,v.jsxs)("div",{className:"flex flex-col text-center",children:[(0,v.jsx)("p",{className:"text-xxs md:text-xs text-white/30 whitespace-nowrap",children:u.ag._("24h Change")}),(0,v.jsx)("div",{className:"text-xs text-white",style:{color:null===b||void 0===b?void 0:b.color},children:null!==b&&void 0!==b&&b.text?b.text:(0,v.jsx)(O.O,{className:"w-10 h-4 rounded-md"})})]}),(0,v.jsxs)("div",{className:"flex flex-col text-center",children:[(0,v.jsx)("p",{className:"text-xxs md:text-xs text-white/30 whitespace-nowrap",children:u.ag._("24h Vol")}),(0,v.jsx)("div",{className:"text-xs text-white",children:j?(0,ne.dN)(j.volume,2):(0,v.jsx)(O.O,{className:"w-10 h-4 rounded-md"})})]})]})]})]}),(0,v.jsxs)("div",{className:(0,p.cn)("hidden lg:flex min-w-[260px] lg:px-3 gap-3 xl:gap-7 pr-3","mt-3 justify-between 2xl:justify-end hideScrollbar","pt-3 lg:mt-0 lg:pt-0 lg:ml-auto border-t border-t-v2-lily/5 lg:border-none"),children:[(0,v.jsx)("div",{className:"hidden lg:flex items-center text-center leading-none font-semibold",children:(0,v.jsx)("div",{className:"text-lg text-white",children:N&&y?(0,v.jsx)(vt,{price:new x.Z(y),precision:g,children:N}):(0,v.jsx)(O.O,{className:"w-10 h-4 rounded-md"})})}),(0,v.jsxs)("div",{className:"flex gap-3 xl:gap-7",children:[(0,v.jsxs)("div",{className:"flex flex-col text-center",children:[(0,v.jsx)("p",{className:"text-xs text-white/30 whitespace-nowrap",children:u.ag._("24h Change")}),(0,v.jsx)("div",{className:"text-xs text-white",style:{color:null===b||void 0===b?void 0:b.color},children:null!==b&&void 0!==b&&b.text?b.text:(0,v.jsx)(O.O,{className:"w-10 h-4 rounded-md"})})]}),(0,v.jsxs)("div",{className:"flex flex-col text-center",children:[(0,v.jsx)("p",{className:"text-xs text-white/30 whitespace-nowrap",children:u.ag._("24h Vol")}),(0,v.jsx)("div",{className:"text-xs text-white",children:j?"$".concat((0,ne.dN)(j.volume,2)):(0,v.jsx)(O.O,{className:"w-10 h-4 rounded-md"})})]}),(0,v.jsxs)("div",{className:"hidden xl:flex flex-col text-center",children:[(0,v.jsx)("p",{className:"text-xs text-white/30 whitespace-nowrap",children:u.ag._("24h High")}),(0,v.jsx)("div",{className:"text-xs text-white",children:null!==w&&void 0!==w&&w.high24H?"$"+ne.uf.format(w.high24H,g):(0,v.jsx)(O.O,{className:"w-10 h-4 rounded-md"})})]}),(0,v.jsxs)("div",{className:"hidden xl:flex flex-col text-center",children:[(0,v.jsx)("p",{className:"text-xs text-white/30 whitespace-nowrap",children:u.ag._("24h Low")}),(0,v.jsx)("div",{className:"text-xs text-white",children:null!==w&&void 0!==w&&w.low24H?"$"+ne.uf.format(w.low24H,g):(0,v.jsx)(O.O,{className:"w-10 h-4 rounded-md"})})]})]})]})]})},ln=function(e){(0,r.Z)(e);var t=(0,h.tc)(),n=t.perpsTokens,s=t.bottomTab,o=t.setBottomTab,a=t.oraclePrices,c=t.userPositions,d=(0,y.Bn)().getTokenInfo,m=(0,Yt.Z)(),f=m.fromPairTokenInfo,p=m.toPairTokenInfo,w=m.isReady,j=Jt(),P=V(F.yM),S=(0,y.C9)(),k=(0,y.gZ)().fetchTokenAccounts;(0,i.useEffect)((function(){f&&p&&k([f.address,p.address])}),[f,p,k,S]);var C=(0,i.useCallback)((function(e){P(f,p,e)}),[f,P,p]),Z=D(),M=function(){var e=(0,i.useState)(!0),t=e[0],n=e[1],s=(0,i.useCallback)((function(){"visible"===document.visibilityState?n(!0):n(!1)}),[]);return(0,i.useEffect)((function(){return document.addEventListener("visibilitychange",s),function(){document.removeEventListener("visibilitychange",s)}}),[s]),t}();(0,pt.Sv)(M),(0,i.useEffect)((function(){if(0!==n.stableTokens.length&&0!==n.nonStableTokens.length)if(Z.find((function(e){return e===f.address}))){var e=n.nonStableTokens.find((function(e){return e.address===p.address}));f.address&&e||P(f.address?f:n.nonStableTokens[0],n.nonStableTokens[0],j)}else P(n.nonStableTokens[0],n.nonStableTokens[0],j)}),[n,p,f,P,j,Z]);var L=(0,i.useState)(null),T=L[0],O=L[1],q=(0,i.useState)(null),A=q[0],I=q[1],U=(0,i.useState)(null),R=U[0],E=U[1],z=(0,i.useState)(null),K=z[0],$=z[1],W=(0,i.useCallback)((function(){$(null)}),[$]),H=(0,i.useCallback)((function(e){var t=e.positionAccountPubkey;O({positionAccountPubkey:t})}),[]),G=(0,i.useCallback)((function(e){var t=e.positionAccountPubkey;I({positionAccountPubkey:t})}),[]),Y=(0,i.useCallback)((function(e){var t=e.positionAccountPubkey,n=e.focusOn;E({positionAccountPubkey:t,focusOn:n})}),[]),J=(0,B.Gc)(),Q=(0,i.useMemo)((function(){return"lg"===J||"xl"===J}),[J]),X=(0,i.useMemo)((function(){return"xs"===J||"sm"===J||"md"===J}),[J]),ee=(0,i.useMemo)((function(){if(!a)return null;var e=a[p.address];return e?"long"===j?e.increaseLong:e.increaseShort:null}),[a,j,p.address]),te=(0,rt.y)(ee),ne=(0,N.Dv)((0,i.useMemo)((function(){var e;return(0,pt.EA)(null===(e=nn[p.address])||void 0===e?void 0:e.subscriptionId)}),[p])),ie=(0,i.useMemo)((function(){return nn[p.address]&&Q&&w&&te>0}),[Q,w,te,p.address]),se=(0,i.useMemo)((function(){return nn[p.address]&&X&&w&&te>0}),[X,w,te,p.address]),le=(0,i.useRef)(null),oe=(0,i.useRef)(null),ae=(0,i.useMemo)((function(){return ie?le:se?oe:void 0}),[ie,se]),ce=(0,dt._)("jupiter-labs-perps-render-position-on-tv",!0),ue=(0,l.Z)(ce,2),de=ue[0],xe=ue[1],me=(0,ft.Me)(),fe=(0,i.useMemo)((function(){return c&&de?c.map((function(e){var t,n=d(e.custody.account.mint.toString());if((null===n||void 0===n?void 0:n.address)!==p.address)return null;var i=new x.Z(e.price).div(1e6).toFixed(te),s="long"===e.side?u.ag._("Long"):u.ag._("Short"),l=[],r=Tt(e),o=r.hasTp,a=r.hasSl;return o&&l.push({id:"tp-".concat(e.side,"-").concat(n.symbol,"-").concat(e.price.toString()),publicKey:e.publicKey.toString(),label:"".concat(null===n||void 0===n?void 0:n.symbol,"-TP"),price:Number(o.toFixed(te)),action:"tp",sizeUsd:e.sizeUsd.div(1e6).toDP(2).toString()}),a&&l.push({id:"sl-".concat(e.side,"-").concat(n.symbol,"-").concat(e.price.toString()),publicKey:e.publicKey.toString(),label:"".concat(null===n||void 0===n?void 0:n.symbol,"-SL"),price:Number(a.toFixed(te)),action:"sl",sizeUsd:e.sizeUsd.div(1e6).toDP(2).toString()}),l.push({id:"lq-".concat(e.side,"-").concat(n.symbol,"-").concat(e.price.toString()),publicKey:e.publicKey.toString(),label:"".concat(null===n||void 0===n?void 0:n.symbol,"-").concat(s,"-Liq."),price:Number(null===(t=e.accounting)||void 0===t?void 0:t.liquidationPrice.div(1e6).toFixed(te)),action:"lq",sizeUsd:e.sizeUsd.div(1e6).toDP(2).toString()}),l.push({id:"".concat(e.side,"-").concat(n.symbol,"-").concat(e.price.toString()),publicKey:e.publicKey.toString(),label:"".concat(null===n||void 0===n?void 0:n.symbol,"-").concat(s),price:Number(i),action:e.side,sizeUsd:e.sizeUsd.div(1e6).toDP(2).toString(),onCloseAction:me}),l})).flat().filter(Boolean):[]}),[d,me,te,de,p.address,c]),pe=(0,i.useMemo)((function(){var e=M?null===ne||void 0===ne?void 0:ne.price:ee;return null!==ne&&void 0!==ne&&ne.price&&p&&e?u.ag._("{0} - {1}",{0:new x.Z(e).toFixed(te),1:p.symbol}):u.ag._("Jupiter Perps")}),[M,null===ne||void 0===ne?void 0:ne.price,ee,p,te]);return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(xt.PB,{title:pe}),T?(0,v.jsx)(_e,{open:Boolean(T),onClose:function(){return O(null)},positionAccountPubkey:T.positionAccountPubkey}):null,A?(0,v.jsx)(re,{open:Boolean(A),onClose:function(){return I(null)},positionAccountPubkey:A.positionAccountPubkey}):null,R?(0,v.jsx)(Gt,{open:Boolean(R),onClose:function(){return E(null)},positionAccountPubkey:R.positionAccountPubkey,focusOn:R.focusOn}):null,K?(0,v.jsx)(tn,{open:Boolean(K),info:K,onClose:W}):null,(0,v.jsx)(en,{}),(0,v.jsxs)("div",{className:"hidden lg:flex flex-1 min-h-full min-w-full",children:[(0,v.jsxs)("div",{className:"flex flex-col w-[calc(100vw-360px)]",children:[(0,v.jsx)(sn,{lastPrice:null===ne||void 0===ne?void 0:ne.price}),ae&&ae.current?(0,mt.createPortal)((0,v.jsx)(Xt,{renderingId:"perps",shadesClassName:"!bg-[#131B24]",datafeedObject:{pythId:nn[p.address].pythId,symbol:nn[p.address].pythId,tickerName:nn[p.address].pythId,subscriptionId:nn[p.address].subscriptionId},opt:{enableVolumeStudy:!1,showVolume:!1,showPriceSource:!1,showBarChange:!1},style:{maxHeight:X?"200px":void 0,background:"#131B24"},positions:fe,hasFocus:M}),ae.current):null,(0,v.jsx)("div",{ref:le,className:"h-screen max-h-[580px] bg-[#131B24] relative"}),(0,v.jsxs)(_,{activeTab:s,setActiveTab:o,showPositions:de,setShowPositions:xe,children:["Positions"===s?(0,v.jsx)(Rt,{onShowEditCollateralDialog:H,onShowCloseConfirmationDialog:G,onShowEditTPSLDialog:Y,setPositionDirection:C,setShowPerpsShareDialog:$}):null,"Trade History"===s?(0,v.jsx)($t,{setPositionDirection:C,setShowPerpsShareDialog:$}):null]})]}),(0,v.jsx)("div",{className:"flex-1 w-[360px] min-w-[360px] lg:max-w-[360px]",children:(0,v.jsx)(ut,{positionDirection:j,setPositionDirection:C,fromPairTokenInfo:f,toPairTokenInfo:p,onShowEditCollateralDialog:H})})]}),(0,v.jsxs)("div",{className:"flex w-full lg:hidden flex-col",children:[(0,v.jsx)(sn,{lastPrice:null===ne||void 0===ne?void 0:ne.price}),(0,v.jsx)("div",{ref:oe,className:"relative"}),(0,v.jsxs)("div",{className:"flex lg:hidden items-center justify-between w-full bg-[#16202B] px-2 py-2",children:[(0,v.jsxs)("div",{className:"flex whitespace-nowrap space-x-2 items-center text-xs text-v2-lily/50",children:[(0,v.jsx)(Qt,{active:de,onClick:function(){return xe((function(e){return!e}))}}),(0,v.jsx)("span",{children:u.ag._("Show Positions on Chart")})]}),(0,v.jsx)(b(),{href:"https://pyth.network/",rel:"noopener noreferrer",target:"_blank",className:"text-v2-lily/50 fill-current text-xxs",children:(0,v.jsx)(g,{width:60,height:20})})]}),(0,v.jsx)("div",{className:"w-full",children:(0,v.jsx)(ut,{positionDirection:j,setPositionDirection:C,fromPairTokenInfo:f,toPairTokenInfo:p,onShowEditCollateralDialog:H})}),(0,v.jsx)("div",{children:(0,v.jsxs)(_,{activeTab:s,setActiveTab:o,showPositions:de,setShowPositions:xe,children:["Positions"===s?(0,v.jsx)(Rt,{onShowEditCollateralDialog:H,onShowCloseConfirmationDialog:G,onShowEditTPSLDialog:Y,setPositionDirection:C,setShowPerpsShareDialog:$}):null,"Trade History"===s?(0,v.jsx)($t,{setPositionDirection:C,setShowPerpsShareDialog:$}):null]})})]})]})},rn=!0,on=function(){return(0,v.jsx)(s.Z,{children:(0,v.jsx)(ln,{})})}},31157:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/perps/[direction]/[inOut]",function(){return n(74222)}])}},function(e){e.O(0,[4508,2420,3215,7821,4518,2351,5516,5010,1672,5288,7179,9774,2888,179],(function(){return t=31157,e(e.s=t);var t}));var t=e.O();_N_E=t}]);
//# sourceMappingURL=[inOut]-e870b58b85a59997.js.map